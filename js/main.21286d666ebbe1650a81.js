(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"2Qx2":function(e,t,o){"use strict";(function(e,n){o.d(t,"a",(function(){return c}));var i=o("W2Rx"),r=o("oj90");const s=o("33yf"),a=o("Iab2");var c={editingPath:e.observable(null),editingName:e.observable("NewFile"),editingType:e.observable("json"),editingFolder:e.observable(null),editingFileFolder:function(e=""){const t=c.editingPath()?c.editingPath():"";return e.length>0?s.join(s.dirname(t),e):s.dirname(t)},tryLoadConfigFile:function(){if(app.configFilePath=s.join(remote.app.getPath("home"),".yarn-story-editor.json"),fs.existsSync(app.configFilePath)&&(app.config=JSON.parse(fs.readFileSync(app.configFilePath)),console.log("Settings loaded from:\n"+app.configFilePath),app.config&&app.config.settings&&app.config.settings.autoSave)){if(app.config.settings.autoSave<.1)return;setInterval((function(){c.editingPath()&&(c.trySaveCurrent(),console.log("Autosaved:\n"+c.editingPath()))}),6e4*app.config.settings.autoSave)}},readFile:function(e,t,o){var n=new FileReader;n.onload=function(i){var s=c.getFileType(t);s==r.a.UNKNOWN?alert("Unknown filetype!"):(c.editingPath(e.path),c.editingType(s),c.loadData(n.result,s,o))},n.readAsText(e)},openFile:function(e,t){c.editingPath()&&!confirm("Are you sure you want to close \n"+c.editingPath()+"\nAny unsaved progress will be lost...")||(c.editingName(t.replace(/^.*[\\\/]/,"")),document.title=e.path?e.path:c.editingName(),c.readFile(e,t,!0),app.refreshWindowTitle(t))},openFolder:function(e,t){editingFolder=t,alert("openFolder not yet implemented e: "+e+" foldername: "+t)},appendFile:function(e,t){c.readFile(e,t,!1)},getFileType:function(e){const t=e.toLowerCase();return t.endsWith(".json")?r.a.JSON:t.endsWith(".yarn.txt")||t.endsWith(".yarn")?r.a.YARN:t.endsWith(".xml")?r.a.XML:t.endsWith(".txt")?r.a.TWEE:t.endsWith(".tw2")||t.endsWith(".twee")?r.a.TWEE2:r.a.UNKNOWN},loadData:function(e,t,o){const n=[];if(t==r.a.JSON){if(!(e=JSON.parse(e)))return;for(let t=0;t<e.length;t++)n.push(e[t])}else if(t==r.a.YARN){var s=e.split(/\r?\n/),a=null,l=0,d=!1;for(let e=0;e<s.length;e++)if("==="===s[e].trim())d=!1,null!=a&&(n.push(a),a=null);else if(d)a.body+=s[e]+"\n";else if(s[e].indexOf("title:")>-1)null==a&&(a={}),a.title=s[e].substr(7,s[e].length-7);else if(s[e].indexOf("position:")>-1){null==a&&(a={});var u=s[e].substr(9,s[e].length-9).split(",");a.position={x:Number(u[0].trim()),y:Number(u[1].trim())}}else s[e].indexOf("colorID:")>-1?(null==a&&(a={}),a.colorID=Number(s[e].substr(9,s[e].length-9).trim())):s[e].indexOf("tags:")>-1?(null==a&&(a={}),a.tags=s[e].substr(6,s[e].length-6)):"---"==s[e].trim()&&(d=!0,a.body="");null!=a&&n.push(a)}else if(t==r.a.TWEE||t==r.a.TWEE2){s=e.split("\n"),a=null,l=0;for(var p=0;p<s.length;p++)if(s[p]=s[p].trim(),"::"==s[p].substr(0,2)){null!=a&&n.push(a),a={};var h="",f="",g={x:80*++l,y:80*l},m=s[p].indexOf("["),y=s[p].indexOf("]");m>0&&y>0&&(f=s[p].substr(m+1,y-m-1));var v=s[p].indexOf("<"),w=s[p].indexOf(">");if(v>0&&w>0){var b=s[p].substr(v+1,w-v-1).split(",");g.x=parseInt(b[0]),g.y=parseInt(b[1])}var x=0;m>0?x=m:v>0&&(x=v),h=(h=x?s[p].substr(3,x-3):s[p].substr(3)).trim(),a.title=h,a.tags=f,a.body="",a.position=g}else null!=a&&(a.body.length>0&&(s[p]+="\n"),a.body+=s[p]);null!=a&&n.push(a)}else if(t==r.a.XML){var k=(new DOMParser).parseFromString(e,"text/xml");if(null!=(e=r.b.xmlToObject(k)))for(p=0;p<e.length;p++)n.push(e[p])}app.nodes.extend({rateLimit:{method:"notifyWhenChangesStop",timeout:250}}),o&&app.nodes.removeAll(),n.forEach((e,t)=>{let o=new i.a({title:e.title,body:e.body,tags:e.tags,colorID:e.colorID,x:parseInt(e.position.x),y:parseInt(e.position.y)});app.nodes.push(o)}),app.nodes.extend({rateLimit:!1});var S=new CustomEvent("yarnLoadedData");S.document=document,S.data=c,S.app=app,window.parent.dispatchEvent(S)},getSaveData:function(e){for(var t="",o=[],n=app.nodes(),i=0;i<n.length;i++)o.push({title:n[i].title(),tags:n[i].tags(),body:n[i].body(),position:{x:n[i].x(),y:n[i].y()},colorID:n[i].colorID()});if(e==r.a.JSON)t=JSON.stringify(o,null,"\t");else if(e==r.a.YARN)for(i=0;i<o.length;i++){t+="title: "+o[i].title+"\n",t+="tags: "+o[i].tags+"\n",t+="colorID: "+o[i].colorID+"\n",t+="position: "+o[i].position.x+","+o[i].position.y+"\n",t+="---\n",t+=o[i].body;var s=o[i].body;s.length>0&&"\n"==s[s.length-1]||(t+="\n"),t+="===\n"}else if(e==r.a.TWEE)for(i=0;i<o.length;i++){var a="";o[i].tags.length>0&&(a=" ["+o[i].tags+"]"),t+=":: "+o[i].title+a+"\n",t+=o[i].body+"\n\n"}else if(e==r.a.TWEE2)for(i=0;i<o.length;i++){a="";o[i].tags.length>0&&(a=" ["+o[i].tags+"]");var c=" <"+o[i].position.x+","+o[i].position.y+">";t+=":: "+o[i].title+a+c+"\n",t+=o[i].body+"\n\n"}else if(e==r.a.XML){for(t+="<nodes>\n",i=0;i<o.length;i++)t+="\t<node>\n",t+="\t\t<title>"+o[i].title+"</title>\n",t+="\t\t<tags>"+o[i].tags+"</tags>\n",t+="\t\t<body>"+o[i].body+"</body>\n",t+='\t\t<position x="'+o[i].position.x+'" y="'+o[i].position.y+'"></position>\n',t+="\t\t<colorID>"+o[i].colorID+"</colorID>\n",t+="\t</node>\n";t+="</nodes>\n"}return t},saveTo:function(e,t,o=null){null!=app.fs&&app.fs.writeFile(e,t,{encoding:"utf-8"},(function(t){c.editingPath(e),o&&o(),t&&alert("Error Saving Data to "+e+": "+t)}))},openFileDialog:function(e,t){e.bind("change",(function(o){t(o.currentTarget.files[0],e.val());var n="";null!=e.attr("nwsaveas")&&(n='nwsaveas="'+e.attr("nwsaveas")+'"'),null!=e.attr("accept")&&(n='accept="'+e.attr("accept")+'"'),e.parent().append('<input type="file" id="'+e.attr("id")+'"  '+n+">"),e.unbind("change"),e.remove()})),e.trigger("click")},saveFileDialog:function(e,t,o){var n=new Blob([o],{type:"text/plain;charset=utf-8"});a(n,c.editingName().replace(/\.[^/.]+$/,"")+"."+t)},insertImageFileName:function(){c.openFileDialog(n("#open-image"),(function(e,t){app.insertTextAtCursor(e.path?e.path:e.name)}))},tryOpenFile:function(){c.openFileDialog(n("#open-file"),c.openFile)},tryLoadFromDropbox:function(e){console.log("fetched from db",e),n.get(e.link,(function(t){var o=c.getFileType(e.name);o==r.a.UNKNOWN?alert("Unknown filetype!"):(c.editingPath(e.link),c.editingType(o),c.editingName(e.name.replace(/\.[^/.]+$/,"")),c.loadData(t,o,!0))}))},trySaveDropbox:function(){const e=c.editingType();if("NewFile"===c.editingName()){var t=prompt("Please enter your name:","NewFile");null===t&&""===t||c.editingName(t)}const o=c.editingName().replace(/\.[^/.]+$/,"")+"."+e,n=c.getSaveData(e),i=r.b.makeTextFile(n);var s={files:[{url:i,filename:o}],success:function(){alert("Success! Files saved to your Dropbox."),c.editingName(o.replace(/\.[^/.]+$/,""))}};Dropbox.save(i,o,s)},tryShareFilePwa:function(e){const t=c.editingType();c.getSaveData(t);var o=[new Blob(["you construct a file..."],{type:"text/plain"})," Same way as you do with blob",new Uint16Array([33])],n=new File(o,"sample.txt",{lastModified:new Date(0),type:"overide/mimetype"});navigator.canShare&&navigator.canShare({files:[n]})?navigator.share({file:[n]}).then(()=>console.log("Successful share")).catch(e=>console.log("Error sharing",e)):console.log("Web Share API is not supported in your browser.")},tryOpenFolder:function(){c.openFileDialog(n("#open-folder"),c.openFolder)},tryAppend:function(){c.openFileDialog(n("#open-file"),c.appendFile)},save:function(){self.editingPath()?self.trySaveCurrent():self.trySave(r.a.JSON)},trySave:function(e){c.editingType(e),c.saveFileDialog(n("#save-file"),e,c.getSaveData(e))},trySaveCurrent:function(){c.editingPath().length>0&&c.editingType().length>0&&c.saveTo(c.editingPath(),c.getSaveData(c.editingType()))},doesFileExist:function(e){return!1}}}).call(this,o("Z1dp"),o("EVdn"))},"5dEm":function(e,t,o){"use strict";(function(e){o.d(t,"a",(function(){return i}));var n=o("oj90");const i=function(t){const o=this;this.canvas=e(".arrows")[0],this.context=o.canvas.getContext("2d"),this.updateArrowsInterval=void 0,this.deferredArrowsDrawInterval=void 0,this.nextArrowsUpdate=Number.NEGATIVE_INFINITY,this.isDrawingArrows=!1,this.selectedNodes=[],this.offset={x:0,y:0},this.isMarqueeEnabled=!1,this.marqueeSelection=[],this.marqueeRect={x1:0,y1:0,x2:0,y2:0},this.marqueeOffset=[0,0],this.onPanLeft=function(){t.transformOrigin[0]+=o.getPanAmount(),t.translate(100)},this.onPanRight=function(){t.transformOrigin[0]-=o.getPanAmount(),t.translate(100)},this.onPanUp=function(){t.transformOrigin[1]+=o.getPanAmount(),t.translate(100)},this.onPanDown=function(){t.transformOrigin[1]-=o.getPanAmount(),t.translate(100)},this.getPanAmount=function(){const e=t.cachedScale||1;return t.input.isShiftDown?100*e:500*e},this.onZoom=function(e,o,i){const r=t.cachedScale,s=i*t.zoomSpeed*t.cachedScale;t.cachedScale=n.b.clamp(t.cachedScale+s,t.zoomLimitMin,t.zoomLimitMax);const a=e-t.transformOrigin[0],c=o-t.transformOrigin[1],l=a-a*(t.cachedScale/r),d=c-c*(t.cachedScale/r);t.transformOrigin[0]+=l,t.transformOrigin[1]+=d,t.translate()},this.onDragStart=function(e){o.offset.x=e.x,o.offset.y=e.y},this.onDragUpdate=function(e){o.isMarqueeEnabled&&t.workspace.onMarqueeEnd(),t.workspace.shiftNodes(e)},this.onDragEnd=function(){},this.onMarqueeStart=function(e){o.isMarqueeEnabled=!0,o.offset.x=e.x,o.offset.y=e.y,o.marqueeSelection=[],o.marqueeOffset[0]=0,o.marqueeOffset[1]=0,o.marqueeRect={x1:0,y1:0,x2:0,y2:0}},this.onMarqueeUpdate=function(e){o.isMarqueeEnabled&&(o.updateMarqueeRect(e),o.selectNodesInsideMarquee())},this.updateMarqueeRect=function(t){t.x>o.offset.x&&t.y<o.offset.y?(o.marqueeRect.x1=o.offset.x,o.marqueeRect.y1=t.y,o.marqueeRect.x2=t.x,o.marqueeRect.y2=o.offset.y):t.x>o.offset.x&&t.y>o.offset.y?(o.marqueeRect.x1=o.offset.x,o.marqueeRect.y1=o.offset.y,o.marqueeRect.x2=t.x,o.marqueeRect.y2=t.y):t.x<o.offset.x&&t.y<o.offset.y?(o.marqueeRect.x1=t.x,o.marqueeRect.y1=t.y,o.marqueeRect.x2=o.offset.x,o.marqueeRect.y2=o.offset.y):(o.marqueeRect.x1=t.x,o.marqueeRect.y1=o.offset.y,o.marqueeRect.x2=o.offset.x,o.marqueeRect.y2=t.y),e("#marquee").css({display:"block",x:o.marqueeRect.x1,y:o.marqueeRect.y1,width:Math.abs(o.marqueeRect.x1-o.marqueeRect.x2),height:Math.abs(o.marqueeRect.y1-o.marqueeRect.y2)})},this.selectNodesInsideMarquee=function(){const n=t.cachedScale;t.nodes().forEach(t=>{const i=o.marqueeSelection.indexOf(t),r=i>=0,s=e(".nodes-holder").offset();(o.marqueeRect.x2-s.left)/n>t.x()&&(o.marqueeRect.x1-s.left)/n<t.x()+t.tempWidth&&(o.marqueeRect.y2-s.top)/n>t.y()&&(o.marqueeRect.y1-s.top)/n<t.y()+t.tempHeight?r||(o.addNodesToSelection(t),o.marqueeSelection.push(t)):r&&(o.removeNodesFromSelection(t),o.marqueeSelection.splice(i,1))})},this.onMarqueeEnd=function(){o.isMarqueeEnabled&&(0==o.marqueeSelection.length&&o.deselectAll(),o.isMarqueeEnabled=!1,o.marqueeSelection=[],o.marqueeRect={x1:0,y1:0,x2:0,y2:0},e("#marquee").css({display:"none",x:0,y:0,width:0,height:0}))},this.shiftNodes=function(e){t.nodes().forEach(n=>{n.x(n.x()+(e.x-o.offset.x)/t.cachedScale),n.y(n.y()+(e.y-o.offset.y)/t.cachedScale)}),o.offset.x=e.x,o.offset.y=e.y,o.updateArrows()},this.startUpdatingArrows=function(){o.stopUpdatingArrows(),o.updateArrowsInterval=setInterval(o.updateArrows,50)},this.stopUpdatingArrows=function(){o.updateArrowsInterval&&(window.clearInterval(o.updateArrowsInterval),o.updateArrowsInterval=void 0)},this.updateArrows=function(){if(o.isDrawingArrows)return;const n=(new Date).getTime();if(n<o.nextArrowsUpdate)return void(o.deferredArrowsDrawInterval||(o.deferredArrowsDrawInterval=window.setTimeout(o.updateArrows,o.nextArrowsUpdate+50-n)));o.isDrawingArrows=!0,o.nextArrowsUpdate=n+50,window.clearInterval(o.deferredArrowsDrawInterval),o.deferredArrowsDrawInterval=void 0;const i=t.nodes(),r=e(".nodes-holder").offset(),s=t.cachedScale,a=3*s,c=8*s,l=6*s,d=[],u=[];o.canvas.width=e(window).width(),o.canvas.height=e(window).height(),o.context.lineWidth=a,o.context.strokeStyle=o.context.fillStyle="rgba(0, 0, 0, 1)";for(let t of i)if(t.halfWidth=e(t.element).width()/2,t.halfHeight=e(t.element).height()/2,t.linkedTo().length){const e=(t.x()+t.halfWidth)*s+r.left,o=(t.y()+t.halfHeight)*s+r.top;for(let n of t.linkedTo()){const t=(n.x()+n.halfWidth)*s+r.left,i=(n.y()+n.halfHeight)*s+r.top,a=Math.sqrt((e-t)*(e-t)+(o-i)*(o-i)),p={x:(t-e)/a,y:(i-o)/a},h=(110+160*(1-Math.max(Math.abs(p.x),Math.abs(p.y))))*s,f={x:e+p.x*h,y:o+p.y*h},g={x:t-p.x*h,y:i-p.y*h};d.push({x1:f.x,y1:f.y,x2:g.x,y2:g.y}),u.push({x1:g.x+10*p.x,y1:g.y+10*p.y,x2:g.x-p.x*c-p.y*l,y2:g.y-p.y*c+p.x*l,x3:g.x-p.x*c+p.y*l,y3:g.y-p.y*c-p.x*l})}}o.context.beginPath();for(let e of d)o.context.moveTo(e.x1,e.y1),o.context.lineTo(e.x2,e.y2);o.context.stroke(),o.context.beginPath();for(let e of u)o.context.moveTo(e.x1,e.y1),o.context.lineTo(e.x2,e.y2),o.context.lineTo(e.x3,e.y3);o.context.fill(),o.isDrawingArrows=!1},this.bringToFront=function(t){const o=e(t),i=n.b.getHighestZ(o.parent());o.css("z-index",i+1)},this.selectAll=function(){o.addNodesToSelection(t.nodes())},this.deselectAll=function(){o.removeNodesFromSelection(t.nodes())},this.addNodesToSelection=function(e){const t=Array.isArray(e)?e:[e];for(let e of t)o.selectedNodes.includes(e)||(o.selectedNodes.push(e),e.setSelected(!0))},this.removeNodesFromSelection=function(e){const t=Array.isArray(e)?e:[e];for(let e of t){const t=o.selectedNodes.indexOf(e);t>=0&&(o.selectedNodes.splice(t,1),e.setSelected(!1))}},this.getSelectedNodes=function(){return 1===o.selectedNodes.length?[o.selectedNodes[0]]:Array.apply(this,o.selectedNodes)},this.warpToNodeByIdx=function(e){o.warpToNode(t.nodes()[e]),t.focusedNodeIdx=e},this.warpToSelectedNodeByIdx=function(e){o.warpToNode(o.getSelectedNodes()[e]),t.focusedNodeIdx=e},this.warpToNode=function(e){e&&o.warpToXY(e.x(),e.y())},this.warpToXY=function(o,n){const i=-o*t.cachedScale,r=-n*t.cachedScale,s=e(window).width()/2,a=e(window).height()/2,c=100*t.cachedScale/2,l=100*t.cachedScale/2;t.transformOrigin[0]=i+s-c,t.transformOrigin[1]=r+a-l,t.translate(100)},this.alignY=function(){const e=t.nodes().filter(e=>e.selected).sort((e,t)=>e.y()>t.y()?1:e.y()<t.y()?-1:0),o=e.shift();e.length?e.forEach((e,t)=>{const n=o.y()+210*(t+1);e.moveTo(o.x(),n)}):alert("Select nodes to align")},this.alignX=function(){const e=t.nodes().filter(e=>e.selected).sort((e,t)=>e.x()>t.x()?1:e.x()<t.x()?-1:0),o=e.shift();e.length?e.forEach((e,t)=>{const n=o.x()+210*(t+1);e.moveTo(n,o.y())}):alert("Select nodes to align")},this.arrangeSpiral=function(){o.getSelectedNodes().forEach((e,t)=>{e.moveTo(Math.cos(.5*t)*(600+30*t),Math.sin(.5*t)*(600+30*t))})},this.sortAlphabetical=function(){const t=o.getSelectedNodes().sort((e,t)=>e.title().localeCompare(t.title()));if(!t.length)return;let n=Math.round(t.length/2),i=0,r=0;const s=e(t[0].element).width()+30,a=e(t[0].element).height()+30;t.forEach((e,o)=>{o%n?i+=1:(r+=1,i=0),1===o&&(r=0),e.moveTo(t[0].x()+i*s,t[0].y()+r*a)}),o.warpToNode(t[0])}}}).call(this,o("EVdn"))},INAQ:function(e,t,o){"use strict";(function(e,n){o.d(t,"a",(function(){return i}));const i=function(t){const o=this,i=Object.freeze({Left:0,Middle:1,Right:2}),r=Object.freeze({Escape:27,Enter:31,Space:32,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,C:67,D:68,O:79,S:83,V:86,W:87,X:88,Y:89,Z:90});this.mouse={x:0,y:0},this.isDragging=!1,this.isScreenTouched=!1,this.isMiddleButtonDown=!1,this.isShiftDown=!1,this.trackMouseEvents=function(){e(".nodes").on("pointerdown",e=>{if(o.isDragging=!0,o.mouse.x=e.pageX,o.mouse.y=e.pageY,o.isMiddleButtonDown=e.button===i.Middle,t.inWorkspace())switch(e.altKey||e.shiftKey||t.workspace.deselectAll(),e.button){case i.Left:t.workspace.onMarqueeStart({x:e.pageX,y:e.pageY});break;case i.Middle:t.workspace.onDragStart({x:e.pageX,y:e.pageY})}}),window.addEventListener("touchstart",()=>{o.isScreenTouched=!0}),e(document).on("pointermove",e=>{o.mouse.x=e.pageX,o.mouse.y=e.pageY}),e(document).on("mousemove touchmove",e=>{if(o.isDragging){t.focusedNodeIdx=-1;const n=o.isScreenTouched&&e.changedTouches?e.changedTouches[0].pageX:e.pageX,i=o.isScreenTouched&&e.changedTouches?e.changedTouches[0].pageY:e.pageY;t.inWorkspace()&&(e.altKey||o.isMiddleButtonDown||o.isScreenTouched?t.workspace.onDragUpdate({x:n,y:i}):t.workspace.onMarqueeUpdate({x:n,y:i}))}}),e(document).on("pointerup",e=>{e.button===i.Middle&&(o.isMiddleButtonDown=!1),o.isDragging=!1,t.inWorkspace()&&(t.workspace.onDragEnd(),t.workspace.onMarqueeEnd())}),e(".nodes").mousewheel(e=>{e.altKey||(e.preventDefault(),t.inWorkspace()&&t.workspace.onZoom(e.pageX,e.pageY,e.deltaY))}),e(document).contextmenu(o=>{const n=e(o.target).hasClass("nodes")||e(o.target).parents(".nodes").length;if(o.button==i.Right&&n){let e=-1*t.transformOrigin[0]/t.cachedScale,n=-1*t.transformOrigin[1]/t.cachedScale;e+=o.pageX/t.cachedScale,n+=o.pageY/t.cachedScale,t.newNodeAt(e,n)}return!n})},this.trackKeyboardEvents=function(){e(document).on("keyup keydown",e=>{o.isShiftDown=e.shiftKey}),e(document).on("keyup",(function(e){if(e.keyCode===r.Space){if(t.inWorkspace()&&e.altKey||t.inEditor()&&!e.altKey)return;t.cachedScale=1;const o=t.workspace.getSelectedNodes(),n=o.length>0,i=n>0?o:t.nodes();++t.focusedNodeIdx,(t.focusedNodeIdx<0||t.focusedNodeIdx>=i.length)&&(t.focusedNodeIdx=0),t.inWorkspace()?n?t.workspace.warpToSelectedNodeByIdx(t.focusedNodeIdx):t.workspace.warpToNodeByIdx(t.focusedNodeIdx):t.inEditor()&&t.editNode(t.nodes()[t.focusedNodeIdx])}})),e(document).on("keydown",e=>{if(t.inWorkspace()){if((e.metaKey||e.ctrlKey)&&e.shiftKey)switch(e.keyCode){case r.S:t.data.trySave(FILETYPE.JSON);break;case r.A:t.data.tryAppend()}if((e.metaKey||e.ctrlKey)&&e.altKey)switch(e.keyCode){case r.S:t.data.trySave(FILETYPE.YARN)}else if(e.metaKey||e.ctrlKey)switch(e.keyCode){case r.C:t.nodeClipboard=t.cloneNodeArray(t.workspace.getSelectedNodes());break;case r.D:t.workspace.deselectAll();break;case r.O:t.data.tryOpenFile();break;case r.S:t.data.save();break;case r.X:t.nodeClipboard=t.cloneNodeArray(t.workspace.getSelectedNodes()),t.deleteSelectedNodes();break;case r.Y:t.historyDirection("redo");break;case r.Z:t.historyDirection("undo")}else e.keyCode!==r.Delete&&"Delete"!==e.key||t.deleteSelectedNodes(),t.$searchField.is(":focus")||e.ctrlKey||e.metaKey||(e.keyCode===r.A||e.keyCode===r.Left?t.workspace.onPanLeft():e.keyCode===r.D||e.keyCode===r.Right?t.workspace.onPanRight():e.keyCode===r.W||e.keyCode===r.Up?t.workspace.onPanUp():e.keyCode!==r.S&&e.keyCode!==r.Down||t.workspace.onPanDown())}}),e(document).on("keyup",e=>{if(t.inWorkspace())if(e.metaKey||e.ctrlKey)switch(e.keyCode){case r.A:t.workspace.selectAll();break;case r.V:t.pasteNodes()}else if(e.keyCode===r.Enter||"Enter"===e.key){const e=t.nodes()[t.focusedNodeIdx];e?t.editNode(e):t.editNode(t.nodes()[0])}}),e(document).on("keydown",(function(e){if(t.inEditor())if(e.metaKey||e.ctrlKey)switch(e.keyCode){case r.Escape:t.saveNode();break;case r.C:o.clipboard=t.editor.getSelectedText();break;case r.X:document.execCommand("copy"),t.clipboard=t.editor.getSelectedText(),sapp.insertTextAtCursor("")}else switch(e.keyCode){case r.Escape:t.saveNode()}})),e(document).on("keyup",(function(e){t.inEditor()&&e.ctrlKey&&e.altKey&&t.saveNode()})),e(document).on("keyup keydown pointerdown pointerup",(function(e){t.inEditor()&&t.updateEditorStats()})),e(document).on("keydown",e=>{if(t.editing()&&!t.previewStory.finished)switch(e.keyCode){case r.Z:t.previewStory.changeTextScrollSpeed(200),-1!=t.previewStory.vnSelectedChoice&&t.previewStory.vnSelectChoice();break;case r.Up:-1!=t.previewStory.vnSelectedChoice&&t.previewStory.vnUpdateChoice(-1);break;case r.Down:-1!=t.previewStory.vnSelectedChoice&&t.previewStory.vnUpdateChoice(1)}})},this.initKnockoutBindings=function(){n.bindingHandlers.preventBubble={init:function(e,t){var o=n.utils.unwrapObservable(t());n.utils.registerEventHandler(e,o,(function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}))}},n.bindingHandlers.mousedown={init:function(t,o,i,r,s){var a=n.unwrap(o());e(t).mousedown((function(){a()}))}}};o.initKnockoutBindings(),o.trackMouseEvents(),o.trackKeyboardEvents()}}).call(this,o("EVdn"),o("Z1dp"))},P0sH:function(e,t,o){"use strict";(function(e,n){o.d(t,"a",(function(){return u}));var i=o("owJe"),r=o("W2Rx"),s=o("5dEm"),a=o("INAQ"),c=o("2Qx2"),l=o("P3rc"),d=o("oj90"),u=function(t,u){const p=this;this.workspace=new s.a(p),this.input=new a.a(p),this.previewStory=new l.a,this.instance=this,this.data=c.a,this.name=e.observable(t),this.version=e.observable(u),this.editing=e.observable(null),this.deleting=e.observable(null),this.nodes=e.observableArray([]),this.tags=e.observableArray([]),this.cachedScale=1,this.nodeHistory=[],this.nodeFuture=[],this.editingHistory=[],this.editingSaveHistoryTimeout=null,this.dirty=!1,this.focusedNodeIdx=-1,this.zoomSpeed=.005,this.zoomLimitMin=.05,this.zoomLimitMax=1,this.transformOrigin=[0,0],this.isElectron=!1,this.editor=null,this.nodeVisitHistory=[],this.clipboard="",this.nodeClipboard=[],this.speachInstance=null,this.selectedLanguageIndex=6,this.language=null,this.configFilePath=null,this.config={nightModeEnabled:!1,spellcheckEnabled:!0,transcribeEnabled:!1,showCounter:!1,autocompleteWordsEnabled:!0,autocompleteEnabled:!0,overwrites:{makeNewNodesFromLinks:!0},settings:{autoSave:-1}},this.editingPath=e.observable(null),this.$searchField=n(".search-field"),this.inEditor=()=>p.editing(),this.inWorkspace=()=>!p.editing(),this.run=function(){var t="Unknown OS";-1!=navigator.platform.indexOf("Win")&&(t="Windows"),-1!=navigator.platform.indexOf("Mac")&&(t="MacOS"),-1!=navigator.platform.indexOf("X11")&&(t="UNIX"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),p.isElectron=navigator.userAgent.toLowerCase().includes("electron"),window.addEventListener("yarnLoadedData",e=>{n(".arrows").css({opacity:0}).transition({opacity:1},500),p.updateNodeLinks()});var o=navigator.userAgent||navigator.vendor||window.opera;let r;/android|iPad|iPhone|iPod/.test(o.toLowerCase())&&!window.MSStream&&(t="mobile"),"Windows"==t&&(p.zoomSpeed=.1);const s=n("#addPwa")[0];s.style.display="none",window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),r=e,s.style.display="block",s.addEventListener("click",e=>{s.style.display="none",r.prompt(),r.userChoice.then(e=>{"accepted"===e.outcome?(console.log("User accepted the A2HS prompt"),s.style.display="none"):console.log("User dismissed the A2HS prompt"),r=null})})}),n("#app").show(),e.applyBindings(p,n("#app")[0]),p.newNode().title("Start"),p.$searchField.on("keyup",(function(e){27==e.keyCode?p.clearSearch():p.searchWarp()})),"mobile"===t&&p.zoom(3),p.isElectron?document.getElementById("dropboxIO").style.display="none":d.b.createDropboxChooser(document.getElementById("dropbox-container"),e=>c.a.tryLoadFromDropbox(e)),p.$searchField.on("input",p.updateSearch),n(".search-title input").click(p.updateSearch),n(".search-body input").click(p.updateSearch),n(".search-tags input").click(p.updateSearch),n(window).on("resize",p.workspace.updateArrows),this.guessPopUpHelper=function(){/^\[color=#([a-zA-Z0-9]{3,6})$/.test(p.getTagBeforeCursor())?p.insertColorCode():p.getTagBeforeCursor().match(/\[img\]/)},this.insertBBcodeTags=function(e){var t="[/"+e.replace(/[\"#=]/gi,"")+"]";"cmd"===e?(e="<<",t=">>"):"opt"===e?(e="[[",t="|]]"):e="["+e+"]";var o=JSON.parse(JSON.stringify(p.editor.selection.getRange()));if(p.editor.session.insert(o.start,e),p.editor.session.insert({column:o.end.column+e.length,row:o.end.row},t),"[color=#]"===e){if(0===p.editor.getSelectedText().length)return p.moveEditCursor(-9),void p.insertColorCode();p.editor.selection.setRange({start:{row:p.editor.selection.getRange().start.row,column:p.editor.selection.getRange().start.column-1},end:{row:p.editor.selection.getRange().start.row,column:p.editor.selection.getRange().start.column-1}}),p.insertColorCode()}else 0===p.editor.getSelectedText().length?p.moveEditCursor(-t.length):p.editor.selection.setRange({start:p.editor.selection.getRange().start,end:{row:p.editor.selection.getRange().end.row,column:p.editor.selection.getRange().end.column-t.length}});p.editor.focus()},this.insertEmoji=function(){this.emPicker.toggle(),p.togglePreviewMode(!0),n("#emojiPicker-container").css({left:p.input.mouse.x-200,top:p.input.mouse.y-125}),n("#emojiPicker-container").show()},this.updateCountry=function(){var e=document.getElementById("select_language");p.selectedLanguageIndex=e.selectedIndex,p.language=d.b.langs[e.selectedIndex][1][0],spoken.recognition.lang=p.language,Object(i.load_dictionary)(p.language.split("-")[0])},this.speakText=function(){const e=p.editor.getSelectedText(),t=e||p.editor.getSession().getValue();spoken.voices().then(e=>{const o=p.language.split("-")[0],n=e.filter(e=>!e.lang.indexOf(o));n.length?(console.log("Loaded voice",n[0]),spoken.say(t,n[0])):spoken.say(t)})},this.startCapture=function(){spoken.listen({continuous:!0}).then(e=>{if(console.log(e),p.editing())p.insertTextAtCursor(e+". "),document.getElementById("speakTextBtnBubble").title="Transcribe";else if("open"===e){console.log("try open...");var t=p.getFirstFoundNode(p.$searchField.val().toLowerCase()).title();console.log("try open:",t),p.openNodeByTitle(t)}else"clear"===e?(p.$searchField.val(""),p.updateSearch()):(p.$searchField.val(e),p.updateSearch());spoken.listen.stop().then(()=>{p.editing()&&(document.getElementById("speakTextBtnBubble").style.visibility="hidden"),this.continueCapture()})}).catch(e=>spoken.listen.stop().then(()=>this.continueCapture()))},this.continueCapture=function(){spoken.delay(500).then(()=>{spoken.recognition.continuous&&p.startCapture()})},this.toglTranscribing=function(){const e=spoken.listen.available();var t=document.getElementById("toglTranscribing"),o=document.getElementById("speakTextBtnBubble");p.config.transcribeEnabled=t.checked,t.checked&&e?(spoken.listen.on.partial(e=>{p.editing()?(o.style.visibility="visible",o.title=`üó£Ô∏è ${e} ü¶ú`):p.$searchField.val(`üó£Ô∏è ${e} ü¶ú`)}),p.startCapture()):(o.style.visibility="hidden",t.checked=!1,spoken.recognition.continuous=!1,spoken.listen.stop())},this.hearText=function(){spoken.listen.available()?(spoken.listen.on.partial(e=>{console.log(e),document.getElementById("speakTextBtnBubble").title=`üó£Ô∏è ${e} ü¶ú`}),spoken.listen().then(e=>{p.insertTextAtCursor(e+" "),document.getElementById("speakTextBtnBubble").title="Transcribe"}).catch(e=>console.warn(e.message))):alert("Speech recognition not avaiilable!")},this.insertColorCode=function(){n("#colorPicker-container").is(":visible")||(n("#colorPicker").spectrum("set",p.editor.getSelectedText()),n("#colorPicker").spectrum("toggle"),n("#colorPicker-container").css({left:p.input.mouse.x-70,top:p.input.mouse.y-50}),n("#colorPicker-container").show(),n("#colorPicker").on("dragstop.spectrum",(function(e,t){p.applyPickerColorEditor(t)})),p.togglePreviewMode(!0))},this.applyPickerColorEditor=function(e){var t=JSON.parse(JSON.stringify(p.editor.selection.getRange()));p.editor.selection.setRange(t);var o=e.toHexString().replace("#","");p.editor.session.replace(t,o),p.editor.selection.setRange({start:p.editor.getCursorPosition(),end:{row:p.editor.getCursorPosition().row,column:p.editor.getCursorPosition().column-o.length}}),p.togglePreviewMode(!0)},document.addEventListener("contextmenu",(function(e){p.editing()&&e.preventDefault()}),!1),n(document).on("pointerup",(function(e){p.editing()&&2===e.button&&p.guessPopUpHelper()})),document.ondragover=document.ondrop=e=>{e.preventDefault()},document.body.ondrop=e=>{var t;for(e.preventDefault(),t=0;t<e.dataTransfer.files.length;t++)c.a.appendFile(e.dataTransfer.files[t],e.dataTransfer.files[t].name,!1)};var a=new CustomEvent("yarnReady");a.document=document,a.data=c.a,a.app=this,window.parent.dispatchEvent(a)},this.getNodesConnectedTo=function(e){var t=[],o=p.nodes();for(var n in o)if(o[n]!=e&&o[n].isConnectedTo(e,!0)){var i=!1;for(var r in t)if(t[r]==o[n]){i=!0;break}i||t.push(o[n])}return t},this.matchConnectedColorID=function(e){var t=p.getNodesConnectedTo(e);for(var o in t)t[o].colorID(e.colorID())},this.quit=function(){p.isElectron},this.validateTitle=function(){var e=document.getElementById("editorTitle").value;p.getOtherNodeTitles().includes(e)||p.titleExistsTwice(e)?(n("#editorTitle").css({color:"red"}),n("#editorTitle").attr("title","Another node has the same title")):(n("#editorTitle").css({color:"#666"}),n("#editorTitle").attr("title",""))},this.refreshWindowTitle=function(e){let t="Yarn - ["+e+"] ";p.isElectron||(document.title=t)},this.recordNodeAction=function(e,t){if(p.nodeFuture.length>0){for(var o=0;o<p.nodeFuture.length;o++){delete p.nodeFuture.pop().node}delete p.nodeFuture,p.nodeFuture=[]}var n={action:e,node:t,lastX:t.x(),lastY:t.y()};"removed"==e&&(n.lastY+=80),p.nodeHistory.push(n)},this.historyDirection=function(e){function t(e){var t=p.nodes.indexOf(e);t>=0&&p.nodes.splice(t,1),p.updateNodeLinks()}var o=null;if(o="undo"==e?p.nodeHistory.pop():p.nodeFuture.pop()){var n=o.action,i=o.node;"undo"==e?("created"==n?(o.lastX=i.x(),o.lastY=i.y(),t(i)):"removed"==n&&p.recreateNode(i,o.lastX,o.lastY),p.nodeFuture.push(o)):("created"==n?p.recreateNode(i,o.lastX,o.lastY):"removed"==n&&t(i),p.nodeHistory.push(o))}},this.recreateNode=function(e,t,o){p.nodes.push(e),e.moveTo(t,o),p.updateNodeLinks()},this.setSelectedColors=function(e){var t=p.workspace.getSelectedNodes();for(var o in t.splice(t.indexOf(e),1),t)t[o].colorID(e.colorID())},this.pasteNodes=function(){p.nodeClipboard.length&&(p.workspace.deselectAll(),p.nodeClipboard.forEach((function(e){var t=new r.a({title:p.getUniqueTitle(e.title()),body:e.body(),tags:e.tags(),colorID:e.colorID(),x:e.createX,y:e.createY});p.nodes.push(t),p.workspace.addNodesToSelection(t),p.recordNodeAction("created",t)})),p.updateNodeLinks())},this.deleteSelectedNodes=function(){var e=p.workspace.getSelectedNodes();for(var t in e)p.workspace.removeNodesFromSelection(e[t]),e[t].remove()},this.cloneNodeArray=function(e){return e.map((function(e){return new r.a({title:e.title(),body:e.body(),tags:e.tags(),colorID:e.colorID(),x:e.x()+10,y:e.y()+10})}))},this.newNode=function(e=!0){var t=new r.a;return p.nodes.push(t),e&&p.updateNodeLinks(),p.recordNodeAction("created",t),t},this.newNodeAt=function(e,t){var o=new r.a;return p.nodes.push(o),o.x(e-100),o.y(t-100),p.updateNodeLinks(),p.recordNodeAction("created",o),o},this.removeNode=function(e){e.selected&&p.deleteSelectedNodes();var t=p.nodes.indexOf(e);t>=0&&(p.recordNodeAction("removed",e),p.nodes.splice(t,1)),p.updateNodeLinks()},this.searchTextInEditor=function(e=!0){e?p.editor.execCommand("find"):p.editor.searchBox&&p.editor.searchBox.hide()},this.showRandomQuote=function(){n.ajax({url:"https://api.forismatic.com/api/1.0/?",dataType:"jsonp",data:"method=getQuote&format=jsonp&lang=en&jsonp=?",success:function(e){alert(e.quoteText+"\n\n-"+e.quoteAuthor)}})},this.editNode=function(e){if(e.active()){p.editing()&&p.editing()!==e&&p.saveNode(!1),e.oldTitle=e.title(),p.editing(e),n(".node-editor").css({opacity:0}).transition({opacity:1},250),n(".node-editor .form").css({y:"-100"}).transition({y:"0"},250),p.editor=ace.edit("editor"),p.editor.navigateFileEnd(),document.getElementById("toglAutocomplete").checked=p.config.autocompleteEnabled,document.getElementById("toglAutocompleteWords").checked=p.config.autocompleteWordsEnabled,document.getElementById("toglSpellCheck").checked=p.config.spellcheckEnabled,document.getElementById("toglTranscribing").checked=p.config.transcribeEnabled,p.toglTranscribing(),document.getElementById("toglNightMode").checked=p.config.nightModeEnabled,p.toggleNightMode(),document.getElementById("toglShowCounter").checked=p.config.showCounter,p.toggleShowCounter(),p.toggleWordCompletion(),p.validateTitle(),n("#colorPicker").spectrum({flat:!0,showButtons:!1,showInput:!0,showPalette:!0,preferredFormat:"hex",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"]],change:function(e){n("#colorPicker-container").is(":visible")&&(app.applyPickerColorEditor(e),n("#colorPicker").spectrum.set(e.toHexString()))},clickoutFiresChange:!0});var t=ace.require("ace/ext/language_tools"),o=d.b.createAutocompleter(["string.llink","string.rlink"],p.getOtherNodeTitles(),"Node Link");t.setCompleters([o]),p.editor.getSession().on("change",(function(e){if("insert"===e.action&&document.getElementById("toglAutocomplete").checked)return void setTimeout(()=>{switch(p.getTagBeforeCursor()){case"[[":p.insertTextAtCursor(" answer: | ]] "),p.moveEditCursor(-4);break;case"<<":p.insertTextAtCursor(" >> "),p.moveEditCursor(-3);break;case"[colo":p.insertTextAtCursor("r=#][/color] "),p.moveEditCursor(-10),p.insertColorCode();break;case"[b":p.insertTextAtCursor("][/b] "),p.moveEditCursor(-5);break;case"[i":p.insertTextAtCursor("][/i] "),p.moveEditCursor(-5);break;case"[img":p.insertTextAtCursor("][/img] "),p.moveEditCursor(-7);break;case"[u":p.insertTextAtCursor("][/u] "),p.moveEditCursor(-5)}},200)})),this.emPicker=new EmojiPicker(document.getElementById("emojiPickerDom"),e=>{p.insertTextAtCursor(e.char),this.emPicker.toggle(),p.togglePreviewMode(!1)});for(var i=document.getElementById("select_language"),r=0;r<d.b.langs.length;r++){var s=document.createElement("option");s.text=d.b.langs[r][0],i.add(s)}i.selectedIndex=p.selectedLanguageIndex,p.language||(p.language="en-US",p.updateCountry()),p.toggleSpellCheck(),p.updateEditorStats()}},this.chooseRelativePathImage=function(e){p.insertTextAtCursor(e)},this.openNodeByTitle=function(e){p.makeNodeWithName(e),app.nodes().forEach(t=>{t.title().trim().toLowerCase()===e.trim().toLowerCase()&&p.editNode(t)})},this.openLastEditedNode=function(){if(0===p.nodeVisitHistory.length)p.saveNode();else{const e=p.nodeVisitHistory.pop();p.propagateUpdateFromNode(p.editing()),p.openNodeByTitle(e)}},this.getSpellCheckSuggestionItems=function(){var e=Object(i.suggest_word_for_misspelled)(p.editor.getSelectedText());if(e){var t={};return e.forEach(e=>{t[e]={name:e,icon:"edit",callback:e=>{p.insertTextAtCursor(e)}}}),t}return!1},this.getThesaurusItems=function(){var e=o("GLdW")(p.editor.getSelectedText());if(!e)return!1;var t=[];if(Object.keys(e).forEach((function(o){e[o].forEach((function(e){t.includes(e)||e===o||t.push(e)}))})),t.length>0){var n={};return t.forEach(e=>{n[e]={name:e,icon:"edit",callback:e=>{p.insertTextAtCursor(e)}}}),n}return!1},this.toggleSpellCheck=function(){var e=document.getElementById("toglSpellCheck");p.config.spellcheckEnabled=e.checked,e.checked?Object(i.enable_spellcheck)():Object(i.disable_spellcheck)()},this.toggleNightMode=function(){var e=document.getElementById("toglNightMode");p.config.nightModeEnabled=e.checked;var t={};t=p.config.nightModeEnabled?{filter:"invert(100%)"}:{filter:"invert(0%)"},n("#app").css(t),n("#app-bg").css(t),n(".tooltip").css(t),n(".node .body").css(t),n(".node-editor .form .editor-container .editor-preview").css(t)},this.toggleShowCounter=function(){var e=document.getElementById("toglShowCounter");p.config.showCounter=e.checked,p.config.showCounter?n(".node-editor .form .bbcode-toolbar .editor-counter").css({display:"initial"}):n(".node-editor .form .bbcode-toolbar .editor-counter").css({display:"none"})},this.toggleWordCompletion=function(){var e=document.getElementById("toglAutocompleteWords");p.config.autocompleteWordsEnabled=e.checked,p.editor.setOptions({enableBasicAutocompletion:p.config.autocompleteWordsEnabled,enableLiveAutocompletion:p.config.autocompleteWordsEnabled})},this.advanceStoryPlayMode=function(e=5){p.previewStory.finished?p.togglePlayMode(!1):(p.previewStory.changeTextScrollSpeed(e),-1!=p.previewStory.vnSelectedChoice&&5===e&&p.previewStory.vnSelectChoice())},this.togglePlayMode=function(e=!1){var t=n(".editor")[0],o=document.getElementById("storyPlayButton"),i=document.getElementById("editor-play");e?(p.togglePreviewMode(!1),t.style.display="none",i.style.display="flex",o.className="bbcode-button disabled",p.previewStory.emiter.on("finished",(function(){p.togglePlayMode(!1)})),p.previewStory.initYarn(JSON.parse(c.a.getSaveData(d.a.JSON)),p.editing().title().trim(),"NVrichTextLabel",!1,"commandDebugLabel")):(p.editor.session.setScrollTop(i.scrollTop),i.style.display="none",t.style.display="flex",o.className="bbcode-button",p.previewStory.terminate(),setTimeout(()=>{p.editing().title()!==p.previewStory.node.title&&p.openNodeByTitle(p.previewStory.node.title),p.editor.focus()},1e3))},this.togglePreviewMode=function(e){var t=n(".editor")[0],o=document.getElementById("editor-preview");e?(p.togglePlayMode(!1),t.style.display="none",o.style.display="block",o.innerHTML=p.editing().textToHtml(p.editing().body(),!0),o.scrollTop=p.editor.renderer.scrollTop):(p.editor.session.setScrollTop(o.scrollTop),o.innerHTML="",o.style.display="none",t.style.display="flex",p.editor.focus(),n("#colorPicker-container").is(":visible")&&n("#colorPicker-container").hide(),n("#emojiPicker-container").is(":visible")&&n("#emojiPicker-container").hide())},this.appendText=function(e){p.editing().body(p.editing().body()+e);var t=p.editor.session.getLength()-1,o=p.editor.session.getLine(t).length;p.editor.gotoLine(t+1,o)},this.moveEditCursor=function(e){var t=p.editor.getCursorPosition();p.editor.gotoLine(t.row+1,t.column+e),p.editor.focus()},this.insertTextAtCursor=function(e){p.editor.session.replace(p.editor.selection.getRange(),""),p.editor.session.insert(p.editor.getCursorPosition(),e),p.editor.focus()},this.getTagBeforeCursor=function(){var e=p.editor.getSelectionRange(),t=e.start.row,o=e.end.column,n=p.editor.session.getLine(t).substring(0,o);if(n){var i=-1!==n.lastIndexOf("[")?n.substring(n.lastIndexOf("["),n.length):"";return"[["===n.substring(n.length-2,n.length)&&(i="[["),"<<"===n.substring(n.length-2,n.length)&&(i="<<"),i}},this.openNodeListMenu=function(e){var t=document.getElementById(e+"HelperMenuFilter").value,o=document.getElementById(e+"HelperMenu");o.innerHTML="",app.nodes().forEach((i,r)=>{if(i.title().toLowerCase().indexOf(t)>=0||0==t.length){var s=document.createElement("span");s.innerHTML=i.title(),n(s).addClass("item "+app.nodes()[r].titleStyles[app.nodes()[r].colorID()]),"link"==e?i.title()!==p.editing().title()&&(s.setAttribute("onclick","app.insertTextAtCursor(' [[Answer:"+i.title()+"|"+i.title()+"]]')"),o.appendChild(s)):"open"==e&&(i.title().toLowerCase().indexOf(t)>=0||0==t.length)&&(s.setAttribute("onclick",`app.openNodeByTitle("${i.title()}")`),s.setAttribute("onmouseover",`app.workspace.warpToNodeByIdx(${p.nodes.indexOf(i)})`),o.appendChild(s))}})},this.saveNode=function(e=!0){const t=p.editing();if(t){const o=n("#editorTitle")[0];p.previewStory.terminate();const i=p.getFutureEditedNodeTitle();o.value=i,t.title(i),t.body(p.trimBodyLinks(t.body().trim())),p.makeNewNodesFromLinks(),p.propagateUpdateFromNode(t),p.workspace.updateArrows();const r=document.getElementById("toglAutocomplete");p.config.autocompleteEnabled=r.checked;const s=document.getElementById("toglAutocompleteWords");p.config.autocompleteWordsEnabled=s.checked,setTimeout(p.updateSearch,600),e&&(n(".node-editor").transition({opacity:0},250),n(".node-editor .form").transition({y:"-100"},250,(function(e){p.editing(null)})))}},this.updateSearch=function(){for(var e=p.$searchField.val().toLowerCase(),t=n(".search-title input").is(":checked"),o=n(".search-body input").is(":checked"),i=n(".search-tags input").is(":checked"),r=0;r<app.nodes().length;r++){var s=app.nodes()[r],a=n(s.element);if(e.length>0&&(t||o||i)){var c=t&&s.title().toLowerCase().indexOf(e)>=0,l=o&&s.body().toLowerCase().indexOf(e)>=0,d=i&&s.tags().toLowerCase().indexOf(e)>=0;c||l||d?(s.active(!0),a.clearQueue(),a.transition({opacity:1},500)):(s.active(!1),a.clearQueue(),a.transition({opacity:.25},500))}else s.active(!0),a.clearQueue(),a.transition({opacity:1},500)}},this.trimBodyLinks=function(e){return e.replace(/\[\[(.+?)\|\s*(.+?)\s*\]\]/g,"[[$1|$2]]")},this.updateNodeLinks=function(){for(let e of p.nodes())e.updateLinks()},this.propagateUpdateFromNode=function(e){var t=[],o=[];for(t.push(e);e=t.pop();)o.includes(e)||(o.push(e),e.updateLinks(),e.linkedTo().forEach(e=>{o.includes(e)||t.push(e)}),e.linkedFrom().forEach(e=>{o.includes(e)||t.push(e)}))},this.updateTagsRepository=function(){p.tags().forEach(e=>e.count=0),p.nodes().forEach(e=>{d.b.uniqueSplit(e.tags()," ").forEach(e=>{const t=p.tags().find(t=>t.text==e);if(t)++t.count;else{const t=(()=>{const e=p.tags().map(e=>e.id);for(let t=1;;++t)if(!e.includes(t))return t})();p.tags.push({id:t,style:"tag-style-"+t,text:e,count:1})}})});let e=app.tags().length;for(;e--;)0===app.tags()[e].count&&app.tags().splice(e,1)},this.makeNewNodesFromLinks=function(){if(this.config&&this.config.overwrites&&!this.config.overwrites.makeNewNodesFromLinks)console.info("Autocreation of new nodes from links is disabled in:\n"+this.configFilePath);else{var e=p.editing().getLinksInNode();if(null!=e)for(var t=0;t<e.length;t++){const n=e[t].trim();var o=220*(t+1);p.makeNodeWithName(n,o)}}},this.makeNodeWithName=function(e,t=220){const o=p.getOtherNodeTitles();e&&e.length>0&&!o.includes(e)&&e!=p.editing().title()&&p.newNodeAt(p.editing().x()+t,p.editing().y()-120).title(e)},this.titleExistsTwice=function(e){return app.nodes().filter(t=>t.title().trim()===e.trim()).length>1},this.getFutureEditedNodeTitle=function(){const e=n("#editorTitle")[0];return p.getUniqueTitle(e.value.trim())},this.getOtherNodeTitles=function(){var e=[];return app.nodes().forEach(t=>{p.editing()&&t.title()===p.editing().title()||e.push(t.title().trim())}),e},this.getHighlightedText=function(e){e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\</g,"&lt;")).replace(/\>/g,"&gt;")).replace(/\&lt;\&lt;(.*?)\&gt;\&gt;/g,'<p class="conditionbounds">&lt;&lt;</p><p class="condition">$1</p><p class="conditionbounds">&gt;&gt;</p>')).replace(/\[\[([^\|]*?)\]\]/g,'<p class="linkbounds">[[</p><p class="linkname">$1</p><p class="linkbounds">]]</p>')).replace(/\[\[([^\[\]]*?)\|([^\[\]]*?)\]\]/g,'<p class="linkbounds">[[</p>$1<p style="color:red"><p class="linkbounds">|</p><p class="linkname">$2</p><p class="linkbounds">]]</p>')).replace(/[^:]\/\/(.*)?($|\n)/g,'<span class="comment">//$1</span>\n')).replace(/\/\*((.|[\r\n])*)?\*\//gm,'<span class="comment">/*$1*/</span>')).replace(/\/\%((.|[\r\n])*)?\%\//gm,'<span class="comment">/%$1%/</span>');var t=n("<div>");return t[0].innerHTML=e,t.find(".comment").each((function(){n(this).find("p").each((function(){n(this).removeClass()}))})),t.find(".linkname").each((function(){var e=n(this).text(),t=!1;for(var o in p.nodes())if(p.nodes()[o].title().toLowerCase()==e.toLowerCase()){t=!0;break}t||n(this).removeClass("linkname")})),e=t[0].innerHTML},this.updateLineNumbers=function(e){for(var t=e.split("\n"),o="",i=0;i<Math.max(1,t.length);i++)(0==i||i<t.length-1||t[i].length>0)&&(o+=i+1+"<br />");n(".editor-container .lines").html(o)},this.zoom=function(e){p.cachedScale=e/4,p.translate(200)},this.translate=function(e){e&&p.workspace.startUpdatingArrows(),n(".nodes-holder").transition({transform:"matrix("+p.cachedScale+",0,0,"+p.cachedScale+","+p.transformOrigin[0]+","+p.transformOrigin[1]+")"},e||0,"easeInQuad",(function(){e&&p.workspace.stopUpdatingArrows(),p.workspace.updateArrows()}))},this.moveNodes=function(e,t){for(var o in p.nodes()){var n=p.nodes()[o];n.moveTo(n.x()+e,n.y()+t)}},this.getFirstFoundNode=function(e){return p.nodes().find(t=>t.title().toLowerCase().includes(e))},this.searchWarp=function(){var e=p.$searchField.val().toLowerCase().trim();if(""===e)p.workspace.warpToNodeByIdx(0);else{const t=p.getFirstFoundNode(e);p.workspace.warpToNodeByIdx(p.nodes.indexOf(t))}},this.clearSearch=function(){p.$searchField.val(""),p.updateSearch()},this.updateEditorStats=function(){var e=p.editor.getSession().getValue(),t=p.editor.getCursorPosition(),o=e.split("\n");n(".editor-counter .character-count").html(e.length),n(".editor-counter .line-count").html(o.length),n(".editor-counter .row-index").html(t.row),n(".editor-counter .column-index").html(t.column)},this.getUniqueTitle=function(e){var t=p.getOtherNodeTitles();if(e&&!t.includes(e))return e;var o=e||"Node",n=2;const i=o.match(/^(.*)(_([0-9]+))$/);if(i&&4===i.length&&(o=i[1],n=Number(i[3])),!t.includes(o))return o;for(;;++n){var r=o+"_"+n;if(!t.includes(r))return r}}}}).call(this,o("Z1dp"),o("EVdn"))},P3rc:function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));const n=o("Wd8k"),i=o("L8pc"),r=new n.Runner,s=o("+qE3").EventEmitter;var a=function(){this.visitedNodes=[];this.node={title:""};let e=new s;this.emiter=e;let t=[];this.commandsPassedLog=t;this.commandPassed="";let o=!0;this.finished=o,this.visitedChapters=[],this.self=this,this.vnChoiceSelectionCursor=">",this.startTimeWait,this.vnSelectedChoice=-1,this.vnTextScrollInterval,this.storyChapter="",this.choices={};let n,a,c,l,d,u,p,h,f=null;this.vnSelectChoice=()=>{(new Date).getTime()-this.startTimeWait<1e3||(this.choices[this.storyChapter].push(l.options[this.vnSelectedChoice]),l.select(this.vnSelectedChoice),this.emiter.emit("choiceMade",l.options[this.vnSelectedChoice]),a="",n=void 0,l=self.goToNext(),this.vnSelectedChoice=-1,this.changeTextScrollSpeed(111))},this.vnUpdateChoice=(e=0)=>{if(this.vnSelectedChoice<0)return;let t=this.vnSelectedChoice+e;t>l.options.length-1?t=0:t<0&&(t=l.options.length-1),this.vnSelectedChoice=t,n=document.createElement("DIV"),l.options.forEach((e,t)=>{const o=document.createElement("DIV");t==this.vnSelectedChoice?o.innerHTML=`${this.vnChoiceSelectionCursor} [${e}]`:o.innerHTML=`${this.vnChoiceSelectionCursor.replace(/.*/gm,"&nbsp;")} [${e}]`,o.onclick=e=>{e.stopPropagation(),this.vnSelectedChoice=t,this.vnUpdateChoice()},o.ondblclick=e=>{e.stopPropagation(),this.vnSelectedChoice=t,this.vnSelectChoice()},o.className="storyPreviewChoiceButton",n.appendChild(o)}),self.updateVNHud()},this.changeTextScrollSpeed=(t=0)=>{if(t!==this.vnTextScrollInterval){if(this.vnTextScrollInterval=t,clearInterval(u),f<0){if(this.isFinishedParsing(l))return void e.emit("finished");if("TextResult"===l.constructor.name)return a=l.text,f=0,void this.changeTextScrollSpeed(220);"OptionsResult"===l.constructor.name&&-1===this.vnSelectedChoice&&(this.vnSelectedChoice=0,this.vnUpdateChoice(),this.startTimeWait=(new Date).getTime())}0!==t&&(u=setInterval(this.scrollUpdateText,t))}},self.goToNext=()=>{const e=d.next().value;if(!this.isFinishedParsing(e))return"TextResult"===e.constructor.name&&e.data&&this.node.title!==e.data.title&&(a="",f=-1,this.node=self.jsonCopy(e.data),this.visitedNodes.push(e.data.title),this.emiter.emit("startedNode",this.node)),e},this.isFinishedParsing=e=>(void 0===e||null===l)&&(o||(o=!0,f=-1),o=!0,o),this.runCommand=()=>{e.emit("commandCall",l.text),t.push(l.text),l=self.goToNext(),this.isFinishedParsing(l)||("TextResult"===l.constructor.name&&(a+="\n"+l.text),"OptionsResult"===l.constructor.name&&(f=-1))},this.scrollUpdateText=()=>{if(!this.isFinishedParsing(l))if(f<0)"CommandResult"===l.constructor.name&&this.runCommand();else if(f>a.length){if("TextResult"===l.constructor.name){if(l=self.goToNext(),this.isFinishedParsing(l))return;"CommandResult"===l.constructor.name?this.runCommand():("TextResult"===l.constructor.name||"OptionsResult"===l.constructor.name)&&(f=-1)}}else"TextResult"===l.constructor.name&&(f+=1,c=a.substring(0,f),self.updateVNHud())},self.updateVNHud=()=>{if("TextResult"===l.constructor.name){for(;c.lastIndexOf("[img]")>c.lastIndexOf("[/img]");)f+=1,c=a.substring(0,f);for(;c.lastIndexOf("[")>c.lastIndexOf("]");)f+=1,c=a.substring(0,f)}document.getElementById(p).innerHTML=i.parse(c)+"<br>",void 0!==n&&document.getElementById(p).appendChild(n)},this.terminate=()=>{try{document.getElementById(p).innerHTML="",document.getElementById(h).innerHTML="",n=void 0,e.removeAllListeners(),this.finished=!0}catch(e){console.warn(e)}},this.initYarn=(t,n,i,s,a)=>{const c=["#f5ff6f","#44fe66","#e00ec0","#e93ecf","#0ec0e0","#3ecfe9","#e4dbcb","#978e7e","#666","#2f919a","deeppink","black","#97E1E9","#576574","#6EA5E0","#9EDE74","#FFE374","#F7A666","#C47862"],l=["__Ã¥ƒ±Ã¥Ã¥Ã°Ã°Ã° Ã°ÕålÃ°Ã°Ã° Ã°ÕålÃ°*Ã°Ã° Ã¥Ã°ƒ±Ã¥Ã¥Ã° Ã°Ã°Õ°| Ã≤‚ñ´Ã≤Õ° Ã≤Ã≤Õ°‚ñ´Ã≤Ã≤Õ°Õ° Ã≤|Ã°Ã°Ã° Ã°, Ã¥Ã°ƒ±Ã¥Ã°Ã° Ã°ÕålÃ°Ã°Ã°Ã°.___","¬∞¬∫¬§√∏,¬∏¬∏,√∏¬§¬∫¬∞`¬∞¬∫¬§√∏,¬∏,√∏¬§¬∞¬∫¬§√∏,¬∏¬∏,√∏¬§¬∫¬∞`¬∞¬∫¬§√∏,¬∏","(===||:::::::::::::::>","¬∏.¬∑¬¥¬Ø`¬∑.¬¥¬Ø`¬∑.¬∏¬∏.¬∑¬¥¬Ø`¬∑.¬∏><(((¬∫>","=^..^=","|==|iiii|>-----"," ¬¶ÃµÃ± ÃµÃ± ÃµÃ± ÃµÃ± ÃµÃ±(Ã¢ Ã°ÃÖÕá‚îîÃÖÕá‚îòÕáÃÖ (‚ñ§8◊õ‚àí‚ó¶","(‚ô•_‚ô•)","Èæ¥‚ÜÄ‚ó°‚ÜÄÈæ¥","‚òÅ ‚ñÖ‚ñí‚ñë‚òº‚Äø‚òº‚ñë‚ñí‚ñÖ ‚òÅ,","‚ñì‚öó_‚öó‚ñì","<:3 )~~~","(‚ïØ¬∞‚ñ°¬∞Ôºâ‚ïØÔ∏µ ‚îª‚îÅ‚îª","‚óè‚ñ¨‚ñ¨‚ñ¨‚ñ¨‡πë€©€©‡πë‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚óè","(/)(√ñ,,,,√ñ)(/)","/)^3^(\\","( . Y . )","< )))) ><","(„Éé‡≤†Áõä‡≤†)„ÉéÂΩ°","d(^o^)b¬∏¬∏‚ô¨¬∑¬Ø¬∑‚ô©¬∏¬∏‚ô™¬∑¬Ø¬∑‚ô´¬∏¬∏","O=('-'Q)","-`·É¶¬¥-","ÀÅ(‚¶ø·¥•‚¶ø)ÀÄ","(‚ï•Ôπè‚ï•)","‚ú≤¬¥*„ÄÇ.‚ùÑ¬®¬Ø`*‚ú≤„ÄÇ‚ùÑ„ÄÇ*„ÄÇ¬®¬Ø`*‚ú≤","‚ñÇ‚ñÉ‚ñÖ‚ñá‚ñà‚ñì‚ñí‚ñë€©€û€©        €©€û€©‚ñë‚ñí‚ñì‚ñà‚ñá‚ñÖ‚ñÉ‚ñÇ","( ‚Ä¢_‚Ä¢)O*¬Ø`¬∑.¬∏.¬∑¬¥¬Ø`¬∞Q(‚Ä¢_‚Ä¢ )","‚îª‚îÅ‚îªÔ∏µ  (¬∞‚ñ°¬∞)/ Ô∏µ ‚îª‚îÅ‚îª","|Ã≤Ã≤Ã≤Õ°Õ°Õ° Ã≤‚ñ´Ã≤Õ° Ã≤Ã≤Ã≤Õ°Õ°œÄÃ≤Ã≤Õ°Õ° Ã≤Ã≤Õ°‚ñ´Ã≤Ã≤Õ°Õ° Ã≤|Ã°Ã°Ã° Ã° Ã¥Ã°ƒ±Ã¥Ã°Ã° Ã°ÕålÃ° Ã¥Ã°ƒ±Ã¥Ã¥Ã° Ã°lÃ°*Ã°Ã° Ã¥Ã°ƒ±Ã¥Ã¥Ã° Ã°Ã°Õ°|Ã≤Ã≤Ã≤Õ°Õ°Õ° Ã≤‚ñ´Ã≤Õ° Ã≤Ã≤Ã≤Õ°Õ°œÄÃ≤Ã≤Õ°Õ° Ã≤Ã≤Õ°‚ñ´Ã≤Ã≤Õ°Õ° |","‚ù§‚ó¶.¬∏¬∏.  ‚ó¶‚úø"," ï òÃÖÕú òÃÖ î","( ‡πè Y ‡πè )"," ï‚Ä¢Õ°Ã´‚Ä¢ ï*Õ°Ã´* ï‚Ä¢Õ°Õì‚Ä¢ î-Õ°Ã´- ï‚Ä¢Õ°Ã´‚Ä¢ î*Õ°Ã´* î-Õ°Ã´- î","(„Å£‚óï‚Äø‚óï)„Å£","‚ùö‚ñà‚ïê‚ïê‚ñà‚ùö","‚îÄ=‚â°Œ£((( „Å§‚óïŸÑÕú‚óï)„Å§","^‚ÜÄ·¥•‚ÜÄ^","‡ºº „Å§ Õ°‚óï —æ Õ°‚óï ‡ºΩ„Å§","·ï¶(√≤_√≥Àá)·ï§","‚î¨‚î¥‚î¨‚î¥‚î§ Õú ñ Õ°¬∞) ‚îú‚î¨‚î¥‚î¨‚î¥","[Ã≤ÃÖ$Ã≤ÃÖ(Ã≤ÃÖ5)Ã≤ÃÖ$Ã≤ÃÖ]","(Íàç‚åìÍàç‚úø)","(‡πë‚Ä¢ÃÅ ‚ÇÉ ‚Ä¢ÃÄ‡πë) ‚ô°","( ‚Ä¢ )( ‚Ä¢ )‘Ö(‚âñ‚å£‚âñ‘Ö)","Ôºà„ÄÇ„ÄÖ¬∞Ôºâ","‚äÇ(¬¥ÔΩ•‚ó°ÔΩ•‚äÇ )‚àòÀöÀ≥¬∞","( „ÖÖ )","(Ôæâ‚òâ„ÉÆ‚öÜ)Ôæâ ‚åí*:ÔΩ•Ôæü‚úß","(Ôºç‚Ä∏·Éö)","(‚Äø|‚Äø)","(„áè(‚Ä¢ÃÄ·µ•·µ•‚Ä¢ÃÅ)„Éé)"," ö‚úü‚Éõ…û","(‚Ä≤ÍàçœâÍàç‚Äµ)","‚ôö ‚ôõ ‚ôú ‚ôù ‚ôû ‚ôü ‚ôî ‚ôï ‚ôñ ‚ôó ‚ôò ‚ôô","(¬¥·¥ó`)(¬¥·¥ó`)","‚ô•(¬¥‚àÄÔΩÄ)","‡∏Ö(Àµ‚óèÔªå‚óèÀµ)‡∏Ö"];h=a,p=i,this.yarnDataObject=t,this.startChapter=n,this.resourcesPath=s,this.finished=!1,document.getElementById(h).innerHTML="<br/><font color='red'>üö•Press/Hold Z or üì±Double-click/Tap to advance</font><br/>",e.on("startedNode",(function(e){document.getElementById(h).innerHTML+="<br/><br/><font color='#581845'>üìú --- Loaded next node ---</font>",document.getElementById(h).innerHTML+=`<font color='${c[Math.floor(Math.random()*c.length)]}'>  ${l[Math.floor(Math.random()*l.length)]}</font>`,document.getElementById(h).innerHTML+="<br/><font color='CADETBLUE'>&ensp;&ensp;&ensp;Title: "+e.title+"</font>",e.tags.length>0&&e.tags[0].length>0&&(document.getElementById(h).innerHTML+="<br/><font color='deeppink'>&ensp;&ensp;&ensp;Tags: "+e.tags+"</font>")})),e.on("choiceMade",(function(e){document.getElementById(h).innerHTML+="<br/><font color='fuchsia'>üêôPlayer chose: >"+e+"</font>"})),e.on("commandCall",(function(e){document.getElementById(h).innerHTML+=`<br/><font color='green'>üê£Command call:</font> <font color='red'>&lt;&lt;${e}&gt;&gt;</font>`})),e.on("finished",(function(){o=!0,e.removeAllListeners()})),r.load(t),this.loadYarnChapter(n)},this.loadYarnChapter=e=>{o=!1,this.storyChapter=e,this.choices[this.storyChapter]=[],this.visitedChapters.push(e),d=r.run(e),l=self.goToNext(),a=l.text,this.changeTextScrollSpeed(100)},this.wasChoiceMade=(e,t=this.storyChapter)=>!!this.choices[t].includes(e),this.timesNodeWasVisited=e=>{let t=0;return this.visitedNodes.forEach((o,n)=>{o===e&&(t+=1)}),t},self.jsonCopy=e=>JSON.parse(JSON.stringify(e))}},Q0t6:function(e,t){function o(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}o.keys=function(){return[]},o.resolve=o,e.exports=o,o.id="Q0t6"},W2Rx:function(e,t,o){"use strict";(function(e,n){o.d(t,"a",(function(){return c}));var i=o("2Qx2"),r=o("oj90"),s=0;const a=o("L8pc");var c=function(t={}){var o=this;this.titleStyles=["title-style-1","title-style-2","title-style-3","title-style-4","title-style-5","title-style-6","title-style-7","title-style-8","title-style-9"],this.index=e.observable(s++),this.title=e.observable(t.title||app.getUniqueTitle()),this.tags=e.observable(t.tags||""),this.body=e.observable(t.body||"Empty Text"),this.active=e.observable(t.active||!0),this.tempWidth=null,this.tempHeight=null,this.tempOpacity=null,this.style=null,this.colorID=e.observable(t.colorID||0),this.checked=!1,this.selected=!1,this.createX=t.x||null,this.createY=t.y||null,this.clippedTags=e.computed((function(){return app.updateTagsRepository(),r.b.uniqueSplit(o.tags()," ").map(e=>app.tags().find(t=>t.text===e)).filter(e=>e)}),this),this.textToHtml=function(e,t=!1){var o=1,n=t?'<font color="pink">'+o+".   </font>"+e:e;return n=(n=(n=(n=(n=(n=n.replace(/\[\[[^\[]+\]\]/gi,(function(e){const t=e.match(/\[\[(.*)\]\]/i);if(t.length>1)return'<font color="tomato">(go:'+t[1]+")</font>"}))).replace(/<</gi,"<font color='violet'>(run:")).replace(/>>/gi,")</font>")).replace(/\[color=#[A-Za-z0-9]+\]/gi,(function(e){const t=e.match(/\[color=#([A-Za-z0-9]+)\]/i);if(t&&t.length>1)return"[color=#"+t[1]+"]<font color=#"+t[1]+">&#9751</font>"}))).replace(/\[img\][^\[]+\[\/img\]/gi,(function(e){const o=e.match(/\[img\](.*)\[\/img\]/i);if(o.length>1){const e=i.a.editingFileFolder(o[1]);return i.a.doesFileExist(e)?t?'<img src="'+e+'"> </img>':'<img src="'+e+'" width="128" height="auto"> </img>':t?'<img src="'+o[1]+'"> </img>':'<img src="'+o[1]+'" width="128" height="auto"> </img>'}}))).replace(/[\n\r]/g,(function(e){var n="<br/>";return o+=1,t&&(n+='<font color="pink">'+o+".   </font>"),n})),n=a.parse(n)},this.clippedBody=e.computed((function(){if(!app.editing()){var e=app.getHighlightedText(this.body());return e=(e=o.textToHtml(e)).substr(0,1024)}}),this),this.linkedTo=e.observableArray(),this.linkedFrom=e.observableArray(),this.element=null,this.canDoubleClick=!0,this.create=function(){if(o.style=window.getComputedStyle(n(o.element).get(0)),o.createX&&o.createY)o.x(o.createX),o.y(o.createY);else{var e=n(o.element).parent();o.x(-e.offset().left+n(window).width()/2-100),o.y(-e.offset().top+n(window).height()/2-100)}app.workspace.bringToFront(o.element),app.workspace.startUpdatingArrows(),n(o.element).css({opacity:0,scale:.8,y:"-=80px",rotate:"45deg"}).transition({opacity:1,scale:1,y:"+=80px",rotate:"0deg"},250,"easeInQuad",(function(){app.workspace.stopUpdatingArrows(),app.workspace.updateArrows()})),o.drag(),n(o.element).on("dblclick",(function(){o.canDoubleClick&&app.editNode(o)})),r.b.addDoubleTapDetector(o.element,(function(){o.canDoubleClick&&app.editNode(o)})),n(o.element).on("click",(function(e){e.ctrlKey&&(o.selected?app.workspace.removeNodesFromSelection(o):app.workspace.addNodesToSelection(o))}))},this.setSelected=function(e){o.selected=e,o.selected?n(o.element).addClass("selected"):n(o.element).removeClass("selected")},this.toggleSelected=function(){o.setSelected(!o.selected)},this.x=function(e){return null!=e&&n(o.element).css({x:Math.floor(e)}),Math.floor(new WebKitCSSMatrix(o.style.webkitTransform).m41)},this.y=function(e){return null!=e&&n(o.element).css({y:Math.floor(e)}),Math.floor(new WebKitCSSMatrix(o.style.webkitTransform).m42)},this.resetDoubleClick=function(){o.canDoubleClick=!0},this.tryRemove=function(){o.active()&&app.deleting(this),setTimeout(o.resetDoubleClick,500),o.canDoubleClick=!1},this.cycleColorDown=function(){o.doCycleColorDown(),setTimeout(o.resetDoubleClick,500),o.canDoubleClick=!1,app.input.isShiftDown&&app.matchConnectedColorID(o),o.selected&&app.setSelectedColors(o)},this.cycleColorUp=function(){o.doCycleColorUp(),setTimeout(o.resetDoubleClick,500),o.canDoubleClick=!1,app.input.isShiftDown&&app.matchConnectedColorID(o),o.selected&&app.setSelectedColors(o)},this.doCycleColorDown=function(){o.colorID(o.colorID()-1),o.colorID()<0&&o.colorID(8)},this.doCycleColorUp=function(){o.colorID(o.colorID()+1),o.colorID()>8&&o.colorID(0)},this.remove=function(){n(o.element).transition({opacity:0,scale:.8,y:"-=80px",rotate:"-45deg"},250,"easeInQuad",(function(){app.removeNode(o),app.workspace.updateArrows()})),app.deleting(null)},this.drag=function(){var e=!1,t=!1,i=[0,0];n(document.body).on("mousemove touchmove",(function(n){if(e){const e=app.input.isScreenTouched&&n.changedTouches?n.changedTouches[0].pageX:n.pageX,u=app.input.isScreenTouched&&n.changedTouches?n.changedTouches[0].pageY:n.pageY;var r=e/o.getScale()-i[0],s=u/o.getScale()-i[1],a=r-o.x(),c=s-o.y();if(o.x(r),o.y(s),t){var l=[];if(o.selected?(l=app.workspace.getSelectedNodes()).splice(l.indexOf(o),1):l=app.getNodesConnectedTo(o),l.length>0)for(var d in l)l[d].x(l[d].x()+a),l[d].y(l[d].y()+c)}app.workspace.updateArrows()}})),n(o.element).on("pointerdown",(function(r){if(!e&&o.active()){n(o.element).parent();e=!0,(app.input.isShiftDown||o.selected)&&(t=!0),i[0]=r.pageX/o.getScale()-o.x(),i[1]=r.pageY/o.getScale()-o.y()}})),n(o.element).on("pointerdown",(function(e){e.stopPropagation()})),n(o.element).on("pointerup touchend",(function(o){e=!1,t=!1}))},this.moveTo=function(e,t){app.workspace.startUpdatingArrows(),n(o.element).clearQueue(),n(o.element).transition({x:e,y:t},app.stopUpdatingArrows,500)},this.isConnectedTo=function(e,t){if(t&&e.isConnectedTo(o,!1))return!0;var n=o.linkedTo();for(var i in n){if(n[i]==e)return!0;if(n[i].isConnectedTo(e,!1))return!0;if(e.isConnectedTo(n[i],!1))return!0}return!1},this.getLinksInNode=function(e){var t=(e||o).body().match(/\[\[(.*?)\]\]/g);if(null!=t){for(var n={},i=t.length-1;i>=0;i--)t[i]=t[i].substr(2,t[i].length-4).trim(),t[i].indexOf("|")>=0&&(t[i]=t[i].split("|")[1]),null!=n[t[i]]&&t.splice(i,1),n[t[i]]=!0;return t}},this.updateLinks=function(){o.resetDoubleClick(),o.updateLinksFromParents(),o.updateLinksToChildren()},this.updateLinksFromParents=function(){o.oldTitle&&o.oldTitle!==o.title()&&(o.linkedFrom.removeAll(),app.nodes().forEach(e=>{var t=o.getLinksInNode(e);if(t&&t.includes(o.oldTitle)){var n=RegExp("\\|\\s*"+o.oldTitle+"\\s*\\]\\]","g"),i=e.body().replace(n,"|"+o.title()+"]]");e.body(i),o.linkedFrom.push(e)}}),o.oldTitle=void 0)},this.updateLinksToChildren=function(){o.linkedTo.removeAll();var e=o.getLinksInNode();if(e)for(var t in app.nodes())for(var n=app.nodes()[t],i=0;i<e.length;i++)n!=o&&n.title().trim()===e[i].trim()&&o.linkedTo.push(n)},this.getScale=function(){return app&&"number"==typeof app.cachedScale?app.cachedScale:1}};e.bindingHandlers.nodeBind={init:function(e,t,o,n,i){i.$rawData.element=e,i.$rawData.create()},update:function(e,t,o,i,r){n(e).on("pointerdown",(function(){app.workspace.bringToFront(e)}))}}}).call(this,o("Z1dp"),o("EVdn"))},e6Wu:function(e,t,o){"use strict";o.r(t);o("hZTp");var n=o("uvWk"),i=o("0h2I"),r=o.n(i),s=(o("5uVa"),o("si6p"),o("bU/s")),a=o.n(s),c=(o("A8C4"),o("VEX6"),o("jF1P"),o("YhK8"),o("Ab/9"),o("KDOe"),o("XfCI"),o("P0sH")),l=o("pLxK");n.install(),window.ko=r.a,window.$=window.jQuery=o("EVdn"),window.ace=a.a,a.a.config.set("basePath","public"),window.define=a.a.define,window.app=new c.a("Yarn",l.a),window.app.run()},hZTp:function(e,t,o){},jF1P:function(e,t,o){(function(e){var t,o;t={},o=0,e.bindingHandlers.ace={init:function(n,i,r,s,a){var c=r().aceOptions||{},l=e.utils.unwrapObservable(i());n.id||(n.id="knockout-ace-"+o,o+=1);var d=ace.edit(n.id);c.theme&&d.setTheme("ace/theme/"+c.theme),c.mode&&d.getSession().setMode("ace/mode/"+c.mode),d.setValue(l),d.gotoLine(0),d.setShowPrintMargin(!1),d.getSession().setUseWrapMode(!0),d.getSession().on("change",(function(t){e.isWriteableObservable(i())&&i()(d.getValue())})),t[n.id]=d,e.utils.domNodeDisposal.addDisposeCallback(n,(function(){try{d.destroy()}catch(e){}delete t[n.id]}))},update:function(o,n,i,r,s){var a=e.utils.unwrapObservable(n()),c=o.id;if(void 0!==c&&""!==c&&t.hasOwnProperty(c)){var l=t[c];l.getValue()!==a&&(l.setValue(a),l.gotoLine(0))}}},e.aceEditors={resizeAll:function(){for(var e in t)t.hasOwnProperty(e)&&t[e].resize()},get:function(e){return t[e]}}}).call(this,o("Z1dp"))},oj90:function(e,t,o){"use strict";(function(e){o.d(t,"a",(function(){return n})),o.d(t,"b",(function(){return i}));var n={JSON:"json",XML:"xml",TWEE:"twee",TWEE2:"tw2",UNKNOWN:"none",YARN:"yarn"},i={createAutocompleter:function(e,t,o,n=1){return{getCompletions:function(i,r,s,a,c){var l=i.session.getTokenAt(s.row,s.column);a.length<n||!e.includes(l.type)?c(null,[]):c(null,t.map((function(e){return{caption:e,value:e,meta:o}})))}}},addDoubleTapDetector:function(e,t){e.lastTap=0,e.tapTimeout=0,e.addEventListener("touchend",(function(o){var n=(new Date).getTime(),i=n-e.lastTap;clearTimeout(e.tapTimeout),i<500&&i>0?(t(),o.preventDefault()):e.tapTimeout=setTimeout((function(){clearTimeout(e.tapTimeout)}),500),e.lastTap=n}))},uniqueSplit:function(e,t=" "){return[...new Set(e.split(t).filter(e=>e))]},getHighestZ:function(t){let o=Number.NEGATIVE_INFINITY;return e(t).children().each((function(){let t=parseInt(e(this).css("z-index"))||0;t>o&&(o=t)})),o},clamp:function(e,t,o){return Math.max(Math.min(e,o),t)},stripHtml:function(e){for(;e.indexOf("<")>=0;)e=e.replace("<","&lt;");for(;e.indexOf(">")>=0;)e=e.replace(">","&gt");return e},xmlToObject:function(e){var t=[];if((e=e.childNodes.item(0)).hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o);if(n.hasChildNodes()){for(var i={},r=!1,s=0;s<n.childNodes.length;s++){var a=n.childNodes.item(s);if("#text"!=a.nodeName&&(r=!0,a.hasChildNodes()?i[a.nodeName]=a.childNodes.item(0).nodeValue:i[a.nodeName]="",a.attributes.length>0)){i[a.nodeName]={};for(var c=0;c<a.attributes.length;c++){var l=a.attributes.item(c);i[a.nodeName][l.nodeName]=l.nodeValue}}}r&&t.push(i)}}return t},now:Date.now||function(){return(new Date).getTime()},langs:[["Afrikaans",["af-ZA"]],["Bahasa Indonesia",["id-ID"]],["Bahasa Melayu",["ms-MY"]],["Catal√†",["ca-ES"]],["ƒåe≈°tina",["cs-CZ"]],["Deutsch",["de-DE"]],["English",["en-AU","Australia"],["en-CA","Canada"],["en-IN","India"],["en-NZ","New Zealand"],["en-ZA","South Africa"],["en-GB","United Kingdom"],["en-US","United States"]],["Espa√±ol",["es-AR","Argentina"],["es-BO","Bolivia"],["es-CL","Chile"],["es-CO","Colombia"],["es-CR","Costa Rica"],["es-EC","Ecuador"],["es-SV","El Salvador"],["es-ES","Espa√±a"],["es-US","Estados Unidos"],["es-GT","Guatemala"],["es-HN","Honduras"],["es-MX","M√©xico"],["es-NI","Nicaragua"],["es-PA","Panam√°"],["es-PY","Paraguay"],["es-PE","Per√∫"],["es-PR","Puerto Rico"],["es-DO","Rep√∫blica Dominicana"],["es-UY","Uruguay"],["es-VE","Venezuela"]],["Euskara",["eu-ES"]],["Fran√ßais",["fr-FR"]],["Galego",["gl-ES"]],["Hrvatski",["hr_HR"]],["IsiZulu",["zu-ZA"]],["√çslenska",["is-IS"]],["Italiano",["it-IT","Italia"],["it-CH","Svizzera"]],["Magyar",["hu-HU"]],["Nederlands",["nl-NL"]],["Norsk bokm√•l",["nb-NO"]],["Polski",["pl-PL"]],["Portugu√™s",["pt-BR","Brasil"],["pt-PT","Portugal"]],["Rom√¢nƒÉ",["ro-RO"]],["Slovenƒçina",["sk-SK"]],["Suomi",["fi-FI"]],["Svenska",["sv-SE"]],["T√ºrk√ße",["tr-TR"]],["–±—ä–ª–≥–∞—Ä—Å–∫–∏",["bg-BG"]],["P—É—Å—Å–∫–∏–π",["ru-RU"]],["–°—Ä–ø—Å–∫–∏",["sr-RS"]],["ÌïúÍµ≠Ïñ¥",["ko-KR"]],["‰∏≠Êñá",["cmn-Hans-CN","ÊôÆÈÄöËØù (‰∏≠ÂõΩÂ§ßÈôÜ)"],["cmn-Hans-HK","ÊôÆÈÄöËØù (È¶ôÊ∏Ø)"],["cmn-Hant-TW","‰∏≠Êñá (Âè∞ÁÅ£)"],["yue-Hant-HK","Á≤µË™û (È¶ôÊ∏Ø)"]],["Êó•Êú¨Ë™û",["ja-JP"]],["Lingua latƒ´na",["la"]]],createDropboxChooser:function(e,t){if(e){var o={success:function(e){e.forEach((function(e){t(e)}))},cancel:function(){},linkType:"direct",multiselect:!1},n=Dropbox.createChooseButton(o);e.appendChild(n)}},makeTextFile:function(e){return"data:text/plain;charset=utf-11,"+encodeURIComponent(e)}}}).call(this,o("EVdn"))},owJe:function(e,t,o){(function(e){var n=o("jXEy"),i="public/dictionaries/en/index.dic",r="public/dictionaries/en/index.aff";e("<style type='text/css'>.ace_marker-layer .misspelled { position: absolute; z-index: -2; border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head"),e("<style type='text/css'>.misspelled { border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head");var s=null;function a(e){var t=e.split(/\s+|\.|\,|\?|\\|\/|\!|\[|\]|"|'|;|:|`|\+|\-|\&|\$|@|~|#|>|<|_|\)|\(|¬£|\^|%|\*|‚Äû|‚Äú|\||[0-9]+/g),o=0,n=[];for(word in t){var i=t[word];s.correct(i)||(n[n.length]=[o,o+t[word].length]),o+=t[word].length+1}return n}t.load_dictionary=function(t){console.info(`Loading ${t} hunspell dictionary locally`),i=`public/dictionaries/${t}/index.dic`,r=`public/dictionaries/${t}/index.aff`,e.get(i,(function(e){dicData=e})).fail((function(){console.error(`${t} not found locally. Loading dictionary from server instead...`),i=`https://raw.githubusercontent.com/wooorm/dictionaries/master/dictionaries/${t}/index.dic`,r=`https://raw.githubusercontent.com/wooorm/dictionaries/master/dictionaries/${t}/index.aff`,e.get(i,(function(e){dicData=e})).done((function(){e.get(r,(function(e){affData=e})).done((function(){console.log("Dictionary loaded from server"),s=new n(affData,dicData),c=!0,u()}))}))})).done((function(){e.get(r,(function(e){affData=e})).done((function(){console.log("Dictionary loaded locally"),s=new n(affData,dicData),c=!0,u()}))}))},t.misspelled=a;var c=!0,l=!1,d=[];function u(){if(null!=s&&!l&&c){l=!0;var e=ace.edit("editor").getSession();h();try{var t=ace.require("ace/range").Range,o=e.getDocument().getAllLines();for(var n in o){var i=a(o[n]);for(var r in i){var u=new t(n,i[r][0],n,i[r][1]);d[d.length]=e.addMarker(u,"misspelled","typo",!0)}}}finally{l=!1,c=!1}}}t.spell_check=u;var p=!1;function h(){var e=ace.edit("editor").getSession();for(var t in d)e.removeMarker(d[t]);d=[];var o=e.getDocument().getAllLines();for(var t in o)e.removeGutterDecoration(t,"misspelled")}t.enable_spellcheck=function(){p=!0,ace.edit("editor").getSession().on("change",(function(e){p&&(c=!0,u())})),c=!0,u()},t.disable_spellcheck=function(){p=!1,h()},t.clear_spellcheck_markers=h,t.suggest_word_for_misspelled=function(e){var t=s.suggest(e);return 0!==t.length&&t}}).call(this,o("EVdn"))},pLxK:function(e){e.exports=JSON.parse('{"a":"0.4.5"}')}},[["e6Wu",1,2]]]);