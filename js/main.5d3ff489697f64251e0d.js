(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"+NoZ":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return a}));const i=n("HSUl"),o=function(e="my-db",t="preferences"){return{dbName:e,objectStoreName:t,db:void 0,save:async function(e,t){const n=this.db.transaction(this.objectStoreName,"readwrite");return n.objectStore(this.objectStoreName).put({key:e,value:t}),n.complete},load:async function(e){const t=this.db.transaction(this.objectStoreName,"readonly").objectStore(this.objectStoreName),n=await t.get(e);return n&&n.value},openDatabase:function(){return i.openDB(e,1,{upgrade:e=>{e.createObjectStore(this.objectStoreName,{keyPath:"key"})}})},getDbValue:function(e=this.dbName){return this.openDatabase().then(t=>(this.db=t,this.load(e)))}}},s={JSON:"json",XML:"xml",TWEE:"twee",TWEE2:"tw2",UNKNOWN:"none",YARN:"yarn",INK:"ink",INKJSON:"ink.json",RENPY:"rpy"},r=e=>{if(!e)return s.UNKNOWN;const t=e.toLowerCase();return t.endsWith(".json")?s.JSON:t.endsWith(".yarn.txt")?s.YARN:t.endsWith(".ink")?s.INK:t.endsWith(".yarn")?s.YARN:t.endsWith(".xml")?s.XML:t.endsWith(".txt")?s.TWEE:t.endsWith(".tw2")||t.endsWith(".twee")?s.TWEE2:s.UNKNOWN},a=(e="gist")=>"gist"===e?{getFileType:r,FILETYPE:s,lastStorageHost:"GIST",fileType:s.UNKNOWN,fileHandle:void 0,writable:void 0,saveAsFile:async function(e,t){return new Promise(async(n,i)=>{const o=await window.showSaveFilePicker({suggestedName:e,types:[{description:"Yarn editor files",accept:{"text/plain":Object.values(s).map(e=>"."+e)}}]});this.fileHandle=o;const a=o.name,l=r(a);this.fileType=l;const d=await t(l),c=await o.createWritable();this.writable=c,await c.write(d),await c.close(),console.log({fileHandle:o,writable:c}),n({type:l,content:d,chosenFileName:a,fileHandle:o,writable:c})})},downloadContent:function(e,t){const n=new File([e],t,{type:"text/plain"}),i=document.createElement("a"),o=URL.createObjectURL(n);i.href=o,i.download=n.name,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o)},saveToCurrentFile:async function(e,t){if(console.log({writable:this.writable,handle:this.fileHandle}),this.fileHandle){const t=await this.fileHandle.createWritable();await t.write(e),await t.close()}else this.downloadContent(e,t)},openFileOrFiles:async function(e=!1){const t="showOpenFilePicker"in window;let n;if(console.log({supportsFileSystemAccess:t}),t){try{const t=await showOpenFilePicker({multiple:e});e||(this.fileHandle=t[0],n=t[0],console.log({fileOrFiles:n}))}catch(e){"AbortError"!==e.name&&console.error(e.name,e.message)}return await n.getFile()}return new Promise(t=>{const n=document.createElement("input");n.style.display="none",n.type="file",document.body.append(n),e&&(n.multiple=!0),n.addEventListener("change",()=>{n.remove(),n.files&&t(e?n.files:n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})},fileName:"",openLocalFile:function(){return this.openFileOrFiles().then(e=>(this.fileType=r(e.name),this.fileName=e.name,this.lastStorageHost="LOCAL",e.text()))},setLastStorageHost:function(e){this.lastStorageHost=e},token:void 0,isTokenInvalid:!0,gistId:void 0,setCredentials:function(e,t){this.token=e,this.gistId=t,this.isTokenInvalid=!e||e.length<5},filesInGist:{},getFilesInGist:function(e){return e?e in this.filesInGist?this.filesInGist[e]:void console.error(e+" not found in gist",this.filesInGist):this.filesInGist},getGistHeaders:function(){return{Accept:"application/vnd.github+json",Authorization:"Bearer "+this.token,"X-GitHub-Api-Version":"2022-11-28"}},getGist:function(e,t=(()=>{})){if(!e)throw new Error("No gist id specified");const n="https://api.github.com/gists/"+e;return fetch(n,{method:"GET",headers:this.getGistHeaders()}).then(e=>{if(console.log("GOT -- ",{data:e}),!1===e.ok){const i={401:"Is your Gist Token valid?",404:"Is your Gist ID online?\n\naddress:\n"+n};return console.error("GOT -- ",{data:e,fetchAddress:n,data:e}),t(`Failed to get:\n${n}...\n\nSTATUS: ${e.status}\n${e.status in i?i[e.status]:""}`),e.status in i&&t(e.status),404===e.status&&window.open(n,"_blank").focus(),fetch(n).then(e=>(console.warn("Got data without authorisation"),this.isTokenInvalid=!0,e.json()))}return this.isTokenInvalid=!1,e.json()}).then(e=>{console.log("NEW from get::",{content:e}),this.filesInGist=e.files||{};const t={};return Object.keys(this.filesInGist).forEach(e=>{t[e]=e}),this.setLastStorageHost("GIST"),{body:e,filesInGist:this.filesInGist,inputOptions:t,fileList:Object.keys(this.filesInGist)}})},hasGistSettings:function(){return this.gistId&&this.gistId.length>0},getIsTokenInvalid:function(){return!this.token||this.token.length<5||this.isTokenInvalid},getGistFileFromRawUrl:function(e,t=(()=>{})){return fetch(e).then(e=>e.text())},getGistFiles:function(e=(()=>{})){return this.getGist(this.gistId,e)},getContentOrRaw:function(e,t){return new Promise((n,i)=>{!e&&t?fetch(t).then(e=>(this.fileType=r(e.name),this.fileName=e.name,this.fileHandle=e,this.lastStorageHost="GIST",e.text())).then(e=>{n(e)}):n(e)})},editGist:function(e,t,n){return console.log({gistId:e,fileName:t,content:n}),fetch("https://api.github.com/gists/"+e,{method:"POST",headers:this.getGistHeaders(),body:JSON.stringify({description:n?"upload data from api":"delete "+t,public:!1,files:{[t]:n?{content:n}:{}}})}).then(e=>e.json()).then(e=>(this.setLastStorageHost("GIST"),{response:e,file:e.files&&t in e.files?e.files[t]:void 0}))},editGistFile:function(e,t){return this.editGist(this.gistId,e,t)},deleteGistFile:function(e,t){return this.editGist(e,t,"")},FILETYPE:s}:{getFile:()=>{},setFile:()=>{},credentials:credentials,setCredentials:setCredentials}},"1mrn":function(e,t,n){},"2Qx2":function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return l}));var o=n("W2Rx"),s=n("oj90"),r=n("+NoZ");const a=n("33yf"),l={db:Object(r.a)("yarn-DB","Yarn-persistence"),storage:Object(r.c)("gist"),appInstanceStates:e.observable([]),isDocumentDirty:e.observable(!1),editingPath:e.observable(null),editingName:e.observable("NewFile"),editingType:e.observable("json"),editingFolder:e.observable(null),documentHeader:e.observable(null),lastEditedUnix:e.observable(new Date),lastSavedUnix:e.observable(null),inkCompiler:null,editingFileFolder:function(e=""){const t=l.editingPath()?l.editingPath():"";return e.length>0?a.join(a.dirname(t),e):a.dirname(t)},startNewFile:function(e="NewFile",t="json"){l.editingPath(null),l.editingName(e),l.editingType(t),l.editingFolder(null),l.documentHeader(null),app.workspace.selectedNodes=[],app.editing(null),t===r.b.INK&&app.settings.documentType("ink"),app.nodes([app.newNode(!0).title("ink"===app.settings.documentType()?l.InkGlobalScopeNodeName:"Start").body("ink"===app.settings.documentType()?"":"Empty text")]),app.tags([]),app.updateNodeLinks(),app.workspace.warpToNodeByIdx(0),l.isDocumentDirty(!0),app.refreshWindowTitle(),l.saveAppStateToLocalStorage(),app.ui.dispatchEvent("newYarnFileStarted")},askForFileName:function(){Swal.fire({title:"Enter a New File Name",input:"text",inputPlaceholder:"NewFile",showCancelButton:!0}).then(e=>{(e.value||""===e.value)&&l.startNewFile(e.value||"NewFile")})},setNewFile:function(){Swal.fire({title:"Create a New File?",text:`Any unsaved progress to ${l.editingName()}.${l.editingType()} will be lost!\n      Path: ${l.editingPath()}\n      Storage: ${app.settings.lastStorageHost()}\n      `,icon:"warning",showCancelButton:!0,confirmButtonText:"New file",cancelButtonText:"No, cancel!"}).then(e=>{e.value?l.askForFileName():l.startNewFile("NewFile")})},loadDocumentStateTabFromIndex:function(e){app.log("ATTEMPT TO LOAD STATE",e),app.settings.selectedFileTab(e),l.loadAppStateFromLocalStorage()},getCurrentAppState:function(){return{editingPath:l.editingPath(),editingName:l.editingName(),documentType:app.settings.documentType(),editingType:l.editingType(),editingFolder:l.editingFolder(),editingTitle:app.editing()?app.editing().title():null,nodes:l.getNodesAsObjects(),documentHeader:l.documentHeader(),tags:app.tags(),editorSelection:app.editor?app.editor.selection.getRange():null,transform:app.workspace.transform,scale:app.workspace.scale,lastStorageHost:app.settings.lastStorageHost(),lastEditedUnix:l.lastEditedUnix()||"",lastSavedUnix:l.lastSavedUnix(),pluginStorage:app.plugins.pluginStorage}},deleteDocumentStateTab:function(e){Swal.fire({title:"Are you sure?",text:`Are you sure you want to close this file? Any unsaved changes to ${l.editingName()}.${l.editingType()} will be lost!\n      Path: ${l.editingPath()||""}\n      Storage: ${app.settings.lastStorageHost()}\n      `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes close",cancelButtonText:"Cancel",reverseButtons:!0}).then(t=>{if(t.value){app.log("DELETE TAB",l.appInstanceStates(),e);const t=l.appInstanceStates().filter((t,n)=>n!==e).map(e=>({...e}));l.appInstanceStates([...t]),l.saveAppStateToLocalStorage(!1),setTimeout(()=>{const t=e>l.appInstanceStates().length-1?l.appInstanceStates().length-1:e;l.loadDocumentStateTabFromIndex(t)},500),app.log(l.appInstanceStates(),"resulting mutation",t)}})},addDocumentState:function({editingName:e,editingType:t,yarnData:n,checked:i}){l.appInstanceStates([...l.appInstanceStates(),{...l.getCurrentAppState()}]),app.log("DOCUMENT TAB ADDED",l.appInstanceStates()),l.saveAppStateToLocalStorage(),l.loadDocumentStateTabFromIndex(l.appInstanceStates().length-1),i?(l.editingName(e),l.editingType(t)):l.startNewFile(e,t),app.log({editingName:e,yarnData:n,editingType:t,checked:i})},addDocumentStateTab:function(){l.promptFileNameAndFormat(l.addDocumentState,null,"📜 Name of new file"," Copy of "+l.editingName())},saveAppStateToLocalStorage:s.Utils.debounce((function(e=!0){app.settings.storage;l.isDocumentDirty(!0),l.lastEditedUnix(new Date),app.refreshWindowTitle();const t=[...l.appInstanceStates()];if(e){t[null!=app.settings.selectedFileTab()&&app.settings.selectedFileTab()<t.length?app.settings.selectedFileTab():0]=l.getCurrentAppState()}console.log({updatedStates:t,tab:app.settings.selectedFileTab(),new:l.getCurrentAppState()}),l.appInstanceStates(t),l.db.save("appStates",JSON.stringify(l.appInstanceStates())),app.ui.dispatchEvent("yarnSavedStateToLocalStorage")}),700),loadAppStateFromLocalStorage:async function(){const e=app.settings.storage;e.getItem("appState")&&(app.log("--- storage.clear() ---"),e.clear());const t=await l.db.getDbValue("appStates");if(!t)return void console.warn("failed to load persisted state");const n=JSON.parse(t),i=n[app.settings.selectedFileTab()];if(!1===app.settings.restoreSessionEnabled())return i&&(app.pluginStorage=i.pluginStorage),app.settings.selectedFileTab(0),void l.startNewFile();if(l.appInstanceStates(n),app.log("APP state",n,i),i){const{editingPath:e,editingName:t,editingType:n,documentType:o,editingFolder:s,editingTitle:r,editorSelection:a,nodes:d,documentHeader:c,tags:p,transform:u,scale:g,pluginStorage:h,lastEditedUnix:f,lastSavedUnix:m}=i;app.pluginStorage=h,app.tags(p),l.editingPath(e),l.editingName(t),l.editingType(n),app.settings.documentType(o),l.editingFolder(s),l.lastEditedUnix(f),l.lastSavedUnix(m),l.documentHeader(c),l.isDocumentDirty(!0),app.refreshWindowTitle(),app.ui.dispatchEvent("yarnLoadedStateFromLocalStorage"),app.log("--- app.plugins.pluginStorage ---"),l.getNodesFromObjectsAsync(d).then(e=>{r&&(app.editNode(e.find(e=>e.title()===r)),a&&app.editor.selection.setRange(a)),app.log("--- app.nodes(newNodes) ---",e.length),app.nodes(e),app.log("--- app.updateNodeLinks ---"),app.updateNodeLinks(),app.log("--- app.workspace.setTranslation ---"),app.workspace.setTranslation(u.x,u.y),app.log("--- app.workspace.setZoom ---"),app.workspace.setZoom(4*g)})}},readFile:function(e,t,n){l.getFileData(e,t).then(t=>{l.editingPath(e.path),l.editingType(t.type),l.loadData(t.data,t.type,n)})},setNewFileStats:function(e,t,n="LOCAL"){app.log("Updated save data",e,t),l.editingName(e.replace(/^.*[\\\/]/,"")),l.isDocumentDirty(!1),l.editingPath(t),app.settings.lastStorageHost(n),app.refreshWindowTitle()},openFile:function(e,t){const n=l.editingPath()?"Any unsaved progress to "+l.editingName()+" will be lost.":"Any unsaved progress will be lost.";Swal.fire({title:"Are you sure you want to open another file?",text:n,icon:"warning",showConfirmButton:!0,showCancelButton:!0}).then(n=>{!0===n.value&&(l.readFile(e,t,!0),l.setNewFileStats(t,e.path),app.refreshWindowTitle())})},openFileFromFilePath:function(e){const t=app.path.basename(e);i.ajax({url:e,async:!1,success:n=>{const i=Object(r.d)(t);i===r.b.UNKNOWN?Swal.fire({title:"Unknown filetype!",icon:"error"}):(l.loadData(n,i,!0),l.setNewFileStats(t,e),l.editingType(i))}})},getFileData:function(e,t){return new Promise((n,i)=>{const o=new FileReader;o.onload=function(s){const a=Object(r.d)(t);a===r.b.UNKNOWN?(Swal.fire({title:"Unknown filetype!",icon:"error"}),i()):n({file:e,type:a,data:o.result,name:e.name})},o.readAsText(e)})},openFolder:function(e,t){editingFolder=t,Swal.fire({text:"openFolder not yet implemented e: "+e+" foldername: "+t,icon:"error"})},appendFile:function(e,t){l.readFile(e,t,!1)},dispatchEventDataLoaded:function(){var e=new CustomEvent("yarnLoadedData");e.document=document,e.data=l,e.app=app,window.dispatchEvent(e),window.parent.dispatchEvent(e)},restoreSettingsFromDocumentHeader:function(){if(null!==l.documentHeader()){const e=l.documentHeader();app.log("Apply settings from file header:",e),"markupLanguage"in e&&app.settings.markupLanguage(e.markupLanguage),"language"in e&&app.settings.language(e.language),"filetypeVersion"in e&&app.settings.filetypeVersion(e.filetypeVersion),app.settings.apply()}},loadData:function(e,t,n){const i=[],o=e=>{for(let t=0;t<e.length;t++)"title"in e[t]&&i.push(e[t])};if(app.log("OPENING::",{content:e}),t===r.b.JSON){if(!(e=JSON.parse(e)))return;Array.isArray(e)?o(e):(l.documentHeader(e.header),o(e.nodes)),app.setDocumentType("yarn")}else if(t===r.b.INK){var a=e.split(/\r?\n/),d=null;const t=e=>{try{d.title=a[e].split("//yarn-editor-metadata:")[0].replace(/===/g,"").trim();const{x:t,y:n,colorID:i}=JSON.parse(a[e].split("//yarn-editor-metadata:")[1]);d.position={x:parseInt(t),y:parseInt(n)},d.colorID=i}catch(e){console.warn("node metadata failed parse: ",e)}};for(let e=0;e<a.length;e++){const n={body:"",position:{x:160*i.length,y:160*i.length},colorID:0,tags:""};null!==d||a[e].trim().startsWith("===")||((d={...n,position:{x:-400,y:0}}).title=l.InkGlobalScopeNodeName),a[e].trim().startsWith("===")?(null!==d&&i.push(d),d={title:a[e].trim().replace(/===/g,""),...n},a[e].trim().includes("//yarn-editor-metadata:")&&t(e)):null!==d&&(d.body+=a[e]+"\n")}null!==d&&i.push(d),app.setDocumentType("ink")}else if(t===r.b.YARN){a=e.split(/\r?\n/),d=null;var c=!1;for(let e=0;e<a.length;e++)if("==="===a[e].trim())c=!1,null!=d&&(i.push(d),d=null);else if(c)d.body+=a[e]+"\n";else if(a[e].indexOf("title:")>-1)null==d&&(d={}),d.title=a[e].substr(7,a[e].length-7);else if(a[e].indexOf("position:")>-1){null==d&&(d={});var p=a[e].substr(9,a[e].length-9).split(",");d.position={x:Number(p[0].trim()),y:Number(p[1].trim())}}else a[e].indexOf("colorID:")>-1?(null==d&&(d={}),d.colorID=Number(a[e].substr(9,a[e].length-9).trim())):a[e].indexOf("tags:")>-1?(null==d&&(d={}),d.tags=a[e].substr(6,a[e].length-6)):"---"===a[e].trim()&&(c=!0,d.body="");null!=d&&i.push(d),app.setDocumentType("yarn")}else if(t===r.b.TWEE||t===r.b.TWEE2){a=e.split("\n"),d=null;for(var u=0,g=0;g<a.length;g++)if(a[g]=a[g].trim(),"::"===a[g].substr(0,2)){null!=d&&i.push(d),d={};var h="",f="",m={x:80*++u,y:80*u},y=a[g].indexOf("["),b=a[g].indexOf("]");y>0&&b>0&&(f=a[g].substr(y+1,b-y-1));var v=a[g].indexOf("<"),w=a[g].indexOf(">");if(v>0&&w>0){var S=a[g].substr(v+1,w-v-1).split(",");m.x=parseInt(S[0]),m.y=parseInt(S[1])}var x=0;y>0?x=y:v>0&&(x=v),h=(h=x?a[g].substr(3,x-3):a[g].substr(3)).trim(),d.title=h,d.tags=f,d.body="",d.position=m}else null!=d&&(d.body.length>0&&(a[g]+="\n"),d.body+=a[g]);null!=d&&i.push(d),app.setDocumentType("yarn")}else if(t===r.b.XML){app.setDocumentType("yarn");var T=(new DOMParser).parseFromString(e,"text/xml");if(void 0!==(e=s.Utils.xmlToObject(T)))for(let t=0;t<e.length;t++)i.push(e[t])}app.limitNodesUpdate(()=>{n&&app.nodes.removeAll(),l.getNodesFromObjects(i).forEach(e=>app.nodes.push(e))}),l.editingType(t),l.restoreSettingsFromDocumentHeader(),app.updateNodeLinks(),app.workspace.warpToNodeByIdx(0),l.isDocumentDirty(!1),l.addGlobalScopeToInkDoc(),l.dispatchEventDataLoaded()},addGlobalScopeToInkDoc:function(){"ink"!==app.settings.documentType()||app.nodes().find(e=>e.title().trim()===l.InkGlobalScopeNodeName)||app.newNode(!0).title(l.InkGlobalScopeNodeName).x(-400)},getNodeFromObject:function(e){return new o.a({title:e.title,body:e.body,tags:e.tags,colorID:e.colorID,x:parseInt(e.position.x),y:parseInt(e.position.y)})},getNodeAsObject:function(e){return{title:e.title(),tags:e.tags(),body:e.body(),position:{x:e.x(),y:e.y()},colorID:e.colorID()}},getNodesFromObjects:function(e){const t=[];if(!e)return[];for(let n=0;n<e.length;n++)t.push(l.getNodeFromObject(e[n]));return t},getNodesFromObjectsAsync:async function(e){if(!e)return[];const t=e.map(e=>new Promise(t=>t(l.getNodeFromObject(e))));return await Promise.all(t)},getNodesAsObjects:function(){const e=[],t=app.nodes();for(var n=0;n<t.length;n++)e.push(l.getNodeAsObject(t[n]));return e},getSaveData:async function(e,t=null,n=!1,i=l.getNodesAsObjects()){var o="";if(e===r.b.JSON)if("2"===app.settings.filetypeVersion()){app.log("Saving as Yarn json v2 type");const e=new Date;l.documentHeader({...l.documentHeader(),lastSavedUnix:e,language:app.settings.language(),documentType:app.settings.documentType(),markupLanguage:app.settings.markupLanguage(),filetypeVersion:app.settings.filetypeVersion(),pluginStorage:app.plugins.pluginStorage}),o=JSON.stringify({header:l.documentHeader(),nodes:i},null,"\t")}else o=JSON.stringify(i,null,"\t");else if(e===r.b.INK){const e=i.find(e=>e.title.trim()===l.InkGlobalScopeNodeName);if(e){if(n){const t=e.body.split(/\r\n|\r|\n/).filter(e=>e.trim().startsWith("INCLUDE "));o+=e.body.split(/\r\n|\r|\n/).filter(e=>!e.trim().startsWith("INCLUDE ")).join("\n");for(const e of t){const t=e.trim().split("INCLUDE ");if(t.length>1){const e=l.appInstanceStates().find(e=>e.editingType===r.b.INK&&e.editingName===t[1]);if(e){o+=await l.getSaveData(r.b.INK,null,n,e.nodes)+"\n"}}}}else o+=e.body;if(t&&o.split(/\r\n|\r|\n/).length>t)return e}for(let e=0;e<i.length;e++){const n=i[e];if(n.title.trim()!==l.InkGlobalScopeNodeName)if(o+=`\n=== ${n.title} === //yarn-editor-metadata: `+JSON.stringify({x:parseInt(n.position.x),y:parseInt(n.position.y),colorID:parseInt(n.colorID)})+"\n",o+=n.body,(s=n.body).length>0&&"\n"===s[s.length-1]||(o+="\n"),t&&o.split(/\r\n|\r|\n/).length>t)return n}}else if(e===r.b.INKJSON){const e=await l.getSaveData("ink",null,!0),t=new Promise((t,n)=>{ToastWc.show({type:"info",content:"Ink file is compiling",time:2e3}),l.inkCompiler.init(i=>{i.errors.length>0?(Swal.fire({title:"Failed to parse ink file",html:`<div class="title-error">${i.errors.join("<br/>")}</div>`,icon:"error"}).then(()=>l.goToErrorInkNode(e,i.errors[0])),n()):(app.log("Warnings",i.warnings),ToastWc.show({type:i.warnings.length>0?"warning":"success",content:""+(i.warnings.length>0?"Ink file compiled with some warnings:\n"+i.warnings.join("\n"):"Ink file compiled successfully"),time:i.warnings.length>0?3e3:1500}),app.log({responseStory:i.story}),t(JSON.stringify(i.story,null,"\t")))}).then(()=>l.inkCompiler.submit(e))});o=await t}else if(e===r.b.YARN)for(let e=0;e<i.length;e++){var s;o+="title: "+i[e].title+"\n",o+="tags: "+i[e].tags+"\n",o+="colorID: "+i[e].colorID+"\n",o+="position: "+i[e].position.x+","+i[e].position.y+"\n",o+="---\n",o+=i[e].body,(s=i[e].body).length>0&&"\n"===s[s.length-1]||(o+="\n"),o+="===\n"}else if(e===r.b.RENPY)for(let e=0;e<i.length;e++){o+=`\n${i[e].tags.includes("screen")?"screen":"label"} `+i[e].title.replace(/[ ]/g,"_")+":\n";const t=i[e].body;t.length>0&&"\n"===t[t.length-1]||(o+="\n");let n=!1,s=!1,r="";const a=i[e].tags.includes("renpy");t.split("\n").forEach(e=>{const t=e.trim(),i=s?"\t\t":"\t";if(a)r+=`${i}${e}\n`;else if(t.startsWith("[[")){const e=t.replace(/[\[\[]|[\]\]]]/g,"").split("|");e.length>1?(n||(r+=i+"menu:\n",n=!0),r+=`${i}\t"${e[0].trim()}":\n${i}\t\tjump ${e[1].trim()}\n`):r+=`${i}jump ${e[0].trim()}\n`}else if(t.startsWith("<<if")){const e=t.replace(/\<\<\|$|\>\>|if/g,"").split(/==|!=|>|</g).filter(Boolean),n=t.substring(2,t.length-2).match(/(>|==|!=|<)/);r+=e.length>1&&n?`\tif ${e[0].trim()} ${n[0]} ${e[1].trim()}:\n`:`\t# ${t}\n`,s=!0}else if(t.startsWith("<<elseif")){const e=t.replace(/\<\<\|$|\>\>|elseif/g,"").split(/==|!=|>|</g).filter(Boolean),n=t.substring(2,t.length-2).match(/(>|==|!=|<)/);r+=e.length>1&&n?`\telif ${e[0].trim()} ${n[0]} ${e[1].trim()}:\n`:`\t# ${t}\n`,s=!0}else if(t.startsWith("<<else"))r+="\telse:\n",s=!0;else if(t.startsWith("<<endif"))r+="\n",s=!1;else if(t.startsWith("<<set")){const e=t.replace(/[\<\>\$]|set /g,"").split("=");app.log({set:e}),r+=e.length>1?`${i}$ ${e[0].trim()} = ${e[1].trim()}\n`:`${i}#$ ${e[0].trim()} = 0:\n`}else t.startsWith("<<")?r+=`${i}${t.replace(/[\<\>]/g,"")}\n`:t.startsWith("//")?r+=`${i}#${t.substring(2)}\n`:t.length>0&&(t.endsWith('"')?r+=`${i}${t}\n`:r+=`${i}"${t}"\n`);n=!1}),o+=r+"\n"}else if(e===r.b.TWEE)for(let e=0;e<i.length;e++){var a="";i[e].tags.length>0&&(a=" ["+i[e].tags+"]"),o+=":: "+i[e].title+a+"\n",o+=i[e].body+"\n\n"}else if(e===r.b.TWEE2)for(let e=0;e<i.length;e++){a="";i[e].tags.length>0&&(a=" ["+i[e].tags+"]");var d=" <"+i[e].position.x+","+i[e].position.y+">";o+=":: "+i[e].title+a+d+"\n",o+=i[e].body+"\n\n"}else if(e===r.b.XML){o+="<nodes>\n";for(let e=0;e<i.length;e++)o+="\t<node>\n",o+="\t\t<title>"+i[e].title+"</title>\n",o+="\t\t<tags>"+i[e].tags+"</tags>\n",o+="\t\t<body>"+i[e].body+"</body>\n",o+='\t\t<position x="'+i[e].position.x+'" y="'+i[e].position.y+'"></position>\n',o+="\t\t<colorID>"+i[e].colorID+"</colorID>\n",o+="\t</node>\n";o+="</nodes>\n"}return l.isDocumentDirty(!1),app.refreshWindowTitle(),o},tryOpenFile:function(){l.storage.openLocalFile().then(e=>{l.addDocumentState({editingName:l.storage.fileName,editingType:l.storage.fileType,yarnData:e}),l.loadData(e,l.storage.fileType,!0)})},promptFileNameAndFormat:function(e,t=null,n="💾 Save file - enter file name",i=""){const o=l.editingName().replace(/\.[^/.]+$/,"")+"."+l.editingType();Swal.fire({title:n,html:` <input id="swal-input1" list="select-file-name" name="select" placeholder="${o}">\n      <datalist class="form-control" id="select-file-name">    \n        ${t&&t.map(e=>`<option value="${e}" />`).join("")}\n      </datalist>\n      ${i?`<br/><br/><input type="checkbox" id="swal-checkbox-checked"> ${i}</input>`:""}\n        `,onOpen:()=>{"NewFile"!==l.editingName()&&(document.getElementById("swal-input1").value=o,document.getElementById("swal-input1").addEventListener("focus",e=>{e.target.value="",e.target.showPicker()}))},showCancelButton:!0,preConfirm:()=>({name:document.getElementById("swal-input1").value,checked:!!i&&document.getElementById("swal-checkbox-checked").checked})}).then(({value:t})=>{if(t){const{name:n,checked:i}=t,o=n.split(".").pop(),s=Object.values(r.b).includes(o)?o:l.editingType(),a=(n||"").replace(/\.[^/.]+$/,"")+"."+s;l.getSaveData(s).then(t=>{e({editingName:a,editingType:s,yarnData:t,checked:i})})}})},tryShareFilePwa:function(e){l.promptFileNameAndFormat(({editingName:e,yarnData:t})=>{const n=[new Blob([t],{type:"text/plain"})],i=new File(n,e,{});navigator.canShare&&navigator.canShare({files:[i]})?navigator.share({title:e,text:t,file:[i]}).then(()=>app.log("Successful share")).catch(e=>app.log("Error sharing",e)):Swal.fire({title:"Web Share API is not supported in your browser.\nTry using it on your smartphone or tablet...",icon:"error"})})},trySaveGist:function(e){console.log({gists:e}),l.storage.hasGistSettings()?l.storage.getGistFiles().then(e=>{const t=Object.keys(e.body.files);app.log(t),l.promptFileNameAndFormat(({editingName:e,yarnData:t})=>{l.editingName(e),l.storage.editGist(l.storage.gistId,e,t),Swal.fire("Saved!","The Yarn has been saved to gist "+l.storage.gistId,"success"),app.settings.lastStorageHost("GIST"),l.isDocumentDirty(!1),app.refreshWindowTitle()},t)}):(Swal.fire("Not configured","Your github settings are not configured","warning"),app.ui.openSettingsDialog())},openGist:function(e,t){const n=Object(r.d)(t);l.loadData(e,n,!0),l.isDocumentDirty(!1),app.settings.lastStorageHost("GIST"),l.editingPath(null),l.editingName(t),app.settings.lastEditedGist(t),app.refreshWindowTitle()},tryOpenGist:function(e){if(l.storage.hasGistSettings()){console.log({edit:l.editingName(),last:app.settings.lastEditedGist(),lastHost:app.settings.lastStorageHost()});const e="GIST"===app.settings.lastStorageHost()?app.settings.lastEditedGist():"";l.storage.getGistFiles(app.ui.openSettingsDialog).then(({inputOptions:t,filesInGist:n})=>{Swal.fire({title:"🐙 Open file from a gist",input:"select",inputOptions:t,inputAttributes:{autocomplete:"off"},inputValue:e,inputPlaceholder:"Select a file from the gist",showCancelButton:!0}).then(({value:e})=>{if(e){const t=n[e].content,i=n[e].raw_url;l.storage.getContentOrRaw(t,i).then(t=>{l.openGist(t,e)})}})})}else Swal.fire("Not configured","Your github settings are not configured","warning"),app.ui.openSettingsDialog()},tryAppend:function(){l.storage.openLocalFile().then(e=>{l.loadData(e,l.storage.fileType,!1)})},trySave:function(e){const t=(l.editingName()||"").replace(/\.[^/.]+$/,"")+"."+e;l.storage.saveAsFile(t,l.getSaveData).then(e=>{l.setNewFileStats(e.chosenFileName,"","LOCAL"),l.editingType(e.type)})},trySaveCurrent:function(){if(l.isDocumentDirty())if("GIST"===app.settings.lastStorageHost()){const e=l.storage;l.getSaveData(l.editingType()).then(t=>{l.getSaveData(l.editingType()),e.editGistFile(l.editingName(),t),app.settings.lastStorageHost("GIST"),l.isDocumentDirty(!1),app.refreshWindowTitle(),app.ui.toastMixin.fire({title:"Saved",text:`Saved ${l.editingName()} to Gist`})})}else l.editingPath()?l.editingPath().length>0&&l.editingType().length>0&&l.getSaveData(l.editingType()).then(e=>{}):l.getSaveData(l.editingType()).then(e=>{l.storage.saveToCurrentFile(e,l.editingName())})},doesFileExist:function(e){return!1},triggerPasteClipboard:function(){if(app.electron){const e=app.electron.clipboard.readText();app.clipboard=e,document.execCommand("paste")}else navigator.clipboard&&navigator.clipboard.readText().then(e=>{app.clipboard=e}).catch(e=>{app.clipboard=app.editor.getSelectedText(),app.log("No clipboard access",e,"using local instead")}),setTimeout(()=>app.insertTextAtCursor(app.clipboard),100)},triggerCopyClipboard:function(){if(app.electron)app.electron.clipboard.writeText(app.editor.getSelectedText()),app.clipboard=app.editor.getSelectedText();else{const e=app.editor.getSelectedText();app.clipboard=e,navigator.clipboard&&e.length>0&&navigator.clipboard.writeText(e).then(()=>{app.clipboard=e})}},InkCompiler:function(){this.errors=[],this.warnings=[],this.errorHandler=(e,t)=>{let n=e.match(/^(ERROR|RUNTIME ERROR): ('([^']+)' )?line (\d+): (.*)/);let i=e.match(/^(WARNING|RUNTIME WARNING|TODO): ('([^']+)' )?line (\d+): (.*)/);n?this.errors.push(e):i&&this.warnings.push(e)},this.compilerOptions=new inkjs.CompilerOptions(null,[],!1,this.errorHandler),this.ready=!1,this.worker=null,this.onComplete=()=>{},this.init=(e=(()=>{}))=>(this.onComplete=e,new Promise((e,t)=>{e()})),this.submit=e=>{this.errors=[],this.warnings=[];const t=new inkjs.Compiler(e,this.compilerOptions).Compile().ToJson(),n={story:JSON.parse(t),warnings:this.warnings,errors:this.errors};this.onComplete(n)},this.getInkErrorGotoNode=async(e,t)=>{const n=t.substr(t.lastIndexOf(":")+1,t.length).trim();try{const e=Number(t.match(/line ([0-9]+):/)[1]);return{ln:e,node:(await l.getSaveData(r.b.INK,e)).title,find:n}}catch(e){return console.error(e),null}}},InkGlobalScopeNodeName:"INK_GLOBAL_SCOPE",goToErrorInkNode:(e,t)=>{l.inkCompiler.getInkErrorGotoNode(e,t).then(e=>{if(e){const{node:t,ln:n,find:i}=e;app.openNodeByTitle(t,i)}})}}}).call(this,n("Z1dp"),n("EVdn"))},"3ozf":function(e,t,n){},"5aMW":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r}));var i=n("tUqF"),o=n("qVgP");const{JSONEditor:s}=n("JGHU");var r=function({app:t,createButton:r,addSettingsItem:a,getPluginStore:l,onYarnEditorOpen:d,onYarnInPreviewMode:c,onYarnSavedNode:p,onYarnSetDocumentType:u,onKeyUp:g,onKeyDown:h,onLoad:f,setPluginStore:m}){const y=this;this.name="Runner",this.onOpenDialog=async()=>{let e=null;const{value:i}=await Swal.fire({title:"Playtest starting variables",html:'<div class="json-editor-wrapper"><div id="jsoneditor"/></div>',focusConfirm:!1,customClass:"swal-wide",onOpen:()=>{n("1mrn"),e=new s({id:"jsoneditor"});const i=l(y.name);t.log({editor:e}),e.setValue("object"!=typeof i.variables?[{key:"er",value:"erd"}]:i.variables),m(y.name,"runnerVariablesOpen",!0)},preConfirm:()=>(m(y.name,"runnerVariablesOpen",!1),e.getValue())});i&&m(y.name,"variables",i)},f(()=>{a({title:"Playtesting Style",valueKey:"playtestStyle",defaultValue:"chat",optionsKey:"availablePlaytestStyles",options:[{id:"npc",name:"Npc bubble"},{id:"chat",name:"Chat messages"}],setterKey:"setPlaytestStyle",settingsColumn:"A"}),t.settings.developmentModeEnabled()&&r(y.name,{name:"Playtest variables",className:"item",attachTo:"fileMenuDropdown",onClick:"onOpenDialog()",iconName:"cog"}),l(y.name).runnerVariablesOpen&&y.onOpenDialog()});const b=()=>{if("yarn"===t.settings.documentType())this.previewStory=new i.a,this.gotoLastPlayNode=function(){t.editing()&&t.editing().title()!==y.previewStory.node.title&&t.openNodeByTitle(y.previewStory.node.title),t.editor.focus()},this.advanceStoryPlayMode=function(e=5){y.previewStory.finished?(y.togglePlayMode(!1),y.gotoLastPlayNode()):(y.previewStory.changeTextScrollSpeed(e),-1!=y.previewStory.vnSelectedChoice&&5===e&&y.previewStory.vnSelectChoice())},this.togglePlayMode=function(n=!1){const i=e(".editor")[0],o=document.getElementById("storyPlayButton"),s=document.getElementById("editor-play");if(e("#editor-play").addClass("inYarnMode"),e("#commandDebugLabel").addClass("inYarnMode"),t.isEditorInPlayMode(n),n){i.style.display="none",e(".bbcode-toolbar").addClass("hidden"),s.style.display="flex",e(o).addClass("disabled"),y.previewStory.emiter.on("finished",(function(){y.togglePlayMode(!1),y.gotoLastPlayNode()})),y.previewStory.emiter.on("startedNode",(function(e){t.isEditorSplit&&t.workspace.warpToNode(t.getFirstFoundNode(e.title.toLowerCase().trim()))}));const n=l(y.name);t.log("variables",n),t.data.getSaveData("json").then(e=>{y.previewStory.initYarn(JSON.parse(e),t.editing().title().trim(),"NVrichTextLabel",!1,"commandDebugLabel",t.settings.playtestStyle(),n.variables||[])})}else t.editor.session.setScrollTop(s.scrollTop),s.style.display="none",i.style.display="flex",e(o).removeClass("disabled"),e(".bbcode-toolbar").removeClass("hidden"),e(".toggle-toolbar").removeClass("hidden"),e(".editor-counter").removeClass("hidden"),y.previewStory.terminate()},c(()=>y.togglePlayMode(!1)),p(()=>y.togglePlayMode(!1)),d(()=>{r(y.name,{iconName:"play",title:"Preview",attachTo:"bbcodeToolbar",onClick:"togglePlayMode(true)",className:"bbcode-button bbcode-button-right",id:"storyPlayButton"});const e=document.createElement("div");e.innerHTML=`\n    <div class="editor-play" id="editor-play" onpointerdown="app.plugins.${y.name}.advanceStoryPlayMode(30)" ondblclick="app.plugins.${y.name}.advanceStoryPlayMode()">\n        <p class="story-playtest-answer" id="NVrichTextLabel"></p>\n        <div id="commandDebugLabel"></div>\n    </div>\n  `,document.getElementById("editorContainer").appendChild(e),h(e=>{if(t.editing()&&!y.previewStory.finished)switch(e.keyCode){case t.input.keys.Z:y.previewStory.changeTextScrollSpeed(10),-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnSelectChoice();break;case t.input.keys.Up:-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnUpdateChoice(-1);break;case t.input.keys.Down:-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnUpdateChoice(1)}}),g(e=>{e.keyCode===t.input.keys.Z&&(y.previewStory.changeTextScrollSpeed(200),-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnSelectChoice())})});else{this.previewStory=new o.a,this.prevSession={story:null,prevSavePoints:[],childNodes:[],recompile:!1};const n=new t.data.InkCompiler;this.togglePlayMode=function(i=!1){const o=e(".editor")[0],s=document.getElementById("storyPlayButton"),r=document.getElementById("editor-play");if(t.isEditorInPlayMode(i),e("#editor-play").addClass("inInkMode"),e("#commandDebugLabel").addClass("inInkMode"),i){r.style.display="flex",e("#editor").addClass("editor-take-half"),y.previewStory.emiter.on("finished",(function(){y.togglePlayMode(!1),y.gotoLastPlayNode()})),y.previewStory.emiter.on("startedNode",(function(e){t.isEditorSplit&&t.workspace.warpToNode(t.getFirstFoundNode(e.title.toLowerCase().trim()))}));const i=l(y.name);t.log("VARIABLES::::",i),t.data.getSaveData("ink",null,!0).then(e=>{y.previewStory.initInk(n,()=>{y.prevSession={...y.prevSession,recompile:!0},y.togglePlayMode(!0)},y.prevSession,e,t.editing().title().trim(),"NVrichTextLabel",!1,"commandDebugLabel",t.settings.playtestStyle(),i.variables||[])})}else t.editor.session.setScrollTop(r.scrollTop),r.style.display="none",o.style.display="flex",e("#editor").removeClass("editor-take-half"),e(s).removeClass("disabled"),y.prevSession={prevSavePoints:y.previewStory.prevSavePoints,story:y.previewStory.story,childNodes:y.previewStory.textAreaEl?[...y.previewStory.textAreaEl.childNodes]:[],recompile:!1},y.previewStory.terminate();t.editor.resize()},c(()=>y.togglePlayMode(!1)),p(()=>y.togglePlayMode(!1)),this.advanceStoryPlayMode=function(e=5){},d(()=>{r(y.name,{iconName:"play",title:"Preview",attachTo:"bbcodeToolbar",onClick:"togglePlayMode(!app.isEditorInPlayMode())",className:"bbcode-button bbcode-button-right",id:"storyPlayButton"});const e=document.createElement("div");e.innerHTML=`\n    <div class="editor-play" id="editor-play" onpointerdown="app.plugins.${y.name}.advanceStoryPlayMode(30)" ondblclick="app.plugins.${y.name}.advanceStoryPlayMode()">\n        <p class="story-playtest-answer" id="NVrichTextLabel"></p>\n        <div id="commandDebugLabel"></div>\n    </div>\n  `,document.getElementById("editorContainer").appendChild(e)})}};b(),u(b),t.togglePlayMode=this.togglePlayMode}}).call(this,n("EVdn"))},"5dEm":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var i=n("oj90");const o=function(t){const n=this,o={toast:!0,position:"bottom",icon:"error",title:"Alignment requires two or more nodes be selected.",showConfirmButton:!1,timer:3500,timerProgressBar:!0};this.canvas=e(".arrows")[0],this.context=n.canvas.getContext("2d"),this.gridCanvas=e("#grid-canvas")[0],this.gridContext=n.gridCanvas.getContext("2d"),this.gridEnabled=!0,this.updateArrowsThrottle=50,this.updateArrowsInterval=void 0,this.deferredArrowsDrawInterval=void 0,this.nextArrowsUpdate=Number.NEGATIVE_INFINITY,this.isDrawingArrows=!1,this.selectedNodes=[],this.scale=1,this.offset={x:0,y:0},this.transform={x:0,y:0},this.isMarqueeEnabled=!1,this.marqueeSelection=[],this.marqueeRect={x1:0,y1:0,x2:0,y2:0},this.marqueeOffset=[0,0],this.zoomSpeed=.005,this.zoomLimitMin=.05,this.zoomLimitMax=1,this.setThrottle=function(e,t){const o=t?t.target.value:e;n.updateArrowsThrottle=i.Utils.clamp(o,16,250)},this.setTranslation=function(e,t,i=0){n.transform.x=e,n.transform.y=t,n.translate(i)},this.shiftTranslation=function(e,t,i=0){n.setTranslation(n.transform.x+e,n.transform.y+t,i)},this.translate=function(t){t&&n.startUpdatingArrows(),e(".nodes-holder").finish().transition({transform:"matrix("+n.scale+",0,0,"+n.scale+","+n.transform.x+","+n.transform.y+")"},t||0,"easeInQuad",(function(){t&&n.stopUpdatingArrows(),n.updateArrows(),n.updateGrid()}))},this.toWorkspaceCoordinates=(e,i)=>t.settings.snapGridEnabled()?{x:n.stepify((e-n.transform.x)/n.scale,t.settings.gridSize()),y:n.stepify((i-n.transform.y)/n.scale,t.settings.gridSize())}:{x:(e-n.transform.x)/n.scale,y:(i-n.transform.y)/n.scale},this.onPanLeft=function(){n.shiftTranslation(n.getPanAmount(),0,100)},this.onPanRight=function(){n.shiftTranslation(-n.getPanAmount(),0,100)},this.onPanUp=function(){n.shiftTranslation(0,n.getPanAmount(),100)},this.onPanDown=function(){n.shiftTranslation(0,-n.getPanAmount(),100)},this.getPanAmount=function(){return t.input.isShiftDown?100*n.scale:500*n.scale},this.setZoom=function(e){n.scale=e/4,n.translate(200)},this.onZoom=function(e,t,o){const s=n.scale,r=o*n.zoomSpeed*n.scale;n.scale=i.Utils.clamp(n.scale+r,n.zoomLimitMin,n.zoomLimitMax);const a=e-n.transform.x,l=t-n.transform.y,d=a-a*(n.scale/s),c=l-l*(n.scale/s);n.shiftTranslation(d,c)},this.onDragStart=function(e){n.offset.x=e.x,n.offset.y=e.y},this.onDragUpdate=function(e){n.isMarqueeEnabled&&t.workspace.onMarqueeEnd(),t.workspace.shiftNodes(e)},this.onDragEnd=function(){t.data.saveAppStateToLocalStorage()},this.onMarqueeStart=function(e){n.isMarqueeEnabled=!0,n.offset.x=e.x,n.offset.y=e.y,n.marqueeSelection=[],n.marqueeOffset[0]=0,n.marqueeOffset[1]=0,n.marqueeRect={x1:0,y1:0,x2:0,y2:0}},this.onMarqueeUpdate=function(e){n.isMarqueeEnabled&&(n.updateMarqueeRect(e),n.selectNodesInsideMarquee())},this.updateMarqueeRect=function(t){t.x>n.offset.x&&t.y<n.offset.y?(n.marqueeRect.x1=n.offset.x,n.marqueeRect.y1=t.y,n.marqueeRect.x2=t.x,n.marqueeRect.y2=n.offset.y):t.x>n.offset.x&&t.y>n.offset.y?(n.marqueeRect.x1=n.offset.x,n.marqueeRect.y1=n.offset.y,n.marqueeRect.x2=t.x,n.marqueeRect.y2=t.y):t.x<n.offset.x&&t.y<n.offset.y?(n.marqueeRect.x1=t.x,n.marqueeRect.y1=t.y,n.marqueeRect.x2=n.offset.x,n.marqueeRect.y2=n.offset.y):(n.marqueeRect.x1=t.x,n.marqueeRect.y1=n.offset.y,n.marqueeRect.x2=n.offset.x,n.marqueeRect.y2=t.y),e("#marquee").css({display:"block",x:n.marqueeRect.x1,y:n.marqueeRect.y1,width:Math.abs(n.marqueeRect.x1-n.marqueeRect.x2),height:Math.abs(n.marqueeRect.y1-n.marqueeRect.y2)})},this.selectNodesInsideMarquee=function(){const e=n.toWorkspaceCoordinates(n.marqueeRect.x1,n.marqueeRect.y1),o=n.toWorkspaceCoordinates(n.marqueeRect.x2,n.marqueeRect.y2),s={left:e.x,right:o.x,top:e.y,bottom:o.y};t.nodes().forEach(e=>{const t=n.marqueeSelection.indexOf(e),o=t>=0,r=e.x(),a=e.y(),l={left:r,right:r+e.width,top:a,bottom:a+e.height},d=i.Utils.rectanglesOverlap(s,l);d&&!o&&(n.selectNodes(e),n.marqueeSelection.push(e)),!d&&o&&(n.deselectNodes(e),n.marqueeSelection.splice(t,1))})},this.onMarqueeEnd=function(){n.isMarqueeEnabled&&(0==n.marqueeSelection.length&&n.deselectAll(),n.isMarqueeEnabled=!1,n.marqueeSelection=[],n.marqueeRect={x1:0,y1:0,x2:0,y2:0},e("#marquee").css({display:"none",x:0,y:0,width:0,height:0}))},this.shiftNodes=function(e){const t={x:e.x-n.offset.x,y:e.y-n.offset.y};n.shiftTranslation(t.x,t.y),n.offset=e},this.updateGrid=function(){const i=e(".nodes-holder").offset(),o=t.settings.gridSize();if(n.gridContext.clearRect(0,0,n.gridCanvas.width,n.gridCanvas.height),t.settings.snapGridEnabled()){const a=e(window).width(),l=e(window).height(),d=i.left%(o*n.scale),c=i.top%(o*n.scale);n.gridContext.beginPath(),n.gridContext.lineWidth=.5;for(var s=d;s<a;s+=o*n.scale)n.gridContext.moveTo(s,0),n.gridContext.lineTo(s,l);for(var r=c;r<l;r+=o*n.scale)n.gridContext.moveTo(0,r),n.gridContext.lineTo(a,r);if(n.gridContext.stroke(),n.gridContext.closePath(),"blueprint"===t.settings.theme()){n.gridContext.beginPath(),n.gridContext.lineWidth=.25;const e=16,t=200,d=Math.round(Math.min(1,o/t)*e),c=Math.max(1,Math.round(n.scale*d)),p=o*n.scale/c,u=i.left%p,g=i.top%p;for(s=u;s<a;s+=p)n.gridContext.moveTo(s,0),n.gridContext.lineTo(s,l);for(r=g;r<l;r+=p)n.gridContext.moveTo(0,r),n.gridContext.lineTo(a,r);n.gridContext.stroke(),n.gridContext.closePath()}}},this.startUpdatingArrows=function(){n.stopUpdatingArrows(),n.updateArrowsInterval=setInterval(n.updateArrows,n.updateArrowsThrottle)},this.stopUpdatingArrows=function(){n.updateArrowsInterval&&(window.clearInterval(n.updateArrowsInterval),n.updateArrowsInterval=void 0)},this.updateArrows=function(){if(n.isDrawingArrows)return;const i=(new Date).getTime();if(i<n.nextArrowsUpdate)return void(n.deferredArrowsDrawInterval||(n.deferredArrowsDrawInterval=window.setTimeout(n.updateArrows,n.nextArrowsUpdate+n.updateArrowsThrottle-i)));n.isDrawingArrows=!0,window.clearInterval(n.deferredArrowsDrawInterval),n.deferredArrowsDrawInterval=void 0,n.nextArrowsUpdate=i+n.updateArrowsThrottle;const o=t.nodes(),s=e(".nodes-holder").offset(),r=n.scale,a=3*r,l=8*r,d=8*r,c=[],p=[];n.canvas.width=e(window).width(),n.canvas.height=e(window).height(),n.context.lineWidth=a,n.context.strokeStyle=n.context.fillStyle=e(".arrows").css("color");for(let n of o)if(n.halfWidth=e(n.element).width()/2,n.halfHeight=e(n.element).height()/2,n.linkedTo().length)if("straight"===t.settings.lineStyle()){const e=(n.x()+n.halfWidth)*r+s.left,t=(n.y()+n.halfHeight)*r+s.top;for(let i of n.linkedTo()){const n=(i.x()+i.halfWidth)*r+s.left,o=(i.y()+i.halfHeight)*r+s.top,a=Math.sqrt((e-n)*(e-n)+(t-o)*(t-o)),u={x:(n-e)/a,y:(o-t)/a},g=(110+160*(1-Math.max(Math.abs(u.x),Math.abs(u.y))))*r,h={x:e+u.x*g,y:t+u.y*g},f={x:n-u.x*g,y:o-u.y*g};c.push({x1:h.x,y1:h.y,x2:f.x,y2:f.y}),p.push({x1:f.x+10*u.x,y1:f.y+10*u.y,x2:f.x-u.x*l-u.y*d,y2:f.y-u.y*l+u.x*d,x3:f.x-u.x*l+u.y*d,y3:f.y-u.y*l-u.x*d})}}else for(let e of n.linkedTo()){const t=(n.x()+n.halfWidth)*r+s.left,i=(n.y()+n.halfHeight)*r+s.top,o=(e.x()+e.halfWidth)*r+s.left,a=(e.y()+e.halfHeight)*r+s.top,g=(360-180*Math.atan2(a-i,o-t)/Math.PI)%360;let h,f,m,y;var u=!1;g<=45||g>=315?(u=!0,h=(n.x()+n.width)*r+s.left,f=(n.y()+n.halfHeight)*r+s.top,m=e.x()*r+s.left-l,y=(e.y()+e.halfHeight)*r+s.top,p.push({x1:m+l,y1:y,x2:m-l,y2:y-d,x3:m-l,y3:y+d})):g>45&&g<135?(u=!1,h=(n.x()+n.halfWidth)*r+s.left,f=n.y()*r+s.top,m=(e.x()+e.halfWidth)*r+s.left,y=(e.y()+n.height)*r+s.top+d,p.push({x1:m,y1:y-d,x2:m-l,y2:y+d,x3:m+l,y3:y+d})):g>=135&&g<=225?(u=!0,h=n.x()*r+s.left,f=(n.y()+n.halfHeight)*r+s.top,m=(e.x()+e.width)*r+s.left+l,y=(e.y()+e.halfHeight)*r+s.top,p.push({x1:m-l,y1:y,x2:m+l,y2:y-d,x3:m+l,y3:y+d})):g>225&&g<315&&(u=!1,h=(n.x()+n.halfWidth)*r+s.left,f=(n.y()+n.height)*r+s.top,m=(e.x()+e.halfWidth)*r+s.left,y=e.y()*r+s.top-d,p.push({x1:m,y1:y+d,x2:m-l,y2:y-d,x3:m+l,y3:y-d})),c.push({x1:h,y1:f,x2:m,y2:y,drawHorizontal:u})}n.context.beginPath();for(let e of c)n.context.moveTo(e.x1,e.y1),"straight"===t.settings.lineStyle()?n.context.lineTo(e.x2,e.y2):!0===e.drawHorizontal?n.context.bezierCurveTo(e.x2,e.y1,e.x1,e.y2,e.x2,e.y2):n.context.bezierCurveTo(e.x1,e.y2,e.x2,e.y1,e.x2,e.y2);n.context.stroke(),n.context.beginPath();for(let e of p)n.context.moveTo(e.x1,e.y1),n.context.lineTo(e.x2,e.y2),n.context.lineTo(e.x3,e.y3);n.context.fill(),n.isDrawingArrows=!1},this.bringToFront=function(t){const n=e(t),o=i.Utils.getHighestZ(n.parent());n.css("z-index",o+1)},this.selectAll=function(){n.selectNodes(t.nodes())},this.deselectAll=function(){n.deselectNodes(t.nodes())},this.selectNodes=function(e){const i=Array.isArray(e)?e:[e];for(let e of i)if(e.active()&&!n.selectedNodes.includes(e)&&t.canEditNodeMeta(e.title())){if(t.input.isScreenTouched&&t.input.isDragging)return;n.selectedNodes.push(e),e.setSelected(!0)}},this.deselectNodes=function(e){const t=Array.isArray(e)?e:[e];for(let e of t){const t=n.selectedNodes.indexOf(e);e.active()&&t>=0&&(n.selectedNodes.splice(t,1),e.setSelected(!1))}},this.getSelectedNodes=function(){return 1===n.selectedNodes.length?[n.selectedNodes[0]]:Array.apply(this,n.selectedNodes)},this.warpToNodeByIdx=function(e){n.warpToNode(t.nodes()[e]),t.focusedNodeIdx=e},this.warpToSelectedNodeByIdx=function(e){n.warpToNode(n.getSelectedNodes()[e]),t.focusedNodeIdx=e},this.warpToNode=function(t){if(t){var i=e(t.element);n.warpToXY(t.x()||t.createX,t.y()||t.createY),i.clearQueue(),i.transition({outlineColor:"pink",outlineWidth:2,outlineOffset:0},500),setTimeout(()=>{i.transition({outlineColor:"transparent",outlineWidth:1,outlineOffset:50},300)},700)}},this.warpToXY=function(i,o){const s=-i*n.scale,r=-o*n.scale,a=e(window).width()/2,l=e(window).height()/2,d=100*n.scale/2,c=100*n.scale/2;n.setTranslation(s+a-d+t.getSplitEditorXOffset(),r+l-c,100)},this.alignV=function(){if(t.input.isCtrlDown)return void n.reduceAlignV();const e=t.nodes().filter(e=>e.selected).sort((e,t)=>e.y()>t.y()?1:e.y()<t.y()?-1:0);if(e.length<2)return void Swal.fire(o);const i=e.shift();e.forEach((e,t)=>{e.moveTo(i.x(),e.y())})},this.reduceAlignV=function(){const e=t.settings.gridSize(),i=t.nodes().filter(e=>e.selected).sort((e,t)=>e.y()>t.y()?1:e.y()<t.y()?-1:0);if(i.length<2)return void Swal.fire(o);const s=i.shift();t.settings.snapGridEnabled()&&s.moveTo(n.stepify(s.x(),t.settings.gridSize()),n.stepify(s.y(),t.settings.gridSize()));const r=e-(s.y()+s.height)%e+e;i.forEach((e,n)=>{const i=t.settings.snapGridEnabled()?s.y()+e.height*(n+1)+r*(n+1):s.y()+210*(n+1);e.moveTo(s.x(),i)})},this.alignH=function(){if(t.input.isCtrlDown)return void n.reduceAlignH();const e=t.nodes().filter(e=>e.selected).sort((e,t)=>e.x()>t.x()?1:e.x()<t.x()?-1:0);if(e.length<2)return void Swal.fire(o);const i=e.shift();e.forEach((e,t)=>{e.moveTo(e.x(),i.y())})},this.reduceAlignH=function(){const e=t.settings.gridSize(),i=t.nodes().filter(e=>e.selected).sort((e,t)=>e.x()>t.x()?1:e.x()<t.x()?-1:0);if(i.length<2)return void Swal.fire(o);const s=i.shift();t.settings.snapGridEnabled()&&s.moveTo(n.stepify(s.x(),e),n.stepify(s.y(),e));const r=e-(s.x()+s.width)%e+e;i.forEach((e,n)=>{const i=t.settings.snapGridEnabled()?s.x()+e.width*(n+1)+r*(n+1):s.x()+210*(n+1);e.moveTo(i,s.y())})},this.arrangeSpiral=function(){const e=n.getSelectedNodes();e.length<2?Swal.fire(o):(e.forEach((e,i)=>{e.moveTo(t.settings.snapGridEnabled()?n.stepify(Math.cos(.5*i)*(600+30*i),t.settings.gridSize()):Math.cos(.5*i)*(600+30*i),t.settings.snapGridEnabled()?n.stepify(Math.sin(.5*i)*(600+30*i),t.settings.gridSize()):Math.cos(.5*i)*(600+30*i))}),n.warpToXY(0,0))},this.sortAlphabetical=function(){const i=n.getSelectedNodes().sort((e,t)=>e.title().localeCompare(t.title()));if(i.length<2)return void Swal.fire(o);let s=Math.round(i.length/2),r=0,a=0;const l=e(i[0].element).width()+30,d=e(i[0].element).height()+30,c=t.settings.gridSize();t.settings.snapGridEnabled()&&i[0].moveTo(n.stepify(i[0].x(),c),n.stepify(i[0],c)),i.forEach((e,n)=>{n%s?r+=1:(a+=1,r=0),1===n&&(a=0);const o=i[0].x()+i[0].width,p=c-o%c+c,u=i[0].y()+i[0].height,g=c-u%c+c;e.moveTo(t.settings.snapGridEnabled()?i[0].x()+r*e.width+r*p:i[0].x()+r*l,t.settings.snapGridEnabled()?i[0].y()+a*e.height+a*g:i[0].y()+a*d)}),n.warpToNode(i[0])},this.stepify=function(e,t){return Math.round(e/t)*t}}}).call(this,n("EVdn"))},INAQ:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return o}));n("oj90");const o=function(t){const n=this,o=Object.freeze({Left:0,Middle:1,Right:2}),s=Object.freeze({Enter:13,Escape:27,Space:32,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,C:67,D:68,O:79,S:83,V:86,W:87,X:88,Y:89,Z:90});this.keys=s,this.mouse={x:0,y:0},this.isDragging=!1,this.isScreenTouched=!1,this.isMiddleButtonDown=!1,this.isLeftButtonDown=!1,this.isShiftDown=!1,this.isCtrlDown=!1,this.isHoverOverWorkspace=!1,this.trackMouseEvents=function(){e(document).on("pointerdown",e=>{if(n.isDragging="nodes"===e.target.className||"body"===e.target.className&&(n.isMiddleButtonDown||0===t.workspace.selectedNodes.length),n.mouse.x=e.pageX,n.mouse.y=e.pageY,n.isMiddleButtonDown=e.button===o.Middle,this.isLeftButtonDown=e.button===o.Left,t.inWorkspace()){if(n.isDragging)switch(e.button){case o.Left:"nodes"===e.target.className&&t.workspace.onMarqueeStart({x:e.pageX,y:e.pageY});break;case o.Middle:t.workspace.onDragStart({x:e.pageX,y:e.pageY})}}else t.inEditor()&&e.button===o.Right&&(t.guessPopUpHelper(),e.preventDefault())}),window.addEventListener("touchstart",()=>{n.isScreenTouched=!0}),e(document).on("pointermove",e=>{n.mouse.x=e.pageX,n.mouse.y=e.pageY}),e(document).on("mousemove touchmove",e=>{if(n.isDragging){t.focusedNodeIdx=-1;const i=n.isScreenTouched&&e.changedTouches?e.changedTouches[0].pageX:e.pageX,o=n.isScreenTouched&&e.changedTouches?e.changedTouches[0].pageY:e.pageY;t.inWorkspace()&&(e.altKey||n.isMiddleButtonDown||n.isScreenTouched?t.workspace.onDragUpdate({x:i,y:o}):t.workspace.onMarqueeUpdate({x:i,y:o}))}}),e(document).on("pointerup touchend",e=>{n.isScreenTouched=!1,n.isDragging=!1,e.button===o.Left&&(n.isLeftButtonDown=!1),e.button===o.Middle&&(n.isMiddleButtonDown=!1),t.inWorkspace()&&(t.workspace.onDragEnd(),t.workspace.onMarqueeEnd())}),e(".nodes").mousewheel(e=>{e.altKey||(t.inWorkspace()||n.isHoverOverWorkspace)&&(t.workspace.onZoom(e.pageX,e.pageY,e.deltaY),e.preventDefault())}),e(".nodes").hover(()=>{n.isHoverOverWorkspace=!0},()=>{n.isHoverOverWorkspace=!1}),e(".nodes").on("pointerdown",()=>{t.isEditorSplit&&(t.focusEditor(!1),t.makeNewNodesFromLinks(),t.propagateUpdateFromNode(t.editing()),t.mustUpdateTags=!0,t.updateTagsRepository(),t.workspace.updateArrows())}),e(document).contextmenu(n=>{if(!t.inWorkspace())return;const i=e(n.target).hasClass("nodes")||e(n.target).parents(".nodes").length;if(n.button===o.Right&&i){const{x:e,y:i}=t.workspace.toWorkspaceCoordinates(n.pageX,n.pageY);t.newNodeAt(e,i)}return!i})},this.trackKeyboardEvents=function(){e(document).on("keyup keydown",e=>{n.isShiftDown=e.shiftKey,n.isCtrlDown=e.ctrlKey}),e(document).on("keyup",(function(e){if(e.keyCode===s.Space){if(t.inWorkspace()&&e.altKey||t.inEditor()&&!e.altKey)return;t.workspace.scale=1;const n=t.workspace.getSelectedNodes(),i=n.length>0,o=i>0?n:t.nodes();++t.focusedNodeIdx,(t.focusedNodeIdx<0||t.focusedNodeIdx>=o.length)&&(t.focusedNodeIdx=0),t.inWorkspace()?i?t.workspace.warpToSelectedNodeByIdx(t.focusedNodeIdx):t.workspace.warpToNodeByIdx(t.focusedNodeIdx):t.inEditor()&&t.editNode(t.nodes()[t.focusedNodeIdx])}})),e(document).on("keydown",e=>{if(t.inWorkspace()){if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.S:e.preventDefault(),t.data.trySaveCurrent();break;case s.A:if(e.shiftKey){e.preventDefault(),t.data.tryAppend();break}}if((e.metaKey||e.ctrlKey)&&e.altKey)switch(e.keyCode){case s.S:t.data.trySaveCurrent()}else if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.C:t.nodeClipboard=t.cloneNodeArray(t.workspace.getSelectedNodes());break;case s.D:t.workspace.deselectAll();break;case s.O:t.data.tryOpenFile();break;case s.S:t.data.trySaveCurrent();break;case s.X:const e=t.workspace.getSelectedNodes();t.nodeClipboard=t.cloneNodeArray(e),t.deleteNodes(e);break;case s.Y:t.historyDirection("redo");break;case s.Z:t.historyDirection("undo")}else e.keyCode===s.Delete||"Delete"===e.key?t.confirmDeleteNodes(t.workspace.getSelectedNodes()):t.$searchField.is(":focus")||e.ctrlKey||e.metaKey||(e.keyCode===s.A||e.keyCode===s.Left?t.workspace.onPanLeft():e.keyCode===s.D||e.keyCode===s.Right?t.workspace.onPanRight():e.keyCode===s.W||e.keyCode===s.Up?t.workspace.onPanUp():e.keyCode!==s.S&&e.keyCode!==s.Down||t.workspace.onPanDown())}}),e(document).on("keyup",e=>{if(t.inWorkspace())if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.A:t.workspace.selectAll();break;case s.V:t.pasteNodes()}else if(e.keyCode===s.Enter||"Enter"===e.key){const e=t.nodes()[t.focusedNodeIdx];e?t.editNode(e):t.editNode(t.nodes()[0])}}),e(document).on("keydown",(function(e){if(t.inEditor())if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.C:n.clipboard=t.editor.getSelectedText();break;case s.X:document.execCommand("copy"),t.clipboard=t.editor.getSelectedText(),t.insertTextAtCursor("");break;case s.S:t.data.trySaveCurrent()}else switch(e.keyCode){case s.Escape:t.saveNode(),t.closeEditor()}})),e(document).on("keyup",(function(e){if(t.inEditor()&&(e.metaKey||e.ctrlKey)&&e.altKey)switch(e.keyCode){case s.Enter:t.saveNode(),t.closeEditor()}})),e(document).on("keydown",(function(e){if(t.ui.settingsDialogVisible())switch(e.keyCode){case s.Escape:t.ui.closeSettingsDialog()}})),e(document).on("keyup keydown pointerdown pointerup",(function(e){t.inEditor()&&t.updateEditorStats()}))},this.initKnockoutBindings=function(){i.bindingHandlers.preventBubble={init:function(e,t){var n=i.utils.unwrapObservable(t());i.utils.registerEventHandler(e,n,(function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}))}},i.bindingHandlers.mousedown={init:function(t,n,o,s,r){var a=i.unwrap(n());e(t).mousedown((function(){a()}))}}};n.initKnockoutBindings(),n.trackMouseEvents(),n.trackKeyboardEvents()}}).call(this,n("EVdn"),n("Z1dp"))},JGHU:function(e,t,n){"use strict";n.r(t),function(e,i){n.d(t,"JSONEditor",(function(){return o}));var o=function({id:t}){this.tableAdd=({key:t,value:n})=>{var i=this.table.find("tr.hide").clone(!0).removeClass("hide table-line");t&&n&&(console.log("mutate",{key:t,value:n,html:i.html()}),i.html(`\n                <td contenteditable="true" class="cell">${t}</td>\n                <td contenteditable="true" class="cell">${n}</td>\n                <td>\n                    <span class="table-remove glyphicon glyphicon-remove">x delete</span>\n                </td>\n            `),e(".table-remove").on("click",(function(){e(this).parents("tr").detach()}))),this.table.find("table").append(i)},this.getValue=()=>{var t=this.table.find("tr:not(:hidden)"),n=[],i=[];return e(t.shift()).find("th:not(:empty):not([data-attr-ignore])").each((function(){n.push(e(this).text().toLowerCase())})),t.each((function(){var t=e(this).find("td"),o={};n.forEach((function(e,n){o[e]=t.eq(n).text()})),i.push(o)})),i},this.init=()=>{document.getElementById(t).innerHTML='\n        <div class="container">\n  <div id="table" class="table-editable">\n    <table class="table">\n        <tr class="table-header">\n            <th>Key</th>\n            <th>Value</th>\n            <th data-attr-ignore>Remove</th>\n        </tr>\n\n\n      \x3c!-- This is our clonable table line --\x3e\n      <tr class="hide" class="editable-row">\n        <td contenteditable="true" class="cell">key</td>\n        <td contenteditable="true" class="cell">val</td>\n        <td>\n          <span class="table-remove glyphicon glyphicon-remove">x delete</span>\n        </td>\n      </tr>\n    </table>\n\n    <div class="table-footer">\n        <button id="save-btn" class="btn btn-primary">Save Data</button>\n        <p id="save"></p>\n        <span class="table-add glyphicon glyphicon-plus">+ add</span>\n    </div>\n  </div>\n</div>\n        ';var n=e("#table"),o=e("#save-btn");this.table=n,this.rows=n.find("tr:not(:hidden)"),e("#save-btn").addClass("hide"),e(".table-add").on("click",this.tableAdd),e(".table-remove").on("click",(function(){console.log({removeThis:this}),e(this).parents("tr").detach()})),i.fn.pop=[].pop,i.fn.shift=[].shift,o.on("click",this.getValue)},this.init(),this.setValue=(e=[])=>{e.forEach(this.tableAdd)}}}.call(this,n("EVdn"),n("EVdn"))},LaP9:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="LaP9"},P0sH:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return g}));var o=n("owJe"),s=n("W2Rx"),r=n("5dEm"),a=n("INAQ"),l=n("pYPP"),d=n("fkuv"),c=n("2Qx2"),p=n("oj90"),u=n("l8+o"),g=(n("+NoZ"),function(t,g){const h=this;this.utils=p.Utils,this.setTheme=function(t,n){let i=n?n.target.value:t;setTimeout(h.initGrid,50),setTimeout(h.workspace.updateArrows,50),e("#theme-stylesheet").attr("href",p.Utils.getPublicPath(`themes/${i}.css`))},this.setLanguage=function(e,t){const n=t?t.target.value:e;Object(o.load_dictionary)(h.settings.language().split("-")[0]);const i=new CustomEvent("yarnSetLanguage");i.language=n,window.dispatchEvent(i),window.parent.dispatchEvent(i)},this.log=function(e){h.settings.developmentModeEnabled()&&console.log(e)},this.setDocumentType=function(e,t){const n=t?t.target.value:e;h.settings.documentType(n),h.log("Set doc type",e,app.data.inkCompiler),"ink"===n?(null===app.data.inkCompiler&&(app.data.inkCompiler=new app.data.InkCompiler),c.a.addGlobalScopeToInkDoc(),app.setMarkupLanguage("html")):app.data.inkCompiler=null,app.updateNodeLinks();const i=new CustomEvent("yarnSetDocumentType");i.language=n,window.dispatchEvent(i),window.parent.dispatchEvent(i)},this.setMarkupLanguage=function(e,t){const n=t?t.target.value:e;app.settings.markupLanguage(n),h.richTextFormatter=new u.a(h),h.mustRefreshNodes.notifySubscribers()},this.setGistPluginsFile=function(e,t){const n=t?t.target.value:e;app.settings.gistPluginsFile(n)},this.setFiletypeVersion=function(e,t){const n=t?t.target.value:e;h.filetypeVersion=n},this.setGistCredentials=function(e,t){const{token:n,file:i}=e;c.a.storage.setCredentials(n,i)},this.input=new a.a(h),this.settings=new l.a(h),this.workspace=new r.a(h),this.ui=new d.a(h),this.richTextFormatter=new u.a(h),this.data=c.a,this.name=i.observable(t),this.version=i.observable(g),this.editing=i.observable(null),this.nodes=i.observableArray([]),this.tags=i.observableArray([]),this.mustRefreshNodes=i.observable(),this.mustUpdateTags=!0,this.nodeHistory=[],this.nodeFuture=[],this.editingHistory=[],this.editingSaveHistoryTimeout=null,this.focusedNodeIdx=-1,this.isElectron=!1,this.editor=null,this.nodeVisitHistory=[],this.plugins={pluginStorage:{}},this.clipboard="",this.nodeClipboard=[],this.speachInstance=null,this.editingPath=i.observable(null),this.$searchField=e(".search-field"),this.isEditorInPreviewMode=!1,this.isEditorInPlayMode=i.observable(!1),this.isEditorSplit=!1,this.isEditorFocused=!1,this.editorResizeHandleOptions={handleSelector:"#editor-resize-handle",resizeHeight:!1,resizeWidthFrom:"right",onDragStart:function(){h.isSplitEditorInFocus=!0,e("#node-editor").removeClass("split-editor-out-of-focus")},onDragEnd:function(){h.editor.resize(),h.settings.editorSplitSize(e("#editor-form").width())}},this.inEditor=()=>(h.editing()||h.isEditorSplit&&h.isEditorFocused)&&!h.ui.isDialogOpen(),this.inWorkspace=()=>(!h.editing()||h.isEditorSplit&&!1===h.isEditorFocused)&&!h.ui.isDialogOpen(),this.run=function(){var t="Unknown OS";-1!=navigator.platform.indexOf("Win")&&(t="Windows"),-1!=navigator.platform.indexOf("Mac")&&(t="MacOS"),-1!=navigator.platform.indexOf("X11")&&(t="UNIX"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),h.isElectron=navigator.userAgent.toLowerCase().includes("electron");var n=navigator.userAgent||navigator.vendor||window.opera;let o;/android|iPad|iPhone|iPod/.test(n.toLowerCase())&&!window.MSStream&&(t="mobile"),"Windows"==t&&(h.workspace.zoomSpeed=.1),window.addEventListener("beforeunload",e=>(this.data.saveAppStateToLocalStorage(),null)),window.addEventListener("DOMContentLoaded",e=>{if(h.electron){const e=h.electron.remote.process.argv.length>1?h.electron.remote.process.argv[1]:null;if(e&&app.fs.existsSync(e))return void this.data.openFileFromFilePath(e)}this.data.loadAppStateFromLocalStorage();const t=new URL(window.location),n=t.searchParams.get("text")||t.searchParams.get("url");null!==n&&h.insertTextAtCursor(n+"\n",!0)});const s=e("#addPwa")[0];s.style.display="none",window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),o=e,s.style.display="block",s.addEventListener("click",e=>{s.style.display="none",o.prompt(),o.userChoice.then(e=>{"accepted"===e.outcome?(h.log("User accepted the A2HS prompt"),s.style.display="none"):h.log("User dismissed the A2HS prompt"),o=null})})}),e("#app").show(),i.applyBindings(h,e("#app")[0]),h.editingVisualStudioCodeFile()||h.newNode().title("Start"),h.settings.apply(),e(".search-title input").click(h.updateSearch),e(".search-body input").click(h.updateSearch),e(".search-tags input").click(h.updateSearch),h.$searchField.on("input",h.updateSearch),h.$searchField.on("keyup",(function(e){27==e.keyCode?h.clearSearch():h.searchWarp()})),"mobile"===t&&h.workspace.setZoom(3),e(window).on("resize",(function(){h.ui.isScreenNarrow()&&h.editing()&&h.isEditorSplit&&h.toggleEditorView(),h.workspace.updateArrows(),h.initGrid()})),setTimeout(h.initGrid,50),this.guessPopUpHelper=function(){/color=#([a-zA-Z0-9]{3,6})$/.test(h.getTagBeforeCursor())&&h.insertColorCode()},this.insertEmoji=function(){this.emPicker.toggle(),h.togglePreviewMode(!0),e("#emojiPicker-container").css({left:h.input.mouse.x-200,top:h.input.mouse.y-125}),e("#emojiPicker-container").show()},this.insertColorCode=function(){e("#colorPicker-container").is(":visible")||(e("#colorPicker").spectrum("set",h.editor.getSelectedText()),e("#colorPicker").spectrum("toggle"),e("#colorPicker-container").css({left:h.input.mouse.x-70,top:h.input.mouse.y-50}),e("#colorPicker-container").show(),h.togglePreviewMode(!0),setTimeout(()=>{const t=e("#colorPicker").spectrum("get");h.applyPickerColorEditor(t)},100))},this.applyPickerColorEditor=function(e){const t=JSON.parse(JSON.stringify(h.editor.selection.getRange()));h.editor.selection.setRange(t);const n=e.toHexString().replace("#","");h.editor.session.replace(t,n),h.editor.selection.setRange({start:h.editor.getCursorPosition(),end:{row:h.editor.getCursorPosition().row,column:h.editor.getCursorPosition().column-n.length}}),h.togglePreviewMode(!0)},document.addEventListener("contextmenu",(function(e){h.editing()&&e.preventDefault()}),!1),document.ondragover=document.ondrop=e=>{e.preventDefault()},document.body.ondrop=e=>{e.preventDefault();for(var t=0;t<e.dataTransfer.files.length;t++)c.a.appendFile(e.dataTransfer.files[t],e.dataTransfer.files[t].name,!1)},window.addEventListener("message",e=>{const t=e.data;switch(t.type){case"UpdateNode":h.nodes().forEach(e=>{e.title().trim()===t.payload.originalNodeTitle.trim()&&(e.title(t.payload.title),e.tags(t.payload.tags),e.body(t.payload.body),h.setYarnDocumentIsDirty())})}});var r=new CustomEvent("yarnReady");r.document=document,r.data=c.a,r.app=this,window.dispatchEvent(r),window.parent.dispatchEvent(r);const a=new URLSearchParams(window.location.href.split("?")[1]),l=a.get("gist"),d=a.get("fileName");l&&d&&fetch("https://api.github.com/gists/"+l).then(e=>e.json()).then(e=>{const t=e.files[d].content;c.a.openGist(t,d)})},this.limitNodesUpdate=function(e){h.nodes.extend({rateLimit:{method:"notifyWhenChangesStop",timeout:250}}),e(),h.nodes.limit(e=>()=>e())},this.getNodesConnectedTo=function(e){var t=[],n=h.nodes();for(var i in n)if(n[i]!=e&&n[i].isConnectedTo(e,!0)){var o=!1;for(var s in t)if(t[s]==n[i]){o=!0;break}o||t.push(n[i])}return t},this.matchConnectedColorID=function(e){var t=h.getNodesConnectedTo(e);for(var n in t)t[n].colorID(e.colorID())},this.quit=function(){h.isElectron},this.canEditNodeMeta=function(e){return"ink"!==app.settings.documentType()||e.trim()!==c.a.InkGlobalScopeNodeName},this.sanitiseNodeTitle=function(){"ink"===app.settings.documentType()&&(app.editing().title().startsWith("function ")||app.editing().title(app.editing().title().replace(/[ ]/g,"_")))},this.validateTitle=function(){var t=document.getElementById("editorTitle").value,n=e("#editorTitle");h.getOtherNodeTitles().includes(t)||h.titleExistsTwice(t)?(n.attr("class","title title-error"),n.attr("title","Another node has the same title")):"yarn"!==app.settings.documentType()||RegExp("^[a-z0-9]+$","i").test(t)?(n.removeAttr("title"),n.removeClass("title-error")):(n.attr("class","title title-error"),n.attr("title","Only upper or lower case letters and numbers are allowed in a node title."))},this.refreshWindowTitle=function(){let e="";"LOCAL"===app.settings.lastStorageHost()?e="Yarn - "+(c.a.editingPath()||c.a.editingName())+" "+(c.a.isDocumentDirty()?"*":""):"GIST"===app.settings.lastStorageHost()&&(e="Gist - "+(c.a.editingPath()||c.a.editingName())+" "+(c.a.isDocumentDirty()?"*":"")),h.electron?h.electron.remote.getCurrentWindow().setTitle(e):document.title=e},this.usingVisualStudioCodeExtension=function(){return!!window.vsCodeApi},this.editingVisualStudioCodeFile=function(){return!0===window.editingVsCodeFile},this.setYarnDocumentIsDirty=function(){h.usingVisualStudioCodeExtension()&&h.editingVisualStudioCodeFile()&&c.a.getSaveData(c.a.editingType()).then(e=>{window.vsCodeApi.postMessage({type:"DocumentEdit",payload:e})})},this.recordNodeAction=function(e,t){if(h.nodeFuture.length>0){for(var n=0;n<h.nodeFuture.length;n++){delete h.nodeFuture.pop().node}delete h.nodeFuture,h.nodeFuture=[]}var i={action:e,node:t,lastX:t.x(),lastY:t.y()};"removed"==e&&(i.lastY+=80),h.nodeHistory.push(i),h.setYarnDocumentIsDirty()},this.historyDirection=function(e){function t(e){var t=h.nodes.indexOf(e);t>=0&&h.nodes.splice(t,1),h.updateNodeLinks()}var n=null;if(n="undo"==e?h.nodeHistory.pop():h.nodeFuture.pop()){var i=n.action,o=n.node;"undo"==e?("created"==i?(n.lastX=o.x(),n.lastY=o.y(),t(o)):"removed"==i&&h.recreateNode(o,n.lastX,n.lastY),h.nodeFuture.push(n),h.setYarnDocumentIsDirty()):("created"==i?h.recreateNode(o,n.lastX,n.lastY):"removed"==i&&t(o),h.nodeHistory.push(n),h.setYarnDocumentIsDirty())}},this.recreateNode=function(e,t,n){h.nodes.push(e),e.moveTo(t,n),h.updateNodeLinks()},this.setSelectedColors=function(e){var t=h.workspace.getSelectedNodes();for(var n in t.splice(t.indexOf(e),1),t)t[n].colorID(e.colorID())},this.pasteNodes=function(){h.nodeClipboard.length&&(h.workspace.deselectAll(),h.nodeClipboard.forEach((function(e){var t=new s.a({title:h.getUniqueTitle(e.title()),body:e.body(),tags:e.tags(),colorID:e.colorID(),x:e.createX,y:e.createY});h.nodes.push(t),h.workspace.selectNodes(t),h.recordNodeAction("created",t)})),h.updateNodeLinks())},this.confirmDeleteNodes=function(e){const t=Array.isArray(e)?void 0:e,n=Array.isArray(e)?[...e]:t&&t.selected?[...h.workspace.getSelectedNodes()]:[e];n.length&&Swal.fire({title:"Are you sure?",text:`${n.length} ${1===n.length?"node":"nodes"} will be deleted.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(e=>{e.value&&h.deleteNodes(n)})},this.deleteNodes=function(e){const t=Array.isArray(e)?e:[e],n=[];for(let e=t.length-1;e>=0;--e)n.push(t[e].remove());Promise.all(n).then(()=>{h.limitNodesUpdate(()=>{for(let e=t.length-1;e>=0;--e)h.inEditor()&&h.editing()===t[e]&&h.closeEditor(),h.deleteNode(t[e]);h.updateNodeLinks(),h.workspace.deselectNodes(t),h.workspace.updateArrows()})})},this.deleteNode=function(e){const t=h.nodes.indexOf(e);t>=0&&(h.recordNodeAction("removed",e),h.nodes.splice(t,1)),h.setYarnDocumentIsDirty()},this.cloneNodeArray=function(e){return e.map((function(e){return new s.a({title:e.title(),body:e.body(),tags:e.tags(),colorID:e.colorID(),x:e.x()+10,y:e.y()+10})}))},this.newNode=function(e=!0){var t=new s.a;return h.nodes.push(t),e&&h.updateNodeLinks(),h.recordNodeAction("created",t),t},this.newNodeAt=function(e,t){var n=new s.a({x:e-100,y:t-100});return h.nodes.push(n),h.updateNodeLinks(),h.recordNodeAction("created",n),n},this.searchTextInEditor=function(e=!0){e?h.editor.execCommand("find"):h.editor.searchBox&&h.editor.searchBox.hide()},this.showRandomQuote=function(){e.ajax({url:"https://api.forismatic.com/api/1.0/?",dataType:"jsonp",data:"method=getQuote&format=jsonp&lang=en&jsonp=?",success:function(e){Swal.fire({text:e.quoteText+"\n\n-"+e.quoteAuthor})}})},this.editNode=function(t,n=!0){if(!n&&!t.active())return;if(h.settings.alwaysOpenNodesInVisualStudioCodeEditor())return void h.editNodeInVisualStudioCodeEditor(t);h.editing()&&h.editing()!==t&&h.saveNode(!1),h.isEditorInPlayMode()&&h.togglePlayMode(!1),h.isEditorInPreviewMode&&h.togglePreviewMode(!1),t.oldTitle=t.title(),h.editing(t),h.mustUpdateTags=!0,e("#node-editor-background").css({opacity:0}).transition({opacity:1},250),e("#node-editor").css({y:"-100",opacity:0}).transition({y:"0",opacity:1},250),h.editor=ace.edit("editor"),h.editor.setOptions({scrollPastEnd:.5}),h.editor.focus(),h.editor.navigateFileEnd(),e("#colorPicker").spectrum({flat:!0,showButtons:!1,showInput:!0,showPalette:!0,preferredFormat:"hex",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"]],move:function(e){h.applyPickerColorEditor(e)},clickoutFiresChange:!0});const i=ace.require("ace/ext/language_tools"),s=p.Utils.createAutocompleter("ink"===app.settings.documentType()?["divert.target"]:["string.llink","string.rlink"],app.getOtherNodeTitles().map(e=>{const n=h.getNodeByTitle(e);return{word:e,title:e,about:`${n.tags().length>0?`tags: ${n.tags()}<br/>`:""}Preview:<br/>${n.clippedBody()}`,titleStyle:t.titleStyles[n.colorID()]}}),"Node Link");i.setCompleters([s,i.keyWordCompleter,i.textCompleter,i.snippetCompleter]);let r=void 0;h.editor.getSession().on("change",(function(e){const t=h.settings.autoCloseTags();if("insert"===e.action&&t){if(h.richTextFormatter.justInsertedAutoComplete)return void(h.richTextFormatter.justInsertedAutoComplete=!1);r&&clearTimeout(r),r=setTimeout(()=>{r=void 0,h.richTextFormatter.completableTags.forEach(e=>{if(h.getTagBeforeCursor()===e.Start){h.richTextFormatter.justInsertedAutoComplete=!0;let t=e.Completion,n=e.Offset;h.settings.autoCloseBrackets()&&e.BehaviorCompletion&&(t=e.BehaviorCompletion,n+=1),e.Completion&&h.insertTextAtCursor(t),e.Offset&&h.moveEditCursor(n),e.Func&&e.Func()}})},200)}})),this.emPicker=new EmojiPicker(document.getElementById("emojiPickerDom"),e=>{h.insertTextAtCursor(e.char),this.emPicker.toggle(),h.togglePreviewMode(!1)}),Object(o.enable_spellcheck)(),h.toggleInvertColors(),h.toggleShowCounter(),h.toggleSpellCheck(),h.validateTitle(),h.updateEditorStats(),h.updateEditorOptions(),h.$searchField.val().length>0&&e(".search-body input").is(":checked")&&h.editor.findAll(h.$searchField.val()),h.settings.editorSplit()&&(h.splitEditor(),h.workspace.warpToNodeByIdx(t.index()-1)),"right"===h.settings.editorSplitDirection()?(e("#editor-form").addClass("split-editor-right"),e("#editor-resize-handle").addClass("float-right")):(e("#editor-form").removeClass("split-editor-right"),e("#editor-resize-handle").removeClass("float-right")),e(".node-editor").on("pointerdown","> *",(function(e){h.isEditorSplit&&(h.focusEditor(!0),e.stopPropagation())})),e(".app-info").hide(),h.editor.resize(),null!=t.undoManager&&h.editor.session.setUndoManager(t.undoManager);var a=new CustomEvent("yarnEditorOpen");a.document=document,a.data=c.a,a.app=app,window.dispatchEvent(a),window.parent.dispatchEvent(a)},this.splitEditor=function(){h.isEditorSplit=!0,h.focusEditor(!0),h.settings.editorSplit(!0),h.editorResizeHandleOptions.resizeWidthFrom="right"===h.settings.editorSplitDirection()?"left":"right",e("#editor-form").width(h.settings.editorSplitSize()).addClass("split-editor").toggleClass("split-editor-right","right"===h.settings.editorSplitDirection()).resizable(h.editorResizeHandleOptions),e("#node-editor-background").addClass("hidden"),e("#node-editor").css({"z-index":10002}),e("#editor-resize-handle").removeClass("hidden").toggleClass("float-right","right"===h.settings.editorSplitDirection()),e("#split-editor-button").addClass("hidden"),e("#snap-editor-button").removeClass("hidden"),e("#exit-editor").removeClass("hidden"),e("#full-size-editor-button").removeClass("hidden"),e("#split-button-separator").removeClass("hidden"),h.ui.checkAndMoveAppButtons()},this.toggleEditorView=function(){h.settings.editorSplit(!h.settings.editorSplit()),h.reopenEditor()},this.reopenEditor=function(){h.saveNode();let e=h.editing();h.closeEditor(),setTimeout(()=>{h.editNode(e)},250)},this.editorSnapToggle=function(){h.settings.editorSplitDirection("right"===h.settings.editorSplitDirection()?"left":"right"),h.reopenEditor()},this.focusEditor=function(t){!0===t?(e("#node-editor").removeClass("split-editor-unfocused"),h.isEditorFocused=!0):(e("#node-editor").addClass("split-editor-unfocused"),h.isEditorFocused=!1)},this.getSplitEditorXOffset=function(){let t=0;return h.inEditor()&&h.settings.editorSplit()&&(t=e("#editor-form").width()/2,"right"===h.settings.editorSplitDirection()&&(t*=-1)),t},this.editNodeInVisualStudioCodeEditor=function(e){h.usingVisualStudioCodeExtension()?(h.setYarnDocumentIsDirty(),window.vsCodeApi.postMessage({type:"OpenNode",payload:{title:e.title().trim(),tags:e.tags().trim(),body:h.trimBodyLinks(e.body().trim())}})):console.error("Tried to open node in Visual Studio Code text editor but we're not in the Visual Studio Code extension")},this.chooseRelativePathImage=function(e){h.insertTextAtCursor(e)},this.getNodeByTitle=function(e){return h.nodes().find(t=>t.title().trim().toLowerCase()===e.trim().toLowerCase())},this.openNodeByTitle=function(e,t=""){h.isEditorInPlayMode()&&h.togglePlayMode(),h.makeNodeWithName(e);const n=h.nodes().find(t=>t.title().trim().toLowerCase()===e.trim().toLowerCase());n&&(h.editNode(n,!0),t&&setTimeout(()=>h.editor.find(t),200))},this.openLastEditedNode=function(){if(0===h.nodeVisitHistory.length)h.saveNode(),h.closeEditor();else{const e=h.nodeVisitHistory.pop();h.propagateUpdateFromNode(h.editing()),h.openNodeByTitle(e)}},this.getSpellCheckSuggestionItems=function(){var e=Object(o.suggest_word_for_misspelled)(h.editor.getSelectedText());if(e){var t={};return e.forEach(e=>{t[e]={name:e,icon:"edit",callback:e=>{h.insertTextAtCursor(e)}}}),t}return!1},this.getThesaurusItems=function(){var e=n("GLdW")(h.editor.getSelectedText());if(!e)return!1;var t=[];if(Object.keys(e).forEach((function(n){e[n].forEach((function(e){t.includes(e)||e===n||t.push(e)}))})),t.length>0){var i={};return t.forEach(e=>{i[e]={name:e,icon:"edit",callback:e=>{h.insertTextAtCursor(e)}}}),i}return!1},this.toggleSpellCheck=function(){setTimeout((function(){h.settings.spellcheckEnabled()?Object(o.enable_spellcheck)():Object(o.disable_spellcheck)()}),50)},this.toggleInvertColors=function(){const t=h.settings.invertColorsEnabled()?{filter:"invert(100%)"}:{filter:"invert(0%)"};e("#app").css(t),e("#app-bg").css(t),e(".tooltip").css(t),e(".node .body").css(t),e(".editor-container .editor-preview").css(t)},this.initGrid=function(){if(h.settings.snapGridEnabled()){var t=e(window).width(),n=e(window).height();e("#grid-canvas").attr("width",t),e("#grid-canvas").attr("height",n),e("#gridSize").attr("disabled",!1),h.workspace.gridContext.strokeStyle=h.workspace.gridContext.fillStyle=e(".grid-canvas").css("color")}else e("#gridSize").attr("disabled",!0);app.workspace.updateGrid()},this.toggleShowCounter=function(){h.settings.editorStatsEnabled()?e(".node-editor .form .editor-counter").css({display:"initial"}):e(".node-editor .form .editor-counter").css({display:"none"})},this.toggleAutocompleteSuggestions=function(){h.settings.autocompleteSuggestionsEnabled(!h.settings.autocompleteSuggestionsEnabled()),h.updateEditorOptions()},this.toggleAutoCloseBrackets=function(){h.settings.autoCloseBrackets(!h.settings.autoCloseBrackets()),h.updateEditorOptions()},this.updateEditorOptions=function(){h.editor.setOptions({enableBasicAutocompletion:app.settings.autocompleteSuggestionsEnabled(),enableLiveAutocompletion:app.settings.autocompleteSuggestionsEnabled(),behavioursEnabled:app.settings.autoCloseBrackets()})},this.togglePreviewMode=function(t){const n=e(".editor")[0],i=e("#editor-preview")[0];h.isEditorInPreviewMode=t,app.ui.dispatchEvent("yarnInPreviewMode"),t?(e(".bbcode-toolbar").addClass("hidden"),n.style.display="none",i.style.display="block",i.innerHTML=h.richTextFormatter.richTextToHtml(h.editing().body(),!0),i.scrollTop=h.editor.renderer.scrollTop):(e(".bbcode-toolbar").removeClass("hidden"),h.editor.session.setScrollTop(i.scrollTop),i.innerHTML="",i.style.display="none",n.style.display="flex",h.editor.focus(),h.editor.resize(),e("#colorPicker-container").is(":visible")&&e("#colorPicker-container").hide(),e("#emojiPicker-container").is(":visible")&&e("#emojiPicker-container").hide())},this.appendText=function(e){h.editing().body(h.editing().body()+e);const t=h.editor.session.getLength()-1,n=h.editor.session.getLine(t).length;h.editor.gotoLine(t+1,n)},this.moveEditCursor=function(e){const t=h.editor.getCursorPosition();h.editor.gotoLine(t.row+1,t.column+e),h.editor.focus()},this.insertTextAtCursor=function(e,t=!1){if(!h.editing())return;h.editor.session.replace(h.editor.selection.getRange(),"");const n=h.editor.getCursorPosition();if(h.editor.session.insert(n,e),t){const e=h.editor.getCursorPosition();editor.scrollToLine(e.row,!0,!0,(function(){})),h.editor.focus()}h.updateEditorStats(),h.editor.focus()},this.getTagBeforeCursor=function(){const e=h.editor.getSelectionRange(),t=e.start.row,n=h.editor.session.getLine(t).substring(e.start.column-2,e.start.column+2);if(!n)return"";if("ink"===app.settings.documentType()){if(["->"].includes(n.trim()))return n.trim()}else if(["[[","<<"].includes(n.trim())||n.includes("|"))return n.trim();return h.richTextFormatter.identifyTag(n)},this.saveNode=function(){const t=h.editing();if(t){const n=e("#editorTitle")[0],i=h.getFutureEditedNodeTitle();n.value=i,t.title(i),t.body(h.trimBodyLinks(t.body().trim())),h.makeNewNodesFromLinks(),h.propagateUpdateFromNode(t),h.workspace.updateArrows(),setTimeout(h.updateSearch,600),h.setYarnDocumentIsDirty(),app.ui.dispatchEvent("yarnSavedNode")}},this.closeEditor=function(){h.editing().undoManager=h.editor.session.getUndoManager(),e("#node-editor-background").transition({opacity:0},250),e("#node-editor").transition({y:"-100",opacity:0},250,(function(e){h.editing(null),h.editor.destroy(),h.editor=null,this.emPicker=null})),h.isEditorSplit=!1,h.isEditorFocused=!1,e(".app-info").show(),app.ui.resetAppButtonsLocation(),h.isEditorInPlayMode()&&h.togglePlayMode(!1),h.isEditorInPreviewMode&&h.togglePreviewMode(!1)},this.convertMarkup=function(){h.nodes().forEach(e=>{e.body(h.richTextFormatter.convert(e.body()))})},this.updateSearch=p.Utils.debounce((function(){const t=app.$searchField.val().toLowerCase();for(var n=0;n<h.nodes().length;n++){var i=h.nodes()[n],o=e(i.element);const{matchTitle:s,matchBody:r,matchTags:a,clearSearch:l}=app.ui.nodeSearchMatches(i,t);l?(i.active(!0),o.clearQueue(),o.transition({opacity:1},500)):s||r||a?(i.active({title:s,body:r,tags:a}),o.clearQueue(),o.transition({opacity:1},500)):(i.active(!1),o.clearQueue(),o.transition({opacity:.25},500))}}),600),this.trimBodyLinks=function(e){return e.replace(/\[\[(.+?)\|\s*(.+?)\s*\]\]/g,"[[$1|$2]]")},this.updateNodeLinks=function(){for(let e of h.nodes())e.updateLinks()},this.propagateUpdateFromNode=function(e){var t=[],n=[];for(t.push(e);e=t.pop();)n.includes(e)||(n.push(e),e.updateLinks(),e.linkedTo().forEach(e=>{n.includes(e)||t.push(e)}),e.linkedFrom().forEach(e=>{n.includes(e)||t.push(e)}))},this.updateTagsRepository=p.Utils.debounce((function(){if(!app.mustUpdateTags)return;app.mustUpdateTags=!1;h.tags().forEach(e=>e.count=0),h.nodes().forEach(e=>{p.Utils.uniqueSplit(e.tags()," ").forEach(e=>{const t=h.tags().find(t=>t.text==e);if(t)++t.count;else{const t=(()=>{const e=h.tags().map(e=>e.id);for(let t=1;;++t)if(!e.includes(t))return t})();h.tags.push({id:t,style:"tag-style-"+t,text:e,count:1})}})});let e=h.tags().length;for(;e--;)0===h.tags()[e].count&&h.tags().splice(e,1)}),500),this.makeNewNodesFromLinks=function(){if(!h.settings.createNodesEnabled())return console.info("Autocreate new nodes disabled");var e=h.editing().getLinksInNode();if(null!=e)for(var t=0;t<e.length;t++){const i=e[t].trim();var n=220*(t+1);h.makeNodeWithName(i,n)}},this.makeNodeWithName=function(e,t=220){const n=h.getOtherNodeTitles();"ink"!==app.settings.documentType()&&e&&e.length>0&&!n.includes(e)&&e!=h.editing().title()&&h.newNodeAt(h.editing().x()+t,h.editing().y()-120).title(e)},this.titleExistsTwice=function(e){return h.nodes().filter(t=>t.title().trim()===e.trim()).length>1},this.getFutureEditedNodeTitle=function(){const t=e("#editorTitle")[0];return h.getUniqueTitle(t.value.trim())},this.getOtherNodeTitles=function(){const e=[];return h.nodes().forEach(t=>{if(!h.editing()||t.title()!==h.editing().title()){if("ink"===app.settings.documentType()&&t.title().trim()===c.a.InkGlobalScopeNodeName)return;e.push(t.title().trim())}}),e},this.getHighlightedText=function(t){t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\</g,"&lt;")).replace(/\>/g,"&gt;")).replace(/\&lt;\&lt;(.*?)\&gt;\&gt;/g,'<p class="conditionbounds">&lt;&lt;</p><p class="condition">$1</p><p class="conditionbounds">&gt;&gt;</p>')).replace(/\[\[([^\|]*?)\]\]/g,'<p class="linkbounds">[[</p><p class="linkname">$1</p><p class="linkbounds">]]</p>')).replace(/\[\[([^\[\]]*?)\|([^\[\]]*?)\]\]/g,'<p class="linkbounds">[[</p>$1<p style="color:red"><p class="linkbounds">|</p><p class="linkname">$2</p><p class="linkbounds">]]</p>')).replace(/[^:]\/\/(.*)?($|\n)/g,'<span class="comment">//$1</span>\n')).replace(/\/\*((.|[\r\n])*)?\*\//gm,'<span class="comment">/*$1*/</span>')).replace(/\/\%((.|[\r\n])*)?\%\//gm,'<span class="comment">/%$1%/</span>');var n=e("<div>");return n[0].innerHTML=t,n.find(".comment").each((function(){e(this).find("p").each((function(){e(this).removeClass()}))})),n.find(".linkname").each((function(){var t=e(this).text(),n=!1;for(var i in h.nodes())if(h.nodes()[i].title().toLowerCase()==t.toLowerCase()){n=!0;break}n||e(this).removeClass("linkname")})),t=n[0].innerHTML},this.updateLineNumbers=function(t){for(var n=t.split("\n"),i="",o=0;o<Math.max(1,n.length);o++)(0==o||o<n.length-1||n[o].length>0)&&(i+=o+1+"<br />");e(".editor-container .lines").html(i)},this.moveNodes=function(e,t){for(var n in h.nodes()){var i=h.nodes()[n];i.moveTo(i.x()+e,i.y()+t)}},this.getFirstFoundNode=function(e){return h.nodes().find(t=>t.title().toLowerCase().trim()===e)},this.searchWarp=function(){var e=h.$searchField.val().toLowerCase().trim();if(""===e)h.workspace.warpToNodeByIdx(0);else{const t=h.getFirstFoundNode(e);h.workspace.warpToNodeByIdx(h.nodes.indexOf(t))}},this.clearSearch=function(){h.$searchField.val(""),h.updateSearch()},this.updateEditorStats=function(){var t=h.editor.getSession().getValue(),n=h.editor.getCursorPosition(),i=t.split("\n");e(".editor-counter .character-count").html(t.length),e(".editor-counter .line-count").html(i.length),e(".editor-counter .row-index").html(n.row),e(".editor-counter .column-index").html(n.column),c.a.saveAppStateToLocalStorage()},this.getUniqueTitle=function(e){var t=h.getOtherNodeTitles();if(e&&!t.includes(e))return e;var n=e||"Node",i=2;const o=n.match(/^(.*)(_([0-9]+))$/);if(o&&4===o.length&&(n=o[1],i=Number(o[3])),!t.includes(n))return n;for(;;++i){var s=n+"_"+i;if(!t.includes(s))return s}},this.navigateToNodeDuringPlayTest=function(e,t=""){h.openNodeByTitle(e,t),h.togglePlayMode(!0),app.workspace.warpToNode(app.getFirstFoundNode(e))}})}).call(this,n("EVdn"),n("Z1dp"))},"P85/":function(e,t,n){},VgQK:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function({app:e,createButton:t,onLoad:n,setPluginStore:i,getGistFileUrl:o,getSelectedResourceUrl:s,updateUrlParams:r}){const a=this;this.name="ResourcesEditor",this.resourcesFileUrl="",this.resourcesFileContent="",this.isBusy=e=>{document.querySelector("spinner-component").isBusy(e),document.getElementById("resource-file-buttons").className=e?"disabled":""},this.initResourcesFile=()=>new Promise(t=>{e.data.storage.getGistFiles(e.ui.openSettingsDialog).then(({filesInGist:n})=>{const i=Object.values(n).find(e=>"resources.json"===e.filename);if(i)return this.resourcesFileUrl=i.raw_url,e.data.storage.getContentOrRaw(i.content,i.raw_url).then(e=>{t({...i,content:e})});e.data.storage.editGistFile("resources.json","{}").then(({file:e})=>{console.log({result:result}),ToastWc.show({type:"success",content:"Created a resources.json file",time:3e3}),this.resourcesFileUrl=e.raw_url,t(e)})})}),this.onSelectResource=e=>{const t=e.target.value;this.selectedResources=Object.values(e.target.selectedOptions).map(e=>e.id),t.startsWith("data:image")?document.getElementById("selected-resource-preview").innerHTML=`\n        <img src="${t}" style="pointer-events:none;max-width:60vw;object-fit: contain; border: 0;"></img>\n      `:document.getElementById("selected-resource-preview").innerHTML=""},this.onRemoveResource=()=>{const e=JSON.parse(this.resourcesFileContent);this.selectedResources.forEach(t=>{t in e&&delete e[t]});const t=JSON.stringify(e,null,2);this.onCommitResourceFiles(t)};this.onAddResource=e=>{const t=Object.values(e.target.files),n=[];t.forEach(e=>{n.push((e=>new Promise((t,n)=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>t({src:i.result,name:e.name}),i.onerror=e=>n(e)}))(e))}),Promise.all(n).then(e=>{const t=JSON.parse(this.resourcesFileContent);e.forEach(e=>{t[e.name]={src:e.src,added:new Date}});const n=JSON.stringify(t,null,2);this.onCommitResourceFiles(n)})},this.onSelectScroll=()=>{const e=document.getElementById("resources-editor-select"),t=window.innerHeight/2,n=e.scrollTop-t,i=n+e.clientHeight+t+t;for(let t=0;t<e.length;t++){const o=e[t],s=o.offsetTop;o.style["background-image"]=s>n&&s<i?`url(${o.value})`:""}},this.onCommitResourceFiles=t=>{this.isBusy("Uploading changes to gist..."),e.data.storage.editGistFile("resources.json",t).then(e=>{ToastWc.show({type:"info",content:"Saved resources on gist",time:1e3}),this.isBusy("Updating list..."),this.updateResourcesList(t)})},this.updateResourcesList=e=>{const t=JSON.parse(e),n=Object.keys(JSON.parse(e)),i=n.map(e=>{const n=t[e],i="committed"in n;return`<option value="${n.src}" id="${e}" title="${e}" style="${!i&&"border-left:3px solid"}content-visibility:auto;background-size: 25px;background-repeat: no-repeat;background-position-x: right;background-clip: padding-box;">\n         ${e} \n      </option>`});document.getElementById("resource-list-label").innerHTML=n.length+" files",document.getElementById("resources-editor-select").innerHTML=i.join(""),this.onSelectScroll({target:document.getElementById("resources-editor-select")}),this.isBusy("")},this.onOpenResourcesEditor=async()=>{const t="app.plugins."+a.name,{value:n}=await Swal.fire({showCloseButton:!1,showCancelButton:!1,title:`\n        <div class="flex-wrap" style="flex:1;gap: 10px; font-size: 0.9rem">\n        <a id="resourcesFileLink" href="${this.resourcesFileUrl}" target="_blank" rel="noopener noreferrer">resources.json</a>\n        <label for="resources-editor-select" id="resource-list-label">...</label> \n        from <a href="${this.gistId}" target="_blank" rel="noopener noreferrer">Gist</a>\n        </div>\n        `.replaceAll("\n",""),html:`\n        <div id="resources-editor" style="display:flex;height: 80vh; width: 100%; overflow: hidden;">\n          <div style="display:flex;flex:1;gap:3px;" class="row-when-narrow">\n            <div style="width: 300px;display:flex;flex-direction:column;gap:3px;" class="flex-when-narrow">\n              <select id="resources-editor-select" name="resources-editor-select" size="4" multiple="true">\n                <option value="23432423434">...</option>\n              </select>\n              <div id="resource-file-buttons" style="display:flex;justify-content:space-around;">\n                <input type="file" accept="image/*" multiple="true"\n                  id="file-input-res"\n                  style="display:none"\n                />\n                <label class="button" style="padding:3px;" for="file-input-res">\n                  Add Files\n                </label>\n                <button onclick="${t}.onRemoveResource()">Remove</button>\n              </div>\n            </div>\n            <spinner-component id="resourcesLoaderIsBusy" style="position:absolute;right:50%;bottom:20%"></spinner-component> \n            <div id="selected-resource-preview" style="overflow:auto;align-content:center;flex:1;border:1px solid;border-radius:0.7rem;"></div>\n          </div>\n        </div>\n        `,showConfirmButton:!1,focusConfirm:!1,customClass:"swal-wide",width:window.innerWidth-20+"px",onBeforeOpen:()=>{},onAfterClose:()=>{r("selectedResource","")},onOpen:()=>{document.getElementById("file-input-res").addEventListener("change",this.onAddResource),document.getElementById("resources-editor-select").addEventListener("change",this.onSelectResource);const t=e.utils.debounce(this.onSelectScroll,70);document.getElementById("resources-editor-select").removeEventListener("scroll",t),document.getElementById("resources-editor-select").addEventListener("scroll",t),i(a.name,"resourcesEditorOpen",!0),this.isBusy("Loading files from gist..."),this.initResourcesFile().then(e=>{ToastWc.show({type:"success",content:"Editing resources.json at\n"+e.raw_url,time:2e3,onClick:()=>window.open(e.raw_url,"_blank")}),console.log({file:e}),this.resourcesFileContent=e.content||"{}",document.getElementById("resourcesFileLink").href=e.raw_url,r("selectedResource","none"),this.updateResourcesList(this.resourcesFileContent)})},preConfirm:()=>(i(a.name,"resourcesEditorOpen",!1),"")})},n(()=>{this.gistId=o(),o()&&s()&&this.onOpenResourcesEditor(this.resourcesFileContent),t(a.name,{name:"Resources",attachTo:e.settings.developmentModeEnabled()?"appHeader":"fileMenuDropdown",onClick:"onOpenResourcesEditor()",className:"item",id:"resourcesEditorButton",iconName:"image",...e.settings.developmentModeEnabled()?{className:"bbcode-button",style:"padding: 0 10px; margin-top: 3px; font-size: small",as:"span"}:{}})})}},W2Rx:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return r}));var o=n("oj90");let s=0;let r=function(t={}){const n=this;this.titleStyles=["title-style-1","title-style-2","title-style-3","title-style-4","title-style-5","title-style-6","title-style-7","title-style-8","title-style-9"],this.index=e.observable(s++),this.title=e.observable(t.title||app.getUniqueTitle()),this.tags=e.observable(t.tags||""),this.body=e.observable(t.body||""),this.active=e.observable(t.active||!0),this.width=200,this.height=200,this.tempOpacity=null,this.style=null,this.colorID=e.observable(t.colorID||0),this.checked=!1,this.selected=!1,this.createX=t.x||null,this.createY=t.y||null,this.undoManager=null,this.clippedTags=e.computed((function(){return app.updateTagsRepository(),o.Utils.uniqueSplit(n.tags()," ").map(e=>app.tags().find(t=>t.text===e)).filter(e=>e)}),this),this.clippedBody=e.computed((function(){if(app.ui.isScreenNarrow()&&app.editing())return;app.mustRefreshNodes();let e=app.getHighlightedText(this.body());return e=app.richTextFormatter.richTextToHtml(e),e=e.substr(0,225),e}),this),this.linkedTo=e.observableArray(),this.linkedFrom=e.observableArray(),this.element=null,this.canDoubleClick=!0,this.create=function(){if(n.style=window.getComputedStyle(i(n.element).get(0)),n.createX&&n.createY)n.x(n.createX),n.y(n.createY);else{let e=i(n.element).parent();n.x((-e.offset().left+i(window).width()/2-100)/app.workspace.scale),n.y((-e.offset().top+i(window).height()/2-100)/app.workspace.scale)}app.workspace.bringToFront(n.element),app.workspace.startUpdatingArrows(),i(n.element).css({opacity:0,scale:.8,y:"-=80px",rotate:"45deg"}).transition({opacity:1,scale:1,y:"+=80px",rotate:"0deg"},250,"easeInQuad",(function(){app.workspace.stopUpdatingArrows(),app.workspace.updateArrows()})),n.drag(),i(n.element).on("dblclick",(function(){n.canDoubleClick&&app.editNode(n)})),o.Utils.addDoubleTapDetector(n.element,(function(){n.canDoubleClick&&app.editNode(n)})),i(n.element).on("click",(function(e){e.ctrlKey&&(n.selected?app.workspace.deselectNodes(n):app.workspace.selectNodes(n))}))},this.setSelected=function(e){n.selected=e,n.selected?i(n.element).addClass("selected"):i(n.element).removeClass("selected")},this.toggleSelected=function(){n.setSelected(!n.selected)},this.x=function(e){if(null!=e&&i(n.element).css({x:Math.floor(e)}),n.style)return Math.floor(new WebKitCSSMatrix(n.style.webkitTransform).m41)},this.y=function(e){if(null!=e&&i(n.element).css({y:Math.floor(e)}),n.style)return Math.floor(new WebKitCSSMatrix(n.style.webkitTransform).m42)},this.resetDoubleClick=function(){n.canDoubleClick=!0},this.cycleColorDown=function(){n.doCycleColorDown(),setTimeout(n.resetDoubleClick,500),n.canDoubleClick=!1,app.input.isShiftDown&&app.matchConnectedColorID(n),n.selected&&app.setSelectedColors(n),app.setYarnDocumentIsDirty()},this.cycleColorUp=function(){n.doCycleColorUp(),setTimeout(n.resetDoubleClick,500),n.canDoubleClick=!1,app.input.isShiftDown&&app.matchConnectedColorID(n),n.selected&&app.setSelectedColors(n),app.setYarnDocumentIsDirty()},this.doCycleColorDown=function(){n.colorID(n.colorID()-1),n.colorID()<0&&n.colorID(8)},this.doCycleColorUp=function(){n.colorID(n.colorID()+1),n.colorID()>8&&n.colorID(0)},this.remove=async function(){return new Promise((e,t)=>{i(n.element).transition({opacity:0,scale:.8,y:"-=80px",rotate:"-45deg"},250,"easeInQuad",e)})},this.drag=function(){const e={x:0,y:0};let t=!1,o=!1;i(document.body).on("mousemove touchmove",(function(i){if(t){const t=app.input.isScreenTouched&&i.changedTouches?i.changedTouches[0].pageX:i.pageX,s=app.input.isScreenTouched&&i.changedTouches?i.changedTouches[0].pageY:i.pageY;let{x:r,y:a}=app.workspace.toWorkspaceCoordinates(t,s);r-=e.x,a-=e.y;let l=r-n.x(),d=a-n.y();const c=app.workspace.getSelectedNodes();if(("mousemove"===i.originalEvent.type||c.includes(n)&&"touchmove"===i.originalEvent.type)&&(n.x(r),n.y(a)),o&&(n.selected?c.splice(c.indexOf(n),1):c=app.getNodesConnectedTo(n),c.length>0))for(let e in c)c[e].active()&&(c[e].x(c[e].x()+l),c[e].y(c[e].y()+d));app.workspace.updateArrows()}})),i(n.element).on("pointerdown",(function(i){if(!t&&n.active()&&0===i.button){t=!0,(app.input.isShiftDown||n.selected)&&(o=!0);const{x:s,y:r}=app.workspace.toWorkspaceCoordinates(i.pageX,i.pageY);e.x=app.settings.snapGridEnabled()?app.workspace.stepify(s-n.x(),app.settings.gridSize()):s-n.x(),e.y=app.settings.snapGridEnabled()?app.workspace.stepify(r-n.y(),app.settings.gridSize()):r-n.y()}})),i(n.element).on("touchend",(function(e){app.workspace.selectNodes(n)})),i(document).on("pointerup touchend",(function(){(t||o)&&(t=!1,o=!1,app.setYarnDocumentIsDirty())}))},this.moveTo=function(e,t){app.workspace.startUpdatingArrows(),i(n.element).clearQueue(),i(n.element).transition({x:e,y:t},app.stopUpdatingArrows,500)},this.isConnectedTo=function(e,t){if(t&&e.isConnectedTo(n,!1))return!0;let i=n.linkedTo();for(let t in i){if(i[t]==e)return!0;if(i[t].isConnectedTo(e,!1))return!0;if(e.isConnectedTo(i[t],!1))return!0}return!1},this.getLinksInNode=function(e){const t="yarn"===app.settings.documentType();let i=(e||n).body().match(t?/\[\[(.*?)\]\]/g:/\-\>(.*)/g);if(null!=i){let e={};for(let n=i.length-1;n>=0;n--)t?(i[n]=i[n].substr(2,i[n].length-4).trim(),i[n].indexOf("|")>=0&&(i[n]=i[n].split("|")[1]),null!=e[i[n]]&&i.splice(n,1),e[i[n]]=!0):i[n]=i[n].substr(2,i[n].length).trim();return i}},this.updateLinks=function(){n.resetDoubleClick(),n.updateLinksFromParents(),n.updateLinksToChildren()},this.updateLinksFromParents=function(){n.oldTitle&&n.oldTitle!==n.title()&&(n.linkedFrom.removeAll(),app.nodes().forEach(e=>{const t=n.getLinksInNode(e);if(t)if(t.includes(n.oldTitle)){const t=RegExp("\\|\\s*"+n.oldTitle+"\\s*\\]\\]","g"),i=RegExp("\\[\\[\\s*"+n.oldTitle+"\\s*\\]\\]","g");let o=e.body().replace(t,"|"+n.title()+"]]");o=o.replace(i,"[["+n.title()+"]]"),e.body(o),n.linkedFrom.push(e)}else t.includes(n.title())&&n.linkedFrom.push(e)}),n.oldTitle=void 0)},this.updateLinksToChildren=function(){n.linkedTo.removeAll();let e=n.getLinksInNode();if(e)for(let t in app.nodes()){let i=app.nodes()[t];for(let t=0;t<e.length;t++)i!=n&&i.title().trim()===e[t].trim()&&n.linkedTo.push(i)}}};e.bindingHandlers.nodeBind={init:function(e,t,n,i,o){o.$rawData.element=e,o.$rawData.create()},update:function(e,t,n,o,s){i(e).on("pointerdown",(function(){app.workspace.bringToFront(e)}))}}}).call(this,n("Z1dp"),n("EVdn"))},bHyH:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return d}));var o=n("5aMW"),s=n("tn40"),r=n("VgQK");const a=[o.a,s.a,r.a],l={};Promise.all(["public/libs/ink-full.js","public/libs/bondage.min.js"].map(e=>fetch(e))).then(e=>Promise.all(e.map(e=>e.text()))).then(e=>{l.ink=e[0],l.yarn=e[1]});var d=function(t){const n=this,o=e=>(n.pluginStorage||(n.pluginStorage={}),n.pluginStorage[e]||(n.pluginStorage={...n.pluginStorage,[e]:{}}),this.pluginStorage[e]);window.addEventListener("yarnLoadedData",e=>{if(null!==t.data.documentHeader()){const e=t.data.documentHeader();"pluginStorage"in e&&(n.pluginStorage=e.pluginStorage)}}),window.addEventListener("newYarnFileStarted",e=>{n.pluginStorage={}});const s=t.data.db,r=()=>s.getDbValue("volatilePlugins"),d=e=>s.save("volatilePlugins",e),c=new URL(window.location.href),p=c.searchParams;console.log({urlParams:p,url:c});const u=()=>p.get("gistPlugins")||t.settings.gistPluginsFile();this.rawUrls={};const g=()=>new Promise(e=>{t.data.storage.getGist(u()).then(({filesInGist:n})=>{const i=Object.values(n).filter(e=>"JavaScript"===e.language||e.filename.endsWith(".js")||e.filename.endsWith(".json")||e.filename.endsWith(".txt")).map(e=>(this.rawUrls[e.filename]=e.raw_url,t.data.storage.getContentOrRaw(e.content,e.raw_url).then(t=>({...e,content:t}))));e(Promise.all(i))})}),h=(e=!1)=>new Promise(t=>r().then(n=>e?(console.log("---- fetching from gist files ----"),g().then(e=>{const i={};e.forEach(e=>{i[e.filename]=e}),t({...i,...n})}).catch(()=>t(n))):t(n))),f=e=>{try{const t=new Function("parameters","return "+e);if("function"==typeof t){const n=t();if(n){const t=e.indexOf("script:"),i=n()||{},o=e.substring(0,t).split("\n").length;return[{console:!1,...i,scriptStartLn:o},e]}}}catch(t){return console.log({e:t,fileContents:e}),[null,e,t]}return[null,e]},m={app:t,createButton:(e,{name:t,iconName:n,onClick:i,attachTo:o,className:s="item bbcode-button",title:r,onPointerDown:a,onDoubleClick:l,id:d,as:c="span",style:p=""})=>{const u=d||t||r||n;if(null!==document.getElementById(u))return void console.error(`Plugin button creation: Button with the id ${u} already exists. Skip creating it.`);const g=document.createElement(c);return g.id=u,g.innerHTML=`\n      <span class="item ${s||""}" style="${p}" title="${r||""}" ${i?`onclick="click: app.plugins.${e}.${i}"`:""}\n       ${a?` onpointerdown="app.plugins.${e}.${a}"`:""}\n              ${l?`ondblclick="app.plugins.${e}.${l}"`:""}\n       >\n        <svg class="icon menu-icon icon-file-${n} icon-lg icon-fw" style="color:currentColor;"><use xlink:href="public/icons.svg#icon-${n}"></use></svg>\n        ${t||""}\n      </span>\n    `,document.getElementById(o).appendChild(g),g},createToggle:(e,{id:t,attachTo:n,className:i,title:o,tooltipId:s,toggleValueKey:r,onToggle:a,enableKey:l,iconName:d,name:c})=>{const p=t||c||o||d;if(null!==document.getElementById(p))return void console.error(`Plugin button creation: Button with the id ${p} already exists. Skip creating it.`);const u=document.createElement("span");return u.id=p,u.className="styled-checkbox",u.innerHTML=`\n            <input class="styled-checkbox" type="checkbox" id="${r}" data-bind="checked: app.plugins.${e}.${l}, event: { change: app.plugins.${e}.${a} }"></input>\n            <label for="${r}" title="${o}" class="${i}"><span title="${o}" class="button-bubble" id="${s}"></span>\n              <svg class="icon icon-${d} icon-fw icon-lg"><use xlink:href="public/icons.svg#icon-${d}"></use></svg>\n            </label>\n    `,document.getElementById(n).appendChild(u),u},getPluginStore:o,setPluginStore:(e,t,i)=>{const s={...o(e),[t]:i};n.pluginStorage={...n.pluginStorage,[e]:s}},addSettingsItem:({title:n,valueKey:i,defaultValue:o,optionsKey:s,options:r,setterKey:a,settingsColumn:l})=>{t.settings[i]=e.observable(t.settings.storage.getItem(i)||o).extend({persist:i}),t.ui[s]=r,t[a]=function(e,n){const o=n?n.target.value:e;t.settings[i](o)},window.addEventListener("settingsOpened",()=>{const e=t.ui[s].map(e=>`<option value="${e.id}" ${e.id===t.settings[i]()?'selected="true"':""}>${e.name}</option>`).join(""),o=`\n              <label class="settings-label" for="theme">${n}</label>\n              <div class="settings-value markup">\n                <select id="mySelect">\n                   ${e}\n                </select>\n              </div>\n    `,r=document.createElement("div");r.className="settings-item",r.innerHTML=o,document.getElementById("settingsColumn"+(l||"A")).appendChild(r),document.getElementById("mySelect").addEventListener("change",e=>{t[a](!1,e)})})},onYarnLoadedData:e=>{window.addEventListener("yarnLoadedData",t=>{e(t)})},onYarnEditorOpen:e=>{window.addEventListener("yarnEditorOpen",t=>{e(t)})},onYarnInPreviewMode:e=>{window.addEventListener("yarnSavedNode",t=>{e(t)})},onYarnSavedNode:e=>{window.addEventListener("yarnInPreviewMode",t=>{e(t)})},onYarnSetLanguage:e=>{window.addEventListener("yarnSetLanguage",t=>{e(t)})},onYarnLoadedStateFromLocalStorage:e=>{window.addEventListener("yarnLoadedStateFromLocalStorage",t=>{e(t)})},onYarnSavedStateToLocalStorage:e=>{window.addEventListener("yarnSavedStateToLocalStorage",t=>{e(t)})},onYarnSetDocumentType:e=>{window.addEventListener("yarnSetDocumentType",t=>{e(t)})},onKeyUp:e=>{i(document).on("keyup",t=>{e(t)})},onKeyDown:e=>{i(document).on("keydown",t=>{e(t)})},onLoad:e=>{window.addEventListener("DOMContentLoaded",t=>{e(t)})},getVloatilePlugins:r,setVloatilePlugin:(e,t)=>r().then(n=>(n=n||{},s.save("volatilePlugins",{...n,[e]:{...n[e],...t}}))),setVloatilePlugins:d,getGistPluginFiles:g,getGistPluginFile:e=>{if(!u())return Promise.resolve(`// ${e}:\n// No gist id specified - to look for the file`);console.log({rawUrls:this.rawUrls});const n=this.rawUrls[e];return n?t.data.storage.getGistFileFromRawUrl(n):Promise.resolve(`// ${e}:\n// Not found at ${u()}\n// Check if it was deleted or renamed before comitting\n// Commiting changes will create the file at that gist.`)},saveGistPlugin:(e,n)=>(console.log({gistId:t.settings.gistPluginsFile(),fileName:e,contents:n}),t.data.storage.editGist(t.settings.gistPluginsFile(),e,n).then(t=>(this.rawUrls[e]=t.file.raw_url,t))),isGistTokenInvalid:()=>t.data.storage.getIsTokenInvalid(),urlParams:p,updateUrlParams:(e,t)=>{console.log("updateUrlParams",{key:e,value:t}),t?c.searchParams.set(e,t):c.searchParams.delete(e),window.history.replaceState(null,null,c)},getGistPluginsFileUrl:()=>p.get("pluginFile"),getGistPluginsId:u,pluginModeUrl:()=>p.get("mode"),getPluginsList:h,deleteGistPlugin:e=>t.data.storage.deleteGistFile(u(),e),deleteVolatilePlugin:e=>r().then(t=>(e in t&&delete t[e],s.save("volatilePlugins",{...t}))),getExtensionScriptData:f,getPreviewHtml:(e,t,n={})=>{const i=(e.modules||[]).filter(e=>!e.includes("/")&&e in t&&t[e].content).map(e=>{try{const[n,i]=f(t[e].content);if(console.log(e,"----\x3e",{includeData:n}),n&&"script"in n){const t=n.script.toString();return{id:e,body:t.startsWith("function ")?""+t:((e=(()=>{}))=>{const t=e.toString();return e.toString().slice(t.indexOf("{")+1,t.lastIndexOf("}"))})(n.script)}}if(i)return{id:e,body:i}}catch(e){return!1}}).filter(Boolean),o=(e.modules||[]).filter(e=>e.includes("/"));return console.log({data:e,otherFiles:t,localModules:i,remoteModules:o}),`\n    <head>\n      <style>\n        body,\n        head {\n          width: 100%;\n          height: 100%;\n          user-select: none;\n        }\n      </style>\n    </head>\n    <body>\n      <script id="yarnDataJson">\n        const yarnData = ${n};\n      <\/script>\n      ${e.html||e.body||""}\n      ${s=e.parser,"ink"===s?`<script id="inkParserInclude">${l.ink}<\/script>`:"yarn"===s?`<script id="yarnParserInclude">${l.yarn}<\/script>`:""}\n\n      <script id="handle-fallback-message">\n        const logOfConsole = [];\n        const logOfErrors = [];\n        const onUpdateConsoleLogsInternal = (arguments = {}) => {\n          ${!1===e.console&&"if(logOfErrors.length === 0)return;"}\n          window.top.dispatchEvent(\n            new CustomEvent(\n              "previewErrors",\n              {detail: {\n                  errorText: logOfErrors.map(item=>item.arguments.join('')).join('') || Object.values(arguments).join('')\n                }\n              }\n            )\n          )\n          const logMessage = document.querySelector('#logMessage');\n          logMessage.style.display = 'block'\n          const colors = {string: '#00ff00', number: 'red', boolean: '#00fff3', warning: '#ffff008a', log: '#33ff0054', error: 'red', info: '#002bff8a'}\n          logMessage.innerHTML = '<p>-- console logs --</p>' + logOfConsole.map(\n            log => Object.values(log.arguments).map(\n              arg => {\n                let message = '';\n                try {\n                  message = typeof arg == 'object' ? JSON.stringify(arg) : arg;\n                } catch(e){};\n                if(!message) return '';\n                return typeof arg == 'object' ? '<pre style="color:white">' + message +  '</pre>' : '<p style="color:'+ colors[typeof arg] + ';border-right:6px solid ' + colors[log.type] + '">' + message + '</p>'\n              }).join('') // join args\n            ).join('')//join logs\n          logMessage.scrollTop = logMessage.scrollHeight;\n        }\n        window.addEventListener("error", (e) => {\n          console.error({e})\n          const errorText = e.message + "<br>Line: " + (e.lineno - 60 + 1 + ${e.scriptStartLn}) + "<br>Col: " + (e.colno - 4) + "<br> Please see console for more details..";\n          logOfConsole.push({type: 'error', arguments: [e.error.stack || e.message]});\n          logOfErrors.push({type: 'error', arguments: [e.error.stack || e.message]});\n          onUpdateConsoleLogsInternal();\n        });\n        window.addEventListener('unhandledrejection', e => {\n          console.error({e})\n          logOfErrors.push({type: 'error', arguments: [e.reason.stack]});\n          onUpdateConsoleLogsInternal();\n        });\n        const _log = console.log,\n            _warn = console.warn,\n            _info = console.info,\n            _error = console.error;\n        console.log = function() {\n            logOfConsole.push({type: 'log', arguments: arguments});\n            onUpdateConsoleLogsInternal();\n            return _log.apply(console, arguments);\n        };\n        console.warn = function() {\n            logOfConsole.push({type: 'warning', arguments: arguments});\n            onUpdateConsoleLogsInternal();\n            return _warn.apply(console, arguments);\n        };\n        console.error = function() {\n            logOfConsole.push({type: 'error', arguments: arguments});\n            onUpdateConsoleLogsInternal(arguments);\n            return _error.apply(console, arguments);\n        };\n        console.info = function() {\n          logOfConsole.push({type: 'info', arguments: arguments});\n          onUpdateConsoleLogsInternal();\n          return _info.apply(console, arguments);\n        };\n      \n      <\/script>\n      ${o.map(e=>`<script src="${e}" id="${e}" crossorigin="anonymous"><\/script>`).join("")}\n      ${i.map(e=>`<script id="${e.id}" crossorigin="anonymous">${e.body}<\/script>`).join("")}\n      <script type="module">\n      (${e.script||""})()\n      <\/script>\n      <div style="display:flex">\n      <div id="logMessage" style="\n        position: absolute;\n        bottom: 3px;\n        left: 3px;\n        display: none;\n        color: white;\n        background: rgb(0 0 0 / 56%);\n        padding: 6px;\n        border-radius: 0.2rem;\n        font-family: 'Courier New', monospace;\n        word-wrap: break-word;\n        max-height: 70%;\n        max-width: 40%;\n        overflow: auto;\n        line-height: 1rem;\n        flex: 1;\n      ">\n      </div>\n      </div>\n    </body>\n  `;var s},getGistFileUrl:()=>p.get("gistFile")||t.settings.gistFile(),getSelectedResourceUrl:()=>p.get("selectedResource")};a.forEach(e=>{const n=new e(m);window.addEventListener("DOMContentLoaded",e=>{t.plugins[n.name]=n})});h(!0).then(e=>{d(e),Object.values(e).forEach(e=>{const[n]=f(e.content);if(n&&"Constructor"in n&&"name"in n){const e=new n.Constructor(m);t.plugins[n.name]=e,"dependencies"in(i=n)&&i.dependencies.forEach(e=>{const t=document.createElement("script");t.setAttribute("src",e),document.body.appendChild(t),t.addEventListener("load",()=>{console.log("File loaded",e)}),t.addEventListener("error",e=>{console.log("Error on loading file",e)})})}var i})})}}).call(this,n("Z1dp"),n("EVdn"))},e6Wu:function(e,t,n){"use strict";n.r(t);n("3ozf"),n("P85/"),n("uMdg"),n("gugv"),n("sSq8");var i=n("oj90"),o=n("0h2I"),s=n.n(o),r=(n("5uVa"),n("si6p"),n("ghrA"),n("bU/s")),a=n.n(r),l=(n("A8C4"),n("VEX6"),n("jF1P"),n("YhK8"),n("Ab/9"),n("KDOe"),n("PSD3")),d=n.n(l),c=n("P0sH"),p=n("pLxK"),u=n("bHyH");window.ko=s.a,window.$=window.jQuery=n("EVdn"),window.ace=a.a,a.a.config.set("basePath",i.Utils.getPublicPath()),window.define=a.a.define,window.Swal=d.a,"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})}),window.app=new c.a("Yarn",p.a),window.app.run();const g=new u.a(window.app);window.app.plugins=g},fkuv:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return s}));var o=n("2Qx2");const s=function(t){const n=this;this.notification=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2500}),this.dispatchEvent=function(e,t){const n=new CustomEvent(e);n.options=t,window.dispatchEvent(n),window.parent.dispatchEvent(n)},this.settingsDialogVisible=e.observable(!1),this.narrowScreenThreshold=600,this.isScreenNarrow=function(){return i(window).width()<=n.narrowScreenThreshold},this.availableMarkupLanguages=[{id:"bbcode",name:"Bbcode"},{id:"html",name:"Html"}],this.availableFiletypeVersions=[{id:"1",name:"1"},{id:"2",name:"2"}],this.availableThemes=[{id:"classic",name:"Classic"},{id:"blueprint",name:"Blueprint"},{id:"dracula",name:"Dracula"}],this.availableDocumentTypes=[{id:"yarn",name:"Yarn"},{id:"ink",name:"Ink"}],this.availableLanguages=[{name:"Čeština",id:"cs-CZ"},{name:"Deutsch",id:"de-DE"},{name:"English",id:"en-GB"},{name:"Español",id:"es-ES"},{name:"Français",id:"fr-FR"},{name:"Íslenska",id:"is-IS"},{name:"Nederlands",id:"nl-NL"},{name:"Norsk bokmål",id:"nb-NO"},{name:"Polski",id:"pl-PL"},{name:"Română",id:"ro-RO"},{name:"Slovenčina",id:"sk-SK"},{name:"Svenska",id:"sv-SE"},{name:"Türkçe",id:"tr-TR"},{name:"български",id:"bg-BG"},{name:"Pусский",id:"ru-RU"},{name:"Српски",id:"sr-RS"},{name:"한국어",id:"ko-KR"}],this.availableLineStyles=[{id:"straight",name:"Straight Lines"},{id:"bezier",name:"Bezier Curves"}],this.openSettingsDialog=function(){n.settingsDialogVisible(!0),i(".settings-dialog").css({opacity:0}).transition({opacity:1},250),i(".settings-dialog .form").css({y:"-100"}).transition({y:"0"},250);var e=new CustomEvent("settingsOpened");window.dispatchEvent(e)},this.openHelpDialog=function(){Swal.fire({title:"Help",html:'\n      <div style="text-align: justify">\n        <p>Useful editor shortcuts:</p>\n        <small>\n          <ul>\n            <li>Cmd/Ctrl + Left Click -- Create multiple input carets</li>\n            <li>Cmd/Ctrl + Left/Right -- Caret jump word</li>\n            <li>Cmd/Ctrl + Up/Down -- Scroll up/down</li>\n            <li>Cmd/Ctrl + Left/Right + Shift -- Caret jump word selection</li>\n            <li>Cmd/Ctrl + F -- Search</li>\n            <li>Cmd/Ctrl + Alt + K -- Find All</li>\n            <li>Cmd/Ctrl + H -- Search and Replace</li>\n            <li>Cmd/Ctrl + A -- Select all</li>\n            <li>Cmd/Ctrl + U -- To Uppercase</li>\n            <li>Cmd/Ctrl + Shift + U -- To Lowercase</li>\n            <li>Alt + Up/Down -- Move line(s) up/down</li>\n            <li><a href="https://ace.c9.io/demo/keyboard_shortcuts.html" target="_blank">...</a></li>   \n          </ul>\n        </small>\n        <div>How to use <a href="https://yarnspinner.dev/docs/syntax/" target="_blank">Yarn Syntax</a></div>\n        <div>How to use <a href="https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md" target="_blank">Ink Syntax</a></div>\n        <p>Runtimes:</p>\n        <a href="https://github.com/YarnSpinnerTool/YarnSpinner" target="_blank">YarnSpinner (Unity3d)</a>\n        <a href="https://github.com/hylyh/bondage.js" target="_blank">BondageJs (yarn javascript)</a>\n        <a href="https://github.com/inkle/ink-unity-integration" target="_blank">Ink C# (Unity3d)</a>\n        <a href="https://github.com/y-lohse/inkjs" target="_blank">InkJs (javascript)</a>\n        <a href="https://github.com/bladecoder/blade-ink" target="_blank">BladeInk (java)</a>\n        <a href="https://github.com/inkle/ink-library" target="_blank">Many more Ink parsers</a>\n      </div>\n      ',showCancelButton:!0,confirmButtonText:"About",cancelButtonText:"Close"}).then(e=>{e.value&&Swal.fire({title:"About",html:'\n          <div style="text-align: justify">\n            <div><a href="https://github.com/YarnSpinnerTool" target="_blank">Yarn</a> was created by <a href="https://github.com/AlecHolowka" target="_blank">Alec Holowka</a></div>\n            <br>\n            <a href="https://github.com/blurymind/YarnClassic/graphs/contributors" target="_blank">Top contributors:</a>\n            <small>\n              <ul>\n                <li><a href="https://github.com/blurymind" target="_blank">Todor Imreorov</a></li>\n                <li><a href="https://github.com/daviddq" target="_blank">David Diaz</a></li>\n                <li><a href="https://github.com/FaultyFunctions" target="_blank">@FaultyFunctions</a></li>\n              </ul>\n            </small>\n            <a href="https://github.com/blurymind/YarnClassic/issues/new" target="_blank">Report a Bug</a>\n          </div>\n          ',showCancelButton:!1,confirmButtonText:"OK"})})},this.closeSettingsDialog=function(){i(".settings-dialog").css({opacity:1}).transition({opacity:0},250,e=>{n.settingsDialogVisible(!1)}),i(".settings-dialog .form").css({y:"0"}).transition({y:"-100"},250),setTimeout(()=>t.settings.apply(),100)},this.isDialogOpen=function(){return n.settingsDialogVisible()||Swal.isVisible()&&!Swal.isTimerRunning()},this.confirmMarkupConversion=function(){Swal.fire({title:"Are you sure?",text:"Markup on all nodes will be modified. This can rarely result in broken texts. This operation can't be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, convert it!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(e=>{e.value&&(t.convertMarkup(),Swal.fire("Converted!","The markup on the nodes has been converted.","success"))})},this.nodeSearchMatches=function(e,t,n=!1){var o=n||i(".search-title input").is(":checked"),s=n||i(".search-body input").is(":checked"),r=n||i(".search-tags input").is(":checked");return 0!==t.length&&(o||s||r)?{matchTitle:o&&e.title().toLowerCase().indexOf(t)>=0,matchBody:s&&e.body().toLowerCase().indexOf(t)>=0,matchTags:r&&e.tags().toLowerCase().indexOf(t)>=0,clearSearch:!1}:{matchTitle:!1,matchBody:!1,matchTags:!1,clearSearch:!0}},this.findMatchingNodes=function(e){const n={matchTitle:[],matchBody:[],matchTags:[],foundNodes:!1};return[...t.nodes()].reverse().forEach(i=>{const{matchTitle:o,matchBody:s,matchTags:r}=t.ui.nodeSearchMatches(i,e,!0);o&&n.matchTitle.push(i),s&&n.matchBody.push(i),r&&n.matchTags.push(i)}),n.foundNodes=n.matchTitle.length>0||n.matchBody.length>0||n.matchTags.length>0,n},this.createSearchMenuLine=function(e,n,s,r="title"){const a=document.createElement("div");if(a.innerHTML=`${e.title()} ${r?`(${r})`:""}`,i(a).addClass("item "+e.titleStyles[e.colorID()]),"link"==n){if(e.title()!==t.editing().title()){if("ink"===t.settings.documentType()&&e.title().trim()===o.a.InkGlobalScopeNodeName)return;a.setAttribute("onclick","ink"===t.settings.documentType()?"app.insertTextAtCursor('-> "+e.title()+"')":"app.insertTextAtCursor('[["+e.title()+"]]')"),s.appendChild(a)}}else"open"==n&&(a.setAttribute("onclick",`app.openNodeByTitle("${e.title()}")`),a.setAttribute("onmouseenter",`app.workspace.warpToNodeByIdx(${t.nodes.indexOf(e)})`),s.appendChild(a))},this.openNodeListMenu=function(e){const n="link"===e?document.getElementById("linkHelperMenuFilter").value.toLowerCase():document.getElementById("nodeSearchInput").value.toLowerCase(),i=document.getElementById(e+"HelperMenu");i.innerHTML="";const o=()=>{[...t.nodes()].reverse().forEach(t=>{this.createSearchMenuLine(t,e,i,"")})};if(!n)return void o();const s=this.findMatchingNodes(n);s.foundNodes?(s.matchTitle.forEach(t=>{this.createSearchMenuLine(t,e,i,"title")}),s.matchTags.forEach(t=>{this.createSearchMenuLine(t,e,i,"tags")}),s.matchBody.forEach(t=>{this.createSearchMenuLine(t,e,i,"body")})):o()},this.checkAndMoveAppButtons=function(){i(".app-add-node").toggleClass("app-add-node-alt","right"===t.settings.editorSplitDirection()),i(".app-sort").toggleClass("app-sort-alt","right"===t.settings.editorSplitDirection()),i(".app-undo-redo").toggleClass("app-undo-redo-alt","right"===t.settings.editorSplitDirection()),i(".app-zoom").toggleClass("app-zoom-alt","right"===t.settings.editorSplitDirection())},this.resetAppButtonsLocation=function(){i(".app-add-node").removeClass("app-add-node-alt"),i(".app-sort").removeClass("app-sort-alt"),i(".app-undo-redo").removeClass("app-undo-redo-alt"),i(".app-zoom").removeClass("app-zoom-alt")},this.toastMixin=Swal.mixin({toast:!0,icon:"success",title:"Done!",animation:!1,position:"bottom",showConfirmButton:!1,timer:2500,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}}),this.insertTextAtCursorWithParams=function(e="",n=[]){const o=n.map((e,t)=>"boolean"==typeof e.default?`<div class="flex-wrap"><span>${e.name} :</span><input type="checkbox" id="swal-input${t}" class="swal2-input"> </div>`:"number"==typeof e.default?`<div class="flex-wrap"><span>${e.name} :</span><input type="number" step=0.01 id="swal-input${t}" class="swal2-input"> </div>`:`<div class="flex-wrap"><span>${e.name} :</span> <input id="swal-input${t}" class="swal2-input" style="flex:1"></div>`).join("\n");Swal.fire({title:"Snippet properties",html:o,preConfirm:function(){return new Promise((function(e){e(n.map((e,t)=>"boolean"==typeof e.default?i("#swal-input"+t).is(":checked"):i("#swal-input"+t).val()))}))},onOpen:function(){i("#swal-input0").focus(),n.forEach((e,n)=>{void 0!==e.default&&("boolean"==typeof e.default?i("#swal-input"+n)[0].checked=e.default:i("#swal-input"+n)[0].value=e.default,t.log(i("#swal-input"+n)))})}}).then((function(n){if(!n.value)return;let i=e;n.value.forEach((e,t)=>{void 0!==e&&(i=i.replace("%"+t,e))}),t.insertTextAtCursor(i)}))}}}).call(this,n("Z1dp"),n("EVdn"))},gugv:function(e,t,n){},jF1P:function(e,t,n){(function(e){var t,n;t={},n=0,e.bindingHandlers.ace={init:function(i,o,s,r,a){var l=s().aceOptions||{},d=e.utils.unwrapObservable(o());i.id||(i.id="knockout-ace-"+n,n+=1);var c=ace.edit(i.id);l.theme&&c.setTheme("ace/theme/"+l.theme),l.mode&&c.getSession().setMode("ace/mode/"+l.mode),c.setValue(d),c.gotoLine(0),c.setShowPrintMargin(!1),c.getSession().setUseWrapMode(!0),c.getSession().on("change",(function(t){e.isWriteableObservable(o())&&o()(c.getValue())})),t[i.id]=c,e.utils.domNodeDisposal.addDisposeCallback(i,(function(){try{c.destroy()}catch(e){}delete t[i.id]}))},update:function(n,i,o,s,r){var a=e.utils.unwrapObservable(i()),l=n.id;if(void 0!==l&&""!==l&&t.hasOwnProperty(l)){var d=t[l];d.getValue()!==a&&(d.setValue(a),d.gotoLine(0))}}},e.aceEditors={resizeAll:function(){for(var e in t)t.hasOwnProperty(e)&&t[e].resize()},get:function(e){return t[e]}}}).call(this,n("Z1dp"))},"l8+o":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("mIo7"),o=n("mqgS");const s=function(e){const t=t=>{const n=/((https:\/\/)?(www.)?instagram.com\/p\/[^\s\<]+)/gi,i=/(?:http(?:s?):\/\/|)(?:www\.)?youtu(?:be\.com\/watch\?v=|\.be\/)([\w\-\_]*)(&(amp;)?‌​[\w\?‌​=]*)?(?:\?t=[0-9]+)?/gi,o=new RegExp(`^(?!${/(https?:\/\/twitter.com\/[^\s\<]+\/[^\s\<]+\/[^\s\<]+)/gi.source}|${i.source}|${n.source})https?:.*$`,"gm");return t=(t=(t=t.replace(o,(function(e){return`\n      <a class="link" href="${e}">${e}</a>\n    `}))).replace(i,(function(e){const t=e.match(/(?:https\:.*|)(?:www.|)youtu(?:.*\/v\/|.*v\=|\.be\/)([A-Za-z0-9_\-]{11}(?:\?t=[0-9]+)?)/i);if(t.length>1)return`\n        <iframe height="315" src="https://www.youtube.com/embed/${t[1]}" title="YouTube video player"\n              frameBorder="0"\n              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\n              allowFullScreen></iframe> \n      `}))).replace(n,(function(t){const n=t.match(/((?:https?:\/\/)?(?:www.)?instagram.com\/p\/([^\s\<]+)\/)/i);if(n.length>2)return e.log("EXTRACTED",n),`\n            <iframe height="540" src="http://instagram.com/p/${n[2]}/embed" frameborder="0"></iframe>\n      `}))};return"html"===e.settings.markupLanguage()?new o.a(e,t):new i.a(e,t)}},mIo7:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return BbcodeRichTextFormatter}));const bbcode=__webpack_require__("L8pc"),BbcodeRichTextFormatter=function(app,addExtraPreviewerEmbeds){const self=this;this.justInsertedAutoComplete=!1,this.completableTags=Object.freeze([{Start:"<<",Completion:">>",Offset:-2},{Start:"[colo",Completion:"r=#][/color]",Offset:-9,BehaviorCompletion:"r=#][/color",Func:()=>{app.insertColorCode()}},{Start:"[b",Completion:"][/b]",BehaviorCompletion:"][/b",Offset:-4},{Start:"[i",Completion:"][/i]",BehaviorCompletion:"][/i",Offset:-4},{Start:"[img",Completion:"][/img]",BehaviorCompletion:"][/img",Offset:-6},{Start:"[u",Completion:"][/u]",BehaviorCompletion:"][/u",Offset:-4},{Start:"[url",Completion:"][/url]",BehaviorCompletion:"][/url",Offset:-6}]),this.getTagOpen=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"~ ":"{ ":"<<";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"-> ":"* [":"[[";case"color":return"[color=#]";default:return`[${e}]`}},this.getTagClose=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":" }":">>";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":"]":"|]]";default:return`[/${e}]`}},this.identifyTag=function(e){return-1!==e.lastIndexOf("[")?e.substring(e.lastIndexOf("["),e.length):""},this.insertTag=function(e){const t=self.getTagOpen(e),n=self.getTagClose(e),i=JSON.parse(JSON.stringify(app.editor.selection.getRange()));app.editor.session.insert(i.start,t),app.editor.session.insert({column:i.end.column+t.length,row:i.end.row},n),"color"===e&&(0===app.editor.getSelectedText().length?app.moveEditCursor(-9):app.editor.selection.setRange({start:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1},end:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1}}),app.insertColorCode()),"img"===e?0===app.editor.getSelectedText().length&&(app.moveEditCursor(-6),app.data.triggerPasteClipboard(),setTimeout(()=>app.moveEditCursor(6),300)):0===app.editor.getSelectedText().length?app.isEditorInPreviewMode||app.moveEditCursor(-n.length):app.editor.selection.setRange({start:app.editor.selection.getRange().start,end:{row:app.editor.selection.getRange().end.row,column:app.editor.selection.getRange().end.column-n.length}}),app.editor.focus()},this._convertTag=function(inPattern,outPattern,text){const globalRegex=new RegExp(inPattern,"gi"),localRegex=new RegExp(inPattern,"i");return text.replace(globalRegex,m=>{const match=m.match(localRegex),template=eval("`"+outPattern+"`");return match.length?template:null})},this.convert=function(e){let t=e;return t=self._convertTag("<b>(.*?)<\\/b>","[b]${match[1]}[/b]",t),t=self._convertTag("<u>(.*?)<\\/u>","[u]${match[1]}[/u]",t),t=self._convertTag("<i>(.*?)<\\/i>","[i]${match[1]}[/i]",t),t=self._convertTag("<img>(.*?)<\\/img>","[img]${match[1]}[/img]",t),t=self._convertTag("<color=#(.*?)>(.*?)<\\/color>","[color=#${match[1]}]${match[2]}[/color]",t),t=self._convertTag("<url>(.*?)<\\/url>","[url]${match[1]}[/url]",t),t},this.richTextToHtml=function(e,t=!1){let n=1,i=t?'<div><font color="pink">'+n+". </font><font>"+e+"</font></div>":e;return i=i.replace(/<</gi,"<font color='violet'>(run:"),i=i.replace(/>>/gi,")</font>"),i=i.replace(/\[color=#[A-Za-z0-9]+\]/gi,(function(e){const t=e.match(/\[color=#([A-Za-z0-9]+)\]/i);if(t&&t.length>1)return"[color=#"+t[1]+"]<font color=#"+t[1]+">&#9751</font>"})),i=i.replace(/\[img\][^\[]+\[\/img\]/gi,(function(e){const n=e.match(/\[img\](.*)\[\/img\]/i);if(n.length>1){const e=app.data.editingFileFolder(n[1]);return app.data.doesFileExist(e)?t?'<img src="'+e+'"> </img>':'<img src="'+e+'" width="128" height="auto"> </img>':t?'<img src="'+n[1]+'"> </img>':'<img src="'+n[1]+'" width="128" height="auto"> </img>'}})),t&&(i=addExtraPreviewerEmbeds(i)),i=i.replace(/[\n\r]/g,(function(e){let i="</font><br/>";return n+=1,t&&(i+='</div><div><font color="pink">'+n+". </font><font>"),i})),i=bbcode.parse(i),i}}},mqgS:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return HtmlRichTextFormatter}));const HtmlRichTextFormatter=function(app,addExtraPreviewerEmbeds){const self=this;this.justInsertedAutoComplete=!1,this.completableTags=Object.freeze([{Start:"<<",Completion:">>",Offset:-2},{Start:"<colo",Completion:"r=#></color>",Offset:-9,Func:()=>{app.insertColorCode()}},{Start:"<b",Completion:"></b>",Offset:-4},{Start:"<img",Completion:"></img>",Offset:-6},{Start:"<i",Completion:"></i>",Offset:-4},{Start:"<u",Completion:"></u>",Offset:-4},{Start:"<url",Completion:"></url>",Offset:-6}]),this.getTagOpen=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"~ ":"{ ":"<<";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"-> ":"* [":"[[";case"color":return"<color=#>";default:return`<${e}>`}},this.getTagClose=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":" }":">>";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":"]":"|]]";default:return`</${e}>`}},this.identifyTag=function(e){return-1!==e.lastIndexOf("<")?e.substring(e.lastIndexOf("<"),e.length):""},this.insertTag=function(e){const t=self.getTagOpen(e),n=self.getTagClose(e),i=JSON.parse(JSON.stringify(app.editor.selection.getRange()));app.editor.session.insert(i.start,t),app.editor.session.insert({column:i.end.column+t.length,row:i.end.row},n),"color"===e&&(0===app.editor.getSelectedText().length?app.moveEditCursor(-9):app.editor.selection.setRange({start:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1},end:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1}}),app.insertColorCode()),"img"===e?navigator.clipboard.readText().then(e=>{0===app.editor.getSelectedText().length&&(app.moveEditCursor(-7),app.insertTextAtCursor(` src="${e}"`))}):0===app.editor.getSelectedText().length?app.isEditorInPreviewMode||app.moveEditCursor(-n.length):app.editor.selection.setRange({start:app.editor.selection.getRange().start,end:{row:app.editor.selection.getRange().end.row,column:app.editor.selection.getRange().end.column-n.length}}),app.editor.focus()},this._convertTag=function(inPattern,outPattern,text){const globalRegex=new RegExp(inPattern,"gi"),localRegex=new RegExp(inPattern,"i");return text.replace(globalRegex,m=>{const match=m.match(localRegex),template=eval("`"+outPattern+"`");return match.length?template:null})},this.convert=function(e){let t=e;return t=self._convertTag("\\[b\\](.*?)\\[\\/b\\]","<b>${match[1]}</b>",t),t=self._convertTag("\\[u\\](.*?)\\[\\/u\\]","<u>${match[1]}</u>",t),t=self._convertTag("\\[i\\](.*?)\\[\\/i\\]","<i>${match[1]}</i>",t),t=self._convertTag("\\[img\\](.*?)\\[\\/img\\]","<img>${match[1]}</img>",t),t=self._convertTag("\\[color=#(.*?)\\](.*?)\\[\\/color\\]","<color=#${match[1]}>${match[2]}</color>",t),t=self._convertTag("\\[url\\](.*?)\\[\\/url\\]","<url>${match[1]}</url>",t),t},this.richTextToHtml=function(e,t=!1){let n=1,i=t?'<div><font color="pink">'+n+". </font><font>"+e+"</font></div>":e;return i=i.replace(/<</gi,"<font color='violet'>(run:"),i=i.replace(/>>/gi,")</font>"),[/&lt;color=#(.*?)&gt;(.*?)&lt;\/color&gt;/,/<color=#(.*?)>(.*?)<\/color>/].forEach(e=>{const t=new RegExp(e,"gi"),n=new RegExp(e,"i");i=i.replace(t,(function(e){const t=e.match(n);if(t&&t.length>2)return`<font color=#${t[1]}>&#9751${t[2]}</font>`}))}),i=i.replace(/&lt;img&gt;[^\[]+&lt;\/img&gt;/gi,(function(e){const n=e.match(/&lt;img&gt;(.*?)&lt;\/img&gt;/i);if(n.length>1){const e=app.data.editingFileFolder(n[1]);return app.data.doesFileExist(e)?t?'<img src="'+e+'"> </img>':'<img src="'+e+'" width="128" height="auto"> </img>':t?'<img src="'+n[1]+'"> </img>':'<img src="'+n[1]+'" width="128" height="auto"> </img>'}})),i=i.replace(/&lt;b&gt;.*&lt;\/b&gt;/gi,e=>{const t=e.match(/&lt;b&gt;(.*)&lt;\/b&gt;/i);if(t.length)return`<b>${t[1]}</b>`}),i=i.replace(/&lt;u&gt;.*&lt;\/u&gt;/gi,e=>{const t=e.match(/&lt;u&gt;(.*)&lt;\/u&gt;/i);if(t.length)return`<u>${t[1]}</u>`}),i=i.replace(/&lt;i&gt;.*&lt;\/i&gt;/gi,e=>{const t=e.match(/&lt;i&gt;(.*)&lt;\/i&gt;/i);if(t.length)return`<i>${t[1]}</i>`}),t&&(i=addExtraPreviewerEmbeds(i)),i=i.replace(/[\n\r]/g,(function(e){let i="</font><br/>";return n+=1,t&&(i+='</div><div><font color="pink">'+n+". </font><font>"),i})),i}}},"o+ka":function(e,t,n){parcelRequire=function(t,i,o,s){var r,a="function"==typeof parcelRequire&&parcelRequire;function l(e,o){if(!i[e]){if(!t[e]){var s="function"==typeof parcelRequire&&parcelRequire;if(!o&&s)return s(e,!0);if(a)return a(e,!0);if("string"==typeof e)return n("LaP9")(e);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}c.resolve=function(n){return t[e][1][n]||n},c.cache={};var d=i[e]=new l.Module(e);t[e][0].call(d.exports,c,d,d.exports,this)}return i[e].exports;function c(e){return l(c.resolve(e))}}l.isParcelRequire=!0,l.Module=function(e){this.id=e,this.bundle=l,this.exports={}},l.modules=t,l.cache=i,l.parent=a,l.register=function(e,n){t[e]=[function(e,t){t.exports=n},{}]};for(var d=0;d<o.length;d++)try{l(o[d])}catch(t){r||(r=t)}if(o.length){var c=l(o[o.length-1]);e.exports=c}if(parcelRequire=l,r)throw r;return l}({k8CM:[function(e,t,n){var i=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},o=-1;i.Diff=function(e,t){return[e,t]},i.prototype.diff_main=function(e,t,n,o){void 0===o&&(o=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var s=o;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[new i.Diff(0,e)]:[];void 0===n&&(n=!0);var r=n,a=this.diff_commonPrefix(e,t),l=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var d=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var c=this.diff_compute_(e,t,r,s);return l&&c.unshift(new i.Diff(0,l)),d&&c.push(new i.Diff(0,d)),this.diff_cleanupMerge(c),c},i.prototype.diff_compute_=function(e,t,n,s){var r;if(!e)return[new i.Diff(1,t)];if(!t)return[new i.Diff(o,e)];var a=e.length>t.length?e:t,l=e.length>t.length?t:e,d=a.indexOf(l);if(-1!=d)return r=[new i.Diff(1,a.substring(0,d)),new i.Diff(0,l),new i.Diff(1,a.substring(d+l.length))],e.length>t.length&&(r[0][0]=r[2][0]=o),r;if(1==l.length)return[new i.Diff(o,e),new i.Diff(1,t)];var c=this.diff_halfMatch_(e,t);if(c){var p=c[0],u=c[1],g=c[2],h=c[3],f=c[4],m=this.diff_main(p,g,n,s),y=this.diff_main(u,h,n,s);return m.concat([new i.Diff(0,f)],y)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,s):this.diff_bisect_(e,t,s)},i.prototype.diff_lineMode_=function(e,t,n){var s=this.diff_linesToChars_(e,t);e=s.chars1,t=s.chars2;var r=s.lineArray,a=this.diff_main(e,t,!1,n);this.diff_charsToLines_(a,r),this.diff_cleanupSemantic(a),a.push(new i.Diff(0,""));for(var l=0,d=0,c=0,p="",u="";l<a.length;){switch(a[l][0]){case 1:c++,u+=a[l][1];break;case o:d++,p+=a[l][1];break;case 0:if(d>=1&&c>=1){a.splice(l-d-c,d+c),l=l-d-c;for(var g=this.diff_main(p,u,!1,n),h=g.length-1;h>=0;h--)a.splice(l,0,g[h]);l+=g.length}c=0,d=0,p="",u=""}l++}return a.pop(),a},i.prototype.diff_bisect_=function(e,t,n){for(var s=e.length,r=t.length,a=Math.ceil((s+r)/2),l=a,d=2*a,c=new Array(d),p=new Array(d),u=0;u<d;u++)c[u]=-1,p[u]=-1;c[l+1]=0,p[l+1]=0;for(var g=s-r,h=g%2!=0,f=0,m=0,y=0,b=0,v=0;v<a&&!((new Date).getTime()>n);v++){for(var w=-v+f;w<=v-m;w+=2){for(var S=l+w,x=(I=w==-v||w!=v&&c[S-1]<c[S+1]?c[S+1]:c[S-1]+1)-w;I<s&&x<r&&e.charAt(I)==t.charAt(x);)I++,x++;if(c[S]=I,I>s)m+=2;else if(x>r)f+=2;else if(h&&(E=l+g-w)>=0&&E<d&&-1!=p[E]&&I>=(k=s-p[E]))return this.diff_bisectSplit_(e,t,I,x,n)}for(var T=-v+y;T<=v-b;T+=2){for(var k,E=l+T,C=(k=T==-v||T!=v&&p[E-1]<p[E+1]?p[E+1]:p[E-1]+1)-T;k<s&&C<r&&e.charAt(s-k-1)==t.charAt(r-C-1);)k++,C++;if(p[E]=k,k>s)b+=2;else if(C>r)y+=2;else if(!h){var I;if((S=l+g-T)>=0&&S<d&&-1!=c[S])if(x=l+(I=c[S])-S,I>=(k=s-k))return this.diff_bisectSplit_(e,t,I,x,n)}}}return[new i.Diff(o,e),new i.Diff(1,t)]},i.prototype.diff_bisectSplit_=function(e,t,n,i,o){var s=e.substring(0,n),r=t.substring(0,i),a=e.substring(n),l=t.substring(i),d=this.diff_main(s,r,!1,o),c=this.diff_main(a,l,!1,o);return d.concat(c)},i.prototype.diff_linesToChars_=function(e,t){var n=[],i={};function o(e){for(var t="",o=0,r=-1,a=n.length;r<e.length-1;){-1==(r=e.indexOf("\n",o))&&(r=e.length-1);var l=e.substring(o,r+1);(i.hasOwnProperty?i.hasOwnProperty(l):void 0!==i[l])?t+=String.fromCharCode(i[l]):(a==s&&(l=e.substring(o),r=e.length),t+=String.fromCharCode(a),i[l]=a,n[a++]=l),o=r+1}return t}n[0]="";var s=4e4,r=o(e);return s=65535,{chars1:r,chars2:o(t),lineArray:n}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],o=[],s=0;s<i.length;s++)o[s]=t[i.charCodeAt(s)];e[n][1]=o.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,s=0;n<o;)e.substring(s,o)==t.substring(s,o)?s=n=o:i=o,o=Math.floor((i-n)/2+n);return o},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,s=0;n<o;)e.substring(e.length-o,e.length-s)==t.substring(t.length-o,t.length-s)?s=n=o:i=o,o=Math.floor((i-n)/2+n);return o},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):n<i&&(t=t.substring(0,n));var o=Math.min(n,i);if(e==t)return o;for(var s=0,r=1;;){var a=e.substring(o-r),l=t.indexOf(a);if(-1==l)return s;r+=l,0!=l&&e.substring(o-r)!=t.substring(0,r)||(s=r,r++)}},i.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,i=e.length>t.length?t:e;if(n.length<4||2*i.length<n.length)return null;var o=this;function s(e,t,n){for(var i,s,r,a,l=e.substring(n,n+Math.floor(e.length/4)),d=-1,c="";-1!=(d=t.indexOf(l,d+1));){var p=o.diff_commonPrefix(e.substring(n),t.substring(d)),u=o.diff_commonSuffix(e.substring(0,n),t.substring(0,d));c.length<u+p&&(c=t.substring(d-u,d)+t.substring(d,d+p),i=e.substring(0,n-u),s=e.substring(n+p),r=t.substring(0,d-u),a=t.substring(d+p))}return 2*c.length>=e.length?[i,s,r,a,c]:null}var r,a,l,d,c,p=s(n,i,Math.ceil(n.length/4)),u=s(n,i,Math.ceil(n.length/2));return p||u?(r=u?p&&p[4].length>u[4].length?p:u:p,e.length>t.length?(a=r[0],l=r[1],d=r[2],c=r[3]):(d=r[0],c=r[1],a=r[2],l=r[3]),[a,l,d,c,r[4]]):null},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],s=0,r=null,a=0,l=0,d=0,c=0,p=0;a<e.length;)0==e[a][0]?(n[s++]=a,l=c,d=p,c=0,p=0,r=e[a][1]):(1==e[a][0]?c+=e[a][1].length:p+=e[a][1].length,r&&r.length<=Math.max(l,d)&&r.length<=Math.max(c,p)&&(e.splice(n[s-1],0,new i.Diff(o,r)),e[n[s-1]+1][0]=1,s--,a=--s>0?n[s-1]:-1,l=0,d=0,c=0,p=0,r=null,t=!0)),a++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),a=1;a<e.length;){if(e[a-1][0]==o&&1==e[a][0]){var u=e[a-1][1],g=e[a][1],h=this.diff_commonOverlap_(u,g),f=this.diff_commonOverlap_(g,u);h>=f?(h>=u.length/2||h>=g.length/2)&&(e.splice(a,0,new i.Diff(0,g.substring(0,h))),e[a-1][1]=u.substring(0,u.length-h),e[a+1][1]=g.substring(h),a++):(f>=u.length/2||f>=g.length/2)&&(e.splice(a,0,new i.Diff(0,u.substring(0,f))),e[a-1][0]=1,e[a-1][1]=g.substring(0,g.length-f),e[a+1][0]=o,e[a+1][1]=u.substring(f),a++),a++}a++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),o=t.charAt(0),s=n.match(i.nonAlphaNumericRegex_),r=o.match(i.nonAlphaNumericRegex_),a=s&&n.match(i.whitespaceRegex_),l=r&&o.match(i.whitespaceRegex_),d=a&&n.match(i.linebreakRegex_),c=l&&o.match(i.linebreakRegex_),p=d&&e.match(i.blanklineEndRegex_),u=c&&t.match(i.blanklineStartRegex_);return p||u?5:d||c?4:s&&!a&&l?3:a||l?2:s||r?1:0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var o=e[n-1][1],s=e[n][1],r=e[n+1][1],a=this.diff_commonSuffix(o,s);if(a){var l=s.substring(s.length-a);o=o.substring(0,o.length-a),s=l+s.substring(0,s.length-a),r=l+r}for(var d=o,c=s,p=r,u=t(o,s)+t(s,r);s.charAt(0)===r.charAt(0);){o+=s.charAt(0),s=s.substring(1)+r.charAt(0),r=r.substring(1);var g=t(o,s)+t(s,r);g>=u&&(u=g,d=o,c=s,p=r)}e[n-1][1]!=d&&(d?e[n-1][1]=d:(e.splice(n-1,1),n--),e[n][1]=c,p?e[n+1][1]=p:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],s=0,r=null,a=0,l=!1,d=!1,c=!1,p=!1;a<e.length;)0==e[a][0]?(e[a][1].length<this.Diff_EditCost&&(c||p)?(n[s++]=a,l=c,d=p,r=e[a][1]):(s=0,r=null),c=p=!1):(e[a][0]==o?p=!0:c=!0,r&&(l&&d&&c&&p||r.length<this.Diff_EditCost/2&&l+d+c+p==3)&&(e.splice(n[s-1],0,new i.Diff(o,r)),e[n[s-1]+1][0]=1,s--,r=null,l&&d?(c=p=!0,s=0):(a=--s>0?n[s-1]:-1,c=p=!1),t=!0)),a++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push(new i.Diff(0,""));for(var t,n=0,s=0,r=0,a="",l="";n<e.length;)switch(e[n][0]){case 1:r++,l+=e[n][1],n++;break;case o:s++,a+=e[n][1],n++;break;case 0:s+r>1?(0!==s&&0!==r&&(0!==(t=this.diff_commonPrefix(l,a))&&(n-s-r>0&&0==e[n-s-r-1][0]?e[n-s-r-1][1]+=l.substring(0,t):(e.splice(0,0,new i.Diff(0,l.substring(0,t))),n++),l=l.substring(t),a=a.substring(t)),0!==(t=this.diff_commonSuffix(l,a))&&(e[n][1]=l.substring(l.length-t)+e[n][1],l=l.substring(0,l.length-t),a=a.substring(0,a.length-t))),n-=s+r,e.splice(n,s+r),a.length&&(e.splice(n,0,new i.Diff(o,a)),n++),l.length&&(e.splice(n,0,new i.Diff(1,l)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,r=0,s=0,a="",l=""}""===e[e.length-1][1]&&e.pop();var d=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),d=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),d=!0)),n++;d&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,i=0,s=0,r=0,a=0;for(n=0;n<e.length&&(1!==e[n][0]&&(i+=e[n][1].length),e[n][0]!==o&&(s+=e[n][1].length),!(i>t));n++)r=i,a=s;return e.length!=n&&e[n][0]===o?a:a+(t-r)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,s=/>/g,r=/\n/g,a=0;a<e.length;a++){var l=e[a][0],d=e[a][1].replace(n,"&amp;").replace(i,"&lt;").replace(s,"&gt;").replace(r,"&para;<br>");switch(l){case 1:t[a]='<ins style="background:#e6ffe6;">'+d+"</ins>";break;case o:t[a]='<del style="background:#ffe6e6;">'+d+"</del>";break;case 0:t[a]="<span>"+d+"</span>"}}return t.join("")},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==o&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,s=0;s<e.length;s++){var r=e[s][0],a=e[s][1];switch(r){case 1:n+=a.length;break;case o:i+=a.length;break;case 0:t+=Math.max(n,i),n=0,i=0}}return t+Math.max(n,i)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case o:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("\t").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],s=0,r=0,a=t.split(/\t/g),l=0;l<a.length;l++){var d=a[l].substring(1);switch(a[l].charAt(0)){case"+":try{n[s++]=new i.Diff(1,decodeURI(d))}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+d)}break;case"-":case"=":var c=parseInt(d,10);if(isNaN(c)||c<0)throw new Error("Invalid number in diff_fromDelta: "+d);var p=e.substring(r,r+=c);"="==a[l].charAt(0)?n[s++]=new i.Diff(0,p):n[s++]=new i.Diff(o,p);break;default:if(a[l])throw new Error("Invalid diff operation in diff_fromDelta: "+a[l])}}if(r!=e.length)throw new Error("Delta length ("+r+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(t),o=this;function s(e,i){var s=e/t.length,r=Math.abs(n-i);return o.Match_Distance?s+r/o.Match_Distance:r?1:s}var r=this.Match_Threshold,a=e.indexOf(t,n);-1!=a&&(r=Math.min(s(0,a),r),-1!=(a=e.lastIndexOf(t,n+t.length))&&(r=Math.min(s(0,a),r)));var l,d,c=1<<t.length-1;a=-1;for(var p,u=t.length+e.length,g=0;g<t.length;g++){for(l=0,d=u;l<d;)s(g,n+d)<=r?l=d:u=d,d=Math.floor((u-l)/2+l);u=d;var h=Math.max(1,n-d+1),f=Math.min(n+d,e.length)+t.length,m=Array(f+2);m[f+1]=(1<<g)-1;for(var y=f;y>=h;y--){var b=i[e.charAt(y-1)];if(m[y]=0===g?(m[y+1]<<1|1)&b:(m[y+1]<<1|1)&b|(p[y+1]|p[y])<<1|1|p[y+1],m[y]&c){var v=s(g,y-1);if(v<=r){if(r=v,!((a=y-1)>n))break;h=Math.max(1,2*n-a)}}}if(s(g+1,n)>r)break;p=m}return a},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var n=t.substring(e.start2,e.start2+e.length1),o=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)o+=this.Patch_Margin,n=t.substring(e.start2-o,e.start2+e.length1+o);o+=this.Patch_Margin;var s=t.substring(e.start2-o,e.start2);s&&e.diffs.unshift(new i.Diff(0,s));var r=t.substring(e.start2+e.length1,e.start2+e.length1+o);r&&e.diffs.push(new i.Diff(0,r)),e.start1-=s.length,e.start2-=s.length,e.length1+=s.length+r.length,e.length2+=s.length+r.length}},i.prototype.patch_make=function(e,t,n){var s,r;if("string"==typeof e&&"string"==typeof t&&void 0===n)s=e,(r=this.diff_main(s,t,!0)).length>2&&(this.diff_cleanupSemantic(r),this.diff_cleanupEfficiency(r));else if(e&&"object"==typeof e&&void 0===t&&void 0===n)r=e,s=this.diff_text1(r);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===n)s=e,r=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");s=e,r=n}if(0===r.length)return[];for(var a=[],l=new i.patch_obj,d=0,c=0,p=0,u=s,g=s,h=0;h<r.length;h++){var f=r[h][0],m=r[h][1];switch(d||0===f||(l.start1=c,l.start2=p),f){case 1:l.diffs[d++]=r[h],l.length2+=m.length,g=g.substring(0,p)+m+g.substring(p);break;case o:l.length1+=m.length,l.diffs[d++]=r[h],g=g.substring(0,p)+g.substring(p+m.length);break;case 0:m.length<=2*this.Patch_Margin&&d&&r.length!=h+1?(l.diffs[d++]=r[h],l.length1+=m.length,l.length2+=m.length):m.length>=2*this.Patch_Margin&&d&&(this.patch_addContext_(l,u),a.push(l),l=new i.patch_obj,d=0,u=g,c=p)}1!==f&&(c+=m.length),f!==o&&(p+=m.length)}return d&&(this.patch_addContext_(l,u),a.push(l)),a},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n],s=new i.patch_obj;s.diffs=[];for(var r=0;r<o.diffs.length;r++)s.diffs[r]=new i.Diff(o.diffs[r][0],o.diffs[r][1]);s.start1=o.start1,s.start2=o.start2,s.length1=o.length1,s.length2=o.length2,t[n]=s}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,s=[],r=0;r<e.length;r++){var a,l,d=e[r].start2+i,c=this.diff_text1(e[r].diffs),p=-1;if(c.length>this.Match_MaxBits?-1!=(a=this.match_main(t,c.substring(0,this.Match_MaxBits),d))&&(-1==(p=this.match_main(t,c.substring(c.length-this.Match_MaxBits),d+c.length-this.Match_MaxBits))||a>=p)&&(a=-1):a=this.match_main(t,c,d),-1==a)s[r]=!1,i-=e[r].length2-e[r].length1;else if(s[r]=!0,i=a-d,c==(l=-1==p?t.substring(a,a+c.length):t.substring(a,p+this.Match_MaxBits)))t=t.substring(0,a)+this.diff_text2(e[r].diffs)+t.substring(a+c.length);else{var u=this.diff_main(c,l,!1);if(c.length>this.Match_MaxBits&&this.diff_levenshtein(u)/c.length>this.Patch_DeleteThreshold)s[r]=!1;else{this.diff_cleanupSemanticLossless(u);for(var g,h=0,f=0;f<e[r].diffs.length;f++){var m=e[r].diffs[f];0!==m[0]&&(g=this.diff_xIndex(u,h)),1===m[0]?t=t.substring(0,a+g)+m[1]+t.substring(a+g):m[0]===o&&(t=t.substring(0,a+g)+t.substring(a+this.diff_xIndex(u,h+m[1].length))),m[0]!==o&&(h+=m[1].length)}}}}return[t=t.substring(n.length,t.length-n.length),s]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",o=1;o<=t;o++)n+=String.fromCharCode(o);for(o=0;o<e.length;o++)e[o].start1+=t,e[o].start2+=t;var s=e[0],r=s.diffs;if(0==r.length||0!=r[0][0])r.unshift(new i.Diff(0,n)),s.start1-=t,s.start2-=t,s.length1+=t,s.length2+=t;else if(t>r[0][1].length){var a=t-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],s.start1-=a,s.start2-=a,s.length1+=a,s.length2+=a}return 0==(r=(s=e[e.length-1]).diffs).length||0!=r[r.length-1][0]?(r.push(new i.Diff(0,n)),s.length1+=t,s.length2+=t):t>r[r.length-1][1].length&&(a=t-r[r.length-1][1].length,r[r.length-1][1]+=n.substring(0,a),s.length1+=a,s.length2+=a),n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var s=e[n];e.splice(n--,1);for(var r=s.start1,a=s.start2,l="";0!==s.diffs.length;){var d=new i.patch_obj,c=!0;for(d.start1=r-l.length,d.start2=a-l.length,""!==l&&(d.length1=d.length2=l.length,d.diffs.push(new i.Diff(0,l)));0!==s.diffs.length&&d.length1<t-this.Patch_Margin;){var p=s.diffs[0][0],u=s.diffs[0][1];1===p?(d.length2+=u.length,a+=u.length,d.diffs.push(s.diffs.shift()),c=!1):p===o&&1==d.diffs.length&&0==d.diffs[0][0]&&u.length>2*t?(d.length1+=u.length,r+=u.length,c=!1,d.diffs.push(new i.Diff(p,u)),s.diffs.shift()):(u=u.substring(0,t-d.length1-this.Patch_Margin),d.length1+=u.length,r+=u.length,0===p?(d.length2+=u.length,a+=u.length):c=!1,d.diffs.push(new i.Diff(p,u)),u==s.diffs[0][1]?s.diffs.shift():s.diffs[0][1]=s.diffs[0][1].substring(u.length))}l=(l=this.diff_text2(d.diffs)).substring(l.length-this.Patch_Margin);var g=this.diff_text1(s.diffs).substring(0,this.Patch_Margin);""!==g&&(d.length1+=g.length,d.length2+=g.length,0!==d.diffs.length&&0===d.diffs[d.diffs.length-1][0]?d.diffs[d.diffs.length-1][1]+=g:d.diffs.push(new i.Diff(0,g))),c||e.splice(++n,0,d)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),s=0,r=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;s<n.length;){var a=n[s].match(r);if(!a)throw new Error("Invalid patch string: "+n[s]);var l=new i.patch_obj;for(t.push(l),l.start1=parseInt(a[1],10),""===a[2]?(l.start1--,l.length1=1):"0"==a[2]?l.length1=0:(l.start1--,l.length1=parseInt(a[2],10)),l.start2=parseInt(a[3],10),""===a[4]?(l.start2--,l.length2=1):"0"==a[4]?l.length2=0:(l.start2--,l.length2=parseInt(a[4],10)),s++;s<n.length;){var d=n[s].charAt(0);try{var c=decodeURI(n[s].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+c)}if("-"==d)l.diffs.push(new i.Diff(o,c));else if("+"==d)l.diffs.push(new i.Diff(1,c));else if(" "==d)l.diffs.push(new i.Diff(0,c));else{if("@"==d)break;if(""!==d)throw new Error('Invalid patch mode "'+d+'" in: '+c)}s++}}return t},(i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0}).prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case 1:e="+";break;case o:e="-";break;case 0:e=" "}t[n+1]=e+encodeURI(this.diffs[n][1])+"\n"}return t.join("").replace(/%20/g," ")},t.exports=i,t.exports.diff_match_patch=i,t.exports.DIFF_DELETE=o,t.exports.DIFF_INSERT=1,t.exports.DIFF_EQUAL=0},{}],iSlp:[function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return e&&"object"===i(e)&&!Array.isArray(e)&&null!==e}t.exports=function e(t,n){return o(t)&&o(n)&&Object.keys(n).forEach((function(i){o(n[i])?(t[i]&&o(t[i])||(t[i]=n[i]),e(t[i],n[i])):Object.assign(t,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},i,n[i]))})),t}},{}],Os6R:[function(e,t,n){t.exports=function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=null,s=!0;return function(){for(var r=arguments.length,a=new Array(r),l=0;l<r;l++)a[l]=arguments[l];var d=function(){e.apply(n,a),o=null};i&&s&&(s=!1,d()),o||(o=setTimeout(d,t))}}},{}],gTec:[function(e,t,n){t.exports=function(e,t){var n,i=this;return function(){for(var o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];var a=i;clearTimeout(n),n=setTimeout((function(){return e.apply(a,s)}),t)}}},{}],xRfK:[function(e,t,n){t.exports=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/\r\n/g,"\n")}},{}],j8WE:[function(e,t,n){t.exports=function(e,t,n,i){var o=e+(n-e)/2;return"M ".concat(e," ").concat(t," C ").concat(o,",").concat(t," ").concat(o,",").concat(i," ").concat(n,",").concat(i)}},{}],iJA9:[function(e,t,n){t.exports={DIFF_EQUAL:0,DIFF_DELETE:-1,DIFF_INSERT:1,EDITOR_RIGHT:"right",EDITOR_LEFT:"left",RTL:"rtl",LTR:"ltr",SVG_NS:"http://www.w3.org/2000/svg",DIFF_GRANULARITY_SPECIFIC:"specific",DIFF_GRANULARITY_BROAD:"broad"}},{}],gWhB:[function(e,t,n){var i=e("../constants");t.exports=function(e,t){var n=e.options.mode;return t===i.EDITOR_LEFT&&null!==e.options.left.mode&&(n=e.options.left.mode),t===i.EDITOR_RIGHT&&null!==e.options.right.mode&&(n=e.options.right.mode),n}},{"../constants":"iJA9"}],IRlp:[function(e,t,n){var i=e("../constants");t.exports=function(e,t){var n=e.options.theme;return t===i.EDITOR_LEFT&&null!==e.options.left.theme&&(n=e.options.left.theme),t===i.EDITOR_RIGHT&&null!==e.options.right.theme&&(n=e.options.right.theme),n}},{"../constants":"iJA9"}],L8P8:[function(e,t,n){t.exports=function(e,t){return e.ace.getSession().doc.getLine(t)}},{}],gpkQ:[function(e,t,n){t.exports=function(e){return document.getElementById(e.options.left.id).offsetHeight}},{}],QEUm:[function(e,t,n){t.exports=function(e){var t=document.createElement("div"),n={class:e.className,style:"top:".concat(e.topOffset,"px"),title:e.tooltip,"data-diff-index":e.diffIndex};for(var i in n)t.setAttribute(i,n[i]);return t.innerHTML=e.arrowContent,t}},{}],f1Db:[function(e,t,n){t.exports=function(e,t){var n=Math.random().toString(36).substr(2,5),i="js-".concat(t,"-").concat(n),o=e.querySelector(".".concat(t));if(o)return o.id=o.id||i,o.id;var s=document.createElement("div");return e.appendChild(s),s.className=t,s.id=i,s.id}},{}],FPMV:[function(e,t,n){t.exports={on:function(e,t,n,i){var o="document"===e?document:document.querySelector(e);o.addEventListener(t,(function(e){for(var t=o.querySelectorAll(n),s=e.target,r=0,a=t.length;r<a;r+=1)for(var l=s,d=t[r];l&&l!==o;)l===d&&i.call(d,e),l=l.parentNode}))}}},{}],Focm:[function(e,t,n){var i,o=e("diff-match-patch"),s=e("./helpers/merge"),r=e("./helpers/throttle"),a=e("./helpers/debounce"),l=e("./helpers/normalizeContent"),d=e("./visuals/getCurve"),c=e("./visuals/getMode"),p=e("./visuals/getTheme"),u=e("./visuals/getLine"),g=e("./visuals/getEditorHeight"),h=e("./visuals/createArrow"),f=e("./dom/ensureElement"),m=e("./dom/query"),y=e("./constants");function b(e){if(e.Range)return e.Range;var t=e.acequire||e.require;return!!t&&t("ace/range")}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(this instanceof v))return new v(e);var t=this;t.options=s({ace:window?window.ace:void 0,mode:null,theme:null,element:null,diffGranularity:y.DIFF_GRANULARITY_BROAD,lockScrolling:!1,showDiffs:!0,showConnectors:!0,maxDiffs:5e3,left:{id:null,content:null,mode:null,theme:null,editable:!0,copyLinkEnabled:!0},right:{id:null,content:null,mode:null,theme:null,editable:!0,copyLinkEnabled:!0},classes:{gutterID:"acediff__gutter",diff:"acediff__diffLine",connector:"acediff__connector",newCodeConnectorLink:"acediff__newCodeConnector",newCodeConnectorLinkContent:"&#8594;",deletedCodeConnectorLink:"acediff__deletedCodeConnector",deletedCodeConnectorLinkContent:"&#8592;",copyRightContainer:"acediff__copy--right",copyLeftContainer:"acediff__copy--left"},connectorYOffset:0},e);var n=t.options.ace;if(!n){var o="No ace editor found nor supplied - `options.ace` or `window.ace` is missing";return console.error(o),new Error(o)}if(!(i=b(n))){var r="Could not require Range module for Ace. Depends on your bundling strategy, but it usually comes with Ace itself. See https://ace.c9.io/api/range.html, open an issue on GitHub ace-diff/ace-diff";return console.error(r),new Error(r)}if(null===t.options.element){var a="You need to specify an element for Ace-diff - `options.element` is missing";return console.error(a),new Error(a)}if(t.options.element instanceof HTMLElement?t.el=t.options.element:t.el=document.body.querySelector(t.options.element),!t.el){var d="Can't find the specified element ".concat(t.options.element);return console.error(d),new Error(d)}t.options.left.id=f(t.el,"acediff__left"),t.options.classes.gutterID=f(t.el,"acediff__gutter"),t.options.right.id=f(t.el,"acediff__right"),t.el.innerHTML='<div class="acediff__wrap">'.concat(t.el.innerHTML,"</div>"),t.editors={left:{ace:n.edit(t.options.left.id),markers:[],lineLengths:[]},right:{ace:n.edit(t.options.right.id),markers:[],lineLengths:[]},editorHeight:null},t.editors.left.ace.getSession().setMode(c(t,y.EDITOR_LEFT)),t.editors.right.ace.getSession().setMode(c(t,y.EDITOR_RIGHT)),t.editors.left.ace.setReadOnly(!t.options.left.editable),t.editors.right.ace.setReadOnly(!t.options.right.editable),t.editors.left.ace.setTheme(p(t,y.EDITOR_LEFT)),t.editors.right.ace.setTheme(p(t,y.EDITOR_RIGHT)),t.editors.left.ace.setValue(l(t.options.left.content),-1),t.editors.right.ace.setValue(l(t.options.right.content),-1),t.editors.editorHeight=g(t),setTimeout((function(){t.lineHeight=t.editors.left.ace.renderer.lineHeight,S(t),_(t),A(t),t.diff()}),1)}v.prototype={setOptions:function(e){s(this.options,e),this.diff()},getNumDiffs:function(){return this.diffs.length},getEditors:function(){return{left:this.editors.left.ace,right:this.editors.right.ace}},diff:function(){var e=this,t=new o,n=this.editors.left.ace.getSession().getValue(),i=this.editors.right.ace.getSession().getValue(),s=t.diff_main(i,n);t.diff_cleanupSemantic(s),this.editors.left.lineLengths=T(this.editors.left),this.editors.right.lineLengths=T(this.editors.right);var r=[],a={left:0,right:0};s.forEach((function(t,n,i){var o=t[0],l=t[1];i[n+1]&&l.endsWith("\n")&&i[n+1][1].startsWith("\n")&&(l+="\n",s[n][1]=l,s[n+1][1]=s[n+1][1].replace(/^\n/,"")),0!==l.length&&(o===y.DIFF_EQUAL?(a.left+=l.length,a.right+=l.length):o===y.DIFF_DELETE?(r.push(I(e,y.DIFF_DELETE,a.left,a.right,l)),a.right+=l.length):o===y.DIFF_INSERT&&(r.push(I(e,y.DIFF_INSERT,a.left,a.right,l)),a.left+=l.length))}),this),this.diffs=function(e,t){var n=[];function i(t){return e.options.diffGranularity===y.DIFF_GRANULARITY_SPECIFIC?t<1:t<=1}t.forEach((function(e,t){if(0!==t){for(var o=!1,s=0;s<n.length;s+=1)if(i(Math.abs(e.leftStartLine-n[s].leftEndLine))&&i(Math.abs(e.rightStartLine-n[s].rightEndLine))){n[s].leftStartLine=Math.min(e.leftStartLine,n[s].leftStartLine),n[s].rightStartLine=Math.min(e.rightStartLine,n[s].rightStartLine),n[s].leftEndLine=Math.max(e.leftEndLine,n[s].leftEndLine),n[s].rightEndLine=Math.max(e.rightEndLine,n[s].rightEndLine),o=!0;break}o||n.push(e)}else n.push(e)}));var o=[];return n.forEach((function(e){e.leftStartLine===e.leftEndLine&&e.rightStartLine===e.rightEndLine||o.push(e)})),o}(this,r),this.diffs.length>this.options.maxDiffs||(C(this),M(this))},destroy:function(){var e=this.editors.left.ace.getValue();this.editors.left.ace.destroy();var t=this.editors.left.ace.container,n=t.cloneNode(!1);n.textContent=e,t.parentNode.replaceChild(n,t);var i=this.editors.right.ace.getValue();this.editors.right.ace.destroy(),(n=(t=this.editors.right.ace.container).cloneNode(!1)).textContent=i,t.parentNode.replaceChild(n,t),document.getElementById(this.options.classes.gutterID).innerHTML="",w()}};var w=function(){};function S(e){e.editors.left.ace.getSession().on("changeScrollTop",r((function(){E(e)}),16)),e.editors.right.ace.getSession().on("changeScrollTop",r((function(){E(e)}),16));var t=e.diff.bind(e);e.editors.left.ace.on("change",t),e.editors.right.ace.on("change",t),e.options.left.copyLinkEnabled&&m.on("#".concat(e.options.classes.gutterID),"click",".".concat(e.options.classes.newCodeConnectorLink),(function(t){x(e,t,y.LTR)})),e.options.right.copyLinkEnabled&&m.on("#".concat(e.options.classes.gutterID),"click",".".concat(e.options.classes.deletedCodeConnectorLink),(function(t){x(e,t,y.RTL)}));var n=a((function(){e.editors.availableHeight=document.getElementById(e.options.left.id).offsetHeight,e.diff()}),250);window.addEventListener("resize",n),w=function(){window.removeEventListener("resize",n)}}function x(e,t,n){var o,s,r,a,l,d,c=parseInt(t.target.getAttribute("data-diff-index"),10),p=e.diffs[c];n===y.LTR?(o=e.editors.left,s=e.editors.right,r=p.leftStartLine,a=p.leftEndLine,l=p.rightStartLine,d=p.rightEndLine):(o=e.editors.right,s=e.editors.left,r=p.rightStartLine,a=p.rightEndLine,l=p.leftStartLine,d=p.leftEndLine);for(var g="",h=r;h<a;h+=1)g+="".concat(u(o,h),"\n");var f=s.ace.getSession().getScrollTop();s.ace.getSession().replace(new i(l,0,d,0),g),s.ace.getSession().setScrollTop(parseInt(f,10)),e.diff()}function T(e){var t=e.ace.getSession().doc.getAllLines(),n=[];return t.forEach((function(e){n.push(e.length+1)})),n}function k(e,t,n,o,s){var r=e.editors[t];o<n&&(o=n);var a="".concat(s," ").concat(o>n?"lines":"targetOnly");r.markers.push(r.ace.session.addMarker(new i(n,0,o-1,1),a,"fullLine"))}function E(e){C(e),M(e),function(e){var t=e.editors.left.ace.getSession().getScrollTop(),n=e.editors.right.ace.getSession().getScrollTop();e.copyRightContainer.style.cssText="top: ".concat(-t,"px"),e.copyLeftContainer.style.cssText="top: ".concat(-n,"px")}(e)}function C(e){e.editors.left.markers.forEach((function(t){e.editors.left.ace.getSession().removeMarker(t)}),e),e.editors.right.markers.forEach((function(t){e.editors.right.ace.getSession().removeMarker(t)}),e)}function I(e,t,n,i,o){var s={},r=/^\n/.test(o);if(t===y.DIFF_INSERT){var a=N(e.editors.left,n,o),l=D(e.editors.right,i),d=L(e.editors.right,l),c=L(e.editors.left,a.startLine),p=l;0===L(e.editors.left,a.startLine)&&r&&(r=!1),0===a.startChar&&P(e.editors.right,i,r)&&(p=l+1);var u=a.startLine===a.endLine,g=0;(a.startChar>0||u&&o.length<c)&&d>0&&a.startChar<c&&g++,s={leftStartLine:a.startLine,leftEndLine:a.endLine+1,rightStartLine:p,rightEndLine:p+g}}else{a=N(e.editors.right,i,o),l=D(e.editors.left,n),d=L(e.editors.left,l);var h=L(e.editors.right,a.startLine),f=l;0===L(e.editors.right,a.startLine)&&r&&(r=!1),0===a.startChar&&P(e.editors.left,n,r)&&(f=l+1),u=a.startLine===a.endLine,g=0,(a.startChar>0||u&&o.length<h)&&d>0&&a.startChar<h&&g++,s={leftStartLine:f,leftEndLine:f+g,rightStartLine:a.startLine,rightEndLine:a.endLine+1}}return s}function N(e,t,n){var i={startLine:0,startChar:0,endLine:0,endChar:0},o=t+n.length,s=0,r=!1,a=!1;e.lineLengths.forEach((function(e,n){s+=e,!r&&t<s&&(i.startLine=n,i.startChar=t-s+e,r=!0),!a&&o<=s&&(i.endLine=n,i.endChar=o-s+e,a=!0)})),i.startChar>0&&L(e,i.startLine)===i.startChar&&(i.startLine++,i.startChar=0),0===i.endChar&&i.endLine--;var l=/\n$/.test(n);return i.startChar>0&&l&&i.endLine++,i}function L(e,t){return u(e,t).length}function D(e,t){for(var n=e.ace.getSession().doc.getAllLines(),i=0,o=0,s=0;s<n.length;s+=1)if(t<=(o+=n[s].length+1)){i=s;break}return i}function P(e,t,n){for(var i=e.ace.getSession().doc.getAllLines(),o=0,s=0;s<i.length;s+=1){var r=o+=i[s].length+1;if(n&&(r-=1),t===r)break}return P}function A(e){e.gutterHeight=document.getElementById(e.options.classes.gutterID).clientHeight,e.gutterWidth=document.getElementById(e.options.classes.gutterID).clientWidth;var t=F(e,y.EDITOR_LEFT),n=F(e,y.EDITOR_RIGHT),i=Math.max(t,n,e.gutterHeight);e.gutterSVG=document.createElementNS(y.SVG_NS,"svg"),e.gutterSVG.setAttribute("width",e.gutterWidth),e.gutterSVG.setAttribute("height",i),document.getElementById(e.options.classes.gutterID).appendChild(e.gutterSVG)}function F(e,t){return(t===y.EDITOR_LEFT?e.editors.left:e.editors.right).ace.getSession().getLength()*e.lineHeight}function _(e){e.copyRightContainer=document.createElement("div"),e.copyRightContainer.setAttribute("class",e.options.classes.copyRightContainer),e.copyLeftContainer=document.createElement("div"),e.copyLeftContainer.setAttribute("class",e.options.classes.copyLeftContainer),document.getElementById(e.options.classes.gutterID).appendChild(e.copyRightContainer),document.getElementById(e.options.classes.gutterID).appendChild(e.copyLeftContainer)}function M(e){(function(e){document.getElementById(e.options.classes.gutterID).removeChild(e.gutterSVG),A(e)})(e),function(e){e.copyLeftContainer.innerHTML="",e.copyRightContainer.innerHTML=""}(e),e.diffs.forEach((function(t,n){e.options.showDiffs&&(k(e,y.EDITOR_LEFT,t.leftStartLine,t.leftEndLine,e.options.classes.diff),k(e,y.EDITOR_RIGHT,t.rightStartLine,t.rightEndLine,e.options.classes.diff),e.options.showConnectors&&function(e,t,n,i,o){var s=e.editors.left.ace.getSession().getScrollTop(),r=e.editors.right.ace.getSession().getScrollTop();e.connectorYOffset=1;var a=t*e.lineHeight-s+.5,l=e.gutterWidth+1,c=i*e.lineHeight-r+.5,p=n*e.lineHeight-s+e.connectorYOffset+.5,u=e.gutterWidth+1,g=o*e.lineHeight-r+e.connectorYOffset+.5,h=d(-1,a,l,c),f=d(u,g,-1,p),m="L".concat(l,",").concat(c," ").concat(u,",").concat(g),b="L".concat(-1,",").concat(p," ").concat(-1,",").concat(a),v="".concat(h," ").concat(m," ").concat(f," ").concat(b),w=document.createElementNS(y.SVG_NS,"path");w.setAttribute("d",v),w.setAttribute("class",e.options.classes.connector),e.gutterSVG.appendChild(w)}(e,t.leftStartLine,t.leftEndLine,t.rightStartLine,t.rightEndLine),function(e,t,n){if(t.leftEndLine>t.leftStartLine&&e.options.left.copyLinkEnabled){var i=h({className:e.options.classes.newCodeConnectorLink,topOffset:t.leftStartLine*e.lineHeight,tooltip:"Copy to right",diffIndex:n,arrowContent:e.options.classes.newCodeConnectorLinkContent});e.copyRightContainer.appendChild(i)}if(t.rightEndLine>t.rightStartLine&&e.options.right.copyLinkEnabled){var o=h({className:e.options.classes.deletedCodeConnectorLink,topOffset:t.rightStartLine*e.lineHeight,tooltip:"Copy to left",diffIndex:n,arrowContent:e.options.classes.deletedCodeConnectorLinkContent});e.copyLeftContainer.appendChild(o)}}(e,t,n))}),e)}t.exports=v},{"diff-match-patch":"k8CM","./helpers/merge":"iSlp","./helpers/throttle":"Os6R","./helpers/debounce":"gTec","./helpers/normalizeContent":"xRfK","./visuals/getCurve":"j8WE","./visuals/getMode":"gWhB","./visuals/getTheme":"IRlp","./visuals/getLine":"L8P8","./visuals/getEditorHeight":"gpkQ","./visuals/createArrow":"QEUm","./dom/ensureElement":"f1Db","./dom/query":"FPMV","./constants":"iJA9"}]},{},["Focm"])},oj90:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"Utils",(function(){return i}));var i={createAutocompleter:function(e,t,n,i=1){return{getCompletions:function(o,s,r,a,l){var d=o.session.getTokenAt(r.row,r.column);a.length<i||e&&!e.includes(d.type)?l(null,[]):l(null,t.map((function(e){return"object"==typeof e?{caption:e.word,value:e.word,meta:n,title:e.title,about:e.about,titleStyle:e.titleStyle}:{caption:e,value:e,meta:n}})))},getDocTooltip:function(e){if(!e.title&&!e.about)return"";e.docHTML=[`<div class='${e.titleStyle||"title-style-1"}' style='\n            display: flex;\n            flex-direction: column; \n            font-size: 0.8rem;\n            padding: 3px;'>`,"<p>",e.title,"</p>","<div class='node' style='\n            position:relative;\n            min-width: 100%;\n            overflow: hidden;'>","<div class='body' style='\n             font-size: 0.7rem;\n             line-height: 1rem;\n             top: 0;\n             padding: 3px'>",e.about,"</div>","</div>","</div>"].join("")}}},addDoubleTapDetector:function(e,t){e.lastTap=0,e.tapTimeout=0,e.addEventListener("touchend",(function(n){var i=(new Date).getTime(),o=i-e.lastTap;clearTimeout(e.tapTimeout),o<500&&o>0?(t(),n.preventDefault()):e.tapTimeout=setTimeout((function(){clearTimeout(e.tapTimeout)}),500),e.lastTap=i}))},uniqueSplit:function(e,t=" "){return[...new Set(e.split(t).filter(e=>e))]},getHighestZ:function(t){let n=Number.NEGATIVE_INFINITY;return e(t).children().each((function(){let t=parseInt(e(this).css("z-index"))||0;t>n&&(n=t)})),n},clamp:function(e,t,n){return Math.max(Math.min(e,n),t)},rectanglesOverlap:function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},stripHtml:function(e){for(;e.indexOf("<")>=0;)e=e.replace("<","&lt;");for(;e.indexOf(">")>=0;)e=e.replace(">","&gt");return e},xmlToObject:function(e){var t=[];if((e=e.childNodes.item(0)).hasChildNodes())for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes.item(n);if(i.hasChildNodes()){for(var o={},s=!1,r=0;r<i.childNodes.length;r++){var a=i.childNodes.item(r);if("#text"!=a.nodeName&&(s=!0,a.hasChildNodes()?o[a.nodeName]=a.childNodes.item(0).nodeValue:o[a.nodeName]="",a.attributes.length>0)){o[a.nodeName]={};for(var l=0;l<a.attributes.length;l++){var d=a.attributes.item(l);o[a.nodeName][d.nodeName]=d.nodeValue}}}s&&t.push(o)}}return t},now:Date.now||function(){return(new Date).getTime()},getPublicPath:function(e){return window.getPublicVsCodeWebviewUri?window.getPublicVsCodeWebviewUri(e):"public"+(e?"/"+e:"")},getEditorContextMenu:function(e){return{selector:".node-editor .form .editor",trigger:"right",build:function(t){var n={items:{}};if(!/^\[color=#([a-zA-Z0-9]{3,6})$/.test(app.getTagBeforeCursor())){if(app.editor.getSelectedText().length>1){if(n.items={cut:{name:"Cut",icon:"cut",callback:()=>{app.clipboard.length>0&&(app.data.triggerCopyClipboard(),app.insertTextAtCursor(""))}},copy:{name:"Copy",icon:"copy",callback:()=>{app.data.triggerCopyClipboard()}},paste:{name:"Paste",icon:"paste",callback:()=>app.data.triggerPasteClipboard()},sep1:"---------"},!app.getTagBeforeCursor().match(e)||"ink"===app.settings.documentType()&&"END"===app.editor.getSelectedText()||(n.items["go to node"]={name:"Edit node: "+app.editor.getSelectedText(),callback:()=>{const e=app.getFutureEditedNodeTitle();app.nodeVisitHistory.includes(e)||app.nodeVisitHistory.push(e),app.openNodeByTitle(app.editor.getSelectedText())}}),app.settings.spellcheckEnabled()){var i=app.getSpellCheckSuggestionItems();!1!==i&&(n.items.corrections={name:"Correct word",items:i})}var o=app.getThesaurusItems();!1!==o&&(n.items.corrections={name:"Related words",items:o})}else n.items={paste:{name:"Paste",icon:"paste",callback:()=>app.data.triggerPasteClipboard()}},"ink"===app.settings.documentType()&&(n.items.inkSnips={name:"Ink snippets",items:{structure:{name:"Structure",items:{stitch:{name:"Stitch",callback:()=>{app.insertTextAtCursor("= stitchName\nThis is the content of the stitch that should be embedded within a knot.\n-> END")}},end:{name:"Ending indicator",callback:()=>{app.insertTextAtCursor("-> END")}}}},choices:{name:"Choices",items:{basicChoice:{name:"Basic choice",callback:()=>{app.insertTextAtCursor("* This is a choice that can only be chosen once")}},stickyChoice:{name:"Sticky choice",callback:()=>{app.insertTextAtCursor("+ This is a sticky choice - the player can choose it more than once")}},choiceWithoutPrinting:{name:"Choice without printing",callback:()=>{app.insertTextAtCursor("* [A choice where the content isn't printed after choosing]")}},choiceWithoutMixedOutput:{name:"Choice without mixed output",callback:()=>{app.insertTextAtCursor("* Try [it] this example!")}}}},variableText:{name:"Variable text",items:{shuffle:{name:"~Shuffle (rand) text",callback:()=>{app.insertTextAtCursor("I tossed the coin. {~Heads|Tails}.")}},cycle:{name:"&Cycle text",callback:()=>{app.insertTextAtCursor("It was {&Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday} today.")}},sequence:{name:"Sequence text",callback:()=>{app.insertTextAtCursor('The radio hissed into life. {"Three!"|"Two!"|"One!"|There was the white noise racket of an explosion.|But it was just static.}\n\n{I bought a coffee with my five-pound note.|I bought a second coffee for my friend.|I didn\'t have enough money to buy any more coffee.}')}},onceOnly:{name:"!Once only text",callback:()=>{app.insertTextAtCursor("He told me a joke. {!I laughed politely.|I smiled.|I grimaced.|I promised myself to not react again.}\n")}}}},variables:{name:"Variables",items:{globalVariable:{name:"Global variable",callback:()=>{app.insertTextAtCursor("VAR myNumber = 5")}},temporaryVariable:{name:"Temporary variable",callback:()=>{app.insertTextAtCursor("temp myTemporaryValue = 5")}},modifyVariable:{name:"Modify variable",callback:()=>{app.insertTextAtCursor("~ myNumber = myNumber + 1")}}}},conditions:{name:"Conditions",items:{inlineCondition:{name:"Inline condition",callback:()=>{app.insertTextAtCursor("{yourVariable: This is written if yourVariable is true|Otherwise this is written}\n")}},multilineCondition:{name:"Multiline condition",callback:()=>{app.insertTextAtCursor("{yourVariable:\n    This is written if yourVariable is true.\n  - else:\n    Otherwise this is written.\n}")}}}}}},n.items.code={name:"Code",items:{equal:{name:"== (equal)",callback:()=>app.insertTextAtCursor("== ")},notEqual:{name:"!= (not equal)",callback:()=>app.insertTextAtCursor("!= ")},tag:{name:"# (tag)",callback:()=>app.insertTextAtCursor("# ")},list:{name:"LIST",callback:()=>app.insertTextAtCursor("LIST = ")},listFunc:{name:"List functions",items:{count:{name:"count",callback:()=>app.insertTextAtCursor("LIST_COUNT()")},min:{name:"min",callback:()=>app.insertTextAtCursor("LIST_MIN()")},max:{name:"max",callback:()=>app.insertTextAtCursor("LIST_MAX()")},rand:{name:"random",callback:()=>app.insertTextAtCursor("LIST_RANDOM()")}}},variable:{name:"VAR",callback:()=>app.insertTextAtCursor("VAR = ")},temp:{name:"~ temp",callback:()=>app.insertTextAtCursor("~ temp = ")},plusEq:{name:"+= (plus equal)",callback:()=>app.insertTextAtCursor("+= ")},else:{name:"- else",callback:()=>app.insertTextAtCursor("- else:\n")},or:{name:"|",callback:()=>app.insertTextAtCursor("|")},rand:{name:"~",callback:()=>app.insertTextAtCursor("~")}}},n.items.bladeCoder={name:"BladeCoder",items:{player:{name:"$PLAYER>",callback:()=>app.insertTextAtCursor("$PLAYER> ")},animation:{name:"Animation",callback:()=>app.ui.insertTextAtCursorWithParams("> Animation: animation=%0.%1, wait=%2, keepDirection=%3, repeat=%4, count=%5",[{name:"Actor",default:"$PLAYER"},{name:"Animation",default:"stand.right"},{name:"Wait",default:!1},{name:"Keep direction",default:!1},{name:"Repeat",default:"SPRITE_DEFINED"},{name:"Count",default:-1}])},goto:{name:"Goto",callback:()=>app.ui.insertTextAtCursorWithParams("> Goto: actor=%0, target=%1",[{name:"Actor",default:"$PLAYER"},{name:"target",default:"target"}])},wait:{name:"Wait",callback:()=>app.ui.insertTextAtCursorWithParams("> Wait: time=%0",[{name:"Time",default:.8}])},playSound:{name:"Play Sound",callback:()=>app.ui.insertTextAtCursorWithParams("> PlaySound: sound=%0, stop=%1",[{name:"Sound",default:"yawn"},{name:"Stop",default:!1}])},setActorAttr:{name:"Set Actor Attribute",callback:()=>app.ui.insertTextAtCursorWithParams("> SetActorAttr: actor=%0, talkAnimation=%1, visible=%2",[{name:"Actor",default:"$PLAYER"},{name:"Talk animation"},{name:"Visible",default:!0}])}}},n.items.end={name:"-> END",callback:()=>app.insertTextAtCursor("-> END")},n.items.star={name:"* (choice)",callback:()=>app.insertTextAtCursor("* ")},n.items.gather={name:"- (gather)",callback:()=>app.insertTextAtCursor("-")},n.items.stitch={name:"= (stitch)",callback:()=>app.insertTextAtCursor("= ")},n.items.glue={name:"<> (glue)",callback:()=>app.insertTextAtCursor("<>")},n.items.comment={name:"// (comment)",callback:()=>app.insertTextAtCursor("// ")},n.items.nested={name:"Nested",items:{gather2:{name:"-- (gather)",callback:()=>app.insertTextAtCursor("-- ")},star2:{name:"** (choice)",callback:()=>app.insertTextAtCursor("** ")}}},n.items.inkDoc={name:"How to use ink",callback:()=>window.open("https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md","_blank").focus()});return n}}}},debounce:function(e,t){var n;return function(){clearTimeout(n),n=setTimeout((function(){e()}),t)}}}}.call(this,n("EVdn"))},owJe:function(e,t,n){(function(e){var i=n("jXEy"),o=n("oj90"),s=o.Utils.getPublicPath("dictionaries/en/index.dic"),r=o.Utils.getPublicPath("dictionaries/en/index.aff");e("<style type='text/css'>.ace_marker-layer .misspelled { position: absolute; z-index: -2; border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head"),e("<style type='text/css'>.misspelled { border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head");var a=null;function l(e){var t=e.split(/\s+|\.|\,|\?|\\|\/|\!|\[|\]|"|'|;|:|`|\+|\-|\&|\$|@|~|#|>|<|_|\)|\(|£|\^|%|\*|„|“|\||[0-9]+/g),n=0,i=[];for(word in t){var o=t[word];a.correct(o)||(i[i.length]=[n,n+t[word].length]),n+=t[word].length+1}return i}t.load_dictionary=function(t){console.info(`Loading ${t} hunspell dictionary locally`),s=o.Utils.getPublicPath(`dictionaries/${t}/index.dic`),r=o.Utils.getPublicPath(`dictionaries/${t}/index.aff`),e.get(s,(function(e){dicData=e})).fail((function(){const n=sessionStorage.getItem("affData"),o=sessionStorage.getItem("dicData");if(n&&o)return console.info(t+" found in sessionStorage. Loading dictionary from cache..."),a=new i(n,o),void(d=!0);console.error(t+" not found locally. Loading dictionary from server instead..."),s=`https://raw.githubusercontent.com/wooorm/dictionaries/main/dictionaries/${t}/index.dic`,r=`https://raw.githubusercontent.com/wooorm/dictionaries/main/dictionaries/${t}/index.aff`,e.get(s,(function(e){dicData=e})).done((function(){e.get(r,(function(e){affData=e})).done((function(){sessionStorage.setItem("affData",affData),sessionStorage.setItem("dicData",dicData),a=new i(affData,dicData),d=!0}))}))})).done((function(){e.get(r,(function(e){affData=e})).done((function(){console.log("Dictionary loaded locally"),a=new i(affData,dicData),d=!0}))}))},t.misspelled=l;var d=!0,c=!1,p=[];function u(){if(null!=a&&!c&&d){c=!0;var e=ace.edit("editor").getSession();h();try{var t=ace.require("ace/range").Range,n=e.getDocument().getAllLines();for(var i in n){var o=l(n[i]);for(var s in o){var r=new t(i,o[s][0],i,o[s][1]);p[p.length]=e.addMarker(r,"misspelled","typo",!0)}}}finally{c=!1,d=!1}}}t.spell_check=u;var g=!1;function h(){var e=ace.edit("editor").getSession();for(var t in p)e.removeMarker(p[t]);p=[];var n=e.getDocument().getAllLines();for(var t in n)e.removeGutterDecoration(t,"misspelled")}t.enable_spellcheck=function(){g=!0,ace.edit("editor").getSession().on("change",(function(e){g&&(d=!0,u())})),d=!0,u()},t.disable_spellcheck=function(){g=!1,h()},t.clear_spellcheck_markers=h,t.suggest_word_for_misspelled=function(e){var t=a.suggest(e);return 0!==t.length&&t}}).call(this,n("EVdn"))},pLxK:function(e){e.exports=JSON.parse('{"a":"0.4.345"}')},pYPP:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i}));const i=function(t){const n=this,i=window.vsCodeApi?{getItem:()=>{},setItem:()=>{}}:window.localStorage;this.storage=i,e.extenders.persist=function(e,n){return e.subscribe((function(e){i.setItem(n,e),t.data.db.save(n,e)})),e},this.apply=function(){t.setTheme(n.theme()),t.setLanguage(n.language()),t.setDocumentType(n.documentType()),t.toggleInvertColors(),t.setMarkupLanguage(n.markupLanguage()),console.log("redraw throttle:",n.redrawThrottle()),t.workspace.setThrottle(n.redrawThrottle()),t.setGistCredentials({token:n.gistToken(),file:null!==n.gistFile()?n.gistFile().split("/").pop():null}),t.setGistPluginsFile(null!==n.gistPluginsFile()?n.gistPluginsFile().split("/").pop():null)},this.pasteFromClipboard=function(e){e&&e.length>0||navigator.clipboard&&navigator.clipboard.readText().then(n=>{t.log("clipboard",n),n&&n.length>5&&e(n)})},this.guessGistToken=function(){n.pasteFromClipboard(n.gistToken)},this.guessGistFile=function(){n.pasteFromClipboard(n.gistFile)},this.validateGridSize=function(){n.gridSize()<20&&n.gridSize(20),n.gridSize()>200&&n.gridSize(200),n.gridSize(parseInt(n.gridSize())),t.initGrid()},this.theme=e.observable(i.getItem("theme")||"dracula").extend({persist:"theme"}),this.documentType=e.observable(i.getItem("documentType")||"yarn").extend({persist:"documentType"}),this.language=e.observable(i.getItem("language")||"en-GB").extend({persist:"language"}),this.redrawThrottle=e.observable(parseInt(i.getItem("redrawThrottle")||"130")).extend({persist:"redrawThrottle"}),this.gistToken=e.observable(i.getItem("gistToken")).extend({persist:"gistToken"}),this.gistFile=e.observable(i.getItem("gistFile")).extend({persist:"gistFile"}),this.lastEditedGist=e.observable(i.getItem("lastEditedGist")).extend({persist:"lastEditedGist"}),this.lastStorageHost=e.observable(i.getItem("lastStorageHost")).extend({persist:"lastStorageHost"}),this.gistPluginsFile=e.observable(i.getItem("gistPluginsFile")).extend({persist:"gistPluginsFile"}),this.spellcheckEnabled=e.observable(null===i.getItem("spellcheckEnabled")||"true"===i.getItem("spellcheckEnabled")).extend({persist:"spellcheckEnabled"}),this.autoCloseTags=e.observable(null===i.getItem("autoCloseTags")||"true"===i.getItem("autoCloseTags")).extend({persist:"autoCloseTags"}),this.autocompleteSuggestionsEnabled=e.observable(null===i.getItem("autocompleteSuggestionsEnabled")||"true"===i.getItem("autocompleteSuggestionsEnabled")).extend({persist:"autocompleteSuggestionsEnabled"}),this.autoCloseBrackets=e.observable(null===i.getItem("autoCloseBrackets")||"true"===i.getItem("autoCloseBrackets")).extend({persist:"autoCloseBrackets"}),this.invertColorsEnabled=e.observable(null!==i.getItem("invertColorsEnabled")&&"true"===i.getItem("invertColorsEnabled")).extend({persist:"invertColorsEnabled"}),this.snapGridEnabled=e.observable(null!==i.getItem("snapGridEnabled")&&"true"===i.getItem("snapGridEnabled")).extend({persist:"snapGridEnabled"}),this.restoreSessionEnabled=e.observable(null!==i.getItem("restoreSessionEnabled")&&"true"===i.getItem("restoreSessionEnabled")).extend({persist:"restoreSessionEnabled"}),this.developmentModeEnabled=e.observable(null!==i.getItem("developmentModeEnabled")&&"true"===i.getItem("developmentModeEnabled")).extend({persist:"developmentModeEnabled"}),this.gridSize=e.observable(parseInt(i.getItem("gridSize")||"40")).extend({persist:"gridSize"}),this.createNodesEnabled=e.observable(null===i.getItem("createNodesEnabled")||"true"===i.getItem("createNodesEnabled")).extend({persist:"createNodesEnabled"}),this.editorStatsEnabled=e.observable(null!==i.getItem("editorStatsEnabled")&&"true"===i.getItem("editorStatsEnabled")).extend({persist:"editorStatsEnabled"}),this.markupLanguage=e.observable(i.getItem("markupLanguage")||"bbcode").extend({persist:"markupLanguage"}),this.filetypeVersion=e.observable(i.getItem("filetypeVersion")||"1").extend({persist:"filetypeVersion"}),this.lineStyle=e.observable(i.getItem("lineStyle")||"straight").extend({persist:"lineStyle"}),this.fileTabsVisible=e.observable(null===i.getItem("fileTabsVisible")||"true"===i.getItem("fileTabsVisible")).extend({persist:"fileTabsVisible"}),this.selectedFileTab=e.observable(i.getItem("selectedFileTab")||0).extend({persist:"selectedFileTab"}),this.alwaysOpenNodesInVisualStudioCodeEditor=e.observable(null!==i.getItem("alwaysOpenNodesInVisualStudioCodeEditor")&&"true"===i.getItem("alwaysOpenNodesInVisualStudioCodeEditor")).extend({persist:"alwaysOpenNodesInVisualStudioCodeEditor"}),this.editorSplitDirection=e.observable(i.getItem("editorSplitDirection")||"left").extend({persist:"editorSplitDirection"}),this.editorSplit=e.observable(null!==i.getItem("editorSplit")&&"true"===i.getItem("editorSplit")).extend({persist:"editorSplit"}),this.editorSplitSize=e.observable(i.getItem("editorSplitSize")||"50%").extend({persist:"editorSplitSize"})}}).call(this,n("Z1dp"))},qVgP:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s}));var i=n("+qE3");const{Story:o}=inkjs;var s=function(){let t=new i.EventEmitter;this.emiter=t,this.story=null,this.log=[],this.onRecompile=()=>{},this.curStory={messages:[],choices:[],tags:[],paragraphEl:""},this.resetStory=()=>{this.prevSavePoints=[],this.choiceHistory=[],this.textAreaEl.innerHTML="",this.curStory={messages:[],choices:[],tags:[],paragraphEl:""},this.story.ResetState()},this.terminate=()=>{if(this.textAreaEl)try{t.removeAllListeners(),this.finished=!0}catch(e){console.warn(e)}},this.setCurStory=({messages:e,choices:t,tags:n,paragraphEl:i})=>{this.curStory={messages:e,choices:t,tags:n,paragraphEl:i}};const n=(e="",t="")=>{const n=(e=>{let t=[];for(;e.canContinue;)t.push(e.Continue().replace(/\n/g,""));return t})(this.story),i=e.includes('"')?e:`[${e}]`,o=document.createElement("p");if(e){const s=document.createElement("p");s.innerHTML=`<p style="text-align: right;" id="${t}" class="playtestLink" title="Click to open [${t}] Node">${e} ( ${t} )</p>`,s.onclick=()=>app.navigateToNodeDuringPlayTest(t,i),o.appendChild(s),n.forEach(e=>{const t=document.createElement("p");t.innerHTML=e+"<br/>",o.appendChild(t)})}else o.innerHTML=n.join("<br/>");this.setCurStory({...this.curStory,messages:this.log?[...this.curStory.messages,e?`--${e}--`:"",n].filter(Boolean):[n],tags:this.story.currentTags,choices:this.story.currentChoices,paragraphEl:o}),r()};this.prevSavePoints=[];const s=(e,t)=>{this.prevSavePoints.push(this.story.state.toJson());const i=this.story.state.currentChoices[e].sourcePath.split(".")[0];this.story.ChooseChoiceIndex(e),n(t,i)};this.rewindStory=()=>{document.getElementById("choiceButtons").remove(),this.textAreaEl.removeChild(this.textAreaEl.lastElementChild),this.story.state.LoadJson(this.prevSavePoints.pop()),n()},this.createAndAddParagraph=t=>{if(console.log("made",t),t.innerHTML){const n=document.createElement("p");n.appendChild(t),n.className="story-playtest-bubble story-playtest-answer answer-post fade-in is-paused",this.textAreaEl.appendChild(n),e(n).removeClass("is-paused")}};const r=()=>{this.createAndAddParagraph(this.curStory.paragraphEl),this.textAreaEl.querySelectorAll("div").forEach(e=>e.remove());const e=document.createElement("div");e.id="choiceButtons",e.className="flex-wrap";const t=document.createElement("button");t.innerText="🔄",t.title="Recompile story",t.onclick=this.onRecompile,t.className="storyPreviewChoiceButton",e.appendChild(t);const i=document.createElement("button");i.innerText="🎬",i.title="Restart story",i.onclick=()=>{this.resetStory(),n()},i.className="storyPreviewChoiceButton",e.appendChild(i);const o=document.createElement("button");o.innerText="⏪",o.title="Go to previous",o.disabled=0===this.prevSavePoints.length,o.onclick=()=>{this.rewindStory(),n()},e.appendChild(o),o.className="storyPreviewChoiceButton",this.curStory.choices.forEach((t,n)=>{const i=document.createElement("button");i.innerText=t.text,i.onclick=e=>{e.stopPropagation(),s(n,t.text)},i.className="storyPreviewChoiceButton",e.appendChild(i)}),this.textAreaEl.appendChild(e),this.textAreaEl.scrollTo({top:this.textAreaEl.scrollHeight+100,left:0,behavior:"smooth"})};this.initInk=(e,t,i,s,r,a,l,d,c,p)=>{this.onRecompile=t,console.log("INIT INK"),this.finished=!1,document.getElementById(a).style.visibility="hidden",this.textAreaEl=document.getElementById(d),this.textAreaEl.innerHTML='<div class="opacity-pulse centered"><h2>Parsing ink</h2> <h2 class="story-animated-dots"><p>.</p><p>.</p><p>.</p></h2></div>',this.inkTextData=s,this.compiler=e,this.compiler.init(e=>{if(this.textAreaEl.innerHTML="",e.errors.length>0)return this.textAreaEl.innerHTML=`<div class="title-error"><p>Parsing failed:</p>><br/><p>${e.errors.join("</p><p>")}</p><br/><p>${e.warnings.join("</p><p>")}</p></div>`,void(this.textAreaEl.onclick=()=>{console.log("====>",e),app.data.goToErrorInkNode(this.inkTextData,e.errors[0]),this.textAreaEl.onclick=null});if(e.warnings.length>0){const t=document.createElement("p");t.className="title-warning",e.warnings.forEach(e=>{const n=document.createElement("p");n.innerText=e,n.onclick=()=>{app.data.goToErrorInkNode(this.inkTextData,e)},t.appendChild(n)}),this.createAndAddParagraph(t)}if(this.story=new o(e.story),console.log("STORY",this.story),console.warn("Warnings",e.warnings),n(),""===this.story.currentText&&0===this.story.currentChoices.length)if(r!==app.data.InkGlobalScopeNodeName)this.compiler.submit(`-> ${r}\n`+s);else{const e=s.split("\n").find(e=>e.includes("==="));this.compiler.submit(`-> ${e.split("===")[1]}\n`+s)}}).then(()=>{if(!i.recompile&&i.story&&0!==i.prevSavePoints.length)return this.story=i.story,i.childNodes.forEach(e=>this.textAreaEl.appendChild(e)),this.prevSavePoints=i.prevSavePoints,void n();s&&this.compiler.submit(s)})}}}).call(this,n("EVdn"))},sSq8:function(e,t){class n extends HTMLElement{constructor(){super();const e=document.createElement("template");e.innerHTML="",this.attachShadow({mode:"open"}).append(e.content.cloneNode(!0));document.querySelector("web-component").shadowRoot}method(e){}}customElements.define("web-component",n);class i extends HTMLElement{constructor(){super();const e=document.createElement("template");e.innerHTML='\n        <style>\n        #simpleToast {\n          visibility: hidden; /* Hidden by default. Visible on click */\n          min-width: 250px; /* Set a default minimum width */\n          word-break: break-word;\n          background-color: MediumVioletRed; /* Background color */\n          color: #fff; /* White text color */\n          text-align: center; /* Centered text */\n          border-radius: 2px; /* Rounded borders */\n          padding: 16px; /* Padding */\n          position: fixed; /* Sit on top of the screen */\n          z-index: 999999; /* Add a z-index if needed */\n          left: 10vw; /* Center the snackbar */\n          max-width: 80vw;\n          opacity: 0.9;\n          bottom: 30px; /* 30px from the bottom */\n          font-family: monospace;\n          display: inline-flex;\n          line-hight: 12px;\n          border-radius: 0.4rem;\n        }\n        #simpleToast span {\n          margin-left: 12px;\n          margin-top: 2px;\n        }\n\n        #simpleToast[data-type="info"] {\n          background-color: #216aa9;\n        }\n        #simpleToast[data-type="warning"] {\n          color: black;\n          background-color: yellow;\n        }\n        #simpleToast[data-type="danger"] {\n          background-color: #de5454;\n        }\n        #simpleToast[data-type="success"] {\n            background-color: #5cb85c;\n        }\n\n        #simpleToast.show {\n          visibility: visible;\n          animation: fadein 0.5s;\n        }\n        #simpleToast:not(.show) {\n          visibility: hidden;\n          animation: fadeout 0.5s 2.5s;\n        }\n\n        @-webkit-keyframes fadein {\n          from {bottom: 0; opacity: 0;}\n          to {bottom: 30px; opacity: 1;}\n        }\n\n        @keyframes fadein {\n          from {bottom: 0; opacity: 0;}\n          to {bottom: 30px; opacity: 1;}\n        }\n\n        @-webkit-keyframes fadeout {\n          from {bottom: 30px; opacity: 1;}\n          to {bottom: 0; opacity: 0;}\n        }\n\n        @keyframes fadeout {\n          from {bottom: 30px; opacity: 1;}\n          to {bottom: 0; opacity: 0;}\n        }\n        </style>\n        <div id="simpleToast">\n          <div id="toastBody">The notification message...</span>\n        </div>\n        ',this.attachShadow({mode:"open"}).append(e.content.cloneNode(!0));document.querySelector("toast-component").shadowRoot}openToast({content:e,type:t,time:n,onClick:i}){const o=document.querySelector("toast-component").shadowRoot;this.toast=o.querySelector("#simpleToast"),this.toast.className="show",this.toast.setAttribute("data-type",t||""),this.toastBody=o.querySelector("#toastBody"),this.toastBody.innerHTML=e;const s=e=>{this.toast.className=this.toast.className.replace("show",""),e&&i&&i()};clearTimeout(this.countdown),this.countdown=setTimeout(()=>{s(),clearTimeout(this.countdown)},n||3e3),this.toast.removeEventListener("click",s),this.toast.addEventListener("click",s)}}customElements.define("toast-component",i),window.ToastWc={show:({content:e,type:t,time:n,onClick:i})=>{document.querySelector("toast-component").openToast({content:e,type:t,time:n,onClick:i})}};class o extends HTMLElement{constructor(){super();const e=document.createElement("template");e.innerHTML='\n      <style>\n        .spinner {\n          display: inline-block;\n          width: 50px;\n          height: 50px;\n          border: 3px solid rgba(255,255,255,.3);\n          border-radius: 50%;\n          border-top-color: #fff;\n          animation: spin 1s ease-in-out infinite;\n          -webkit-animation: spin 1s ease-in-out infinite;\n        }\n        @keyframes spin {\n          to { -webkit-transform: rotate(360deg); }\n        }\n        @-webkit-keyframes spin {\n          to { -webkit-transform: rotate(360deg); }\n        }\n      </style>\n        <div id="resourcesLoaderIsBusy" style="position:absolute;right:50%;bottom:20%">\n          <div class="spinner"></div>\n          <div id="resourcesLoaderIsBusyMessage">Loading</div>\n      </div>\n    ',this.attachShadow({mode:"open"}).append(e.content.cloneNode(!0));document.querySelector("spinner-component").shadowRoot}isBusy(e){const t=document.querySelector("spinner-component").shadowRoot;this.spinner=t.querySelector("#resourcesLoaderIsBusy"),this.spinner.style.display=e?"block":"none",this.text=t.querySelector("#resourcesLoaderIsBusyMessage"),this.text.innerText=e||""}}customElements.define("spinner-component",o)},tUqF:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));const i=n("L8pc"),o=new bondage.Runner,s=n("+qE3").EventEmitter,r=e=>e instanceof bondage.TextResult,a=e=>e instanceof bondage.OptionsResult,l=e=>e instanceof bondage.CommandResult;var d=function(){this.visitedNodes=[];this.node={title:""};let e=new s;this.emiter=e;let t=[];this.commandsPassedLog=t;this.commandPassed="";let n=!0;this.finished=n,this.scrollTextStyle=!1,this.visitedChapters=[],this.self=this,this.vnChoiceSelectionCursor=">",this.startTimeWait,this.vnSelectedChoice=-1,this.vnTextScrollInterval,this.storyChapter="",this.choices={};let d,c,p,u,g,h,f,m,y=null;this.vnSelectChoice=()=>{(new Date).getTime()-this.startTimeWait<1e3||(this.choices[this.storyChapter].push(u.options[this.vnSelectedChoice]),u.select(this.vnSelectedChoice),this.emiter.emit("choiceMade",u.options[this.vnSelectedChoice]),c="",d=void 0,u=self.goToNext(),this.vnSelectedChoice=-1,this.changeTextScrollSpeed(111))},this.vnUpdateChoice=(t=0)=>{if(this.vnSelectedChoice<0)return;let n=this.vnSelectedChoice+t;n>u.options.length-1?n=0:n<0&&(n=u.options.length-1),this.vnSelectedChoice=n,d=document.createElement("DIV"),u.options.forEach((e,t)=>{const n=document.createElement("DIV");t==this.vnSelectedChoice?n.innerHTML=`${this.vnChoiceSelectionCursor} [${e}]`:n.innerHTML=`${this.vnChoiceSelectionCursor.replace(/.*/gm,"&nbsp;")} [${e}]`,n.onclick=e=>{e.stopPropagation(),this.vnSelectedChoice=t,this.vnUpdateChoice()},n.ondblclick=e=>{e.stopPropagation(),this.vnSelectedChoice=t,this.vnSelectChoice()},n.className="storyPreviewChoiceButton",d.appendChild(n)}),e.emit("choiceUpdated",this.vnSelectedChoice),self.updateVNHud()},this.changeTextScrollSpeed=(t=0)=>{if(t!==this.vnTextScrollInterval){if(this.vnTextScrollInterval=t,clearInterval(h),y<0){if(this.isFinishedParsing(u))return void e.emit("finished");if(r(u))return c=u.text,y=0,e.emit("textResult",c),void this.changeTextScrollSpeed(220);a(u)&&-1===this.vnSelectedChoice&&(this.vnSelectedChoice=0,this.vnUpdateChoice(),this.startTimeWait=(new Date).getTime())}0!==t&&(h=setInterval(this.scrollUpdateText,t))}},self.goToNext=()=>{const e=g.next().value;if(console.log({nextNode:e}),!this.isFinishedParsing(e))return r(u)&&e.data&&this.node.title!==e.data.title&&(c="",y=-1,this.node=self.jsonCopy(e.data),this.visitedNodes.push(e.data.title),this.emiter.emit("startedNode",this.node)),e},this.isFinishedParsing=e=>(void 0===e||null===u)&&(n||(n=!0,y=-1),n=!0,n),this.runCommand=()=>{e.emit("commandCall",u.text),t.push(u.text),u=self.goToNext(),this.isFinishedParsing(u)||(r(u)&&(c+="\n"+u.text,e.emit("textResult",u.text)),a(u)&&(y=-1))},this.scrollUpdateText=()=>{if(!this.isFinishedParsing(u))if(y<0)l(u)&&this.runCommand();else if(y>c.length){if(r(u)){if(u=self.goToNext(),this.isFinishedParsing(u))return;l(u)?this.runCommand():(r(u)||a(u))&&(y=-1)}}else r(u)&&(y+=1,p=c.substring(0,y),self.updateVNHud())},self.updateVNHud=()=>{if(r(u)){for(;p.lastIndexOf("[img]")>p.lastIndexOf("[/img]");)y+=1,p=c.substring(0,y);for(;p.lastIndexOf("[")>p.lastIndexOf("]");)y+=1,p=c.substring(0,y)}this.scrollTextStyle&&(document.getElementById(f).innerHTML=i.parse(p)+"<br>"),void 0!==d&&(this.scrollTextStyle||(document.getElementById(f).innerHTML=""),document.getElementById(f).appendChild(d))},this.terminate=()=>{try{let t=document.getElementById(f);t&&(t.innerHTML=""),t=document.getElementById(m),t&&(t.innerHTML=""),d=void 0,e.removeAllListeners(),this.finished=!0}catch(e){console.warn(e)}},this.initYarn=(t,s,r,a,l,d,c)=>{const p=["#f5ff6f","#44fe66","#e00ec0","#e93ecf","#0ec0e0","#3ecfe9","#e4dbcb","#978e7e","#666","#2f919a","deeppink","black","#97E1E9","#576574","#6EA5E0","#9EDE74","#FFE374","#F7A666","#C47862"],u=["__̴ı̴̴̡̡̡ ̡͌l̡̡̡ ̡͌l̡*̡̡ ̴̡ı̴̴̡ ̡̡͡| ̲▫̲͡ ̲̲͡▫̲̲͡͡ ̲|̡̡̡ ̡, ̴̡ı̴̡̡ ̡͌l̡̡̡̡.___","°º¤ø,¸¸,ø¤º°`°º¤ø,¸,ø¤°º¤ø,¸¸,ø¤º°`°º¤ø,¸","(===||:::::::::::::::>","¸.·´¯`·.´¯`·.¸¸.·´¯`·.¸><(((º>","=^..^=","|==|iiii|>-----"," ¦̵̱ ̵̱ ̵̱ ̵̱ ̵̱(̢ ̡͇̅└͇̅┘͇̅ (▤8כ−◦","(♥_♥)","龴ↀ◡ↀ龴","☁ ▅▒░☼‿☼░▒▅ ☁,","▓⚗_⚗▓","<:3 )~~~","(╯°□°）╯︵ ┻━┻","●▬▬▬▬๑۩۩๑▬▬▬▬▬●","(/)(Ö,,,,Ö)(/)","/)^3^(\\","( . Y . )","< )))) ><","(ノಠ益ಠ)ノ彡","d(^o^)b¸¸♬·¯·♩¸¸♪·¯·♫¸¸","O=('-'Q)","-`ღ´-","ˁ(⦿ᴥ⦿)ˀ","(╥﹏╥)","✲´*。.❄¨¯`*✲。❄。*。¨¯`*✲","▂▃▅▇█▓▒░۩۞۩        ۩۞۩░▒▓█▇▅▃▂","( •_•)O*¯`·.¸.·´¯`°Q(•_• )","┻━┻︵  (°□°)/ ︵ ┻━┻","|̲̲̲͡͡͡ ̲▫̲͡ ̲̲̲͡͡π̲̲͡͡ ̲̲͡▫̲̲͡͡ ̲|̡̡̡ ̡ ̴̡ı̴̡̡ ̡͌l̡ ̴̡ı̴̴̡ ̡l̡*̡̡ ̴̡ı̴̴̡ ̡̡͡|̲̲̲͡͡͡ ̲▫̲͡ ̲̲̲͡͡π̲̲͡͡ ̲̲͡▫̲̲͡͡ |","❤◦.¸¸.  ◦✿","ʕʘ̅͜ʘ̅ʔ","( ๏ Y ๏ )","ʕ•̫͡•ʕ*̫͡*ʕ•͓͡•ʔ-̫͡-ʕ•̫͡•ʔ*̫͡*ʔ-̫͡-ʔ","(っ◕‿◕)っ","❚█══█❚","─=≡Σ((( つ◕ل͜◕)つ","^ↀᴥↀ^","༼ つ ͡◕ Ѿ ͡◕ ༽つ","ᕦ(ò_óˇ)ᕤ","┬┴┬┴┤ ͜ʖ ͡°) ├┬┴┬┴","[̲̅$̲̅(̲̅5)̲̅$̲̅]","(ꈍ⌓ꈍ✿)","(๑•́ ₃ •̀๑) ♡","( • )( • )ԅ(≖⌣≖ԅ)","（。々°）","⊂(´･◡･⊂ )∘˚˳°","( ㅅ )","(ﾉ☉ヮ⚆)ﾉ ⌒*:･ﾟ✧","(－‸ლ)","(‿|‿)","(㇏(•̀ᵥᵥ•́)ノ)","ʚ✟⃛ɞ","(′ꈍωꈍ‵)","♚ ♛ ♜ ♝ ♞ ♟ ♔ ♕ ♖ ♗ ♘ ♙","(´ᴗ`)(´ᴗ`)","♥(´∀｀)","ฅ(˵●ﻌ●˵)ฅ"];if(m=l,f=r,this.yarnDataObject=t,this.startChapter=s,this.resourcesPath=a,this.finished=!1,this.scrollTextStyle="npc"===d,document.getElementById(m).innerHTML="<br/><font color='red'>🚥Press/Hold Z or 📱Double-click/Tap to advance</font><br/>",e.on("startedNode",(function(e){document.getElementById(m).innerHTML+="<br/><br/><font color='#581845'>📜 --- Loaded next node ---</font>",document.getElementById(m).innerHTML+=`<font color='${p[Math.floor(Math.random()*p.length)]}'>  ${u[Math.floor(Math.random()*u.length)]}</font>`,document.getElementById(m).innerHTML+="<br/><font color='CADETBLUE'>&ensp;&ensp;&ensp;Title: "+e.title+"</font>",e.tags.length>0&&e.tags[0].length>0&&(document.getElementById(m).innerHTML+="<br/><font color='deeppink'>&ensp;&ensp;&ensp;Tags: "+e.tags+"</font>")})),e.on("choiceMade",(function(e){this.scrollTextStyle?document.getElementById(m).innerHTML+="<br/><font color='fuchsia'>🐙Player chose: >"+e+"</font>":document.getElementById(m).innerHTML+=`<p class="story-playtest-bubble story-playtest-answer answer-post">${i.parse(e)}</p>`})),e.on("commandCall",(function(e){document.getElementById(m).innerHTML+=`<br/><font color='green'>🐣Command call:</font> <font color='red'>&lt;&lt;${e}&gt;&gt;</font>`})),this.scrollTextStyle||(e.on("textResult",(function(e){document.getElementById(m).innerHTML+=`<p class="story-playtest-bubble">${i.parse(e)}</p>`,document.getElementById(f).innerHTML='<span class="story-animated-dots"><p>.</p><p>.</p><p>.</p></span>',document.getElementById(f).className="story-playtest-bubble",document.getElementById(m).scrollTo({top:document.getElementById(m).scrollHeight,left:0,behavior:"smooth"})})),e.on("choiceUpdated",(function(e){document.getElementById(f).className="story-playtest-answer"}))),e.on("finished",(function(){n=!0,e.removeAllListeners()})),Array.isArray(t))o.load(t);else{if(!("nodes"in t))return;o.load(t.nodes)}this.loadYarnChapter(s),o.variables.data={},c.forEach((function(e){console.log(e),o.variables.set(e.key,e.value)}))},this.loadYarnChapter=e=>{n=!1,this.storyChapter=e,this.choices[this.storyChapter]=[],this.visitedChapters.push(e),g=o.run(e),u=self.goToNext(),c=u.text,this.changeTextScrollSpeed(100)},this.wasChoiceMade=(e,t=this.storyChapter)=>!!this.choices[t].includes(e),this.timesNodeWasVisited=e=>{let t=0;return this.visitedNodes.forEach((n,i)=>{n===e&&(t+=1)}),t},self.jsonCopy=e=>JSON.parse(JSON.stringify(e))}},tn40:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n("o+ka"),o=n.n(i);n("ZdjR");const s=e=>{e.session.$worker.send("setOptions",[{esversion:11,esnext:!1,asi:!0}])},r=(e,t=document.head)=>{const n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href",e),n.setAttribute("id",e),t.appendChild(n)},a=(e,t=document)=>{t.getElementById(e)&&t.getElementById(e).remove()},l='\n() => {\n  return {\n    modules: [\n      // if a module is a web address, it can be included this way\n      "https://unpkg.com/kaplay@3001.0.0-alpha.21/dist/kaplay.js",\n      // you can host a module on the same gist\n      // "test-local-module.js",\n    ],\n    script: () => {\n      const k = kaplay();\n      k.loadSprite("bean", "public/icon.png")\n      k.scene("main", () => {\n        k.add([\n          k.pos(200, 100),\n          k.sprite("bean"),\n        ]);\n        k.add([\n          k.text("yarr"),\n        ])\n      });\n      k.go("main");\n    }\n  }\n}\n',d=(e="")=>`\n<head>\n<style>\n  body,\n  head {\n    width: 100%;\n    height: 100%;\n  }\n</style>\n</head>\n<body>\n<textarea style="height: 100vh; width: 100%;">\n${e}\n\n// To render output here, the script needs to be a function that returns modules, body and script\n// Example:\n${l}\n\n// If you want to instead create a plugin that modifies yarn editor itself, you will need to reload yarn for changes to take effect\n// Example:\n\n() => {\n  return {\n    name: 'ExamplePlugin',\n    Constructor: function( {\n      app,\n      createButton,\n      createToggle,\n      getPluginStore,\n      setPluginStore,\n      addSettingsItem,\n      onYarnLoadedData,\n      onYarnEditorOpen,\n      onYarnInPreviewMode,\n      onYarnSavedNode,\n      onYarnSetLanguage,\n      onYarnLoadedStateFromLocalStorage,\n      onYarnSavedStateToLocalStorage,\n      onYarnSetDocumentType,\n      onKeyUp,\n      onKeyDown,\n      onLoad,\n    }) {\n      const self = this;\n      this.name = 'ExamplePlugin';\n      this.onOpenPluginEditor = ()=> {\n        alert("YAY!")\n      }\n      createButton(self.name, {\n        name: 'ExamplePlugin',\n        attachTo: app.settings.developmentModeEnabled() ? 'appHeader': 'fileMenuDropdown',\n        onClick: 'onOpenPluginEditor()',\n        iconName: 'cog',\n      });\n    }\n  }\n}\n\n</textarea>\n<body>\n`,c={mode:"ace/mode/javascript",tabSize:2,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,useWorker:!0};var p=function({app:e,createButton:t,addSettingsItem:i,getPluginStore:p,onYarnEditorOpen:u,onYarnInPreviewMode:g,onYarnSavedNode:h,onYarnSetDocumentType:f,onKeyUp:m,onKeyDown:y,onLoad:b,setPluginStore:v,setVloatilePlugin:w,getGistPluginFiles:S,setVloatilePlugins:x,getGistPluginFile:T,saveGistPlugin:k,isGistTokenInvalid:E,getGistPluginsFileUrl:C,urlParams:I,pluginModeUrl:N,getGistPluginsId:L,updateUrlParams:D,getPluginsList:P,deleteGistPlugin:A,deleteVolatilePlugin:F,getExtensionScriptData:_,getPreviewHtml:M}){const O=this;this.name="PluginEditor",this.onSetEditingFile=()=>{},this.editor=null,this.differ=null,this.editingFile="",this.volatilePlugins={},this.mode=N()||"edit",this.theme="dracula"===e.settings.theme()?"ace/theme/monokai":void 0,this.yarnData=null,this.hasTestedOnce=!1,this.onAddNewFile=()=>{let e=prompt("Create a new plugin file?\nAllowed formats: .js, .json and .txt\nReserved names: resources.json and yarnData.json","my-new-plugin.js");if(e){if(e=e.replace(/\s+/g,"").replace(/\//g,"").trim(),e in this.volatilePlugins)return void alert(e+" already exists as a plugin.\nPlease choose another name..");w(e,{content:l,filename:e,language:"JavaScript"}).then(()=>{this.onUpdatePluginsList(e),this.onSetPluginEditMode("edit"),this.onSetEditingFile(e)})}},this.onRemoveSelectedFile=()=>{if(confirm("Are you sure you want to delete this file:\n"+this.editingFile)){this.editingFile in this.volatilePlugins&&delete this.volatilePlugins[this.editingFile];const e=Object.keys(this.volatilePlugins),t=e.length>0?e[0]:"";F(this.editingFile).then(()=>{A(this.editingFile).then(()=>{this.onUpdatePluginsList(t).then(()=>{this.onSetEditingFile(t)})})})}},this.onUpdatePluginsList=(e="")=>P(!!e).then(t=>{this.volatilePlugins=t,document.getElementById("edited-plugin-file").innerHTML=Object.keys(t||{}).map(e=>`<option value="${e}">${e}</option>`),e&&e in t&&(document.getElementById("edited-plugin-file").value=e,this.editingFile=e)}),this.onCommitChanges=()=>{const e=this.differ.getEditors().right.getValue();k(this.editingFile,e).then(t=>{console.log({response:t}),this.differ.getEditors().left.setValue(e),ToastWc.show({type:"success",content:`Saved ${this.editingFile}\nto gist: ${t.response.id}`,time:3e3})})},this.onDownloadPreviewOrReload=()=>{document.getElementById("plugin-output-downloader").innerText.includes("Download")?e.data.storage.downloadContent(document.getElementById("plugin-output-previewer").srcdoc,"output.html"):window.location.reload()},this.onCopyLink=()=>{window.navigator.clipboard.writeText(window.location.href),ToastWc.show({type:"success",content:`Copied ${window.location.href} to clipboard!`,time:3e3})},this.onOpenGistLink=()=>{window.open("https://gist.github.com/"+L(),"_blank")},this.onSetPluginEditMode=e=>{this.mode=e,v(O.name,"pluginEditMode",e),document.querySelectorAll("#edit-plugin-mode > button").forEach(e=>e.classList.remove("active")),document.getElementById("edit-plugin-mode-"+e).classList.add("active"),document.getElementById("js-editor").style.display="edit"===e?"block":"none",document.getElementById("edit-plugin-code-buttons").style.display="edit"===e?"flex":"none",document.getElementById("add-remove-plugin-file").style.display="edit"===e||"commit"===e?"flex":"none",document.getElementById("diff-editor").style.display="commit"===e?"block":"none",document.getElementById("plugin-differ-commit").style.display="commit"===e?"block":"none",document.getElementById("plugin-differ-link").style.display="commit"===e?"block":"none",document.getElementById("plugin-output-previewer").style.height="test"===e?"80vh":"0vh",document.getElementById("plugin-test-area").style.display="test"===e?"block":"none",document.getElementById("plugin-yarn-reloader").style.display="none",document.getElementById("plugin-output-previewer").style.position="test"===e?"relative":"absolute",document.getElementById("plugin-output-previewer").sandbox="test"===e?"allow-scripts allow-modals allow-same-origin":"allow-scripts allow-same-origin",document.getElementById("plugin-output-downloader").style.display="test"===e?"block":"none",document.getElementById("plugin-output-linker").style.display="test"===e?"block":"none",document.getElementById("js-editor-errors").style.display="commit"===e?"none":"block",D("mode",e),this.onSetEditingFile()},n("Puta"),n("8UzD"),n("wiAF"),"dracula"===e.settings.theme()?r("public/plugins/ace-diff/ace-diff-dark.min.css"):r("public/plugins/ace-diff/ace-diff.min.css"),this.updatePreviewOutput=(e="",t=(()=>{}))=>{const n=e||this.volatilePlugins[this.editingFile].content;document.querySelector("#js-editor-errors").style.display="none";try{const[e,i,o]=_(n),s="test"===this.mode&&e&&"Constructor"in e;if(document.getElementById("plugin-output-previewer").style.display=s?"none":"block",document.getElementById("plugin-yarn-reloader").style.display=s?"flex":"none",document.getElementById("plugin-output-downloader").innerText=s?"Reload":"Download",!e||!e.script)return document.getElementById("plugin-output-previewer").srcdoc=d("The function needs to return an object.."),void(o&&this.onErrorsInPreview({detail:{errorText:o.message,errorEvent:o}}));if(console.log({outputData:e}),!this.hasTestedOnce)return;document.getElementById("plugin-output-previewer").srcdoc=M(e,this.volatilePlugins,this.yarnData),document.getElementById("plugin-output-previewer").onload=()=>{console.log("LOADED"),t()}}catch(e){document.getElementById("plugin-output-previewer").srcdoc=d(e.toString()+"\n      SEE CONSOLE LOGS"),console.error(e),this.onErrorsInPreview({detail:{errorText:e.message,e:e}})}},this.onErrorsInPreview=e=>{console.log({errorsInPreview:e,editingFile:this.editingFile});const t=e.detail.errorText;document.querySelector("#js-editor-errors").innerHTML=t,document.querySelector("#js-editor-errors").style.display=t&&"commit"!==this.mode?"block":"none",this.editor.find(t)},this.onOpenPluginEditor=async()=>{this.beautify=ace.require("ace/ext/beautify"),this.onFormatCode=()=>{this.beautify.beautify(this.editor.session)},this.onSetEditingFile=(e="")=>{const t=document.getElementById("edited-plugin-file").value;P(!1).then(n=>{this.volatilePlugins=n||{},this.editingFile=e||t;let i=this.volatilePlugins[this.editingFile].content;this.editor.setValue(i),this.editor.clearSelection(),console.log("update plugins file::",this.editingFile),D("pluginFile",this.editingFile),"commit"===this.mode&&(i=this.editor.getValue(),this.differ.getEditors().left.getSession().setValue(i),this.fileContents=i,T(this.editingFile).then(e=>{const n=E(),i=n?"//Access to gist writing failed\n\n//Do you have a valid token.\n// It needs to have permission to edit the gist file.":`//${t}\n\n// Failed to fetch plugin`;this.differ.getEditors().right.getSession().setValue(e&&!n?e:i),this.differ.getEditors().right.setReadOnly(n),document.getElementById("plugin-differ-commit").className=n?"disabled":""}).catch(e=>{this.differ.getEditors().right.setReadOnly(!0),document.getElementById("plugin-differ-commit").className="disabled",this.differ.getEditors().right.getSession().setValue(e.toString())})),"test"===this.mode&&!1===this.hasTestedOnce&&(this.hasTestedOnce=!0,document.querySelector("#edit-plugin-mode-test").style["border-bottom"]="1px solid",document.querySelector("#edit-plugin-mode-test").style.display="block"),"edit"===this.mode&&(document.getElementById("js-editor").style.display="block",document.getElementById("js-editor-errors").style.display="block",document.getElementById("edit-plugin-code-buttons").style.display="flex")})};const{value:t}=await Swal.fire({showCloseButton:!1,showCancelButton:!1,title:`\n        <div class="flex-wrap" style="flex:1;justify-content:space-between;gap: 4px; font-size: 1.4rem">\n          <div class="flex-wrap" style="gap: 12px;">\n            <select id="edited-plugin-file" class="settings-value" onchange="app.plugins.${O.name}.onSetEditingFile()" style="max-width: calc(90vw - 60px)">\n              ${Object.keys(this.volatilePlugins||{}).map(e=>`<option value="${e}">${e}</option>`)}\n            </select>\n            <div class="button-group-rounded" id="add-remove-plugin-file">\n              <button id="add-plugin-file" onclick="app.plugins.${O.name}.onAddNewFile()" title="Add">+</button>\n              <button id="remove-plugin-file" onclick="app.plugins.${O.name}.onRemoveSelectedFile()" title="remove">─</button>\n            </div>\n          </div>\n          <div id="edit-plugin-mode" class="button-group-rounded">\n            <button onclick="app.plugins.${O.name}.onSetPluginEditMode('edit')" id="edit-plugin-mode-edit" style="width:90px;border-right: 1px solid #f0f8ff14;">Edit</button>\n\n            <button onclick="app.plugins.${O.name}.onSetPluginEditMode('test')" id="edit-plugin-mode-test" style="width:90px;border-right: 1px solid #f0f8ff14">Test</button>\n\n        <button onclick="app.plugins.${O.name}.onSetPluginEditMode('commit')" id="edit-plugin-mode-commit" style="width:107px">Commit</button> \n          </div>\n        </div>\n        `.replaceAll("\n",""),html:`\n      <div style="overflow:hidden;">\n        <div id="js-editor-wrapper" style="position:relative">\n          <div id="js-editor" style="height: 80vh; width: 100%;"></div>\n        </div>\n        </div>\n        <div id="js-editor-errors" style="\n          position: absolute;\n          bottom: 28px;\n          right: 20px;\n          display: none;\n          color: red;\n          background: rgba(0, 0, 0, 0.75);\n          padding: 6px;\n          border-radius: 0.2rem;\n          font-family: 'Courier New', monospace;\n          font-size: 0.7rem;\n          text-align: start;\n          max-height: 60%;\n          max-width: 45%;\n          overflow: auto;\n          z-index: 9999;\n        ">\n        </div> \n\n        <div style="position: relative;">\n            <div id="diff-editor" class="diff-editor" style="height: 80vh; width: 100%;"></div>\n            <button id="plugin-differ-commit" style="position: absolute;\n            right: 17px;\n            bottom: 17px;\n            padding-left: 9px;\n            padding-right: 9px;\n            border-radius: 0.9rem;\n            display: block;"\n            onclick="app.plugins.${O.name}.onCommitChanges()"\n          >\n            Save to Gist\n          </button>\n          <button id="plugin-differ-link" style="position: absolute;\n            right: 170px;\n            bottom: 17px;\n            padding-left: 9px;\n            padding-right: 9px;\n            border-radius: 0.9rem;\n            display: block;"\n            onclick="app.plugins.${O.name}.onOpenGistLink()"\n          >\n            Open target gist\n          </button>\n        </div>\n\n        <div>\n          <div style="position: absolute;\n              right: calc(50vw - 65px);\n              bottom: 3px;\n              z-index: 999;\n              padding-left: 9px;\n              padding-right: 9px;\n              border-radius: 0.9rem;">\n            <button id="plugin-output-downloader"\n              onclick="app.plugins.${O.name}.onDownloadPreviewOrReload()"\n            >\n              Download\n            </button>\n\n            <button title="format" onclick="app.plugins.${O.name}.onFormatCode()" id="edit-plugin-code-buttons">format</button>\n          </div>\n\n          <div style="position: absolute;\n              right: calc(50vw + 80px);\n              bottom: 3px;\n              z-index: 999;\n              padding-left: 9px;\n              padding-right: 9px;\n              border-radius: 0.9rem;">\n            <button id="plugin-output-linker"\n              onclick="app.plugins.${O.name}.onCopyLink()"\n            >\n              Copy link\n            </button>\n          </div>\n          <div id="plugin-test-area" style="height: 80vh; width: 100%;">\n            <div id="plugin-yarn-reloader" style="display: none; flex-direction: column; gap: 7px">\n              <div style="margin: 2rem">\n                Your code has a Constructor field.\n                This appears to be a yarn editor plugin.\n                You need to reload Yarn for any changes to take effect.\n              </div>\n              <div style="flex:1;align-content:center;">\n                <img  width="170px" src="./public/icon.png" alt="Yarn Icon" style="margin:0; padding:0;filter: drop-shadow(1px 1px 1px white) drop-shadow(-1px -1px 1px white);" />\n              </div>\n            </div>\n            <iframe id="plugin-output-previewer" style="height: 80vh; width: 100%;border: none;"> \n          </div>\n        </div>\n      </div>\n        `,showConfirmButton:!1,focusConfirm:!1,customClass:"swal-wide",width:window.innerWidth-20+"px",onBeforeOpen:()=>{this.theme="dracula"===e.settings.theme()?"ace/theme/monokai":void 0,"dracula"===e.settings.theme()?(a("public/plugins/ace-diff/ace-diff.min.css"),r("public/plugins/ace-diff/ace-diff-dark.min.css")):(a("public/plugins/ace-diff/ace-diff-dark.min.css"),r("public/plugins/ace-diff/ace-diff.min.css")),D("gistPlugins",L())},onAfterClose:()=>{window.removeEventListener("previewErrors",this.onErrorsInPreview),this.hasTestedOnce=!1,D("mode",""),this.editor.terminate(),this.editor=null},onOpen:()=>{e.data.getSaveData("ink"===e.settings.documentType()?"ink.json":"json").then(e=>{this.yarnData=e}),window.addEventListener("previewErrors",this.onErrorsInPreview,!1),this.editor=ace.edit("js-editor"),this.editor.setOptions({...c,theme:this.theme}),s(this.editor);const t=e.utils.debounce(()=>{w(this.editingFile,{content:this.editor.getValue()}).then(()=>{this.updatePreviewOutput(this.editor.getValue(),()=>this.editor.focus())})},600);this.editor.getSession().on("change",()=>{t()}),v(O.name,"pluginEditorOpen",!0),this.differ=new o.a({element:document.querySelector(".diff-editor"),left:{...c,theme:this.theme,content:""},theme:"ace/theme/monokai",right:{...c,theme:this.theme,content:"... no connection with gist"}}),s(this.differ.getEditors().left),s(this.differ.getEditors().right);const n=e.utils.debounce(()=>{w(this.editingFile,{content:this.differ.getEditors().left.getValue()})},600);this.differ.getEditors().left.getSession().on("change",(function(){n()})),this.differ.getEditors().right.getSession().on("change",()=>{}),setTimeout(()=>{const e=p(O.name);console.log("Open plugins file  "+C()),C()?this.onUpdatePluginsList(C()).then(()=>{this.onSetPluginEditMode(e.pluginEditMode||this.mode,C()),D("gistPlugins",L())}):this.onSetPluginEditMode(e.pluginEditMode||this.mode,C())},400)},preConfirm:()=>(v(O.name,"pluginEditorOpen",!1),this.editor.getValue())})},b(()=>{P(!1).then(e=>{this.volatilePlugins=e,C()&&N()&&this.onOpenPluginEditor()}),t(O.name,{name:"Playground",attachTo:e.settings.developmentModeEnabled()?"appHeader":"fileMenuDropdown",onClick:"onOpenPluginEditor()",className:"item",id:"pluginEditorButton",iconName:"javascript",...e.settings.developmentModeEnabled()?{className:"bbcode-button",style:"padding: 0 10px; margin-top: 3px; font-size: small",as:"span"}:{}})})}},uMdg:function(e,t,n){}},[["e6Wu",1,2]]]);