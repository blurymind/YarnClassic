(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"+NoZ":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return r}));const i=n("HSUl"),o=function(e="my-db",t="preferences"){return{dbName:e,objectStoreName:t,db:void 0,save:async function(e,t){const n=this.db.transaction(this.objectStoreName,"readwrite");return n.objectStore(this.objectStoreName).put({key:e,value:t}),n.complete},load:async function(e){const t=this.db.transaction(this.objectStoreName,"readonly").objectStore(this.objectStoreName),n=await t.get(e);return n&&n.value},openDatabase:function(){return i.openDB(e,1,{upgrade:e=>{e.createObjectStore(this.objectStoreName,{keyPath:"key"})}})},getDbValue:function(e=this.dbName){return this.openDatabase().then(t=>(this.db=t,this.load(e)))}}},s={JSON:"json",XML:"xml",TWEE:"twee",TWEE2:"tw2",UNKNOWN:"none",YARN:"yarn",INK:"ink",INKJSON:"ink.json",RENPY:"rpy"},a=e=>{if(!e)return s.UNKNOWN;const t=e.toLowerCase();return t.endsWith(".json")?s.JSON:t.endsWith(".yarn.txt")?s.YARN:t.endsWith(".ink")?s.INK:t.endsWith(".yarn")?s.YARN:t.endsWith(".xml")?s.XML:t.endsWith(".txt")?s.TWEE:t.endsWith(".tw2")||t.endsWith(".twee")?s.TWEE2:s.UNKNOWN},r=(e="gist")=>"gist"===e?{getFileType:a,FILETYPE:s,lastStorageHost:"GIST",fileType:s.UNKNOWN,fileHandle:void 0,writable:void 0,saveAsFile:async function(e,t){return new Promise(async(n,i)=>{const o=await window.showSaveFilePicker({suggestedName:e,types:[{description:"Yarn editor files",accept:{"text/plain":Object.values(s).map(e=>"."+e)}}]});this.fileHandle=o;const r=o.name,l=a(r);this.fileType=l;const c=await t(l),d=await o.createWritable();this.writable=d,await d.write(c),await d.close(),console.log({fileHandle:o,writable:d}),n({type:l,content:c,chosenFileName:r,fileHandle:o,writable:d})})},downloadContent:function(e,t){const n=new File([e],t,{type:"text/plain"}),i=document.createElement("a"),o=URL.createObjectURL(n);i.href=o,i.download=n.name,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o)},saveToCurrentFile:async function(e,t){if(console.log({writable:this.writable,handle:this.fileHandle}),this.fileHandle){const t=await this.fileHandle.createWritable();await t.write(e),await t.close()}else this.downloadContent(e,t)},openFileOrFiles:async function(e=!1){const t="showOpenFilePicker"in window;let n;if(console.log({supportsFileSystemAccess:t}),t){try{const t=await showOpenFilePicker({multiple:e});e||(this.fileHandle=t[0],n=t[0],console.log({fileOrFiles:n}))}catch(e){"AbortError"!==e.name&&console.error(e.name,e.message)}return await n.getFile()}return new Promise(t=>{const n=document.createElement("input");n.style.display="none",n.type="file",document.body.append(n),e&&(n.multiple=!0),n.addEventListener("change",()=>{n.remove(),n.files&&t(e?n.files:n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})},fileName:"",openLocalFile:function(){return this.openFileOrFiles().then(e=>(this.fileType=a(e.name),this.fileName=e.name,this.lastStorageHost="LOCAL",e.text()))},setLastStorageHost:function(e){this.lastStorageHost=e},token:void 0,gistId:void 0,setCredentials:function(e,t){this.token=e,this.gistId=t},filesInGist:{},getFilesInGist:function(e){return e?e in this.filesInGist?this.filesInGist[e]:void console.error(e+" not found in gist",this.filesInGist):this.filesInGist},getGist:function(e,t=(()=>{})){const n="https://api.github.com/gists/"+e;return fetch(n,{method:"GET",headers:{Accept:"application/vnd.github+json",Authorization:"Bearer "+this.token,"X-GitHub-Api-Version":"2022-11-28"}}).then(e=>{if(console.log("GOT -- ",{data:e}),!1===e.ok){const i={401:"Is your Gist Token valid?",404:"Is your Gist ID online?\n\naddress:\n"+n};alert(`Failed to get:\n${n}...\n\nSTATUS: ${e.status}\n${e.status in i?i[e.status]:""}`),e.status in i&&t(e.status),404===e.status&&window.open(n,"_blank").focus()}return e.json()}).then(e=>{console.log("NEW from get::",{content:e}),this.filesInGist=e.files;const t={};return Object.keys(this.filesInGist).forEach(e=>{t[e]=e}),this.setLastStorageHost("GIST"),{body:e,filesInGist:this.filesInGist,inputOptions:t,fileList:Object.keys(this.filesInGist)}})},hasGistSettings:function(){return this.gistId&&this.gistId.length>0},getGistFile:function(e=(()=>{})){return this.getGist(this.gistId,e)},getContentOrRaw:function(e,t){return new Promise((n,i)=>{!e&&t?fetch(t).then(e=>(this.fileType=a(e.name),this.fileName=e.name,this.fileHandle=e,this.lastStorageHost="GIST",e.text())).then(e=>{n(e)}):n(e)})},editGist:function(e,t,n){return console.log({gistId:e,fileName:t,content:n}),fetch("https://api.github.com/gists/"+e,{method:"POST",headers:{Accept:"application/vnd.github+json",Authorization:"Bearer "+this.token,"X-GitHub-Api-Version":"2022-11-28"},body:JSON.stringify({description:"upload data from api",public:!1,files:{[t]:{content:n}}})}).then(e=>(this.setLastStorageHost("GIST"),e.json()))},editGistFile:function(e,t){return this.editGist(this.gistId,e,t)},FILETYPE:s}:{getFile:()=>{},setFile:()=>{},credentials:credentials,setCredentials:setCredentials}},"1mrn":function(e,t,n){},"2Qx2":function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return c}));var o=n("W2Rx"),s=n("oj90"),a=n("+NoZ");const r=n("33yf"),l=n("OeYU"),c={db:Object(a.a)("yarn-DB","Yarn-persistence"),storage:Object(a.c)("gist"),appInstanceStates:e.observable([]),isDocumentDirty:e.observable(!1),editingPath:e.observable(null),editingName:e.observable("NewFile"),editingType:e.observable("json"),editingFolder:e.observable(null),documentHeader:e.observable(null),lastEditedUnix:e.observable(new Date),lastSavedUnix:e.observable(null),inkCompiler:null,editingFileFolder:function(e=""){const t=c.editingPath()?c.editingPath():"";return e.length>0?r.join(r.dirname(t),e):r.dirname(t)},startNewFile:function(e="NewFile",t="json"){c.editingPath(null),c.editingName(e),c.editingType(t),c.editingFolder(null),c.documentHeader(null),app.workspace.selectedNodes=[],app.editing(null),t===a.b.INK&&app.settings.documentType("ink"),app.nodes([app.newNode(!0).title("ink"===app.settings.documentType()?c.InkGlobalScopeNodeName:"Start").body("ink"===app.settings.documentType()?"":"Empty text")]),app.tags([]),app.updateNodeLinks(),app.workspace.warpToNodeByIdx(0),c.isDocumentDirty(!0),app.refreshWindowTitle(),c.saveAppStateToLocalStorage(),app.ui.dispatchEvent("newYarnFileStarted")},askForFileName:function(){Swal.fire({title:"Enter a New File Name",input:"text",inputPlaceholder:"NewFile",showCancelButton:!0}).then(e=>{(e.value||""===e.value)&&c.startNewFile(e.value||"NewFile")})},setNewFile:function(){Swal.fire({title:"Create a New File?",text:`Any unsaved progress to ${c.editingName()}.${c.editingType()} will be lost!\n      Path: ${c.editingPath()}\n      Storage: ${app.settings.lastStorageHost()}\n      `,icon:"warning",showCancelButton:!0,confirmButtonText:"New file",cancelButtonText:"No, cancel!"}).then(e=>{e.value?c.askForFileName():c.startNewFile("NewFile")})},loadDocumentStateTabFromIndex:function(e){app.log("ATTEMPT TO LOAD STATE",e),app.settings.selectedFileTab(e),c.loadAppStateFromLocalStorage()},getCurrentAppState:function(){return{editingPath:c.editingPath(),editingName:c.editingName(),documentType:app.settings.documentType(),editingType:c.editingType(),editingFolder:c.editingFolder(),editingTitle:app.editing()?app.editing().title():null,nodes:c.getNodesAsObjects(),documentHeader:c.documentHeader(),tags:app.tags(),editorSelection:app.editor?app.editor.selection.getRange():null,transform:app.workspace.transform,scale:app.workspace.scale,lastStorageHost:app.settings.lastStorageHost(),lastEditedUnix:c.lastEditedUnix()||"",lastSavedUnix:c.lastSavedUnix(),pluginStorage:app.plugins.pluginStorage}},deleteDocumentStateTab:function(e){Swal.fire({title:"Are you sure?",text:`Are you sure you want to close this file? Any unsaved changes to ${c.editingName()}.${c.editingType()} will be lost!\n      Path: ${c.editingPath()||""}\n      Storage: ${app.settings.lastStorageHost()}\n      `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes close",cancelButtonText:"Cancel",reverseButtons:!0}).then(t=>{if(t.value){app.log("DELETE TAB",c.appInstanceStates(),e);const t=c.appInstanceStates().filter((t,n)=>n!==e).map(e=>({...e}));c.appInstanceStates([...t]),c.saveAppStateToLocalStorage(!1),setTimeout(()=>{const t=e>c.appInstanceStates().length-1?c.appInstanceStates().length-1:e;c.loadDocumentStateTabFromIndex(t)},500),app.log(c.appInstanceStates(),"resulting mutation",t)}})},addDocumentState:function({editingName:e,editingType:t,yarnData:n,checked:i}){c.appInstanceStates([...c.appInstanceStates(),{...c.getCurrentAppState()}]),app.log("DOCUMENT TAB ADDED",c.appInstanceStates()),c.saveAppStateToLocalStorage(),c.loadDocumentStateTabFromIndex(c.appInstanceStates().length-1),i?(c.editingName(e),c.editingType(t)):c.startNewFile(e,t),app.log({editingName:e,yarnData:n,editingType:t,checked:i})},addDocumentStateTab:function(){c.promptFileNameAndFormat(c.addDocumentState,null,"ðŸ“œ Name of new file"," Copy of "+c.editingName())},saveAppStateToLocalStorage:s.Utils.debounce((function(e=!0){app.settings.storage;c.isDocumentDirty(!0),c.lastEditedUnix(new Date),app.refreshWindowTitle();const t=[...c.appInstanceStates()];if(e){t[null!=app.settings.selectedFileTab()&&app.settings.selectedFileTab()<t.length?app.settings.selectedFileTab():0]=c.getCurrentAppState()}console.log({updatedStates:t,tab:app.settings.selectedFileTab(),new:c.getCurrentAppState()}),c.appInstanceStates(t),c.db.save("appStates",JSON.stringify(c.appInstanceStates())),app.ui.dispatchEvent("yarnSavedStateToLocalStorage")}),700),loadAppStateFromLocalStorage:async function(){const e=app.settings.storage;e.getItem("appState")&&(app.log("--- storage.clear() ---"),e.clear());const t=await c.db.getDbValue("appStates");if(!t)return void console.warn("failed to load persisted state");const n=JSON.parse(t),i=n[app.settings.selectedFileTab()];if(!1===app.settings.restoreSessionEnabled())return i&&(app.pluginStorage=i.pluginStorage),app.settings.selectedFileTab(0),void c.startNewFile();if(c.appInstanceStates(n),app.log("APP state",n,i),i){const{editingPath:e,editingName:t,editingType:n,documentType:o,editingFolder:s,editingTitle:a,editorSelection:r,nodes:l,documentHeader:d,tags:p,transform:u,scale:h,pluginStorage:g,lastEditedUnix:f,lastSavedUnix:m}=i;app.pluginStorage=g,app.tags(p),c.editingPath(e),c.editingName(t),c.editingType(n),app.settings.documentType(o),c.editingFolder(s),c.lastEditedUnix(f),c.lastSavedUnix(m),c.documentHeader(d),c.isDocumentDirty(!0),app.refreshWindowTitle(),app.ui.dispatchEvent("yarnLoadedStateFromLocalStorage"),app.log("--- app.plugins.pluginStorage ---"),c.getNodesFromObjectsAsync(l).then(e=>{a&&(app.editNode(e.find(e=>e.title()===a)),r&&app.editor.selection.setRange(r)),app.log("--- app.nodes(newNodes) ---",e.length),app.nodes(e),app.log("--- app.updateNodeLinks ---"),app.updateNodeLinks(),app.log("--- app.workspace.setTranslation ---"),app.workspace.setTranslation(u.x,u.y),app.log("--- app.workspace.setZoom ---"),app.workspace.setZoom(4*h)})}},readFile:function(e,t,n){c.getFileData(e,t).then(t=>{c.editingPath(e.path),c.editingType(t.type),c.loadData(t.data,t.type,n)})},setNewFileStats:function(e,t,n="LOCAL"){app.log("Updated save data",e,t),c.editingName(e.replace(/^.*[\\\/]/,"")),c.isDocumentDirty(!1),c.editingPath(t),app.settings.lastStorageHost(n),app.refreshWindowTitle()},openFile:function(e,t){const n=c.editingPath()?"Any unsaved progress to "+c.editingName()+" will be lost.":"Any unsaved progress will be lost.";Swal.fire({title:"Are you sure you want to open another file?",text:n,icon:"warning",showConfirmButton:!0,showCancelButton:!0}).then(n=>{!0===n.value&&(c.readFile(e,t,!0),c.setNewFileStats(t,e.path),app.refreshWindowTitle())})},openFileFromFilePath:function(e){const t=app.path.basename(e);i.ajax({url:e,async:!1,success:n=>{const i=Object(a.d)(t);i===a.b.UNKNOWN?Swal.fire({title:"Unknown filetype!",icon:"error"}):(c.loadData(n,i,!0),c.setNewFileStats(t,e),c.editingType(i))}})},getFileData:function(e,t){return new Promise((n,i)=>{const o=new FileReader;o.onload=function(s){const r=Object(a.d)(t);r===a.b.UNKNOWN?(Swal.fire({title:"Unknown filetype!",icon:"error"}),i()):n({file:e,type:r,data:o.result,name:e.name})},o.readAsText(e)})},openFolder:function(e,t){editingFolder=t,Swal.fire({text:"openFolder not yet implemented e: "+e+" foldername: "+t,icon:"error"})},appendFile:function(e,t){c.readFile(e,t,!1)},dispatchEventDataLoaded:function(){var e=new CustomEvent("yarnLoadedData");e.document=document,e.data=c,e.app=app,window.dispatchEvent(e),window.parent.dispatchEvent(e)},restoreSettingsFromDocumentHeader:function(){if(null!==c.documentHeader()){const e=c.documentHeader();app.log("Apply settings from file header:",e),"markupLanguage"in e&&app.settings.markupLanguage(e.markupLanguage),"language"in e&&app.settings.language(e.language),"filetypeVersion"in e&&app.settings.filetypeVersion(e.filetypeVersion),app.settings.apply()}},loadData:function(e,t,n){const i=[],o=e=>{for(let t=0;t<e.length;t++)"title"in e[t]&&i.push(e[t])};if(app.log("OPENING::",{content:e}),t===a.b.JSON){if(!(e=JSON.parse(e)))return;Array.isArray(e)?o(e):(c.documentHeader(e.header),o(e.nodes)),app.setDocumentType("yarn")}else if(t===a.b.INK){var r=e.split(/\r?\n/),l=null;const t=e=>{try{l.title=r[e].split("//yarn-editor-metadata:")[0].replace(/===/g,"").trim();const{x:t,y:n,colorID:i}=JSON.parse(r[e].split("//yarn-editor-metadata:")[1]);l.position={x:parseInt(t),y:parseInt(n)},l.colorID=i}catch(e){console.warn("node metadata failed parse: ",e)}};for(let e=0;e<r.length;e++){const n={body:"",position:{x:160*i.length,y:160*i.length},colorID:0,tags:""};null!==l||r[e].trim().startsWith("===")||((l={...n,position:{x:-400,y:0}}).title=c.InkGlobalScopeNodeName),r[e].trim().startsWith("===")?(null!==l&&i.push(l),l={title:r[e].trim().replace(/===/g,""),...n},r[e].trim().includes("//yarn-editor-metadata:")&&t(e)):null!==l&&(l.body+=r[e]+"\n")}null!==l&&i.push(l),app.setDocumentType("ink")}else if(t===a.b.YARN){r=e.split(/\r?\n/),l=null;var d=!1;for(let e=0;e<r.length;e++)if("==="===r[e].trim())d=!1,null!=l&&(i.push(l),l=null);else if(d)l.body+=r[e]+"\n";else if(r[e].indexOf("title:")>-1)null==l&&(l={}),l.title=r[e].substr(7,r[e].length-7);else if(r[e].indexOf("position:")>-1){null==l&&(l={});var p=r[e].substr(9,r[e].length-9).split(",");l.position={x:Number(p[0].trim()),y:Number(p[1].trim())}}else r[e].indexOf("colorID:")>-1?(null==l&&(l={}),l.colorID=Number(r[e].substr(9,r[e].length-9).trim())):r[e].indexOf("tags:")>-1?(null==l&&(l={}),l.tags=r[e].substr(6,r[e].length-6)):"---"===r[e].trim()&&(d=!0,l.body="");null!=l&&i.push(l),app.setDocumentType("yarn")}else if(t===a.b.TWEE||t===a.b.TWEE2){r=e.split("\n"),l=null;for(var u=0,h=0;h<r.length;h++)if(r[h]=r[h].trim(),"::"===r[h].substr(0,2)){null!=l&&i.push(l),l={};var g="",f="",m={x:80*++u,y:80*u},y=r[h].indexOf("["),b=r[h].indexOf("]");y>0&&b>0&&(f=r[h].substr(y+1,b-y-1));var v=r[h].indexOf("<"),w=r[h].indexOf(">");if(v>0&&w>0){var S=r[h].substr(v+1,w-v-1).split(",");m.x=parseInt(S[0]),m.y=parseInt(S[1])}var x=0;y>0?x=y:v>0&&(x=v),g=(g=x?r[h].substr(3,x-3):r[h].substr(3)).trim(),l.title=g,l.tags=f,l.body="",l.position=m}else null!=l&&(l.body.length>0&&(r[h]+="\n"),l.body+=r[h]);null!=l&&i.push(l),app.setDocumentType("yarn")}else if(t===a.b.XML){app.setDocumentType("yarn");var T=(new DOMParser).parseFromString(e,"text/xml");if(void 0!==(e=s.Utils.xmlToObject(T)))for(let t=0;t<e.length;t++)i.push(e[t])}app.limitNodesUpdate(()=>{n&&app.nodes.removeAll(),c.getNodesFromObjects(i).forEach(e=>app.nodes.push(e))}),c.editingType(t),c.restoreSettingsFromDocumentHeader(),app.updateNodeLinks(),app.workspace.warpToNodeByIdx(0),c.isDocumentDirty(!1),c.addGlobalScopeToInkDoc(),c.dispatchEventDataLoaded()},addGlobalScopeToInkDoc:function(){"ink"!==app.settings.documentType()||app.nodes().find(e=>e.title().trim()===c.InkGlobalScopeNodeName)||app.newNode(!0).title(c.InkGlobalScopeNodeName).x(-400)},getNodeFromObject:function(e){return new o.a({title:e.title,body:e.body,tags:e.tags,colorID:e.colorID,x:parseInt(e.position.x),y:parseInt(e.position.y)})},getNodeAsObject:function(e){return{title:e.title(),tags:e.tags(),body:e.body(),position:{x:e.x(),y:e.y()},colorID:e.colorID()}},getNodesFromObjects:function(e){const t=[];if(!e)return[];for(let n=0;n<e.length;n++)t.push(c.getNodeFromObject(e[n]));return t},getNodesFromObjectsAsync:async function(e){if(!e)return[];const t=e.map(e=>new Promise(t=>t(c.getNodeFromObject(e))));return await Promise.all(t)},getNodesAsObjects:function(){const e=[],t=app.nodes();for(var n=0;n<t.length;n++)e.push(c.getNodeAsObject(t[n]));return e},getSaveData:async function(e,t=null,n=!1,i=c.getNodesAsObjects()){var o="";if(e===a.b.JSON)if("2"===app.settings.filetypeVersion()){app.log("Saving as Yarn json v2 type");const e=new Date;c.documentHeader({...c.documentHeader(),lastSavedUnix:e,language:app.settings.language(),documentType:app.settings.documentType(),markupLanguage:app.settings.markupLanguage(),filetypeVersion:app.settings.filetypeVersion(),pluginStorage:app.plugins.pluginStorage}),o=JSON.stringify({header:c.documentHeader(),nodes:i},null,"\t")}else o=JSON.stringify(i,null,"\t");else if(e===a.b.INK){const e=i.find(e=>e.title.trim()===c.InkGlobalScopeNodeName);if(e){if(n){const t=e.body.split(/\r\n|\r|\n/).filter(e=>e.trim().startsWith("INCLUDE "));o+=e.body.split(/\r\n|\r|\n/).filter(e=>!e.trim().startsWith("INCLUDE ")).join("\n");for(const e of t){const t=e.trim().split("INCLUDE ");if(t.length>1){const e=c.appInstanceStates().find(e=>e.editingType===a.b.INK&&e.editingName===t[1]);if(e){o+=await c.getSaveData(a.b.INK,null,n,e.nodes)+"\n"}}}}else o+=e.body;if(t&&o.split(/\r\n|\r|\n/).length>t)return e}for(let e=0;e<i.length;e++){const n=i[e];if(n.title.trim()!==c.InkGlobalScopeNodeName)if(o+=`\n=== ${n.title} === //yarn-editor-metadata: `+JSON.stringify({x:parseInt(n.position.x),y:parseInt(n.position.y),colorID:parseInt(n.colorID)})+"\n",o+=n.body,(s=n.body).length>0&&"\n"===s[s.length-1]||(o+="\n"),t&&o.split(/\r\n|\r|\n/).length>t)return n}}else if(e===a.b.INKJSON){const e=await c.getSaveData("ink",null,!0),t=new Promise((t,n)=>{app.ui.toastMixin.fire({title:"Ink file is compiling",icon:"info",timer:4e3,text:"Please wait..."}),c.inkCompiler.init(i=>{i.errors.length>0?(Swal.fire({title:"Failed to parse ink file",html:`<div class="title-error">${i.errors.join("<br/>")}</div>`,icon:"error"}).then(()=>c.goToErrorInkNode(e,i.errors[0])),n()):(app.log("Warnings",i.warnings),app.ui.toastMixin.fire({animation:!0,title:i.warnings.length>0?"Ink file compiled with some warnings":"Ink file compiled successfully",icon:i.warnings.length>0?"warning":"success",text:i.warnings.join("\n")}),app.log({responseStory:i.story}),t(JSON.stringify(i.story,null,"\t")))}).then(()=>c.inkCompiler.submit(e))});o=await t}else if(e===a.b.YARN)for(let e=0;e<i.length;e++){var s;o+="title: "+i[e].title+"\n",o+="tags: "+i[e].tags+"\n",o+="colorID: "+i[e].colorID+"\n",o+="position: "+i[e].position.x+","+i[e].position.y+"\n",o+="---\n",o+=i[e].body,(s=i[e].body).length>0&&"\n"===s[s.length-1]||(o+="\n"),o+="===\n"}else if(e===a.b.RENPY)for(let e=0;e<i.length;e++){o+=`\n${i[e].tags.includes("screen")?"screen":"label"} `+i[e].title.replace(/[ ]/g,"_")+":\n";const t=i[e].body;t.length>0&&"\n"===t[t.length-1]||(o+="\n");let n=!1,s=!1,a="";const r=i[e].tags.includes("renpy");t.split("\n").forEach(e=>{const t=e.trim(),i=s?"\t\t":"\t";if(r)a+=`${i}${e}\n`;else if(t.startsWith("[[")){const e=t.replace(/[\[\[]|[\]\]]]/g,"").split("|");e.length>1?(n||(a+=i+"menu:\n",n=!0),a+=`${i}\t"${e[0].trim()}":\n${i}\t\tjump ${e[1].trim()}\n`):a+=`${i}jump ${e[0].trim()}\n`}else if(t.startsWith("<<if")){const e=t.replace(/\<\<\|$|\>\>|if/g,"").split(/==|!=|>|</g).filter(Boolean),n=t.substring(2,t.length-2).match(/(>|==|!=|<)/);a+=e.length>1&&n?`\tif ${e[0].trim()} ${n[0]} ${e[1].trim()}:\n`:`\t# ${t}\n`,s=!0}else if(t.startsWith("<<elseif")){const e=t.replace(/\<\<\|$|\>\>|elseif/g,"").split(/==|!=|>|</g).filter(Boolean),n=t.substring(2,t.length-2).match(/(>|==|!=|<)/);a+=e.length>1&&n?`\telif ${e[0].trim()} ${n[0]} ${e[1].trim()}:\n`:`\t# ${t}\n`,s=!0}else if(t.startsWith("<<else"))a+="\telse:\n",s=!0;else if(t.startsWith("<<endif"))a+="\n",s=!1;else if(t.startsWith("<<set")){const e=t.replace(/[\<\>\$]|set /g,"").split("=");app.log({set:e}),a+=e.length>1?`${i}$ ${e[0].trim()} = ${e[1].trim()}\n`:`${i}#$ ${e[0].trim()} = 0:\n`}else t.startsWith("<<")?a+=`${i}${t.replace(/[\<\>]/g,"")}\n`:t.startsWith("//")?a+=`${i}#${t.substring(2)}\n`:t.length>0&&(t.endsWith('"')?a+=`${i}${t}\n`:a+=`${i}"${t}"\n`);n=!1}),o+=a+"\n"}else if(e===a.b.TWEE)for(let e=0;e<i.length;e++){var r="";i[e].tags.length>0&&(r=" ["+i[e].tags+"]"),o+=":: "+i[e].title+r+"\n",o+=i[e].body+"\n\n"}else if(e===a.b.TWEE2)for(let e=0;e<i.length;e++){r="";i[e].tags.length>0&&(r=" ["+i[e].tags+"]");var l=" <"+i[e].position.x+","+i[e].position.y+">";o+=":: "+i[e].title+r+l+"\n",o+=i[e].body+"\n\n"}else if(e===a.b.XML){o+="<nodes>\n";for(let e=0;e<i.length;e++)o+="\t<node>\n",o+="\t\t<title>"+i[e].title+"</title>\n",o+="\t\t<tags>"+i[e].tags+"</tags>\n",o+="\t\t<body>"+i[e].body+"</body>\n",o+='\t\t<position x="'+i[e].position.x+'" y="'+i[e].position.y+'"></position>\n',o+="\t\t<colorID>"+i[e].colorID+"</colorID>\n",o+="\t</node>\n";o+="</nodes>\n"}return c.isDocumentDirty(!1),app.refreshWindowTitle(),o},tryOpenFile:function(){c.storage.openLocalFile().then(e=>{c.addDocumentState({editingName:c.storage.fileName,editingType:c.storage.fileType,yarnData:e}),c.loadData(e,c.storage.fileType,!0)})},promptFileNameAndFormat:function(e,t=null,n="ðŸ’¾ Save file - enter file name",i=""){const o=c.editingName().replace(/\.[^/.]+$/,"")+"."+c.editingType();Swal.fire({title:n,html:` <input id="swal-input1" list="select-file-name" name="select" placeholder="${o}">\n      <datalist class="form-control" id="select-file-name">    \n        ${t&&t.map(e=>`<option value="${e}" />`).join("")}\n      </datalist>\n      ${i?`<br/><br/><input type="checkbox" id="swal-checkbox-checked"> ${i}</input>`:""}\n        `,onOpen:()=>{"NewFile"!==c.editingName()&&(document.getElementById("swal-input1").value=o,document.getElementById("swal-input1").addEventListener("focus",e=>{e.target.value="",e.target.showPicker()}))},showCancelButton:!0,preConfirm:()=>({name:document.getElementById("swal-input1").value,checked:!!i&&document.getElementById("swal-checkbox-checked").checked})}).then(({value:t})=>{if(t){const{name:n,checked:i}=t,o=n.split(".").pop(),s=Object.values(a.b).includes(o)?o:c.editingType(),r=(n||"").replace(/\.[^/.]+$/,"")+"."+s;c.getSaveData(s).then(t=>{e({editingName:r,editingType:s,yarnData:t,checked:i})})}})},tryShareFilePwa:function(e){c.promptFileNameAndFormat(({editingName:e,yarnData:t})=>{const n=[new Blob([t],{type:"text/plain"})],i=new File(n,e,{});navigator.canShare&&navigator.canShare({files:[i]})?navigator.share({title:e,text:t,file:[i]}).then(()=>app.log("Successful share")).catch(e=>app.log("Error sharing",e)):Swal.fire({title:"Web Share API is not supported in your browser.\nTry using it on your smartphone or tablet...",icon:"error"})})},trySaveGist:function(e){console.log({gists:e}),c.storage.hasGistSettings()?c.storage.getGistFile().then(e=>{const t=Object.keys(e.body.files);app.log(t),c.promptFileNameAndFormat(({editingName:e,yarnData:t})=>{c.editingName(e),c.storage.editGist(c.storage.gistId,e,t),Swal.fire("Saved!","The Yarn has been saved to gist "+c.storage.gistId,"success"),app.settings.lastStorageHost("GIST"),c.isDocumentDirty(!1),app.refreshWindowTitle()},t)}):(Swal.fire("Not configured","Your github settings are not configured","warning"),app.ui.openSettingsDialog())},openGist:function(e,t){const n=Object(a.d)(t);c.loadData(e,n,!0),c.isDocumentDirty(!1),app.settings.lastStorageHost("GIST"),c.editingPath(null),c.editingName(t),app.settings.lastEditedGist(t),app.refreshWindowTitle()},tryOpenGist:function(e){if(c.storage.hasGistSettings()){console.log({edit:c.editingName(),last:app.settings.lastEditedGist(),lastHost:app.settings.lastStorageHost()});const e="GIST"===app.settings.lastStorageHost()?app.settings.lastEditedGist():"";c.storage.getGistFile(app.ui.openSettingsDialog).then(({inputOptions:t,filesInGist:n})=>{Swal.fire({title:"ðŸ™ Open file from a gist",input:"select",inputOptions:t,inputAttributes:{autocomplete:"off"},inputValue:e,inputPlaceholder:"Select a file from the gist",showCancelButton:!0}).then(({value:e})=>{if(e){const t=n[e].content,i=n[e].raw_url;c.storage.getContentOrRaw(t,i).then(t=>{c.openGist(t,e)})}})})}else Swal.fire("Not configured","Your github settings are not configured","warning"),app.ui.openSettingsDialog()},tryAppend:function(){c.storage.openLocalFile().then(e=>{c.loadData(e,c.storage.fileType,!1)})},trySave:function(e){const t=(c.editingName()||"").replace(/\.[^/.]+$/,"")+"."+e;c.storage.saveAsFile(t,c.getSaveData).then(e=>{c.setNewFileStats(e.chosenFileName,"","LOCAL"),c.editingType(e.type)})},trySaveCurrent:function(){if(c.isDocumentDirty())if("GIST"===app.settings.lastStorageHost()){const e=c.storage;e.getGistFile().then(t=>{c.getSaveData(c.editingType()).then(t=>{c.getSaveData(c.editingType()),e.editGistFile(c.editingName(),t),app.settings.lastStorageHost("GIST"),c.isDocumentDirty(!1),app.refreshWindowTitle(),app.ui.toastMixin.fire({title:"Saved",text:`Saved ${c.editingName()} to Gist`})})})}else c.editingPath()?c.editingPath().length>0&&c.editingType().length>0&&c.getSaveData(c.editingType()).then(e=>{}):c.getSaveData(c.editingType()).then(e=>{c.storage.saveToCurrentFile(e,c.editingName())})},doesFileExist:function(e){return!1},triggerPasteClipboard:function(){if(app.electron){const e=app.electron.clipboard.readText();app.clipboard=e,document.execCommand("paste")}else navigator.clipboard&&navigator.clipboard.readText().then(e=>{app.clipboard=e}).catch(e=>{app.clipboard=app.editor.getSelectedText(),app.log("No clipboard access",e,"using local instead")}),setTimeout(()=>app.insertTextAtCursor(app.clipboard),100)},triggerCopyClipboard:function(){if(app.electron)app.electron.clipboard.writeText(app.editor.getSelectedText()),app.clipboard=app.editor.getSelectedText();else{const e=app.editor.getSelectedText();app.clipboard=e,navigator.clipboard&&e.length>0&&navigator.clipboard.writeText(e).then(()=>{app.clipboard=e})}},InkCompiler:function(){this.errors=[],this.warnings=[],this.errorHandler=(e,t)=>{let n=e.match(/^(ERROR|RUNTIME ERROR): ('([^']+)' )?line (\d+): (.*)/);let i=e.match(/^(WARNING|RUNTIME WARNING|TODO): ('([^']+)' )?line (\d+): (.*)/);n?this.errors.push(e):i&&this.warnings.push(e)},this.compilerOptions=new l.CompilerOptions(null,[],!1,this.errorHandler),this.ready=!1,this.worker=null,this.onComplete=()=>{},this.init=(e=(()=>{}))=>(this.onComplete=e,new Promise((e,t)=>{e()})),this.submit=e=>{this.errors=[],this.warnings=[];const t=new l.Compiler(e,this.compilerOptions).Compile().ToJson(),n={story:JSON.parse(t),warnings:this.warnings,errors:this.errors};this.onComplete(n)},this.getInkErrorGotoNode=async(e,t)=>{const n=t.substr(t.lastIndexOf(":")+1,t.length).trim();try{const e=Number(t.match(/line ([0-9]+):/)[1]);return{ln:e,node:(await c.getSaveData(a.b.INK,e)).title,find:n}}catch(e){return console.error(e),null}}},InkGlobalScopeNodeName:"INK_GLOBAL_SCOPE",goToErrorInkNode:(e,t)=>{c.inkCompiler.getInkErrorGotoNode(e,t).then(e=>{if(e){const{node:t,ln:n,find:i}=e;app.openNodeByTitle(t,i)}})}}}).call(this,n("Z1dp"),n("EVdn"))},"3ozf":function(e,t,n){},"5aMW":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var i=n("tUqF"),o=n("qVgP");const{JSONEditor:s}=n("JGHU");var a=function({app:t,createButton:a,addSettingsItem:r,getPluginStore:l,onYarnEditorOpen:c,onYarnInPreviewMode:d,onYarnSavedNode:p,onYarnSetDocumentType:u,onKeyUp:h,onKeyDown:g,onLoad:f,setPluginStore:m}){const y=this;this.name="Runner",this.onOpenDialog=async()=>{let e=null;const{value:i}=await Swal.fire({title:"Playtest starting variables",html:'<div class="json-editor-wrapper"><div id="jsoneditor"/></div>',focusConfirm:!1,customClass:"swal-wide",onOpen:()=>{n("1mrn"),e=new s({id:"jsoneditor"});const i=l(y.name);t.log({editor:e}),e.setValue("object"!=typeof i.variables?[{key:"er",value:"erd"}]:i.variables),m(y.name,"runnerVariablesOpen",!0)},preConfirm:()=>(m(y.name,"runnerVariablesOpen",!1),e.getValue())});i&&m(y.name,"variables",i)},f(()=>{r({title:"Playtesting Style",valueKey:"playtestStyle",defaultValue:"chat",optionsKey:"availablePlaytestStyles",options:[{id:"npc",name:"Npc bubble"},{id:"chat",name:"Chat messages"}],setterKey:"setPlaytestStyle",settingsColumn:"A"}),t.settings.developmentModeEnabled()&&a(y.name,{name:"Playtest variables",attachTo:"fileMenuDropdown",onClick:"onOpenDialog()",iconName:"cog"}),l(y.name).runnerVariablesOpen&&y.onOpenDialog()});const b=()=>{if("yarn"===t.settings.documentType())this.previewStory=new i.a,this.gotoLastPlayNode=function(){t.editing()&&t.editing().title()!==y.previewStory.node.title&&t.openNodeByTitle(y.previewStory.node.title),t.editor.focus()},this.advanceStoryPlayMode=function(e=5){y.previewStory.finished?(y.togglePlayMode(!1),y.gotoLastPlayNode()):(y.previewStory.changeTextScrollSpeed(e),-1!=y.previewStory.vnSelectedChoice&&5===e&&y.previewStory.vnSelectChoice())},this.togglePlayMode=function(n=!1){const i=e(".editor")[0],o=document.getElementById("storyPlayButton"),s=document.getElementById("editor-play");if(e("#editor-play").addClass("inYarnMode"),e("#commandDebugLabel").addClass("inYarnMode"),t.isEditorInPlayMode(n),n){i.style.display="none",e(".bbcode-toolbar").addClass("hidden"),s.style.display="flex",e(o).addClass("disabled"),y.previewStory.emiter.on("finished",(function(){y.togglePlayMode(!1),y.gotoLastPlayNode()})),y.previewStory.emiter.on("startedNode",(function(e){t.isEditorSplit&&t.workspace.warpToNode(t.getFirstFoundNode(e.title.toLowerCase().trim()))}));const n=l(y.name);t.log("variables",n),t.data.getSaveData("json").then(e=>{y.previewStory.initYarn(JSON.parse(e),t.editing().title().trim(),"NVrichTextLabel",!1,"commandDebugLabel",t.settings.playtestStyle(),n.variables||[])})}else t.editor.session.setScrollTop(s.scrollTop),s.style.display="none",i.style.display="flex",e(o).removeClass("disabled"),e(".bbcode-toolbar").removeClass("hidden"),e(".toggle-toolbar").removeClass("hidden"),e(".editor-counter").removeClass("hidden"),y.previewStory.terminate()},d(()=>y.togglePlayMode(!1)),p(()=>y.togglePlayMode(!1)),c(()=>{a(y.name,{iconName:"play",title:"Preview",attachTo:"bbcodeToolbar",onClick:"togglePlayMode(true)",className:"bbcode-button bbcode-button-right",id:"storyPlayButton"});const e=document.createElement("div");e.innerHTML=`\n    <div class="editor-play" id="editor-play" onpointerdown="app.plugins.${y.name}.advanceStoryPlayMode(30)" ondblclick="app.plugins.${y.name}.advanceStoryPlayMode()">\n        <p class="story-playtest-answer" id="NVrichTextLabel"></p>\n        <div id="commandDebugLabel"></div>\n    </div>\n  `,document.getElementById("editorContainer").appendChild(e),g(e=>{if(t.editing()&&!y.previewStory.finished)switch(e.keyCode){case t.input.keys.Z:y.previewStory.changeTextScrollSpeed(10),-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnSelectChoice();break;case t.input.keys.Up:-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnUpdateChoice(-1);break;case t.input.keys.Down:-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnUpdateChoice(1)}}),h(e=>{e.keyCode===t.input.keys.Z&&(y.previewStory.changeTextScrollSpeed(200),-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnSelectChoice())})});else{this.previewStory=new o.a,this.prevSession={story:null,prevSavePoints:[],childNodes:[],recompile:!1};const n=new t.data.InkCompiler;this.togglePlayMode=function(i=!1){const o=e(".editor")[0],s=document.getElementById("storyPlayButton"),a=document.getElementById("editor-play");if(t.isEditorInPlayMode(i),e("#editor-play").addClass("inInkMode"),e("#commandDebugLabel").addClass("inInkMode"),i){a.style.display="flex",e("#editor").addClass("editor-take-half"),y.previewStory.emiter.on("finished",(function(){y.togglePlayMode(!1),y.gotoLastPlayNode()})),y.previewStory.emiter.on("startedNode",(function(e){t.isEditorSplit&&t.workspace.warpToNode(t.getFirstFoundNode(e.title.toLowerCase().trim()))}));const i=l(y.name);t.log("VARIABLES::::",i),t.data.getSaveData("ink",null,!0).then(e=>{y.previewStory.initInk(n,()=>{y.prevSession={...y.prevSession,recompile:!0},y.togglePlayMode(!0)},y.prevSession,e,t.editing().title().trim(),"NVrichTextLabel",!1,"commandDebugLabel",t.settings.playtestStyle(),i.variables||[])})}else t.editor.session.setScrollTop(a.scrollTop),a.style.display="none",o.style.display="flex",e("#editor").removeClass("editor-take-half"),e(s).removeClass("disabled"),y.prevSession={prevSavePoints:y.previewStory.prevSavePoints,story:y.previewStory.story,childNodes:y.previewStory.textAreaEl?[...y.previewStory.textAreaEl.childNodes]:[],recompile:!1},y.previewStory.terminate();t.editor.resize()},d(()=>y.togglePlayMode(!1)),p(()=>y.togglePlayMode(!1)),this.advanceStoryPlayMode=function(e=5){},c(()=>{a(y.name,{iconName:"play",title:"Preview",attachTo:"bbcodeToolbar",onClick:"togglePlayMode(!app.isEditorInPlayMode())",className:"bbcode-button bbcode-button-right",id:"storyPlayButton"});const e=document.createElement("div");e.innerHTML=`\n    <div class="editor-play" id="editor-play" onpointerdown="app.plugins.${y.name}.advanceStoryPlayMode(30)" ondblclick="app.plugins.${y.name}.advanceStoryPlayMode()">\n        <p class="story-playtest-answer" id="NVrichTextLabel"></p>\n        <div id="commandDebugLabel"></div>\n    </div>\n  `,document.getElementById("editorContainer").appendChild(e)})}};b(),u(b),t.togglePlayMode=this.togglePlayMode}}).call(this,n("EVdn"))},"5dEm":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var i=n("oj90");const o=function(t){const n=this,o={toast:!0,position:"bottom",icon:"error",title:"Alignment requires two or more nodes be selected.",showConfirmButton:!1,timer:3500,timerProgressBar:!0};this.canvas=e(".arrows")[0],this.context=n.canvas.getContext("2d"),this.gridCanvas=e("#grid-canvas")[0],this.gridContext=n.gridCanvas.getContext("2d"),this.gridEnabled=!0,this.updateArrowsThrottle=50,this.updateArrowsInterval=void 0,this.deferredArrowsDrawInterval=void 0,this.nextArrowsUpdate=Number.NEGATIVE_INFINITY,this.isDrawingArrows=!1,this.selectedNodes=[],this.scale=1,this.offset={x:0,y:0},this.transform={x:0,y:0},this.isMarqueeEnabled=!1,this.marqueeSelection=[],this.marqueeRect={x1:0,y1:0,x2:0,y2:0},this.marqueeOffset=[0,0],this.zoomSpeed=.005,this.zoomLimitMin=.05,this.zoomLimitMax=1,this.setThrottle=function(e,t){const o=t?t.target.value:e;n.updateArrowsThrottle=i.Utils.clamp(o,16,250)},this.setTranslation=function(e,t,i=0){n.transform.x=e,n.transform.y=t,n.translate(i)},this.shiftTranslation=function(e,t,i=0){n.setTranslation(n.transform.x+e,n.transform.y+t,i)},this.translate=function(t){t&&n.startUpdatingArrows(),e(".nodes-holder").finish().transition({transform:"matrix("+n.scale+",0,0,"+n.scale+","+n.transform.x+","+n.transform.y+")"},t||0,"easeInQuad",(function(){t&&n.stopUpdatingArrows(),n.updateArrows(),n.updateGrid()}))},this.toWorkspaceCoordinates=(e,i)=>t.settings.snapGridEnabled()?{x:n.stepify((e-n.transform.x)/n.scale,t.settings.gridSize()),y:n.stepify((i-n.transform.y)/n.scale,t.settings.gridSize())}:{x:(e-n.transform.x)/n.scale,y:(i-n.transform.y)/n.scale},this.onPanLeft=function(){n.shiftTranslation(n.getPanAmount(),0,100)},this.onPanRight=function(){n.shiftTranslation(-n.getPanAmount(),0,100)},this.onPanUp=function(){n.shiftTranslation(0,n.getPanAmount(),100)},this.onPanDown=function(){n.shiftTranslation(0,-n.getPanAmount(),100)},this.getPanAmount=function(){return t.input.isShiftDown?100*n.scale:500*n.scale},this.setZoom=function(e){n.scale=e/4,n.translate(200)},this.onZoom=function(e,t,o){const s=n.scale,a=o*n.zoomSpeed*n.scale;n.scale=i.Utils.clamp(n.scale+a,n.zoomLimitMin,n.zoomLimitMax);const r=e-n.transform.x,l=t-n.transform.y,c=r-r*(n.scale/s),d=l-l*(n.scale/s);n.shiftTranslation(c,d)},this.onDragStart=function(e){n.offset.x=e.x,n.offset.y=e.y},this.onDragUpdate=function(e){n.isMarqueeEnabled&&t.workspace.onMarqueeEnd(),t.workspace.shiftNodes(e)},this.onDragEnd=function(){t.data.saveAppStateToLocalStorage()},this.onMarqueeStart=function(e){n.isMarqueeEnabled=!0,n.offset.x=e.x,n.offset.y=e.y,n.marqueeSelection=[],n.marqueeOffset[0]=0,n.marqueeOffset[1]=0,n.marqueeRect={x1:0,y1:0,x2:0,y2:0}},this.onMarqueeUpdate=function(e){n.isMarqueeEnabled&&(n.updateMarqueeRect(e),n.selectNodesInsideMarquee())},this.updateMarqueeRect=function(t){t.x>n.offset.x&&t.y<n.offset.y?(n.marqueeRect.x1=n.offset.x,n.marqueeRect.y1=t.y,n.marqueeRect.x2=t.x,n.marqueeRect.y2=n.offset.y):t.x>n.offset.x&&t.y>n.offset.y?(n.marqueeRect.x1=n.offset.x,n.marqueeRect.y1=n.offset.y,n.marqueeRect.x2=t.x,n.marqueeRect.y2=t.y):t.x<n.offset.x&&t.y<n.offset.y?(n.marqueeRect.x1=t.x,n.marqueeRect.y1=t.y,n.marqueeRect.x2=n.offset.x,n.marqueeRect.y2=n.offset.y):(n.marqueeRect.x1=t.x,n.marqueeRect.y1=n.offset.y,n.marqueeRect.x2=n.offset.x,n.marqueeRect.y2=t.y),e("#marquee").css({display:"block",x:n.marqueeRect.x1,y:n.marqueeRect.y1,width:Math.abs(n.marqueeRect.x1-n.marqueeRect.x2),height:Math.abs(n.marqueeRect.y1-n.marqueeRect.y2)})},this.selectNodesInsideMarquee=function(){const e=n.toWorkspaceCoordinates(n.marqueeRect.x1,n.marqueeRect.y1),o=n.toWorkspaceCoordinates(n.marqueeRect.x2,n.marqueeRect.y2),s={left:e.x,right:o.x,top:e.y,bottom:o.y};t.nodes().forEach(e=>{const t=n.marqueeSelection.indexOf(e),o=t>=0,a=e.x(),r=e.y(),l={left:a,right:a+e.width,top:r,bottom:r+e.height},c=i.Utils.rectanglesOverlap(s,l);c&&!o&&(n.selectNodes(e),n.marqueeSelection.push(e)),!c&&o&&(n.deselectNodes(e),n.marqueeSelection.splice(t,1))})},this.onMarqueeEnd=function(){n.isMarqueeEnabled&&(0==n.marqueeSelection.length&&n.deselectAll(),n.isMarqueeEnabled=!1,n.marqueeSelection=[],n.marqueeRect={x1:0,y1:0,x2:0,y2:0},e("#marquee").css({display:"none",x:0,y:0,width:0,height:0}))},this.shiftNodes=function(e){const t={x:e.x-n.offset.x,y:e.y-n.offset.y};n.shiftTranslation(t.x,t.y),n.offset=e},this.updateGrid=function(){const i=e(".nodes-holder").offset(),o=t.settings.gridSize();if(n.gridContext.clearRect(0,0,n.gridCanvas.width,n.gridCanvas.height),t.settings.snapGridEnabled()){const r=e(window).width(),l=e(window).height(),c=i.left%(o*n.scale),d=i.top%(o*n.scale);n.gridContext.beginPath(),n.gridContext.lineWidth=.5;for(var s=c;s<r;s+=o*n.scale)n.gridContext.moveTo(s,0),n.gridContext.lineTo(s,l);for(var a=d;a<l;a+=o*n.scale)n.gridContext.moveTo(0,a),n.gridContext.lineTo(r,a);if(n.gridContext.stroke(),n.gridContext.closePath(),"blueprint"===t.settings.theme()){n.gridContext.beginPath(),n.gridContext.lineWidth=.25;const e=16,t=200,c=Math.round(Math.min(1,o/t)*e),d=Math.max(1,Math.round(n.scale*c)),p=o*n.scale/d,u=i.left%p,h=i.top%p;for(s=u;s<r;s+=p)n.gridContext.moveTo(s,0),n.gridContext.lineTo(s,l);for(a=h;a<l;a+=p)n.gridContext.moveTo(0,a),n.gridContext.lineTo(r,a);n.gridContext.stroke(),n.gridContext.closePath()}}},this.startUpdatingArrows=function(){n.stopUpdatingArrows(),n.updateArrowsInterval=setInterval(n.updateArrows,n.updateArrowsThrottle)},this.stopUpdatingArrows=function(){n.updateArrowsInterval&&(window.clearInterval(n.updateArrowsInterval),n.updateArrowsInterval=void 0)},this.updateArrows=function(){if(n.isDrawingArrows)return;const i=(new Date).getTime();if(i<n.nextArrowsUpdate)return void(n.deferredArrowsDrawInterval||(n.deferredArrowsDrawInterval=window.setTimeout(n.updateArrows,n.nextArrowsUpdate+n.updateArrowsThrottle-i)));n.isDrawingArrows=!0,window.clearInterval(n.deferredArrowsDrawInterval),n.deferredArrowsDrawInterval=void 0,n.nextArrowsUpdate=i+n.updateArrowsThrottle;const o=t.nodes(),s=e(".nodes-holder").offset(),a=n.scale,r=3*a,l=8*a,c=8*a,d=[],p=[];n.canvas.width=e(window).width(),n.canvas.height=e(window).height(),n.context.lineWidth=r,n.context.strokeStyle=n.context.fillStyle=e(".arrows").css("color");for(let n of o)if(n.halfWidth=e(n.element).width()/2,n.halfHeight=e(n.element).height()/2,n.linkedTo().length)if("straight"===t.settings.lineStyle()){const e=(n.x()+n.halfWidth)*a+s.left,t=(n.y()+n.halfHeight)*a+s.top;for(let i of n.linkedTo()){const n=(i.x()+i.halfWidth)*a+s.left,o=(i.y()+i.halfHeight)*a+s.top,r=Math.sqrt((e-n)*(e-n)+(t-o)*(t-o)),u={x:(n-e)/r,y:(o-t)/r},h=(110+160*(1-Math.max(Math.abs(u.x),Math.abs(u.y))))*a,g={x:e+u.x*h,y:t+u.y*h},f={x:n-u.x*h,y:o-u.y*h};d.push({x1:g.x,y1:g.y,x2:f.x,y2:f.y}),p.push({x1:f.x+10*u.x,y1:f.y+10*u.y,x2:f.x-u.x*l-u.y*c,y2:f.y-u.y*l+u.x*c,x3:f.x-u.x*l+u.y*c,y3:f.y-u.y*l-u.x*c})}}else for(let e of n.linkedTo()){const t=(n.x()+n.halfWidth)*a+s.left,i=(n.y()+n.halfHeight)*a+s.top,o=(e.x()+e.halfWidth)*a+s.left,r=(e.y()+e.halfHeight)*a+s.top,h=(360-180*Math.atan2(r-i,o-t)/Math.PI)%360;let g,f,m,y;var u=!1;h<=45||h>=315?(u=!0,g=(n.x()+n.width)*a+s.left,f=(n.y()+n.halfHeight)*a+s.top,m=e.x()*a+s.left-l,y=(e.y()+e.halfHeight)*a+s.top,p.push({x1:m+l,y1:y,x2:m-l,y2:y-c,x3:m-l,y3:y+c})):h>45&&h<135?(u=!1,g=(n.x()+n.halfWidth)*a+s.left,f=n.y()*a+s.top,m=(e.x()+e.halfWidth)*a+s.left,y=(e.y()+n.height)*a+s.top+c,p.push({x1:m,y1:y-c,x2:m-l,y2:y+c,x3:m+l,y3:y+c})):h>=135&&h<=225?(u=!0,g=n.x()*a+s.left,f=(n.y()+n.halfHeight)*a+s.top,m=(e.x()+e.width)*a+s.left+l,y=(e.y()+e.halfHeight)*a+s.top,p.push({x1:m-l,y1:y,x2:m+l,y2:y-c,x3:m+l,y3:y+c})):h>225&&h<315&&(u=!1,g=(n.x()+n.halfWidth)*a+s.left,f=(n.y()+n.height)*a+s.top,m=(e.x()+e.halfWidth)*a+s.left,y=e.y()*a+s.top-c,p.push({x1:m,y1:y+c,x2:m-l,y2:y-c,x3:m+l,y3:y-c})),d.push({x1:g,y1:f,x2:m,y2:y,drawHorizontal:u})}n.context.beginPath();for(let e of d)n.context.moveTo(e.x1,e.y1),"straight"===t.settings.lineStyle()?n.context.lineTo(e.x2,e.y2):!0===e.drawHorizontal?n.context.bezierCurveTo(e.x2,e.y1,e.x1,e.y2,e.x2,e.y2):n.context.bezierCurveTo(e.x1,e.y2,e.x2,e.y1,e.x2,e.y2);n.context.stroke(),n.context.beginPath();for(let e of p)n.context.moveTo(e.x1,e.y1),n.context.lineTo(e.x2,e.y2),n.context.lineTo(e.x3,e.y3);n.context.fill(),n.isDrawingArrows=!1},this.bringToFront=function(t){const n=e(t),o=i.Utils.getHighestZ(n.parent());n.css("z-index",o+1)},this.selectAll=function(){n.selectNodes(t.nodes())},this.deselectAll=function(){n.deselectNodes(t.nodes())},this.selectNodes=function(e){const i=Array.isArray(e)?e:[e];for(let e of i)if(e.active()&&!n.selectedNodes.includes(e)&&t.canEditNodeMeta(e.title())){if(t.input.isScreenTouched&&t.input.isDragging)return;n.selectedNodes.push(e),e.setSelected(!0)}},this.deselectNodes=function(e){const t=Array.isArray(e)?e:[e];for(let e of t){const t=n.selectedNodes.indexOf(e);e.active()&&t>=0&&(n.selectedNodes.splice(t,1),e.setSelected(!1))}},this.getSelectedNodes=function(){return 1===n.selectedNodes.length?[n.selectedNodes[0]]:Array.apply(this,n.selectedNodes)},this.warpToNodeByIdx=function(e){n.warpToNode(t.nodes()[e]),t.focusedNodeIdx=e},this.warpToSelectedNodeByIdx=function(e){n.warpToNode(n.getSelectedNodes()[e]),t.focusedNodeIdx=e},this.warpToNode=function(t){if(t){var i=e(t.element);n.warpToXY(t.x()||t.createX,t.y()||t.createY),i.clearQueue(),i.transition({outlineColor:"pink",outlineWidth:2,outlineOffset:0},500),setTimeout(()=>{i.transition({outlineColor:"transparent",outlineWidth:1,outlineOffset:50},300)},700)}},this.warpToXY=function(i,o){const s=-i*n.scale,a=-o*n.scale,r=e(window).width()/2,l=e(window).height()/2,c=100*n.scale/2,d=100*n.scale/2;n.setTranslation(s+r-c+t.getSplitEditorXOffset(),a+l-d,100)},this.alignV=function(){if(t.input.isCtrlDown)return void n.reduceAlignV();const e=t.nodes().filter(e=>e.selected).sort((e,t)=>e.y()>t.y()?1:e.y()<t.y()?-1:0);if(e.length<2)return void Swal.fire(o);const i=e.shift();e.forEach((e,t)=>{e.moveTo(i.x(),e.y())})},this.reduceAlignV=function(){const e=t.settings.gridSize(),i=t.nodes().filter(e=>e.selected).sort((e,t)=>e.y()>t.y()?1:e.y()<t.y()?-1:0);if(i.length<2)return void Swal.fire(o);const s=i.shift();t.settings.snapGridEnabled()&&s.moveTo(n.stepify(s.x(),t.settings.gridSize()),n.stepify(s.y(),t.settings.gridSize()));const a=e-(s.y()+s.height)%e+e;i.forEach((e,n)=>{const i=t.settings.snapGridEnabled()?s.y()+e.height*(n+1)+a*(n+1):s.y()+210*(n+1);e.moveTo(s.x(),i)})},this.alignH=function(){if(t.input.isCtrlDown)return void n.reduceAlignH();const e=t.nodes().filter(e=>e.selected).sort((e,t)=>e.x()>t.x()?1:e.x()<t.x()?-1:0);if(e.length<2)return void Swal.fire(o);const i=e.shift();e.forEach((e,t)=>{e.moveTo(e.x(),i.y())})},this.reduceAlignH=function(){const e=t.settings.gridSize(),i=t.nodes().filter(e=>e.selected).sort((e,t)=>e.x()>t.x()?1:e.x()<t.x()?-1:0);if(i.length<2)return void Swal.fire(o);const s=i.shift();t.settings.snapGridEnabled()&&s.moveTo(n.stepify(s.x(),e),n.stepify(s.y(),e));const a=e-(s.x()+s.width)%e+e;i.forEach((e,n)=>{const i=t.settings.snapGridEnabled()?s.x()+e.width*(n+1)+a*(n+1):s.x()+210*(n+1);e.moveTo(i,s.y())})},this.arrangeSpiral=function(){const e=n.getSelectedNodes();e.length<2?Swal.fire(o):(e.forEach((e,i)=>{e.moveTo(t.settings.snapGridEnabled()?n.stepify(Math.cos(.5*i)*(600+30*i),t.settings.gridSize()):Math.cos(.5*i)*(600+30*i),t.settings.snapGridEnabled()?n.stepify(Math.sin(.5*i)*(600+30*i),t.settings.gridSize()):Math.cos(.5*i)*(600+30*i))}),n.warpToXY(0,0))},this.sortAlphabetical=function(){const i=n.getSelectedNodes().sort((e,t)=>e.title().localeCompare(t.title()));if(i.length<2)return void Swal.fire(o);let s=Math.round(i.length/2),a=0,r=0;const l=e(i[0].element).width()+30,c=e(i[0].element).height()+30,d=t.settings.gridSize();t.settings.snapGridEnabled()&&i[0].moveTo(n.stepify(i[0].x(),d),n.stepify(i[0],d)),i.forEach((e,n)=>{n%s?a+=1:(r+=1,a=0),1===n&&(r=0);const o=i[0].x()+i[0].width,p=d-o%d+d,u=i[0].y()+i[0].height,h=d-u%d+d;e.moveTo(t.settings.snapGridEnabled()?i[0].x()+a*e.width+a*p:i[0].x()+a*l,t.settings.snapGridEnabled()?i[0].y()+r*e.height+r*h:i[0].y()+r*c)}),n.warpToNode(i[0])},this.stepify=function(e,t){return Math.round(e/t)*t}}}).call(this,n("EVdn"))},INAQ:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return o}));n("oj90");const o=function(t){const n=this,o=Object.freeze({Left:0,Middle:1,Right:2}),s=Object.freeze({Enter:13,Escape:27,Space:32,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,C:67,D:68,O:79,S:83,V:86,W:87,X:88,Y:89,Z:90});this.keys=s,this.mouse={x:0,y:0},this.isDragging=!1,this.isScreenTouched=!1,this.isMiddleButtonDown=!1,this.isLeftButtonDown=!1,this.isShiftDown=!1,this.isCtrlDown=!1,this.isHoverOverWorkspace=!1,this.trackMouseEvents=function(){e(document).on("pointerdown",e=>{if(n.isDragging="nodes"===e.target.className||"body"===e.target.className&&(n.isMiddleButtonDown||0===t.workspace.selectedNodes.length),n.mouse.x=e.pageX,n.mouse.y=e.pageY,n.isMiddleButtonDown=e.button===o.Middle,this.isLeftButtonDown=e.button===o.Left,t.inWorkspace()){if(n.isDragging)switch(e.button){case o.Left:"nodes"===e.target.className&&t.workspace.onMarqueeStart({x:e.pageX,y:e.pageY});break;case o.Middle:t.workspace.onDragStart({x:e.pageX,y:e.pageY})}}else t.inEditor()&&e.button===o.Right&&(t.guessPopUpHelper(),e.preventDefault())}),window.addEventListener("touchstart",()=>{n.isScreenTouched=!0}),e(document).on("pointermove",e=>{n.mouse.x=e.pageX,n.mouse.y=e.pageY}),e(document).on("mousemove touchmove",e=>{if(n.isDragging){t.focusedNodeIdx=-1;const i=n.isScreenTouched&&e.changedTouches?e.changedTouches[0].pageX:e.pageX,o=n.isScreenTouched&&e.changedTouches?e.changedTouches[0].pageY:e.pageY;t.inWorkspace()&&(e.altKey||n.isMiddleButtonDown||n.isScreenTouched?t.workspace.onDragUpdate({x:i,y:o}):t.workspace.onMarqueeUpdate({x:i,y:o}))}}),e(document).on("pointerup touchend",e=>{n.isScreenTouched=!1,n.isDragging=!1,e.button===o.Left&&(n.isLeftButtonDown=!1),e.button===o.Middle&&(n.isMiddleButtonDown=!1),t.inWorkspace()&&(t.workspace.onDragEnd(),t.workspace.onMarqueeEnd())}),e(".nodes").mousewheel(e=>{e.altKey||(t.inWorkspace()||n.isHoverOverWorkspace)&&(t.workspace.onZoom(e.pageX,e.pageY,e.deltaY),e.preventDefault())}),e(".nodes").hover(()=>{n.isHoverOverWorkspace=!0},()=>{n.isHoverOverWorkspace=!1}),e(".nodes").on("pointerdown",()=>{t.isEditorSplit&&(t.focusEditor(!1),t.makeNewNodesFromLinks(),t.propagateUpdateFromNode(t.editing()),t.mustUpdateTags=!0,t.updateTagsRepository(),t.workspace.updateArrows())}),e(document).contextmenu(n=>{if(!t.inWorkspace())return;const i=e(n.target).hasClass("nodes")||e(n.target).parents(".nodes").length;if(n.button===o.Right&&i){const{x:e,y:i}=t.workspace.toWorkspaceCoordinates(n.pageX,n.pageY);t.newNodeAt(e,i)}return!i})},this.trackKeyboardEvents=function(){e(document).on("keyup keydown",e=>{n.isShiftDown=e.shiftKey,n.isCtrlDown=e.ctrlKey}),e(document).on("keyup",(function(e){if(e.keyCode===s.Space){if(t.inWorkspace()&&e.altKey||t.inEditor()&&!e.altKey)return;t.workspace.scale=1;const n=t.workspace.getSelectedNodes(),i=n.length>0,o=i>0?n:t.nodes();++t.focusedNodeIdx,(t.focusedNodeIdx<0||t.focusedNodeIdx>=o.length)&&(t.focusedNodeIdx=0),t.inWorkspace()?i?t.workspace.warpToSelectedNodeByIdx(t.focusedNodeIdx):t.workspace.warpToNodeByIdx(t.focusedNodeIdx):t.inEditor()&&t.editNode(t.nodes()[t.focusedNodeIdx])}})),e(document).on("keydown",e=>{if(t.inWorkspace()){if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.S:e.preventDefault(),t.data.trySaveCurrent();break;case s.A:if(e.shiftKey){e.preventDefault(),t.data.tryAppend();break}}if((e.metaKey||e.ctrlKey)&&e.altKey)switch(e.keyCode){case s.S:t.data.trySaveCurrent()}else if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.C:t.nodeClipboard=t.cloneNodeArray(t.workspace.getSelectedNodes());break;case s.D:t.workspace.deselectAll();break;case s.O:t.data.tryOpenFile();break;case s.S:t.data.trySaveCurrent();break;case s.X:const e=t.workspace.getSelectedNodes();t.nodeClipboard=t.cloneNodeArray(e),t.deleteNodes(e);break;case s.Y:t.historyDirection("redo");break;case s.Z:t.historyDirection("undo")}else e.keyCode===s.Delete||"Delete"===e.key?t.confirmDeleteNodes(t.workspace.getSelectedNodes()):t.$searchField.is(":focus")||e.ctrlKey||e.metaKey||(e.keyCode===s.A||e.keyCode===s.Left?t.workspace.onPanLeft():e.keyCode===s.D||e.keyCode===s.Right?t.workspace.onPanRight():e.keyCode===s.W||e.keyCode===s.Up?t.workspace.onPanUp():e.keyCode!==s.S&&e.keyCode!==s.Down||t.workspace.onPanDown())}}),e(document).on("keyup",e=>{if(t.inWorkspace())if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.A:t.workspace.selectAll();break;case s.V:t.pasteNodes()}else if(e.keyCode===s.Enter||"Enter"===e.key){const e=t.nodes()[t.focusedNodeIdx];e?t.editNode(e):t.editNode(t.nodes()[0])}}),e(document).on("keydown",(function(e){if(t.inEditor())if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.C:n.clipboard=t.editor.getSelectedText();break;case s.X:document.execCommand("copy"),t.clipboard=t.editor.getSelectedText(),t.insertTextAtCursor("");break;case s.S:t.data.trySaveCurrent()}else switch(e.keyCode){case s.Escape:t.saveNode(),t.closeEditor()}})),e(document).on("keyup",(function(e){if(t.inEditor()&&(e.metaKey||e.ctrlKey)&&e.altKey)switch(e.keyCode){case s.Enter:t.saveNode(),t.closeEditor()}})),e(document).on("keydown",(function(e){if(t.ui.settingsDialogVisible())switch(e.keyCode){case s.Escape:t.ui.closeSettingsDialog()}})),e(document).on("keyup keydown pointerdown pointerup",(function(e){t.inEditor()&&t.updateEditorStats()}))},this.initKnockoutBindings=function(){i.bindingHandlers.preventBubble={init:function(e,t){var n=i.utils.unwrapObservable(t());i.utils.registerEventHandler(e,n,(function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}))}},i.bindingHandlers.mousedown={init:function(t,n,o,s,a){var r=i.unwrap(n());e(t).mousedown((function(){r()}))}}};n.initKnockoutBindings(),n.trackMouseEvents(),n.trackKeyboardEvents()}}).call(this,n("EVdn"),n("Z1dp"))},JGHU:function(e,t,n){"use strict";n.r(t),function(e,i){n.d(t,"JSONEditor",(function(){return o}));var o=function({id:t}){this.tableAdd=({key:t,value:n})=>{var i=this.table.find("tr.hide").clone(!0).removeClass("hide table-line");t&&n&&(console.log("mutate",{key:t,value:n,html:i.html()}),i.html(`\n                <td contenteditable="true" class="cell">${t}</td>\n                <td contenteditable="true" class="cell">${n}</td>\n                <td>\n                    <span class="table-remove glyphicon glyphicon-remove">x delete</span>\n                </td>\n            `),e(".table-remove").on("click",(function(){e(this).parents("tr").detach()}))),this.table.find("table").append(i)},this.getValue=()=>{var t=this.table.find("tr:not(:hidden)"),n=[],i=[];return e(t.shift()).find("th:not(:empty):not([data-attr-ignore])").each((function(){n.push(e(this).text().toLowerCase())})),t.each((function(){var t=e(this).find("td"),o={};n.forEach((function(e,n){o[e]=t.eq(n).text()})),i.push(o)})),i},this.init=()=>{document.getElementById(t).innerHTML='\n        <div class="container">\n  <div id="table" class="table-editable">\n    <table class="table">\n        <tr class="table-header">\n            <th>Key</th>\n            <th>Value</th>\n            <th data-attr-ignore>Remove</th>\n        </tr>\n\n\n      \x3c!-- This is our clonable table line --\x3e\n      <tr class="hide" class="editable-row">\n        <td contenteditable="true" class="cell">key</td>\n        <td contenteditable="true" class="cell">val</td>\n        <td>\n          <span class="table-remove glyphicon glyphicon-remove">x delete</span>\n        </td>\n      </tr>\n    </table>\n\n    <div class="table-footer">\n        <button id="save-btn" class="btn btn-primary">Save Data</button>\n        <p id="save"></p>\n        <span class="table-add glyphicon glyphicon-plus">+ add</span>\n    </div>\n  </div>\n</div>\n        ';var n=e("#table"),o=e("#save-btn");this.table=n,this.rows=n.find("tr:not(:hidden)"),e("#save-btn").addClass("hide"),e(".table-add").on("click",this.tableAdd),e(".table-remove").on("click",(function(){console.log({removeThis:this}),e(this).parents("tr").detach()})),i.fn.pop=[].pop,i.fn.shift=[].shift,o.on("click",this.getValue)},this.init(),this.setValue=(e=[])=>{e.forEach(this.tableAdd)}}}.call(this,n("EVdn"),n("EVdn"))},LaP9:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="LaP9"},P0sH:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return h}));var o=n("owJe"),s=n("W2Rx"),a=n("5dEm"),r=n("INAQ"),l=n("pYPP"),c=n("fkuv"),d=n("2Qx2"),p=n("oj90"),u=n("l8+o"),h=(n("+NoZ"),function(t,h){const g=this;this.utils=p.Utils,this.setTheme=function(t,n){let i=n?n.target.value:t;setTimeout(g.initGrid,50),setTimeout(g.workspace.updateArrows,50),e("#theme-stylesheet").attr("href",p.Utils.getPublicPath(`themes/${i}.css`))},this.setLanguage=function(e,t){const n=t?t.target.value:e;Object(o.load_dictionary)(g.settings.language().split("-")[0]);const i=new CustomEvent("yarnSetLanguage");i.language=n,window.dispatchEvent(i),window.parent.dispatchEvent(i)},this.log=function(e){g.settings.developmentModeEnabled()&&console.log(e)},this.setDocumentType=function(e,t){const n=t?t.target.value:e;g.settings.documentType(n),g.log("Set doc type",e,app.data.inkCompiler),"ink"===n?(null===app.data.inkCompiler&&(app.data.inkCompiler=new app.data.InkCompiler),d.a.addGlobalScopeToInkDoc(),app.setMarkupLanguage("html")):app.data.inkCompiler=null,app.updateNodeLinks();const i=new CustomEvent("yarnSetDocumentType");i.language=n,window.dispatchEvent(i),window.parent.dispatchEvent(i)},this.setMarkupLanguage=function(e,t){const n=t?t.target.value:e;app.settings.markupLanguage(n),g.richTextFormatter=new u.a(g),g.mustRefreshNodes.notifySubscribers()},this.setGistPluginsFile=function(e,t){const n=t?t.target.value:e;app.settings.gistPluginsFile(n)},this.setFiletypeVersion=function(e,t){const n=t?t.target.value:e;g.filetypeVersion=n},this.setGistCredentials=function(e,t){const{token:n,file:i}=e;d.a.storage.setCredentials(n,i)},this.input=new r.a(g),this.settings=new l.a(g),this.workspace=new a.a(g),this.ui=new c.a(g),this.richTextFormatter=new u.a(g),this.data=d.a,this.name=i.observable(t),this.version=i.observable(h),this.editing=i.observable(null),this.nodes=i.observableArray([]),this.tags=i.observableArray([]),this.mustRefreshNodes=i.observable(),this.mustUpdateTags=!0,this.nodeHistory=[],this.nodeFuture=[],this.editingHistory=[],this.editingSaveHistoryTimeout=null,this.focusedNodeIdx=-1,this.isElectron=!1,this.editor=null,this.nodeVisitHistory=[],this.plugins={pluginStorage:{}},this.clipboard="",this.nodeClipboard=[],this.speachInstance=null,this.editingPath=i.observable(null),this.$searchField=e(".search-field"),this.isEditorInPreviewMode=!1,this.isEditorInPlayMode=i.observable(!1),this.isEditorSplit=!1,this.isEditorFocused=!1,this.editorResizeHandleOptions={handleSelector:"#editor-resize-handle",resizeHeight:!1,resizeWidthFrom:"right",onDragStart:function(){g.isSplitEditorInFocus=!0,e("#node-editor").removeClass("split-editor-out-of-focus")},onDragEnd:function(){g.editor.resize(),g.settings.editorSplitSize(e("#editor-form").width())}},this.inEditor=()=>(g.editing()||g.isEditorSplit&&g.isEditorFocused)&&!g.ui.isDialogOpen(),this.inWorkspace=()=>(!g.editing()||g.isEditorSplit&&!1===g.isEditorFocused)&&!g.ui.isDialogOpen(),this.run=function(){var t="Unknown OS";-1!=navigator.platform.indexOf("Win")&&(t="Windows"),-1!=navigator.platform.indexOf("Mac")&&(t="MacOS"),-1!=navigator.platform.indexOf("X11")&&(t="UNIX"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),g.isElectron=navigator.userAgent.toLowerCase().includes("electron");var n=navigator.userAgent||navigator.vendor||window.opera;let o;/android|iPad|iPhone|iPod/.test(n.toLowerCase())&&!window.MSStream&&(t="mobile"),"Windows"==t&&(g.workspace.zoomSpeed=.1),window.addEventListener("beforeunload",e=>(this.data.saveAppStateToLocalStorage(),null)),window.addEventListener("DOMContentLoaded",e=>{if(g.electron){const e=g.electron.remote.process.argv.length>1?g.electron.remote.process.argv[1]:null;if(e&&app.fs.existsSync(e))return void this.data.openFileFromFilePath(e)}this.data.loadAppStateFromLocalStorage();const t=new URL(window.location),n=t.searchParams.get("text")||t.searchParams.get("url");null!==n&&g.insertTextAtCursor(n+"\n",!0)});const s=e("#addPwa")[0];s.style.display="none",window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),o=e,s.style.display="block",s.addEventListener("click",e=>{s.style.display="none",o.prompt(),o.userChoice.then(e=>{"accepted"===e.outcome?(g.log("User accepted the A2HS prompt"),s.style.display="none"):g.log("User dismissed the A2HS prompt"),o=null})})}),e("#app").show(),i.applyBindings(g,e("#app")[0]),g.editingVisualStudioCodeFile()||g.newNode().title("Start"),g.settings.apply(),e(".search-title input").click(g.updateSearch),e(".search-body input").click(g.updateSearch),e(".search-tags input").click(g.updateSearch),g.$searchField.on("input",g.updateSearch),g.$searchField.on("keyup",(function(e){27==e.keyCode?g.clearSearch():g.searchWarp()})),"mobile"===t&&g.workspace.setZoom(3),e(window).on("resize",(function(){g.ui.isScreenNarrow()&&g.editing()&&g.isEditorSplit&&g.toggleEditorView(),g.workspace.updateArrows(),g.initGrid()})),setTimeout(g.initGrid,50),this.guessPopUpHelper=function(){/color=#([a-zA-Z0-9]{3,6})$/.test(g.getTagBeforeCursor())&&g.insertColorCode()},this.insertEmoji=function(){this.emPicker.toggle(),g.togglePreviewMode(!0),e("#emojiPicker-container").css({left:g.input.mouse.x-200,top:g.input.mouse.y-125}),e("#emojiPicker-container").show()},this.insertColorCode=function(){e("#colorPicker-container").is(":visible")||(e("#colorPicker").spectrum("set",g.editor.getSelectedText()),e("#colorPicker").spectrum("toggle"),e("#colorPicker-container").css({left:g.input.mouse.x-70,top:g.input.mouse.y-50}),e("#colorPicker-container").show(),g.togglePreviewMode(!0),setTimeout(()=>{const t=e("#colorPicker").spectrum("get");g.applyPickerColorEditor(t)},100))},this.applyPickerColorEditor=function(e){const t=JSON.parse(JSON.stringify(g.editor.selection.getRange()));g.editor.selection.setRange(t);const n=e.toHexString().replace("#","");g.editor.session.replace(t,n),g.editor.selection.setRange({start:g.editor.getCursorPosition(),end:{row:g.editor.getCursorPosition().row,column:g.editor.getCursorPosition().column-n.length}}),g.togglePreviewMode(!0)},document.addEventListener("contextmenu",(function(e){g.editing()&&e.preventDefault()}),!1),document.ondragover=document.ondrop=e=>{e.preventDefault()},document.body.ondrop=e=>{e.preventDefault();for(var t=0;t<e.dataTransfer.files.length;t++)d.a.appendFile(e.dataTransfer.files[t],e.dataTransfer.files[t].name,!1)},window.addEventListener("message",e=>{const t=e.data;switch(t.type){case"UpdateNode":g.nodes().forEach(e=>{e.title().trim()===t.payload.originalNodeTitle.trim()&&(e.title(t.payload.title),e.tags(t.payload.tags),e.body(t.payload.body),g.setYarnDocumentIsDirty())})}});var a=new CustomEvent("yarnReady");a.document=document,a.data=d.a,a.app=this,window.dispatchEvent(a),window.parent.dispatchEvent(a);const r=new URLSearchParams(window.location.href.split("?")[1]),l=r.get("gist"),c=r.get("fileName");l&&c&&fetch("https://api.github.com/gists/"+l).then(e=>e.json()).then(e=>{const t=e.files[c].content;d.a.openGist(t,c)})},this.limitNodesUpdate=function(e){g.nodes.extend({rateLimit:{method:"notifyWhenChangesStop",timeout:250}}),e(),g.nodes.limit(e=>()=>e())},this.getNodesConnectedTo=function(e){var t=[],n=g.nodes();for(var i in n)if(n[i]!=e&&n[i].isConnectedTo(e,!0)){var o=!1;for(var s in t)if(t[s]==n[i]){o=!0;break}o||t.push(n[i])}return t},this.matchConnectedColorID=function(e){var t=g.getNodesConnectedTo(e);for(var n in t)t[n].colorID(e.colorID())},this.quit=function(){g.isElectron},this.canEditNodeMeta=function(e){return"ink"!==app.settings.documentType()||e.trim()!==d.a.InkGlobalScopeNodeName},this.sanitiseNodeTitle=function(){"ink"===app.settings.documentType()&&(app.editing().title().startsWith("function ")||app.editing().title(app.editing().title().replace(/[ ]/g,"_")))},this.validateTitle=function(){var t=document.getElementById("editorTitle").value,n=e("#editorTitle");g.getOtherNodeTitles().includes(t)||g.titleExistsTwice(t)?(n.attr("class","title title-error"),n.attr("title","Another node has the same title")):"yarn"!==app.settings.documentType()||RegExp("^[a-z0-9]+$","i").test(t)?(n.removeAttr("title"),n.removeClass("title-error")):(n.attr("class","title title-error"),n.attr("title","Only upper or lower case letters and numbers are allowed in a node title."))},this.refreshWindowTitle=function(){let e="";"LOCAL"===app.settings.lastStorageHost()?e="Yarn - "+(d.a.editingPath()||d.a.editingName())+" "+(d.a.isDocumentDirty()?"*":""):"GIST"===app.settings.lastStorageHost()&&(e="Gist - "+(d.a.editingPath()||d.a.editingName())+" "+(d.a.isDocumentDirty()?"*":"")),g.electron?g.electron.remote.getCurrentWindow().setTitle(e):document.title=e},this.usingVisualStudioCodeExtension=function(){return!!window.vsCodeApi},this.editingVisualStudioCodeFile=function(){return!0===window.editingVsCodeFile},this.setYarnDocumentIsDirty=function(){g.usingVisualStudioCodeExtension()&&g.editingVisualStudioCodeFile()&&d.a.getSaveData(d.a.editingType()).then(e=>{window.vsCodeApi.postMessage({type:"DocumentEdit",payload:e})})},this.recordNodeAction=function(e,t){if(g.nodeFuture.length>0){for(var n=0;n<g.nodeFuture.length;n++){delete g.nodeFuture.pop().node}delete g.nodeFuture,g.nodeFuture=[]}var i={action:e,node:t,lastX:t.x(),lastY:t.y()};"removed"==e&&(i.lastY+=80),g.nodeHistory.push(i),g.setYarnDocumentIsDirty()},this.historyDirection=function(e){function t(e){var t=g.nodes.indexOf(e);t>=0&&g.nodes.splice(t,1),g.updateNodeLinks()}var n=null;if(n="undo"==e?g.nodeHistory.pop():g.nodeFuture.pop()){var i=n.action,o=n.node;"undo"==e?("created"==i?(n.lastX=o.x(),n.lastY=o.y(),t(o)):"removed"==i&&g.recreateNode(o,n.lastX,n.lastY),g.nodeFuture.push(n),g.setYarnDocumentIsDirty()):("created"==i?g.recreateNode(o,n.lastX,n.lastY):"removed"==i&&t(o),g.nodeHistory.push(n),g.setYarnDocumentIsDirty())}},this.recreateNode=function(e,t,n){g.nodes.push(e),e.moveTo(t,n),g.updateNodeLinks()},this.setSelectedColors=function(e){var t=g.workspace.getSelectedNodes();for(var n in t.splice(t.indexOf(e),1),t)t[n].colorID(e.colorID())},this.pasteNodes=function(){g.nodeClipboard.length&&(g.workspace.deselectAll(),g.nodeClipboard.forEach((function(e){var t=new s.a({title:g.getUniqueTitle(e.title()),body:e.body(),tags:e.tags(),colorID:e.colorID(),x:e.createX,y:e.createY});g.nodes.push(t),g.workspace.selectNodes(t),g.recordNodeAction("created",t)})),g.updateNodeLinks())},this.confirmDeleteNodes=function(e){const t=Array.isArray(e)?void 0:e,n=Array.isArray(e)?[...e]:t&&t.selected?[...g.workspace.getSelectedNodes()]:[e];n.length&&Swal.fire({title:"Are you sure?",text:`${n.length} ${1===n.length?"node":"nodes"} will be deleted.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(e=>{e.value&&g.deleteNodes(n)})},this.deleteNodes=function(e){const t=Array.isArray(e)?e:[e],n=[];for(let e=t.length-1;e>=0;--e)n.push(t[e].remove());Promise.all(n).then(()=>{g.limitNodesUpdate(()=>{for(let e=t.length-1;e>=0;--e)g.inEditor()&&g.editing()===t[e]&&g.closeEditor(),g.deleteNode(t[e]);g.updateNodeLinks(),g.workspace.deselectNodes(t),g.workspace.updateArrows()})})},this.deleteNode=function(e){const t=g.nodes.indexOf(e);t>=0&&(g.recordNodeAction("removed",e),g.nodes.splice(t,1)),g.setYarnDocumentIsDirty()},this.cloneNodeArray=function(e){return e.map((function(e){return new s.a({title:e.title(),body:e.body(),tags:e.tags(),colorID:e.colorID(),x:e.x()+10,y:e.y()+10})}))},this.newNode=function(e=!0){var t=new s.a;return g.nodes.push(t),e&&g.updateNodeLinks(),g.recordNodeAction("created",t),t},this.newNodeAt=function(e,t){var n=new s.a({x:e-100,y:t-100});return g.nodes.push(n),g.updateNodeLinks(),g.recordNodeAction("created",n),n},this.searchTextInEditor=function(e=!0){e?g.editor.execCommand("find"):g.editor.searchBox&&g.editor.searchBox.hide()},this.showRandomQuote=function(){e.ajax({url:"https://api.forismatic.com/api/1.0/?",dataType:"jsonp",data:"method=getQuote&format=jsonp&lang=en&jsonp=?",success:function(e){Swal.fire({text:e.quoteText+"\n\n-"+e.quoteAuthor})}})},this.editNode=function(t,n=!0){if(!n&&!t.active())return;if(g.settings.alwaysOpenNodesInVisualStudioCodeEditor())return void g.editNodeInVisualStudioCodeEditor(t);g.editing()&&g.editing()!==t&&g.saveNode(!1),g.isEditorInPlayMode()&&g.togglePlayMode(!1),g.isEditorInPreviewMode&&g.togglePreviewMode(!1),t.oldTitle=t.title(),g.editing(t),g.mustUpdateTags=!0,e("#node-editor-background").css({opacity:0}).transition({opacity:1},250),e("#node-editor").css({y:"-100",opacity:0}).transition({y:"0",opacity:1},250),g.editor=ace.edit("editor"),g.editor.setOptions({scrollPastEnd:.5}),g.editor.focus(),g.editor.navigateFileEnd(),e("#colorPicker").spectrum({flat:!0,showButtons:!1,showInput:!0,showPalette:!0,preferredFormat:"hex",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"]],move:function(e){g.applyPickerColorEditor(e)},clickoutFiresChange:!0});const i=ace.require("ace/ext/language_tools"),s=p.Utils.createAutocompleter("ink"===app.settings.documentType()?["divert.target"]:["string.llink","string.rlink"],app.getOtherNodeTitles().map(e=>{const n=g.getNodeByTitle(e);return{word:e,title:e,about:`${n.tags().length>0?`tags: ${n.tags()}<br/>`:""}Preview:<br/>${n.clippedBody()}`,titleStyle:t.titleStyles[n.colorID()]}}),"Node Link");i.setCompleters([s,i.keyWordCompleter,i.textCompleter,i.snippetCompleter]);let a=void 0;g.editor.getSession().on("change",(function(e){const t=g.settings.autoCloseTags();if("insert"===e.action&&t){if(g.richTextFormatter.justInsertedAutoComplete)return void(g.richTextFormatter.justInsertedAutoComplete=!1);a&&clearTimeout(a),a=setTimeout(()=>{a=void 0,g.richTextFormatter.completableTags.forEach(e=>{if(g.getTagBeforeCursor()===e.Start){g.richTextFormatter.justInsertedAutoComplete=!0;let t=e.Completion,n=e.Offset;g.settings.autoCloseBrackets()&&e.BehaviorCompletion&&(t=e.BehaviorCompletion,n+=1),e.Completion&&g.insertTextAtCursor(t),e.Offset&&g.moveEditCursor(n),e.Func&&e.Func()}})},200)}})),this.emPicker=new EmojiPicker(document.getElementById("emojiPickerDom"),e=>{g.insertTextAtCursor(e.char),this.emPicker.toggle(),g.togglePreviewMode(!1)}),Object(o.enable_spellcheck)(),g.toggleInvertColors(),g.toggleShowCounter(),g.toggleSpellCheck(),g.validateTitle(),g.updateEditorStats(),g.updateEditorOptions(),g.$searchField.val().length>0&&e(".search-body input").is(":checked")&&g.editor.findAll(g.$searchField.val()),g.settings.editorSplit()&&(g.splitEditor(),g.workspace.warpToNodeByIdx(t.index()-1)),"right"===g.settings.editorSplitDirection()?(e("#editor-form").addClass("split-editor-right"),e("#editor-resize-handle").addClass("float-right")):(e("#editor-form").removeClass("split-editor-right"),e("#editor-resize-handle").removeClass("float-right")),e(".node-editor").on("pointerdown","> *",(function(e){g.isEditorSplit&&(g.focusEditor(!0),e.stopPropagation())})),e(".app-info").hide(),g.editor.resize(),null!=t.undoManager&&g.editor.session.setUndoManager(t.undoManager);var r=new CustomEvent("yarnEditorOpen");r.document=document,r.data=d.a,r.app=app,window.dispatchEvent(r),window.parent.dispatchEvent(r)},this.splitEditor=function(){g.isEditorSplit=!0,g.focusEditor(!0),g.settings.editorSplit(!0),g.editorResizeHandleOptions.resizeWidthFrom="right"===g.settings.editorSplitDirection()?"left":"right",e("#editor-form").width(g.settings.editorSplitSize()).addClass("split-editor").toggleClass("split-editor-right","right"===g.settings.editorSplitDirection()).resizable(g.editorResizeHandleOptions),e("#node-editor-background").addClass("hidden"),e("#node-editor").css({"z-index":10002}),e("#editor-resize-handle").removeClass("hidden").toggleClass("float-right","right"===g.settings.editorSplitDirection()),e("#split-editor-button").addClass("hidden"),e("#snap-editor-button").removeClass("hidden"),e("#exit-editor").removeClass("hidden"),e("#full-size-editor-button").removeClass("hidden"),e("#split-button-separator").removeClass("hidden"),g.ui.checkAndMoveAppButtons()},this.toggleEditorView=function(){g.settings.editorSplit(!g.settings.editorSplit()),g.reopenEditor()},this.reopenEditor=function(){g.saveNode();let e=g.editing();g.closeEditor(),setTimeout(()=>{g.editNode(e)},250)},this.editorSnapToggle=function(){g.settings.editorSplitDirection("right"===g.settings.editorSplitDirection()?"left":"right"),g.reopenEditor()},this.focusEditor=function(t){!0===t?(e("#node-editor").removeClass("split-editor-unfocused"),g.isEditorFocused=!0):(e("#node-editor").addClass("split-editor-unfocused"),g.isEditorFocused=!1)},this.getSplitEditorXOffset=function(){let t=0;return g.inEditor()&&g.settings.editorSplit()&&(t=e("#editor-form").width()/2,"right"===g.settings.editorSplitDirection()&&(t*=-1)),t},this.editNodeInVisualStudioCodeEditor=function(e){g.usingVisualStudioCodeExtension()?(g.setYarnDocumentIsDirty(),window.vsCodeApi.postMessage({type:"OpenNode",payload:{title:e.title().trim(),tags:e.tags().trim(),body:g.trimBodyLinks(e.body().trim())}})):console.error("Tried to open node in Visual Studio Code text editor but we're not in the Visual Studio Code extension")},this.chooseRelativePathImage=function(e){g.insertTextAtCursor(e)},this.getNodeByTitle=function(e){return g.nodes().find(t=>t.title().trim().toLowerCase()===e.trim().toLowerCase())},this.openNodeByTitle=function(e,t=""){g.isEditorInPlayMode()&&g.togglePlayMode(),g.makeNodeWithName(e);const n=g.nodes().find(t=>t.title().trim().toLowerCase()===e.trim().toLowerCase());n&&(g.editNode(n,!0),t&&setTimeout(()=>g.editor.find(t),200))},this.openLastEditedNode=function(){if(0===g.nodeVisitHistory.length)g.saveNode(),g.closeEditor();else{const e=g.nodeVisitHistory.pop();g.propagateUpdateFromNode(g.editing()),g.openNodeByTitle(e)}},this.getSpellCheckSuggestionItems=function(){var e=Object(o.suggest_word_for_misspelled)(g.editor.getSelectedText());if(e){var t={};return e.forEach(e=>{t[e]={name:e,icon:"edit",callback:e=>{g.insertTextAtCursor(e)}}}),t}return!1},this.getThesaurusItems=function(){var e=n("GLdW")(g.editor.getSelectedText());if(!e)return!1;var t=[];if(Object.keys(e).forEach((function(n){e[n].forEach((function(e){t.includes(e)||e===n||t.push(e)}))})),t.length>0){var i={};return t.forEach(e=>{i[e]={name:e,icon:"edit",callback:e=>{g.insertTextAtCursor(e)}}}),i}return!1},this.toggleSpellCheck=function(){setTimeout((function(){g.settings.spellcheckEnabled()?Object(o.enable_spellcheck)():Object(o.disable_spellcheck)()}),50)},this.toggleInvertColors=function(){const t=g.settings.invertColorsEnabled()?{filter:"invert(100%)"}:{filter:"invert(0%)"};e("#app").css(t),e("#app-bg").css(t),e(".tooltip").css(t),e(".node .body").css(t),e(".editor-container .editor-preview").css(t)},this.initGrid=function(){if(g.settings.snapGridEnabled()){var t=e(window).width(),n=e(window).height();e("#grid-canvas").attr("width",t),e("#grid-canvas").attr("height",n),e("#gridSize").attr("disabled",!1),g.workspace.gridContext.strokeStyle=g.workspace.gridContext.fillStyle=e(".grid-canvas").css("color")}else e("#gridSize").attr("disabled",!0);app.workspace.updateGrid()},this.toggleShowCounter=function(){g.settings.editorStatsEnabled()?e(".node-editor .form .editor-counter").css({display:"initial"}):e(".node-editor .form .editor-counter").css({display:"none"})},this.toggleAutocompleteSuggestions=function(){g.settings.autocompleteSuggestionsEnabled(!g.settings.autocompleteSuggestionsEnabled()),g.updateEditorOptions()},this.toggleAutoCloseBrackets=function(){g.settings.autoCloseBrackets(!g.settings.autoCloseBrackets()),g.updateEditorOptions()},this.updateEditorOptions=function(){g.editor.setOptions({enableBasicAutocompletion:app.settings.autocompleteSuggestionsEnabled(),enableLiveAutocompletion:app.settings.autocompleteSuggestionsEnabled(),behavioursEnabled:app.settings.autoCloseBrackets()})},this.togglePreviewMode=function(t){const n=e(".editor")[0],i=e("#editor-preview")[0];g.isEditorInPreviewMode=t,app.ui.dispatchEvent("yarnInPreviewMode"),t?(e(".bbcode-toolbar").addClass("hidden"),n.style.display="none",i.style.display="block",i.innerHTML=g.richTextFormatter.richTextToHtml(g.editing().body(),!0),i.scrollTop=g.editor.renderer.scrollTop):(e(".bbcode-toolbar").removeClass("hidden"),g.editor.session.setScrollTop(i.scrollTop),i.innerHTML="",i.style.display="none",n.style.display="flex",g.editor.focus(),g.editor.resize(),e("#colorPicker-container").is(":visible")&&e("#colorPicker-container").hide(),e("#emojiPicker-container").is(":visible")&&e("#emojiPicker-container").hide())},this.appendText=function(e){g.editing().body(g.editing().body()+e);const t=g.editor.session.getLength()-1,n=g.editor.session.getLine(t).length;g.editor.gotoLine(t+1,n)},this.moveEditCursor=function(e){const t=g.editor.getCursorPosition();g.editor.gotoLine(t.row+1,t.column+e),g.editor.focus()},this.insertTextAtCursor=function(e,t=!1){if(!g.editing())return;g.editor.session.replace(g.editor.selection.getRange(),"");const n=g.editor.getCursorPosition();if(g.editor.session.insert(n,e),t){const e=g.editor.getCursorPosition();editor.scrollToLine(e.row,!0,!0,(function(){})),g.editor.focus()}g.updateEditorStats(),g.editor.focus()},this.getTagBeforeCursor=function(){const e=g.editor.getSelectionRange(),t=e.start.row,n=g.editor.session.getLine(t).substring(e.start.column-2,e.start.column+2);if(!n)return"";if("ink"===app.settings.documentType()){if(["->"].includes(n.trim()))return n.trim()}else if(["[[","<<"].includes(n.trim())||n.includes("|"))return n.trim();return g.richTextFormatter.identifyTag(n)},this.saveNode=function(){const t=g.editing();if(t){const n=e("#editorTitle")[0],i=g.getFutureEditedNodeTitle();n.value=i,t.title(i),t.body(g.trimBodyLinks(t.body().trim())),g.makeNewNodesFromLinks(),g.propagateUpdateFromNode(t),g.workspace.updateArrows(),setTimeout(g.updateSearch,600),g.setYarnDocumentIsDirty(),app.ui.dispatchEvent("yarnSavedNode")}},this.closeEditor=function(){g.editing().undoManager=g.editor.session.getUndoManager(),e("#node-editor-background").transition({opacity:0},250),e("#node-editor").transition({y:"-100",opacity:0},250,(function(e){g.editing(null),g.editor.destroy(),g.editor=null,this.emPicker=null})),g.isEditorSplit=!1,g.isEditorFocused=!1,e(".app-info").show(),app.ui.resetAppButtonsLocation(),g.isEditorInPlayMode()&&g.togglePlayMode(!1),g.isEditorInPreviewMode&&g.togglePreviewMode(!1)},this.convertMarkup=function(){g.nodes().forEach(e=>{e.body(g.richTextFormatter.convert(e.body()))})},this.updateSearch=p.Utils.debounce((function(){const t=app.$searchField.val().toLowerCase();for(var n=0;n<g.nodes().length;n++){var i=g.nodes()[n],o=e(i.element);const{matchTitle:s,matchBody:a,matchTags:r,clearSearch:l}=app.ui.nodeSearchMatches(i,t);l?(i.active(!0),o.clearQueue(),o.transition({opacity:1},500)):s||a||r?(i.active({title:s,body:a,tags:r}),o.clearQueue(),o.transition({opacity:1},500)):(i.active(!1),o.clearQueue(),o.transition({opacity:.25},500))}}),600),this.trimBodyLinks=function(e){return e.replace(/\[\[(.+?)\|\s*(.+?)\s*\]\]/g,"[[$1|$2]]")},this.updateNodeLinks=function(){for(let e of g.nodes())e.updateLinks()},this.propagateUpdateFromNode=function(e){var t=[],n=[];for(t.push(e);e=t.pop();)n.includes(e)||(n.push(e),e.updateLinks(),e.linkedTo().forEach(e=>{n.includes(e)||t.push(e)}),e.linkedFrom().forEach(e=>{n.includes(e)||t.push(e)}))},this.updateTagsRepository=p.Utils.debounce((function(){if(!app.mustUpdateTags)return;app.mustUpdateTags=!1;g.tags().forEach(e=>e.count=0),g.nodes().forEach(e=>{p.Utils.uniqueSplit(e.tags()," ").forEach(e=>{const t=g.tags().find(t=>t.text==e);if(t)++t.count;else{const t=(()=>{const e=g.tags().map(e=>e.id);for(let t=1;;++t)if(!e.includes(t))return t})();g.tags.push({id:t,style:"tag-style-"+t,text:e,count:1})}})});let e=g.tags().length;for(;e--;)0===g.tags()[e].count&&g.tags().splice(e,1)}),500),this.makeNewNodesFromLinks=function(){if(!g.settings.createNodesEnabled())return console.info("Autocreate new nodes disabled");var e=g.editing().getLinksInNode();if(null!=e)for(var t=0;t<e.length;t++){const i=e[t].trim();var n=220*(t+1);g.makeNodeWithName(i,n)}},this.makeNodeWithName=function(e,t=220){const n=g.getOtherNodeTitles();"ink"!==app.settings.documentType()&&e&&e.length>0&&!n.includes(e)&&e!=g.editing().title()&&g.newNodeAt(g.editing().x()+t,g.editing().y()-120).title(e)},this.titleExistsTwice=function(e){return g.nodes().filter(t=>t.title().trim()===e.trim()).length>1},this.getFutureEditedNodeTitle=function(){const t=e("#editorTitle")[0];return g.getUniqueTitle(t.value.trim())},this.getOtherNodeTitles=function(){const e=[];return g.nodes().forEach(t=>{if(!g.editing()||t.title()!==g.editing().title()){if("ink"===app.settings.documentType()&&t.title().trim()===d.a.InkGlobalScopeNodeName)return;e.push(t.title().trim())}}),e},this.getHighlightedText=function(t){t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\</g,"&lt;")).replace(/\>/g,"&gt;")).replace(/\&lt;\&lt;(.*?)\&gt;\&gt;/g,'<p class="conditionbounds">&lt;&lt;</p><p class="condition">$1</p><p class="conditionbounds">&gt;&gt;</p>')).replace(/\[\[([^\|]*?)\]\]/g,'<p class="linkbounds">[[</p><p class="linkname">$1</p><p class="linkbounds">]]</p>')).replace(/\[\[([^\[\]]*?)\|([^\[\]]*?)\]\]/g,'<p class="linkbounds">[[</p>$1<p style="color:red"><p class="linkbounds">|</p><p class="linkname">$2</p><p class="linkbounds">]]</p>')).replace(/[^:]\/\/(.*)?($|\n)/g,'<span class="comment">//$1</span>\n')).replace(/\/\*((.|[\r\n])*)?\*\//gm,'<span class="comment">/*$1*/</span>')).replace(/\/\%((.|[\r\n])*)?\%\//gm,'<span class="comment">/%$1%/</span>');var n=e("<div>");return n[0].innerHTML=t,n.find(".comment").each((function(){e(this).find("p").each((function(){e(this).removeClass()}))})),n.find(".linkname").each((function(){var t=e(this).text(),n=!1;for(var i in g.nodes())if(g.nodes()[i].title().toLowerCase()==t.toLowerCase()){n=!0;break}n||e(this).removeClass("linkname")})),t=n[0].innerHTML},this.updateLineNumbers=function(t){for(var n=t.split("\n"),i="",o=0;o<Math.max(1,n.length);o++)(0==o||o<n.length-1||n[o].length>0)&&(i+=o+1+"<br />");e(".editor-container .lines").html(i)},this.moveNodes=function(e,t){for(var n in g.nodes()){var i=g.nodes()[n];i.moveTo(i.x()+e,i.y()+t)}},this.getFirstFoundNode=function(e){return g.nodes().find(t=>t.title().toLowerCase().trim()===e)},this.searchWarp=function(){var e=g.$searchField.val().toLowerCase().trim();if(""===e)g.workspace.warpToNodeByIdx(0);else{const t=g.getFirstFoundNode(e);g.workspace.warpToNodeByIdx(g.nodes.indexOf(t))}},this.clearSearch=function(){g.$searchField.val(""),g.updateSearch()},this.updateEditorStats=function(){var t=g.editor.getSession().getValue(),n=g.editor.getCursorPosition(),i=t.split("\n");e(".editor-counter .character-count").html(t.length),e(".editor-counter .line-count").html(i.length),e(".editor-counter .row-index").html(n.row),e(".editor-counter .column-index").html(n.column),d.a.saveAppStateToLocalStorage()},this.getUniqueTitle=function(e){var t=g.getOtherNodeTitles();if(e&&!t.includes(e))return e;var n=e||"Node",i=2;const o=n.match(/^(.*)(_([0-9]+))$/);if(o&&4===o.length&&(n=o[1],i=Number(o[3])),!t.includes(n))return n;for(;;++i){var s=n+"_"+i;if(!t.includes(s))return s}},this.navigateToNodeDuringPlayTest=function(e,t=""){g.openNodeByTitle(e,t),g.togglePlayMode(!0),app.workspace.warpToNode(app.getFirstFoundNode(e))}})}).call(this,n("EVdn"),n("Z1dp"))},"P85/":function(e,t,n){},W2Rx:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return a}));var o=n("oj90");let s=0;let a=function(t={}){const n=this;this.titleStyles=["title-style-1","title-style-2","title-style-3","title-style-4","title-style-5","title-style-6","title-style-7","title-style-8","title-style-9"],this.index=e.observable(s++),this.title=e.observable(t.title||app.getUniqueTitle()),this.tags=e.observable(t.tags||""),this.body=e.observable(t.body||""),this.active=e.observable(t.active||!0),this.width=200,this.height=200,this.tempOpacity=null,this.style=null,this.colorID=e.observable(t.colorID||0),this.checked=!1,this.selected=!1,this.createX=t.x||null,this.createY=t.y||null,this.undoManager=null,this.clippedTags=e.computed((function(){return app.updateTagsRepository(),o.Utils.uniqueSplit(n.tags()," ").map(e=>app.tags().find(t=>t.text===e)).filter(e=>e)}),this),this.clippedBody=e.computed((function(){if(app.ui.isScreenNarrow()&&app.editing())return;app.mustRefreshNodes();let e=app.getHighlightedText(this.body());return e=app.richTextFormatter.richTextToHtml(e),e=e.substr(0,225),e}),this),this.linkedTo=e.observableArray(),this.linkedFrom=e.observableArray(),this.element=null,this.canDoubleClick=!0,this.create=function(){if(n.style=window.getComputedStyle(i(n.element).get(0)),n.createX&&n.createY)n.x(n.createX),n.y(n.createY);else{let e=i(n.element).parent();n.x((-e.offset().left+i(window).width()/2-100)/app.workspace.scale),n.y((-e.offset().top+i(window).height()/2-100)/app.workspace.scale)}app.workspace.bringToFront(n.element),app.workspace.startUpdatingArrows(),i(n.element).css({opacity:0,scale:.8,y:"-=80px",rotate:"45deg"}).transition({opacity:1,scale:1,y:"+=80px",rotate:"0deg"},250,"easeInQuad",(function(){app.workspace.stopUpdatingArrows(),app.workspace.updateArrows()})),n.drag(),i(n.element).on("dblclick",(function(){n.canDoubleClick&&app.editNode(n)})),o.Utils.addDoubleTapDetector(n.element,(function(){n.canDoubleClick&&app.editNode(n)})),i(n.element).on("click",(function(e){e.ctrlKey&&(n.selected?app.workspace.deselectNodes(n):app.workspace.selectNodes(n))}))},this.setSelected=function(e){n.selected=e,n.selected?i(n.element).addClass("selected"):i(n.element).removeClass("selected")},this.toggleSelected=function(){n.setSelected(!n.selected)},this.x=function(e){if(null!=e&&i(n.element).css({x:Math.floor(e)}),n.style)return Math.floor(new WebKitCSSMatrix(n.style.webkitTransform).m41)},this.y=function(e){if(null!=e&&i(n.element).css({y:Math.floor(e)}),n.style)return Math.floor(new WebKitCSSMatrix(n.style.webkitTransform).m42)},this.resetDoubleClick=function(){n.canDoubleClick=!0},this.cycleColorDown=function(){n.doCycleColorDown(),setTimeout(n.resetDoubleClick,500),n.canDoubleClick=!1,app.input.isShiftDown&&app.matchConnectedColorID(n),n.selected&&app.setSelectedColors(n),app.setYarnDocumentIsDirty()},this.cycleColorUp=function(){n.doCycleColorUp(),setTimeout(n.resetDoubleClick,500),n.canDoubleClick=!1,app.input.isShiftDown&&app.matchConnectedColorID(n),n.selected&&app.setSelectedColors(n),app.setYarnDocumentIsDirty()},this.doCycleColorDown=function(){n.colorID(n.colorID()-1),n.colorID()<0&&n.colorID(8)},this.doCycleColorUp=function(){n.colorID(n.colorID()+1),n.colorID()>8&&n.colorID(0)},this.remove=async function(){return new Promise((e,t)=>{i(n.element).transition({opacity:0,scale:.8,y:"-=80px",rotate:"-45deg"},250,"easeInQuad",e)})},this.drag=function(){const e={x:0,y:0};let t=!1,o=!1;i(document.body).on("mousemove touchmove",(function(i){if(t){const t=app.input.isScreenTouched&&i.changedTouches?i.changedTouches[0].pageX:i.pageX,s=app.input.isScreenTouched&&i.changedTouches?i.changedTouches[0].pageY:i.pageY;let{x:a,y:r}=app.workspace.toWorkspaceCoordinates(t,s);a-=e.x,r-=e.y;let l=a-n.x(),c=r-n.y();const d=app.workspace.getSelectedNodes();if(("mousemove"===i.originalEvent.type||d.includes(n)&&"touchmove"===i.originalEvent.type)&&(n.x(a),n.y(r)),o&&(n.selected?d.splice(d.indexOf(n),1):d=app.getNodesConnectedTo(n),d.length>0))for(let e in d)d[e].active()&&(d[e].x(d[e].x()+l),d[e].y(d[e].y()+c));app.workspace.updateArrows()}})),i(n.element).on("pointerdown",(function(i){if(!t&&n.active()&&0===i.button){t=!0,(app.input.isShiftDown||n.selected)&&(o=!0);const{x:s,y:a}=app.workspace.toWorkspaceCoordinates(i.pageX,i.pageY);e.x=app.settings.snapGridEnabled()?app.workspace.stepify(s-n.x(),app.settings.gridSize()):s-n.x(),e.y=app.settings.snapGridEnabled()?app.workspace.stepify(a-n.y(),app.settings.gridSize()):a-n.y()}})),i(n.element).on("touchend",(function(e){app.workspace.selectNodes(n)})),i(document).on("pointerup touchend",(function(){(t||o)&&(t=!1,o=!1,app.setYarnDocumentIsDirty())}))},this.moveTo=function(e,t){app.workspace.startUpdatingArrows(),i(n.element).clearQueue(),i(n.element).transition({x:e,y:t},app.stopUpdatingArrows,500)},this.isConnectedTo=function(e,t){if(t&&e.isConnectedTo(n,!1))return!0;let i=n.linkedTo();for(let t in i){if(i[t]==e)return!0;if(i[t].isConnectedTo(e,!1))return!0;if(e.isConnectedTo(i[t],!1))return!0}return!1},this.getLinksInNode=function(e){const t="yarn"===app.settings.documentType();let i=(e||n).body().match(t?/\[\[(.*?)\]\]/g:/\-\>(.*)/g);if(null!=i){let e={};for(let n=i.length-1;n>=0;n--)t?(i[n]=i[n].substr(2,i[n].length-4).trim(),i[n].indexOf("|")>=0&&(i[n]=i[n].split("|")[1]),null!=e[i[n]]&&i.splice(n,1),e[i[n]]=!0):i[n]=i[n].substr(2,i[n].length).trim();return i}},this.updateLinks=function(){n.resetDoubleClick(),n.updateLinksFromParents(),n.updateLinksToChildren()},this.updateLinksFromParents=function(){n.oldTitle&&n.oldTitle!==n.title()&&(n.linkedFrom.removeAll(),app.nodes().forEach(e=>{const t=n.getLinksInNode(e);if(t)if(t.includes(n.oldTitle)){const t=RegExp("\\|\\s*"+n.oldTitle+"\\s*\\]\\]","g"),i=RegExp("\\[\\[\\s*"+n.oldTitle+"\\s*\\]\\]","g");let o=e.body().replace(t,"|"+n.title()+"]]");o=o.replace(i,"[["+n.title()+"]]"),e.body(o),n.linkedFrom.push(e)}else t.includes(n.title())&&n.linkedFrom.push(e)}),n.oldTitle=void 0)},this.updateLinksToChildren=function(){n.linkedTo.removeAll();let e=n.getLinksInNode();if(e)for(let t in app.nodes()){let i=app.nodes()[t];for(let t=0;t<e.length;t++)i!=n&&i.title().trim()===e[t].trim()&&n.linkedTo.push(i)}}};e.bindingHandlers.nodeBind={init:function(e,t,n,i,o){o.$rawData.element=e,o.$rawData.create()},update:function(e,t,n,o,s){i(e).on("pointerdown",(function(){app.workspace.bringToFront(e)}))}}}).call(this,n("Z1dp"),n("EVdn"))},Z1zX:function(e,t,n){},bHyH:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return l}));var o=n("5aMW"),s=n("tn40");const a=[o.a,s.a];async function r(e,t,{forceUpdate:n}={forceUpdate:!1}){const{AsyncFunction:i,cache:o}=globalThis.__import__||{AsyncFunction:Object.getPrototypeOf((async function(){})).constructor,cache:new Map},s=new i("module","importModuleWeb",e),a={exports:{},filename:t};return await s(a,r),a.exports}var l=function(t){const n=this,o=e=>{t.plugins[e.name]=e},s=e=>(n.pluginStorage||(n.pluginStorage={}),n.pluginStorage[e]||(n.pluginStorage={...n.pluginStorage,[e]:{}}),this.pluginStorage[e]);window.addEventListener("yarnLoadedData",e=>{if(null!==t.data.documentHeader()){const e=t.data.documentHeader();"pluginStorage"in e&&(n.pluginStorage=e.pluginStorage)}}),window.addEventListener("newYarnFileStarted",e=>{n.pluginStorage={}});const l=t.data.db,c=()=>l.getDbValue("volatilePlugins"),d=(e,t)=>{c().then(n=>{n=n||{},l.save("volatilePlugins",{...n,[e]:{...n[e],...t}})})},p=()=>new Promise((e,n)=>{t.settings.gistPluginsFile()||n(),t.data.storage.getGist(t.settings.gistPluginsFile()).then(({filesInGist:n})=>{const i=Object.values(n).filter(e=>"JavaScript"===e.language).map(e=>t.data.storage.getContentOrRaw(e.content,e.raw_url).then(t=>({...e,content:t})));e(Promise.all(i))})}),u={app:t,createButton:(e,{name:t,iconName:n,onClick:i,attachTo:o,className:s,title:a,onPointerDown:r,onDoubleClick:l,id:c})=>{if(null!==document.getElementById(c))return;const d=document.createElement("span");return d.id=c||t||a||n,d.innerHTML=`\n      <span class="item ${s||""}" title="${a||""}" ${i?`onclick="click: app.plugins.${e}.${i}"`:""}\n       ${r?` onpointerdown="app.plugins.${e}.${r}"`:""}\n              ${l?`ondblclick="app.plugins.${e}.${l}"`:""}\n       >\n        <svg class="icon menu-icon icon-file-${n} icon-lg icon-fw" style="color:currentColor;"><use xlink:href="public/icons.svg#icon-${n}"></use></svg>\n        <span class="hide-when-narrow">&nbsp;</span>\n        ${t||""}\n      </span>\n    `,document.getElementById(o).appendChild(d),d},createToggle:(e,{id:t,attachTo:n,className:i,title:o,tooltipId:s,toggleValueKey:a,onToggle:r,enableKey:l,iconName:c})=>{if(null!==document.getElementById(t))return;const d=document.createElement("span");return d.id=t,d.className="styled-checkbox",d.innerHTML=`\n            <input class="styled-checkbox" type="checkbox" id="${a}" data-bind="checked: app.plugins.${e}.${l}, event: { change: app.plugins.${e}.${r} }"></input>\n            <label for="${a}" title="${o}" class="${i}"><span title="${o}" class="button-bubble" id="${s}"></span>\n              <svg class="icon icon-${c} icon-fw icon-lg"><use xlink:href="public/icons.svg#icon-${c}"></use></svg>\n            </label>\n    `,document.getElementById(n).appendChild(d),d},getPluginStore:s,setPluginStore:(e,t,i)=>{const o={...s(e),[t]:i};n.pluginStorage={...n.pluginStorage,[e]:o}},addSettingsItem:({title:n,valueKey:i,defaultValue:o,optionsKey:s,options:a,setterKey:r,settingsColumn:l})=>{t.settings[i]=e.observable(t.settings.storage.getItem(i)||o).extend({persist:i}),t.ui[s]=a,t[r]=function(e,n){const o=n?n.target.value:e;t.settings[i](o)},window.addEventListener("settingsOpened",()=>{const e=t.ui[s].map(e=>`<option value="${e.id}" ${e.id===t.settings[i]()?'selected="true"':""}>${e.name}</option>`).join(""),o=`\n              <label class="settings-label" for="theme">${n}</label>\n              <div class="settings-value markup">\n                <select id="mySelect">\n                   ${e}\n                </select>\n              </div>\n    `,a=document.createElement("div");a.className="settings-item",a.innerHTML=o,document.getElementById("settingsColumn"+(l||"A")).appendChild(a),document.getElementById("mySelect").addEventListener("change",e=>{t[r](!1,e)})})},onYarnLoadedData:e=>{window.addEventListener("yarnLoadedData",t=>{e(t)})},onYarnEditorOpen:e=>{window.addEventListener("yarnEditorOpen",t=>{e(t)})},onYarnInPreviewMode:e=>{window.addEventListener("yarnSavedNode",t=>{e(t)})},onYarnSavedNode:e=>{window.addEventListener("yarnInPreviewMode",t=>{e(t)})},onYarnSetLanguage:e=>{window.addEventListener("yarnSetLanguage",t=>{e(t)})},onYarnLoadedStateFromLocalStorage:e=>{window.addEventListener("yarnLoadedStateFromLocalStorage",t=>{e(t)})},onYarnSavedStateToLocalStorage:e=>{window.addEventListener("yarnSavedStateToLocalStorage",t=>{e(t)})},onYarnSetDocumentType:e=>{window.addEventListener("yarnSetDocumentType",t=>{e(t)})},onKeyUp:e=>{i(document).on("keyup",t=>{e(t)})},onKeyDown:e=>{i(document).on("keydown",t=>{e(t)})},onLoad:e=>{window.addEventListener("DOMContentLoaded",t=>{e(t)})},getVloatilePlugins:c,setVloatilePlugin:d,setVloatilePlugins:e=>l.save("volatilePlugins",e),getGistPluginFiles:p};a.forEach(e=>{const t=new e(u);window.addEventListener("DOMContentLoaded",e=>{o(t)})}),l.getDbValue("volatilePlugins").then(e=>{const n={},i={},s={},c=()=>{p().then(t=>t.forEach(t=>{console.log({gistFile:t}),t.filename in e||(((e,t)=>{r(e,t).then(e=>{const n=e(u);console.log({importedPlugin:e,newPlugin:n}),n.name=n.name||t,"dependencies"in n&&n.dependencies.forEach(e=>{const t=document.createElement("script");t.setAttribute("src",e),document.body.appendChild(t),t.addEventListener("load",()=>{console.log("File loaded",e)}),t.addEventListener("error",e=>{console.log("Error on loading file",e)})}),o(n)})})(content,t.filename),s[t.filename]=t,d(t.filename,s[t.filename]))}))};null!==t.settings.gistPluginsFile()&&c(),a.forEach(t=>{const o={filename:t.name+".js",content:"\n        module.exports = "+t.toString(),type:"builtin",language:"JavaScript"};console.log({builtInPlugin:o}),i[t.name]=o,e&&t.name in e||(n[t.name]=o)}),l.save("builtinVolatilePlugins",n),Object.values(e).forEach(e=>{"builtin"!==e.type&&r(e.content,e.name).then(e=>{const t=new e(u);console.log({importedPlugin:e,initializedPlugin:t}),window.addEventListener("DOMContentLoaded",e=>{o(t)})})})})}}).call(this,n("Z1dp"),n("EVdn"))},e6Wu:function(e,t,n){"use strict";n.r(t);n("3ozf"),n("P85/"),n("uMdg"),n("gugv");var i=n("oj90"),o=n("0h2I"),s=n.n(o),a=(n("5uVa"),n("si6p"),n("ghrA"),n("bU/s")),r=n.n(a),l=(n("A8C4"),n("VEX6"),n("jF1P"),n("YhK8"),n("Ab/9"),n("KDOe"),n("PSD3")),c=n.n(l),d=n("P0sH"),p=n("pLxK"),u=n("bHyH");window.ko=s.a,window.$=window.jQuery=n("EVdn"),window.ace=r.a,r.a.config.set("basePath",i.Utils.getPublicPath()),window.define=r.a.define,window.Swal=c.a,"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})}),window.app=new d.a("Yarn",p.a),window.app.run();const h=new u.a(window.app);window.app.plugins=h},fkuv:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return s}));var o=n("2Qx2");const s=function(t){const n=this;this.notification=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2500}),this.dispatchEvent=function(e,t){const n=new CustomEvent(e);n.options=t,window.dispatchEvent(n),window.parent.dispatchEvent(n)},this.settingsDialogVisible=e.observable(!1),this.narrowScreenThreshold=600,this.isScreenNarrow=function(){return i(window).width()<=n.narrowScreenThreshold},this.availableMarkupLanguages=[{id:"bbcode",name:"Bbcode"},{id:"html",name:"Html"}],this.availableFiletypeVersions=[{id:"1",name:"1"},{id:"2",name:"2"}],this.availableThemes=[{id:"classic",name:"Classic"},{id:"blueprint",name:"Blueprint"},{id:"dracula",name:"Dracula"}],this.availableDocumentTypes=[{id:"yarn",name:"Yarn"},{id:"ink",name:"Ink"}],this.availableLanguages=[{name:"ÄŒeÅ¡tina",id:"cs-CZ"},{name:"Deutsch",id:"de-DE"},{name:"English",id:"en-GB"},{name:"EspaÃ±ol",id:"es-ES"},{name:"FranÃ§ais",id:"fr-FR"},{name:"Ãslenska",id:"is-IS"},{name:"Nederlands",id:"nl-NL"},{name:"Norsk bokmÃ¥l",id:"nb-NO"},{name:"Polski",id:"pl-PL"},{name:"RomÃ¢nÄƒ",id:"ro-RO"},{name:"SlovenÄina",id:"sk-SK"},{name:"Svenska",id:"sv-SE"},{name:"TÃ¼rkÃ§e",id:"tr-TR"},{name:"Ð±ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸",id:"bg-BG"},{name:"PÑƒÑÑÐºÐ¸Ð¹",id:"ru-RU"},{name:"Ð¡Ñ€Ð¿ÑÐºÐ¸",id:"sr-RS"},{name:"í•œêµ­ì–´",id:"ko-KR"}],this.availableLineStyles=[{id:"straight",name:"Straight Lines"},{id:"bezier",name:"Bezier Curves"}],this.openSettingsDialog=function(){n.settingsDialogVisible(!0),i(".settings-dialog").css({opacity:0}).transition({opacity:1},250),i(".settings-dialog .form").css({y:"-100"}).transition({y:"0"},250);var e=new CustomEvent("settingsOpened");window.dispatchEvent(e)},this.openHelpDialog=function(){Swal.fire({title:"Help",html:'\n      <div style="text-align: justify">\n        <p>Useful editor shortcuts:</p>\n        <small>\n          <ul>\n            <li>Cmd/Ctrl + Left Click -- Create multiple input carets</li>\n            <li>Cmd/Ctrl + Left/Right -- Caret jump word</li>\n            <li>Cmd/Ctrl + Up/Down -- Scroll up/down</li>\n            <li>Cmd/Ctrl + Left/Right + Shift -- Caret jump word selection</li>\n            <li>Cmd/Ctrl + F -- Search</li>\n            <li>Cmd/Ctrl + Alt + K -- Find All</li>\n            <li>Cmd/Ctrl + H -- Search and Replace</li>\n            <li>Cmd/Ctrl + A -- Select all</li>\n            <li>Cmd/Ctrl + U -- To Uppercase</li>\n            <li>Cmd/Ctrl + Shift + U -- To Lowercase</li>\n            <li>Alt + Up/Down -- Move line(s) up/down</li>\n            <li><a href="https://ace.c9.io/demo/keyboard_shortcuts.html" target="_blank">...</a></li>   \n          </ul>\n        </small>\n        <div>How to use <a href="https://yarnspinner.dev/docs/syntax/" target="_blank">Yarn Syntax</a></div>\n        <div>How to use <a href="https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md" target="_blank">Ink Syntax</a></div>\n        <p>Runtimes:</p>\n        <a href="https://github.com/YarnSpinnerTool/YarnSpinner" target="_blank">YarnSpinner (Unity3d)</a>\n        <a href="https://github.com/hylyh/bondage.js" target="_blank">BondageJs (yarn javascript)</a>\n        <a href="https://github.com/inkle/ink-unity-integration" target="_blank">Ink C# (Unity3d)</a>\n        <a href="https://github.com/y-lohse/inkjs" target="_blank">InkJs (javascript)</a>\n        <a href="https://github.com/bladecoder/blade-ink" target="_blank">BladeInk (java)</a>\n        <a href="https://github.com/inkle/ink-library" target="_blank">Many more Ink parsers</a>\n      </div>\n      ',showCancelButton:!0,confirmButtonText:"About",cancelButtonText:"Close"}).then(e=>{e.value&&Swal.fire({title:"About",html:'\n          <div style="text-align: justify">\n            <div><a href="https://github.com/YarnSpinnerTool" target="_blank">Yarn</a> was created by <a href="https://github.com/AlecHolowka" target="_blank">Alec Holowka</a></div>\n            <br>\n            <a href="https://github.com/blurymind/YarnClassic/graphs/contributors" target="_blank">Top contributors:</a>\n            <small>\n              <ul>\n                <li><a href="https://github.com/blurymind" target="_blank">Todor Imreorov</a></li>\n                <li><a href="https://github.com/daviddq" target="_blank">David Diaz</a></li>\n                <li><a href="https://github.com/FaultyFunctions" target="_blank">@FaultyFunctions</a></li>\n              </ul>\n            </small>\n            <a href="https://github.com/blurymind/YarnClassic/issues/new" target="_blank">Report a Bug</a>\n          </div>\n          ',showCancelButton:!1,confirmButtonText:"OK"})})},this.closeSettingsDialog=function(){i(".settings-dialog").css({opacity:1}).transition({opacity:0},250,e=>{n.settingsDialogVisible(!1)}),i(".settings-dialog .form").css({y:"0"}).transition({y:"-100"},250),setTimeout(()=>t.settings.apply(),100)},this.isDialogOpen=function(){return n.settingsDialogVisible()||Swal.isVisible()&&!Swal.isTimerRunning()},this.confirmMarkupConversion=function(){Swal.fire({title:"Are you sure?",text:"Markup on all nodes will be modified. This can rarely result in broken texts. This operation can't be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, convert it!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(e=>{e.value&&(t.convertMarkup(),Swal.fire("Converted!","The markup on the nodes has been converted.","success"))})},this.nodeSearchMatches=function(e,t,n=!1){var o=n||i(".search-title input").is(":checked"),s=n||i(".search-body input").is(":checked"),a=n||i(".search-tags input").is(":checked");return 0!==t.length&&(o||s||a)?{matchTitle:o&&e.title().toLowerCase().indexOf(t)>=0,matchBody:s&&e.body().toLowerCase().indexOf(t)>=0,matchTags:a&&e.tags().toLowerCase().indexOf(t)>=0,clearSearch:!1}:{matchTitle:!1,matchBody:!1,matchTags:!1,clearSearch:!0}},this.findMatchingNodes=function(e){const n={matchTitle:[],matchBody:[],matchTags:[],foundNodes:!1};return[...t.nodes()].reverse().forEach(i=>{const{matchTitle:o,matchBody:s,matchTags:a}=t.ui.nodeSearchMatches(i,e,!0);o&&n.matchTitle.push(i),s&&n.matchBody.push(i),a&&n.matchTags.push(i)}),n.foundNodes=n.matchTitle.length>0||n.matchBody.length>0||n.matchTags.length>0,n},this.createSearchMenuLine=function(e,n,s,a="title"){const r=document.createElement("div");if(r.innerHTML=`${e.title()} ${a?`(${a})`:""}`,i(r).addClass("item "+e.titleStyles[e.colorID()]),"link"==n){if(e.title()!==t.editing().title()){if("ink"===t.settings.documentType()&&e.title().trim()===o.a.InkGlobalScopeNodeName)return;r.setAttribute("onclick","ink"===t.settings.documentType()?"app.insertTextAtCursor('-> "+e.title()+"')":"app.insertTextAtCursor('[["+e.title()+"]]')"),s.appendChild(r)}}else"open"==n&&(r.setAttribute("onclick",`app.openNodeByTitle("${e.title()}")`),r.setAttribute("onmouseenter",`app.workspace.warpToNodeByIdx(${t.nodes.indexOf(e)})`),s.appendChild(r))},this.openNodeListMenu=function(e){const n="link"===e?document.getElementById("linkHelperMenuFilter").value.toLowerCase():document.getElementById("nodeSearchInput").value.toLowerCase(),i=document.getElementById(e+"HelperMenu");i.innerHTML="";const o=()=>{[...t.nodes()].reverse().forEach(t=>{this.createSearchMenuLine(t,e,i,"")})};if(!n)return void o();const s=this.findMatchingNodes(n);s.foundNodes?(s.matchTitle.forEach(t=>{this.createSearchMenuLine(t,e,i,"title")}),s.matchTags.forEach(t=>{this.createSearchMenuLine(t,e,i,"tags")}),s.matchBody.forEach(t=>{this.createSearchMenuLine(t,e,i,"body")})):o()},this.checkAndMoveAppButtons=function(){i(".app-add-node").toggleClass("app-add-node-alt","right"===t.settings.editorSplitDirection()),i(".app-sort").toggleClass("app-sort-alt","right"===t.settings.editorSplitDirection()),i(".app-undo-redo").toggleClass("app-undo-redo-alt","right"===t.settings.editorSplitDirection()),i(".app-zoom").toggleClass("app-zoom-alt","right"===t.settings.editorSplitDirection())},this.resetAppButtonsLocation=function(){i(".app-add-node").removeClass("app-add-node-alt"),i(".app-sort").removeClass("app-sort-alt"),i(".app-undo-redo").removeClass("app-undo-redo-alt"),i(".app-zoom").removeClass("app-zoom-alt")},this.toastMixin=Swal.mixin({toast:!0,icon:"success",title:"Done!",animation:!1,position:"bottom",showConfirmButton:!1,timer:2500,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}}),this.insertTextAtCursorWithParams=function(e="",n=[]){const o=n.map((e,t)=>"boolean"==typeof e.default?`<div class="flex-wrap"><span>${e.name} :</span><input type="checkbox" id="swal-input${t}" class="swal2-input"> </div>`:"number"==typeof e.default?`<div class="flex-wrap"><span>${e.name} :</span><input type="number" step=0.01 id="swal-input${t}" class="swal2-input"> </div>`:`<div class="flex-wrap"><span>${e.name} :</span> <input id="swal-input${t}" class="swal2-input" style="flex:1"></div>`).join("\n");Swal.fire({title:"Snippet properties",html:o,preConfirm:function(){return new Promise((function(e){e(n.map((e,t)=>"boolean"==typeof e.default?i("#swal-input"+t).is(":checked"):i("#swal-input"+t).val()))}))},onOpen:function(){i("#swal-input0").focus(),n.forEach((e,n)=>{void 0!==e.default&&("boolean"==typeof e.default?i("#swal-input"+n)[0].checked=e.default:i("#swal-input"+n)[0].value=e.default,t.log(i("#swal-input"+n)))})}}).then((function(n){if(!n.value)return;let i=e;n.value.forEach((e,t)=>{void 0!==e&&(i=i.replace("%"+t,e))}),t.insertTextAtCursor(i)}))}}}).call(this,n("Z1dp"),n("EVdn"))},gugv:function(e,t,n){},jF1P:function(e,t,n){(function(e){var t,n;t={},n=0,e.bindingHandlers.ace={init:function(i,o,s,a,r){var l=s().aceOptions||{},c=e.utils.unwrapObservable(o());i.id||(i.id="knockout-ace-"+n,n+=1);var d=ace.edit(i.id);l.theme&&d.setTheme("ace/theme/"+l.theme),l.mode&&d.getSession().setMode("ace/mode/"+l.mode),d.setValue(c),d.gotoLine(0),d.setShowPrintMargin(!1),d.getSession().setUseWrapMode(!0),d.getSession().on("change",(function(t){e.isWriteableObservable(o())&&o()(d.getValue())})),t[i.id]=d,e.utils.domNodeDisposal.addDisposeCallback(i,(function(){try{d.destroy()}catch(e){}delete t[i.id]}))},update:function(n,i,o,s,a){var r=e.utils.unwrapObservable(i()),l=n.id;if(void 0!==l&&""!==l&&t.hasOwnProperty(l)){var c=t[l];c.getValue()!==r&&(c.setValue(r),c.gotoLine(0))}}},e.aceEditors={resizeAll:function(){for(var e in t)t.hasOwnProperty(e)&&t[e].resize()},get:function(e){return t[e]}}}).call(this,n("Z1dp"))},"l8+o":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("mIo7"),o=n("mqgS");const s=function(e){const t=t=>{const n=/((https:\/\/)?(www.)?instagram.com\/p\/[^\s\<]+)/gi,i=/(?:http(?:s?):\/\/|)(?:www\.)?youtu(?:be\.com\/watch\?v=|\.be\/)([\w\-\_]*)(&(amp;)?â€Œâ€‹[\w\?â€Œâ€‹=]*)?(?:\?t=[0-9]+)?/gi,o=new RegExp(`^(?!${/(https?:\/\/twitter.com\/[^\s\<]+\/[^\s\<]+\/[^\s\<]+)/gi.source}|${i.source}|${n.source})https?:.*$`,"gm");return t=(t=(t=t.replace(o,(function(e){return`\n      <a class="link" href="${e}">${e}</a>\n    `}))).replace(i,(function(e){const t=e.match(/(?:https\:.*|)(?:www.|)youtu(?:.*\/v\/|.*v\=|\.be\/)([A-Za-z0-9_\-]{11}(?:\?t=[0-9]+)?)/i);if(t.length>1)return`\n        <iframe height="315" src="https://www.youtube.com/embed/${t[1]}" title="YouTube video player"\n              frameBorder="0"\n              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\n              allowFullScreen></iframe> \n      `}))).replace(n,(function(t){const n=t.match(/((?:https?:\/\/)?(?:www.)?instagram.com\/p\/([^\s\<]+)\/)/i);if(n.length>2)return e.log("EXTRACTED",n),`\n            <iframe height="540" src="http://instagram.com/p/${n[2]}/embed" frameborder="0"></iframe>\n      `}))};return"html"===e.settings.markupLanguage()?new o.a(e,t):new i.a(e,t)}},mIo7:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return BbcodeRichTextFormatter}));const bbcode=__webpack_require__("L8pc"),BbcodeRichTextFormatter=function(app,addExtraPreviewerEmbeds){const self=this;this.justInsertedAutoComplete=!1,this.completableTags=Object.freeze([{Start:"<<",Completion:">>",Offset:-2},{Start:"[colo",Completion:"r=#][/color]",Offset:-9,BehaviorCompletion:"r=#][/color",Func:()=>{app.insertColorCode()}},{Start:"[b",Completion:"][/b]",BehaviorCompletion:"][/b",Offset:-4},{Start:"[i",Completion:"][/i]",BehaviorCompletion:"][/i",Offset:-4},{Start:"[img",Completion:"][/img]",BehaviorCompletion:"][/img",Offset:-6},{Start:"[u",Completion:"][/u]",BehaviorCompletion:"][/u",Offset:-4},{Start:"[url",Completion:"][/url]",BehaviorCompletion:"][/url",Offset:-6}]),this.getTagOpen=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"~ ":"{ ":"<<";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"-> ":"* [":"[[";case"color":return"[color=#]";default:return`[${e}]`}},this.getTagClose=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":" }":">>";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":"]":"|]]";default:return`[/${e}]`}},this.identifyTag=function(e){return-1!==e.lastIndexOf("[")?e.substring(e.lastIndexOf("["),e.length):""},this.insertTag=function(e){const t=self.getTagOpen(e),n=self.getTagClose(e),i=JSON.parse(JSON.stringify(app.editor.selection.getRange()));app.editor.session.insert(i.start,t),app.editor.session.insert({column:i.end.column+t.length,row:i.end.row},n),"color"===e&&(0===app.editor.getSelectedText().length?app.moveEditCursor(-9):app.editor.selection.setRange({start:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1},end:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1}}),app.insertColorCode()),"img"===e?0===app.editor.getSelectedText().length&&(app.moveEditCursor(-6),app.data.triggerPasteClipboard(),setTimeout(()=>app.moveEditCursor(6),300)):0===app.editor.getSelectedText().length?app.isEditorInPreviewMode||app.moveEditCursor(-n.length):app.editor.selection.setRange({start:app.editor.selection.getRange().start,end:{row:app.editor.selection.getRange().end.row,column:app.editor.selection.getRange().end.column-n.length}}),app.editor.focus()},this._convertTag=function(inPattern,outPattern,text){const globalRegex=new RegExp(inPattern,"gi"),localRegex=new RegExp(inPattern,"i");return text.replace(globalRegex,m=>{const match=m.match(localRegex),template=eval("`"+outPattern+"`");return match.length?template:null})},this.convert=function(e){let t=e;return t=self._convertTag("<b>(.*?)<\\/b>","[b]${match[1]}[/b]",t),t=self._convertTag("<u>(.*?)<\\/u>","[u]${match[1]}[/u]",t),t=self._convertTag("<i>(.*?)<\\/i>","[i]${match[1]}[/i]",t),t=self._convertTag("<img>(.*?)<\\/img>","[img]${match[1]}[/img]",t),t=self._convertTag("<color=#(.*?)>(.*?)<\\/color>","[color=#${match[1]}]${match[2]}[/color]",t),t=self._convertTag("<url>(.*?)<\\/url>","[url]${match[1]}[/url]",t),t},this.richTextToHtml=function(e,t=!1){let n=1,i=t?'<div><font color="pink">'+n+". </font><font>"+e+"</font></div>":e;return i=i.replace(/<</gi,"<font color='violet'>(run:"),i=i.replace(/>>/gi,")</font>"),i=i.replace(/\[color=#[A-Za-z0-9]+\]/gi,(function(e){const t=e.match(/\[color=#([A-Za-z0-9]+)\]/i);if(t&&t.length>1)return"[color=#"+t[1]+"]<font color=#"+t[1]+">&#9751</font>"})),i=i.replace(/\[img\][^\[]+\[\/img\]/gi,(function(e){const n=e.match(/\[img\](.*)\[\/img\]/i);if(n.length>1){const e=app.data.editingFileFolder(n[1]);return app.data.doesFileExist(e)?t?'<img src="'+e+'"> </img>':'<img src="'+e+'" width="128" height="auto"> </img>':t?'<img src="'+n[1]+'"> </img>':'<img src="'+n[1]+'" width="128" height="auto"> </img>'}})),t&&(i=addExtraPreviewerEmbeds(i)),i=i.replace(/[\n\r]/g,(function(e){let i="</font><br/>";return n+=1,t&&(i+='</div><div><font color="pink">'+n+". </font><font>"),i})),i=bbcode.parse(i),i}}},mqgS:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return HtmlRichTextFormatter}));const HtmlRichTextFormatter=function(app,addExtraPreviewerEmbeds){const self=this;this.justInsertedAutoComplete=!1,this.completableTags=Object.freeze([{Start:"<<",Completion:">>",Offset:-2},{Start:"<colo",Completion:"r=#></color>",Offset:-9,Func:()=>{app.insertColorCode()}},{Start:"<b",Completion:"></b>",Offset:-4},{Start:"<img",Completion:"></img>",Offset:-6},{Start:"<i",Completion:"></i>",Offset:-4},{Start:"<u",Completion:"></u>",Offset:-4},{Start:"<url",Completion:"></url>",Offset:-6}]),this.getTagOpen=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"~ ":"{ ":"<<";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"-> ":"* [":"[[";case"color":return"<color=#>";default:return`<${e}>`}},this.getTagClose=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":" }":">>";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":"]":"|]]";default:return`</${e}>`}},this.identifyTag=function(e){return-1!==e.lastIndexOf("<")?e.substring(e.lastIndexOf("<"),e.length):""},this.insertTag=function(e){const t=self.getTagOpen(e),n=self.getTagClose(e),i=JSON.parse(JSON.stringify(app.editor.selection.getRange()));app.editor.session.insert(i.start,t),app.editor.session.insert({column:i.end.column+t.length,row:i.end.row},n),"color"===e&&(0===app.editor.getSelectedText().length?app.moveEditCursor(-9):app.editor.selection.setRange({start:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1},end:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1}}),app.insertColorCode()),"img"===e?navigator.clipboard.readText().then(e=>{0===app.editor.getSelectedText().length&&(app.moveEditCursor(-7),app.insertTextAtCursor(` src="${e}"`))}):0===app.editor.getSelectedText().length?app.isEditorInPreviewMode||app.moveEditCursor(-n.length):app.editor.selection.setRange({start:app.editor.selection.getRange().start,end:{row:app.editor.selection.getRange().end.row,column:app.editor.selection.getRange().end.column-n.length}}),app.editor.focus()},this._convertTag=function(inPattern,outPattern,text){const globalRegex=new RegExp(inPattern,"gi"),localRegex=new RegExp(inPattern,"i");return text.replace(globalRegex,m=>{const match=m.match(localRegex),template=eval("`"+outPattern+"`");return match.length?template:null})},this.convert=function(e){let t=e;return t=self._convertTag("\\[b\\](.*?)\\[\\/b\\]","<b>${match[1]}</b>",t),t=self._convertTag("\\[u\\](.*?)\\[\\/u\\]","<u>${match[1]}</u>",t),t=self._convertTag("\\[i\\](.*?)\\[\\/i\\]","<i>${match[1]}</i>",t),t=self._convertTag("\\[img\\](.*?)\\[\\/img\\]","<img>${match[1]}</img>",t),t=self._convertTag("\\[color=#(.*?)\\](.*?)\\[\\/color\\]","<color=#${match[1]}>${match[2]}</color>",t),t=self._convertTag("\\[url\\](.*?)\\[\\/url\\]","<url>${match[1]}</url>",t),t},this.richTextToHtml=function(e,t=!1){let n=1,i=t?'<div><font color="pink">'+n+". </font><font>"+e+"</font></div>":e;return i=i.replace(/<</gi,"<font color='violet'>(run:"),i=i.replace(/>>/gi,")</font>"),[/&lt;color=#(.*?)&gt;(.*?)&lt;\/color&gt;/,/<color=#(.*?)>(.*?)<\/color>/].forEach(e=>{const t=new RegExp(e,"gi"),n=new RegExp(e,"i");i=i.replace(t,(function(e){const t=e.match(n);if(t&&t.length>2)return`<font color=#${t[1]}>&#9751${t[2]}</font>`}))}),i=i.replace(/&lt;img&gt;[^\[]+&lt;\/img&gt;/gi,(function(e){const n=e.match(/&lt;img&gt;(.*?)&lt;\/img&gt;/i);if(n.length>1){const e=app.data.editingFileFolder(n[1]);return app.data.doesFileExist(e)?t?'<img src="'+e+'"> </img>':'<img src="'+e+'" width="128" height="auto"> </img>':t?'<img src="'+n[1]+'"> </img>':'<img src="'+n[1]+'" width="128" height="auto"> </img>'}})),i=i.replace(/&lt;b&gt;.*&lt;\/b&gt;/gi,e=>{const t=e.match(/&lt;b&gt;(.*)&lt;\/b&gt;/i);if(t.length)return`<b>${t[1]}</b>`}),i=i.replace(/&lt;u&gt;.*&lt;\/u&gt;/gi,e=>{const t=e.match(/&lt;u&gt;(.*)&lt;\/u&gt;/i);if(t.length)return`<u>${t[1]}</u>`}),i=i.replace(/&lt;i&gt;.*&lt;\/i&gt;/gi,e=>{const t=e.match(/&lt;i&gt;(.*)&lt;\/i&gt;/i);if(t.length)return`<i>${t[1]}</i>`}),t&&(i=addExtraPreviewerEmbeds(i)),i=i.replace(/[\n\r]/g,(function(e){let i="</font><br/>";return n+=1,t&&(i+='</div><div><font color="pink">'+n+". </font><font>"),i})),i}}},"o+ka":function(e,t,n){parcelRequire=function(t,i,o,s){var a,r="function"==typeof parcelRequire&&parcelRequire;function l(e,o){if(!i[e]){if(!t[e]){var s="function"==typeof parcelRequire&&parcelRequire;if(!o&&s)return s(e,!0);if(r)return r(e,!0);if("string"==typeof e)return n("LaP9")(e);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}d.resolve=function(n){return t[e][1][n]||n},d.cache={};var c=i[e]=new l.Module(e);t[e][0].call(c.exports,d,c,c.exports,this)}return i[e].exports;function d(e){return l(d.resolve(e))}}l.isParcelRequire=!0,l.Module=function(e){this.id=e,this.bundle=l,this.exports={}},l.modules=t,l.cache=i,l.parent=r,l.register=function(e,n){t[e]=[function(e,t){t.exports=n},{}]};for(var c=0;c<o.length;c++)try{l(o[c])}catch(t){a||(a=t)}if(o.length){var d=l(o[o.length-1]);e.exports=d}if(parcelRequire=l,a)throw a;return l}({k8CM:[function(e,t,n){var i=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},o=-1;i.Diff=function(e,t){return[e,t]},i.prototype.diff_main=function(e,t,n,o){void 0===o&&(o=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var s=o;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[new i.Diff(0,e)]:[];void 0===n&&(n=!0);var a=n,r=this.diff_commonPrefix(e,t),l=e.substring(0,r);e=e.substring(r),t=t.substring(r),r=this.diff_commonSuffix(e,t);var c=e.substring(e.length-r);e=e.substring(0,e.length-r),t=t.substring(0,t.length-r);var d=this.diff_compute_(e,t,a,s);return l&&d.unshift(new i.Diff(0,l)),c&&d.push(new i.Diff(0,c)),this.diff_cleanupMerge(d),d},i.prototype.diff_compute_=function(e,t,n,s){var a;if(!e)return[new i.Diff(1,t)];if(!t)return[new i.Diff(o,e)];var r=e.length>t.length?e:t,l=e.length>t.length?t:e,c=r.indexOf(l);if(-1!=c)return a=[new i.Diff(1,r.substring(0,c)),new i.Diff(0,l),new i.Diff(1,r.substring(c+l.length))],e.length>t.length&&(a[0][0]=a[2][0]=o),a;if(1==l.length)return[new i.Diff(o,e),new i.Diff(1,t)];var d=this.diff_halfMatch_(e,t);if(d){var p=d[0],u=d[1],h=d[2],g=d[3],f=d[4],m=this.diff_main(p,h,n,s),y=this.diff_main(u,g,n,s);return m.concat([new i.Diff(0,f)],y)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,s):this.diff_bisect_(e,t,s)},i.prototype.diff_lineMode_=function(e,t,n){var s=this.diff_linesToChars_(e,t);e=s.chars1,t=s.chars2;var a=s.lineArray,r=this.diff_main(e,t,!1,n);this.diff_charsToLines_(r,a),this.diff_cleanupSemantic(r),r.push(new i.Diff(0,""));for(var l=0,c=0,d=0,p="",u="";l<r.length;){switch(r[l][0]){case 1:d++,u+=r[l][1];break;case o:c++,p+=r[l][1];break;case 0:if(c>=1&&d>=1){r.splice(l-c-d,c+d),l=l-c-d;for(var h=this.diff_main(p,u,!1,n),g=h.length-1;g>=0;g--)r.splice(l,0,h[g]);l+=h.length}d=0,c=0,p="",u=""}l++}return r.pop(),r},i.prototype.diff_bisect_=function(e,t,n){for(var s=e.length,a=t.length,r=Math.ceil((s+a)/2),l=r,c=2*r,d=new Array(c),p=new Array(c),u=0;u<c;u++)d[u]=-1,p[u]=-1;d[l+1]=0,p[l+1]=0;for(var h=s-a,g=h%2!=0,f=0,m=0,y=0,b=0,v=0;v<r&&!((new Date).getTime()>n);v++){for(var w=-v+f;w<=v-m;w+=2){for(var S=l+w,x=(N=w==-v||w!=v&&d[S-1]<d[S+1]?d[S+1]:d[S-1]+1)-w;N<s&&x<a&&e.charAt(N)==t.charAt(x);)N++,x++;if(d[S]=N,N>s)m+=2;else if(x>a)f+=2;else if(g&&(k=l+h-w)>=0&&k<c&&-1!=p[k]&&N>=(C=s-p[k]))return this.diff_bisectSplit_(e,t,N,x,n)}for(var T=-v+y;T<=v-b;T+=2){for(var C,k=l+T,E=(C=T==-v||T!=v&&p[k-1]<p[k+1]?p[k+1]:p[k-1]+1)-T;C<s&&E<a&&e.charAt(s-C-1)==t.charAt(a-E-1);)C++,E++;if(p[k]=C,C>s)b+=2;else if(E>a)y+=2;else if(!g){var N;if((S=l+h-T)>=0&&S<c&&-1!=d[S])if(x=l+(N=d[S])-S,N>=(C=s-C))return this.diff_bisectSplit_(e,t,N,x,n)}}}return[new i.Diff(o,e),new i.Diff(1,t)]},i.prototype.diff_bisectSplit_=function(e,t,n,i,o){var s=e.substring(0,n),a=t.substring(0,i),r=e.substring(n),l=t.substring(i),c=this.diff_main(s,a,!1,o),d=this.diff_main(r,l,!1,o);return c.concat(d)},i.prototype.diff_linesToChars_=function(e,t){var n=[],i={};function o(e){for(var t="",o=0,a=-1,r=n.length;a<e.length-1;){-1==(a=e.indexOf("\n",o))&&(a=e.length-1);var l=e.substring(o,a+1);(i.hasOwnProperty?i.hasOwnProperty(l):void 0!==i[l])?t+=String.fromCharCode(i[l]):(r==s&&(l=e.substring(o),a=e.length),t+=String.fromCharCode(r),i[l]=r,n[r++]=l),o=a+1}return t}n[0]="";var s=4e4,a=o(e);return s=65535,{chars1:a,chars2:o(t),lineArray:n}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],o=[],s=0;s<i.length;s++)o[s]=t[i.charCodeAt(s)];e[n][1]=o.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,s=0;n<o;)e.substring(s,o)==t.substring(s,o)?s=n=o:i=o,o=Math.floor((i-n)/2+n);return o},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,s=0;n<o;)e.substring(e.length-o,e.length-s)==t.substring(t.length-o,t.length-s)?s=n=o:i=o,o=Math.floor((i-n)/2+n);return o},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):n<i&&(t=t.substring(0,n));var o=Math.min(n,i);if(e==t)return o;for(var s=0,a=1;;){var r=e.substring(o-a),l=t.indexOf(r);if(-1==l)return s;a+=l,0!=l&&e.substring(o-a)!=t.substring(0,a)||(s=a,a++)}},i.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,i=e.length>t.length?t:e;if(n.length<4||2*i.length<n.length)return null;var o=this;function s(e,t,n){for(var i,s,a,r,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,d="";-1!=(c=t.indexOf(l,c+1));){var p=o.diff_commonPrefix(e.substring(n),t.substring(c)),u=o.diff_commonSuffix(e.substring(0,n),t.substring(0,c));d.length<u+p&&(d=t.substring(c-u,c)+t.substring(c,c+p),i=e.substring(0,n-u),s=e.substring(n+p),a=t.substring(0,c-u),r=t.substring(c+p))}return 2*d.length>=e.length?[i,s,a,r,d]:null}var a,r,l,c,d,p=s(n,i,Math.ceil(n.length/4)),u=s(n,i,Math.ceil(n.length/2));return p||u?(a=u?p&&p[4].length>u[4].length?p:u:p,e.length>t.length?(r=a[0],l=a[1],c=a[2],d=a[3]):(c=a[0],d=a[1],r=a[2],l=a[3]),[r,l,c,d,a[4]]):null},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],s=0,a=null,r=0,l=0,c=0,d=0,p=0;r<e.length;)0==e[r][0]?(n[s++]=r,l=d,c=p,d=0,p=0,a=e[r][1]):(1==e[r][0]?d+=e[r][1].length:p+=e[r][1].length,a&&a.length<=Math.max(l,c)&&a.length<=Math.max(d,p)&&(e.splice(n[s-1],0,new i.Diff(o,a)),e[n[s-1]+1][0]=1,s--,r=--s>0?n[s-1]:-1,l=0,c=0,d=0,p=0,a=null,t=!0)),r++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),r=1;r<e.length;){if(e[r-1][0]==o&&1==e[r][0]){var u=e[r-1][1],h=e[r][1],g=this.diff_commonOverlap_(u,h),f=this.diff_commonOverlap_(h,u);g>=f?(g>=u.length/2||g>=h.length/2)&&(e.splice(r,0,new i.Diff(0,h.substring(0,g))),e[r-1][1]=u.substring(0,u.length-g),e[r+1][1]=h.substring(g),r++):(f>=u.length/2||f>=h.length/2)&&(e.splice(r,0,new i.Diff(0,u.substring(0,f))),e[r-1][0]=1,e[r-1][1]=h.substring(0,h.length-f),e[r+1][0]=o,e[r+1][1]=u.substring(f),r++),r++}r++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),o=t.charAt(0),s=n.match(i.nonAlphaNumericRegex_),a=o.match(i.nonAlphaNumericRegex_),r=s&&n.match(i.whitespaceRegex_),l=a&&o.match(i.whitespaceRegex_),c=r&&n.match(i.linebreakRegex_),d=l&&o.match(i.linebreakRegex_),p=c&&e.match(i.blanklineEndRegex_),u=d&&t.match(i.blanklineStartRegex_);return p||u?5:c||d?4:s&&!r&&l?3:r||l?2:s||a?1:0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var o=e[n-1][1],s=e[n][1],a=e[n+1][1],r=this.diff_commonSuffix(o,s);if(r){var l=s.substring(s.length-r);o=o.substring(0,o.length-r),s=l+s.substring(0,s.length-r),a=l+a}for(var c=o,d=s,p=a,u=t(o,s)+t(s,a);s.charAt(0)===a.charAt(0);){o+=s.charAt(0),s=s.substring(1)+a.charAt(0),a=a.substring(1);var h=t(o,s)+t(s,a);h>=u&&(u=h,c=o,d=s,p=a)}e[n-1][1]!=c&&(c?e[n-1][1]=c:(e.splice(n-1,1),n--),e[n][1]=d,p?e[n+1][1]=p:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],s=0,a=null,r=0,l=!1,c=!1,d=!1,p=!1;r<e.length;)0==e[r][0]?(e[r][1].length<this.Diff_EditCost&&(d||p)?(n[s++]=r,l=d,c=p,a=e[r][1]):(s=0,a=null),d=p=!1):(e[r][0]==o?p=!0:d=!0,a&&(l&&c&&d&&p||a.length<this.Diff_EditCost/2&&l+c+d+p==3)&&(e.splice(n[s-1],0,new i.Diff(o,a)),e[n[s-1]+1][0]=1,s--,a=null,l&&c?(d=p=!0,s=0):(r=--s>0?n[s-1]:-1,d=p=!1),t=!0)),r++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push(new i.Diff(0,""));for(var t,n=0,s=0,a=0,r="",l="";n<e.length;)switch(e[n][0]){case 1:a++,l+=e[n][1],n++;break;case o:s++,r+=e[n][1],n++;break;case 0:s+a>1?(0!==s&&0!==a&&(0!==(t=this.diff_commonPrefix(l,r))&&(n-s-a>0&&0==e[n-s-a-1][0]?e[n-s-a-1][1]+=l.substring(0,t):(e.splice(0,0,new i.Diff(0,l.substring(0,t))),n++),l=l.substring(t),r=r.substring(t)),0!==(t=this.diff_commonSuffix(l,r))&&(e[n][1]=l.substring(l.length-t)+e[n][1],l=l.substring(0,l.length-t),r=r.substring(0,r.length-t))),n-=s+a,e.splice(n,s+a),r.length&&(e.splice(n,0,new i.Diff(o,r)),n++),l.length&&(e.splice(n,0,new i.Diff(1,l)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,a=0,s=0,r="",l=""}""===e[e.length-1][1]&&e.pop();var c=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),c=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),c=!0)),n++;c&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,i=0,s=0,a=0,r=0;for(n=0;n<e.length&&(1!==e[n][0]&&(i+=e[n][1].length),e[n][0]!==o&&(s+=e[n][1].length),!(i>t));n++)a=i,r=s;return e.length!=n&&e[n][0]===o?r:r+(t-a)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,s=/>/g,a=/\n/g,r=0;r<e.length;r++){var l=e[r][0],c=e[r][1].replace(n,"&amp;").replace(i,"&lt;").replace(s,"&gt;").replace(a,"&para;<br>");switch(l){case 1:t[r]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case o:t[r]='<del style="background:#ffe6e6;">'+c+"</del>";break;case 0:t[r]="<span>"+c+"</span>"}}return t.join("")},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==o&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,s=0;s<e.length;s++){var a=e[s][0],r=e[s][1];switch(a){case 1:n+=r.length;break;case o:i+=r.length;break;case 0:t+=Math.max(n,i),n=0,i=0}}return t+Math.max(n,i)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case o:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("\t").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],s=0,a=0,r=t.split(/\t/g),l=0;l<r.length;l++){var c=r[l].substring(1);switch(r[l].charAt(0)){case"+":try{n[s++]=new i.Diff(1,decodeURI(c))}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+c)}break;case"-":case"=":var d=parseInt(c,10);if(isNaN(d)||d<0)throw new Error("Invalid number in diff_fromDelta: "+c);var p=e.substring(a,a+=d);"="==r[l].charAt(0)?n[s++]=new i.Diff(0,p):n[s++]=new i.Diff(o,p);break;default:if(r[l])throw new Error("Invalid diff operation in diff_fromDelta: "+r[l])}}if(a!=e.length)throw new Error("Delta length ("+a+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(t),o=this;function s(e,i){var s=e/t.length,a=Math.abs(n-i);return o.Match_Distance?s+a/o.Match_Distance:a?1:s}var a=this.Match_Threshold,r=e.indexOf(t,n);-1!=r&&(a=Math.min(s(0,r),a),-1!=(r=e.lastIndexOf(t,n+t.length))&&(a=Math.min(s(0,r),a)));var l,c,d=1<<t.length-1;r=-1;for(var p,u=t.length+e.length,h=0;h<t.length;h++){for(l=0,c=u;l<c;)s(h,n+c)<=a?l=c:u=c,c=Math.floor((u-l)/2+l);u=c;var g=Math.max(1,n-c+1),f=Math.min(n+c,e.length)+t.length,m=Array(f+2);m[f+1]=(1<<h)-1;for(var y=f;y>=g;y--){var b=i[e.charAt(y-1)];if(m[y]=0===h?(m[y+1]<<1|1)&b:(m[y+1]<<1|1)&b|(p[y+1]|p[y])<<1|1|p[y+1],m[y]&d){var v=s(h,y-1);if(v<=a){if(a=v,!((r=y-1)>n))break;g=Math.max(1,2*n-r)}}}if(s(h+1,n)>a)break;p=m}return r},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var n=t.substring(e.start2,e.start2+e.length1),o=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)o+=this.Patch_Margin,n=t.substring(e.start2-o,e.start2+e.length1+o);o+=this.Patch_Margin;var s=t.substring(e.start2-o,e.start2);s&&e.diffs.unshift(new i.Diff(0,s));var a=t.substring(e.start2+e.length1,e.start2+e.length1+o);a&&e.diffs.push(new i.Diff(0,a)),e.start1-=s.length,e.start2-=s.length,e.length1+=s.length+a.length,e.length2+=s.length+a.length}},i.prototype.patch_make=function(e,t,n){var s,a;if("string"==typeof e&&"string"==typeof t&&void 0===n)s=e,(a=this.diff_main(s,t,!0)).length>2&&(this.diff_cleanupSemantic(a),this.diff_cleanupEfficiency(a));else if(e&&"object"==typeof e&&void 0===t&&void 0===n)a=e,s=this.diff_text1(a);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===n)s=e,a=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");s=e,a=n}if(0===a.length)return[];for(var r=[],l=new i.patch_obj,c=0,d=0,p=0,u=s,h=s,g=0;g<a.length;g++){var f=a[g][0],m=a[g][1];switch(c||0===f||(l.start1=d,l.start2=p),f){case 1:l.diffs[c++]=a[g],l.length2+=m.length,h=h.substring(0,p)+m+h.substring(p);break;case o:l.length1+=m.length,l.diffs[c++]=a[g],h=h.substring(0,p)+h.substring(p+m.length);break;case 0:m.length<=2*this.Patch_Margin&&c&&a.length!=g+1?(l.diffs[c++]=a[g],l.length1+=m.length,l.length2+=m.length):m.length>=2*this.Patch_Margin&&c&&(this.patch_addContext_(l,u),r.push(l),l=new i.patch_obj,c=0,u=h,d=p)}1!==f&&(d+=m.length),f!==o&&(p+=m.length)}return c&&(this.patch_addContext_(l,u),r.push(l)),r},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n],s=new i.patch_obj;s.diffs=[];for(var a=0;a<o.diffs.length;a++)s.diffs[a]=new i.Diff(o.diffs[a][0],o.diffs[a][1]);s.start1=o.start1,s.start2=o.start2,s.length1=o.length1,s.length2=o.length2,t[n]=s}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,s=[],a=0;a<e.length;a++){var r,l,c=e[a].start2+i,d=this.diff_text1(e[a].diffs),p=-1;if(d.length>this.Match_MaxBits?-1!=(r=this.match_main(t,d.substring(0,this.Match_MaxBits),c))&&(-1==(p=this.match_main(t,d.substring(d.length-this.Match_MaxBits),c+d.length-this.Match_MaxBits))||r>=p)&&(r=-1):r=this.match_main(t,d,c),-1==r)s[a]=!1,i-=e[a].length2-e[a].length1;else if(s[a]=!0,i=r-c,d==(l=-1==p?t.substring(r,r+d.length):t.substring(r,p+this.Match_MaxBits)))t=t.substring(0,r)+this.diff_text2(e[a].diffs)+t.substring(r+d.length);else{var u=this.diff_main(d,l,!1);if(d.length>this.Match_MaxBits&&this.diff_levenshtein(u)/d.length>this.Patch_DeleteThreshold)s[a]=!1;else{this.diff_cleanupSemanticLossless(u);for(var h,g=0,f=0;f<e[a].diffs.length;f++){var m=e[a].diffs[f];0!==m[0]&&(h=this.diff_xIndex(u,g)),1===m[0]?t=t.substring(0,r+h)+m[1]+t.substring(r+h):m[0]===o&&(t=t.substring(0,r+h)+t.substring(r+this.diff_xIndex(u,g+m[1].length))),m[0]!==o&&(g+=m[1].length)}}}}return[t=t.substring(n.length,t.length-n.length),s]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",o=1;o<=t;o++)n+=String.fromCharCode(o);for(o=0;o<e.length;o++)e[o].start1+=t,e[o].start2+=t;var s=e[0],a=s.diffs;if(0==a.length||0!=a[0][0])a.unshift(new i.Diff(0,n)),s.start1-=t,s.start2-=t,s.length1+=t,s.length2+=t;else if(t>a[0][1].length){var r=t-a[0][1].length;a[0][1]=n.substring(a[0][1].length)+a[0][1],s.start1-=r,s.start2-=r,s.length1+=r,s.length2+=r}return 0==(a=(s=e[e.length-1]).diffs).length||0!=a[a.length-1][0]?(a.push(new i.Diff(0,n)),s.length1+=t,s.length2+=t):t>a[a.length-1][1].length&&(r=t-a[a.length-1][1].length,a[a.length-1][1]+=n.substring(0,r),s.length1+=r,s.length2+=r),n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var s=e[n];e.splice(n--,1);for(var a=s.start1,r=s.start2,l="";0!==s.diffs.length;){var c=new i.patch_obj,d=!0;for(c.start1=a-l.length,c.start2=r-l.length,""!==l&&(c.length1=c.length2=l.length,c.diffs.push(new i.Diff(0,l)));0!==s.diffs.length&&c.length1<t-this.Patch_Margin;){var p=s.diffs[0][0],u=s.diffs[0][1];1===p?(c.length2+=u.length,r+=u.length,c.diffs.push(s.diffs.shift()),d=!1):p===o&&1==c.diffs.length&&0==c.diffs[0][0]&&u.length>2*t?(c.length1+=u.length,a+=u.length,d=!1,c.diffs.push(new i.Diff(p,u)),s.diffs.shift()):(u=u.substring(0,t-c.length1-this.Patch_Margin),c.length1+=u.length,a+=u.length,0===p?(c.length2+=u.length,r+=u.length):d=!1,c.diffs.push(new i.Diff(p,u)),u==s.diffs[0][1]?s.diffs.shift():s.diffs[0][1]=s.diffs[0][1].substring(u.length))}l=(l=this.diff_text2(c.diffs)).substring(l.length-this.Patch_Margin);var h=this.diff_text1(s.diffs).substring(0,this.Patch_Margin);""!==h&&(c.length1+=h.length,c.length2+=h.length,0!==c.diffs.length&&0===c.diffs[c.diffs.length-1][0]?c.diffs[c.diffs.length-1][1]+=h:c.diffs.push(new i.Diff(0,h))),d||e.splice(++n,0,c)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),s=0,a=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;s<n.length;){var r=n[s].match(a);if(!r)throw new Error("Invalid patch string: "+n[s]);var l=new i.patch_obj;for(t.push(l),l.start1=parseInt(r[1],10),""===r[2]?(l.start1--,l.length1=1):"0"==r[2]?l.length1=0:(l.start1--,l.length1=parseInt(r[2],10)),l.start2=parseInt(r[3],10),""===r[4]?(l.start2--,l.length2=1):"0"==r[4]?l.length2=0:(l.start2--,l.length2=parseInt(r[4],10)),s++;s<n.length;){var c=n[s].charAt(0);try{var d=decodeURI(n[s].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+d)}if("-"==c)l.diffs.push(new i.Diff(o,d));else if("+"==c)l.diffs.push(new i.Diff(1,d));else if(" "==c)l.diffs.push(new i.Diff(0,d));else{if("@"==c)break;if(""!==c)throw new Error('Invalid patch mode "'+c+'" in: '+d)}s++}}return t},(i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0}).prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case 1:e="+";break;case o:e="-";break;case 0:e=" "}t[n+1]=e+encodeURI(this.diffs[n][1])+"\n"}return t.join("").replace(/%20/g," ")},t.exports=i,t.exports.diff_match_patch=i,t.exports.DIFF_DELETE=o,t.exports.DIFF_INSERT=1,t.exports.DIFF_EQUAL=0},{}],iSlp:[function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return e&&"object"===i(e)&&!Array.isArray(e)&&null!==e}t.exports=function e(t,n){return o(t)&&o(n)&&Object.keys(n).forEach((function(i){o(n[i])?(t[i]&&o(t[i])||(t[i]=n[i]),e(t[i],n[i])):Object.assign(t,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},i,n[i]))})),t}},{}],Os6R:[function(e,t,n){t.exports=function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=null,s=!0;return function(){for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];var c=function(){e.apply(n,r),o=null};i&&s&&(s=!1,c()),o||(o=setTimeout(c,t))}}},{}],gTec:[function(e,t,n){t.exports=function(e,t){var n,i=this;return function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];var r=i;clearTimeout(n),n=setTimeout((function(){return e.apply(r,s)}),t)}}},{}],xRfK:[function(e,t,n){t.exports=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/\r\n/g,"\n")}},{}],j8WE:[function(e,t,n){t.exports=function(e,t,n,i){var o=e+(n-e)/2;return"M ".concat(e," ").concat(t," C ").concat(o,",").concat(t," ").concat(o,",").concat(i," ").concat(n,",").concat(i)}},{}],iJA9:[function(e,t,n){t.exports={DIFF_EQUAL:0,DIFF_DELETE:-1,DIFF_INSERT:1,EDITOR_RIGHT:"right",EDITOR_LEFT:"left",RTL:"rtl",LTR:"ltr",SVG_NS:"http://www.w3.org/2000/svg",DIFF_GRANULARITY_SPECIFIC:"specific",DIFF_GRANULARITY_BROAD:"broad"}},{}],gWhB:[function(e,t,n){var i=e("../constants");t.exports=function(e,t){var n=e.options.mode;return t===i.EDITOR_LEFT&&null!==e.options.left.mode&&(n=e.options.left.mode),t===i.EDITOR_RIGHT&&null!==e.options.right.mode&&(n=e.options.right.mode),n}},{"../constants":"iJA9"}],IRlp:[function(e,t,n){var i=e("../constants");t.exports=function(e,t){var n=e.options.theme;return t===i.EDITOR_LEFT&&null!==e.options.left.theme&&(n=e.options.left.theme),t===i.EDITOR_RIGHT&&null!==e.options.right.theme&&(n=e.options.right.theme),n}},{"../constants":"iJA9"}],L8P8:[function(e,t,n){t.exports=function(e,t){return e.ace.getSession().doc.getLine(t)}},{}],gpkQ:[function(e,t,n){t.exports=function(e){return document.getElementById(e.options.left.id).offsetHeight}},{}],QEUm:[function(e,t,n){t.exports=function(e){var t=document.createElement("div"),n={class:e.className,style:"top:".concat(e.topOffset,"px"),title:e.tooltip,"data-diff-index":e.diffIndex};for(var i in n)t.setAttribute(i,n[i]);return t.innerHTML=e.arrowContent,t}},{}],f1Db:[function(e,t,n){t.exports=function(e,t){var n=Math.random().toString(36).substr(2,5),i="js-".concat(t,"-").concat(n),o=e.querySelector(".".concat(t));if(o)return o.id=o.id||i,o.id;var s=document.createElement("div");return e.appendChild(s),s.className=t,s.id=i,s.id}},{}],FPMV:[function(e,t,n){t.exports={on:function(e,t,n,i){var o="document"===e?document:document.querySelector(e);o.addEventListener(t,(function(e){for(var t=o.querySelectorAll(n),s=e.target,a=0,r=t.length;a<r;a+=1)for(var l=s,c=t[a];l&&l!==o;)l===c&&i.call(c,e),l=l.parentNode}))}}},{}],Focm:[function(e,t,n){var i,o=e("diff-match-patch"),s=e("./helpers/merge"),a=e("./helpers/throttle"),r=e("./helpers/debounce"),l=e("./helpers/normalizeContent"),c=e("./visuals/getCurve"),d=e("./visuals/getMode"),p=e("./visuals/getTheme"),u=e("./visuals/getLine"),h=e("./visuals/getEditorHeight"),g=e("./visuals/createArrow"),f=e("./dom/ensureElement"),m=e("./dom/query"),y=e("./constants");function b(e){if(e.Range)return e.Range;var t=e.acequire||e.require;return!!t&&t("ace/range")}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(this instanceof v))return new v(e);var t=this;t.options=s({ace:window?window.ace:void 0,mode:null,theme:null,element:null,diffGranularity:y.DIFF_GRANULARITY_BROAD,lockScrolling:!1,showDiffs:!0,showConnectors:!0,maxDiffs:5e3,left:{id:null,content:null,mode:null,theme:null,editable:!0,copyLinkEnabled:!0},right:{id:null,content:null,mode:null,theme:null,editable:!0,copyLinkEnabled:!0},classes:{gutterID:"acediff__gutter",diff:"acediff__diffLine",connector:"acediff__connector",newCodeConnectorLink:"acediff__newCodeConnector",newCodeConnectorLinkContent:"&#8594;",deletedCodeConnectorLink:"acediff__deletedCodeConnector",deletedCodeConnectorLinkContent:"&#8592;",copyRightContainer:"acediff__copy--right",copyLeftContainer:"acediff__copy--left"},connectorYOffset:0},e);var n=t.options.ace;if(!n){var o="No ace editor found nor supplied - `options.ace` or `window.ace` is missing";return console.error(o),new Error(o)}if(!(i=b(n))){var a="Could not require Range module for Ace. Depends on your bundling strategy, but it usually comes with Ace itself. See https://ace.c9.io/api/range.html, open an issue on GitHub ace-diff/ace-diff";return console.error(a),new Error(a)}if(null===t.options.element){var r="You need to specify an element for Ace-diff - `options.element` is missing";return console.error(r),new Error(r)}if(t.options.element instanceof HTMLElement?t.el=t.options.element:t.el=document.body.querySelector(t.options.element),!t.el){var c="Can't find the specified element ".concat(t.options.element);return console.error(c),new Error(c)}t.options.left.id=f(t.el,"acediff__left"),t.options.classes.gutterID=f(t.el,"acediff__gutter"),t.options.right.id=f(t.el,"acediff__right"),t.el.innerHTML='<div class="acediff__wrap">'.concat(t.el.innerHTML,"</div>"),t.editors={left:{ace:n.edit(t.options.left.id),markers:[],lineLengths:[]},right:{ace:n.edit(t.options.right.id),markers:[],lineLengths:[]},editorHeight:null},t.editors.left.ace.getSession().setMode(d(t,y.EDITOR_LEFT)),t.editors.right.ace.getSession().setMode(d(t,y.EDITOR_RIGHT)),t.editors.left.ace.setReadOnly(!t.options.left.editable),t.editors.right.ace.setReadOnly(!t.options.right.editable),t.editors.left.ace.setTheme(p(t,y.EDITOR_LEFT)),t.editors.right.ace.setTheme(p(t,y.EDITOR_RIGHT)),t.editors.left.ace.setValue(l(t.options.left.content),-1),t.editors.right.ace.setValue(l(t.options.right.content),-1),t.editors.editorHeight=h(t),setTimeout((function(){t.lineHeight=t.editors.left.ace.renderer.lineHeight,S(t),M(t),P(t),t.diff()}),1)}v.prototype={setOptions:function(e){s(this.options,e),this.diff()},getNumDiffs:function(){return this.diffs.length},getEditors:function(){return{left:this.editors.left.ace,right:this.editors.right.ace}},diff:function(){var e=this,t=new o,n=this.editors.left.ace.getSession().getValue(),i=this.editors.right.ace.getSession().getValue(),s=t.diff_main(i,n);t.diff_cleanupSemantic(s),this.editors.left.lineLengths=T(this.editors.left),this.editors.right.lineLengths=T(this.editors.right);var a=[],r={left:0,right:0};s.forEach((function(t,n,i){var o=t[0],l=t[1];i[n+1]&&l.endsWith("\n")&&i[n+1][1].startsWith("\n")&&(l+="\n",s[n][1]=l,s[n+1][1]=s[n+1][1].replace(/^\n/,"")),0!==l.length&&(o===y.DIFF_EQUAL?(r.left+=l.length,r.right+=l.length):o===y.DIFF_DELETE?(a.push(N(e,y.DIFF_DELETE,r.left,r.right,l)),r.right+=l.length):o===y.DIFF_INSERT&&(a.push(N(e,y.DIFF_INSERT,r.left,r.right,l)),r.left+=l.length))}),this),this.diffs=function(e,t){var n=[];function i(t){return e.options.diffGranularity===y.DIFF_GRANULARITY_SPECIFIC?t<1:t<=1}t.forEach((function(e,t){if(0!==t){for(var o=!1,s=0;s<n.length;s+=1)if(i(Math.abs(e.leftStartLine-n[s].leftEndLine))&&i(Math.abs(e.rightStartLine-n[s].rightEndLine))){n[s].leftStartLine=Math.min(e.leftStartLine,n[s].leftStartLine),n[s].rightStartLine=Math.min(e.rightStartLine,n[s].rightStartLine),n[s].leftEndLine=Math.max(e.leftEndLine,n[s].leftEndLine),n[s].rightEndLine=Math.max(e.rightEndLine,n[s].rightEndLine),o=!0;break}o||n.push(e)}else n.push(e)}));var o=[];return n.forEach((function(e){e.leftStartLine===e.leftEndLine&&e.rightStartLine===e.rightEndLine||o.push(e)})),o}(this,a),this.diffs.length>this.options.maxDiffs||(E(this),F(this))},destroy:function(){var e=this.editors.left.ace.getValue();this.editors.left.ace.destroy();var t=this.editors.left.ace.container,n=t.cloneNode(!1);n.textContent=e,t.parentNode.replaceChild(n,t);var i=this.editors.right.ace.getValue();this.editors.right.ace.destroy(),(n=(t=this.editors.right.ace.container).cloneNode(!1)).textContent=i,t.parentNode.replaceChild(n,t),document.getElementById(this.options.classes.gutterID).innerHTML="",w()}};var w=function(){};function S(e){e.editors.left.ace.getSession().on("changeScrollTop",a((function(){k(e)}),16)),e.editors.right.ace.getSession().on("changeScrollTop",a((function(){k(e)}),16));var t=e.diff.bind(e);e.editors.left.ace.on("change",t),e.editors.right.ace.on("change",t),e.options.left.copyLinkEnabled&&m.on("#".concat(e.options.classes.gutterID),"click",".".concat(e.options.classes.newCodeConnectorLink),(function(t){x(e,t,y.LTR)})),e.options.right.copyLinkEnabled&&m.on("#".concat(e.options.classes.gutterID),"click",".".concat(e.options.classes.deletedCodeConnectorLink),(function(t){x(e,t,y.RTL)}));var n=r((function(){e.editors.availableHeight=document.getElementById(e.options.left.id).offsetHeight,e.diff()}),250);window.addEventListener("resize",n),w=function(){window.removeEventListener("resize",n)}}function x(e,t,n){var o,s,a,r,l,c,d=parseInt(t.target.getAttribute("data-diff-index"),10),p=e.diffs[d];n===y.LTR?(o=e.editors.left,s=e.editors.right,a=p.leftStartLine,r=p.leftEndLine,l=p.rightStartLine,c=p.rightEndLine):(o=e.editors.right,s=e.editors.left,a=p.rightStartLine,r=p.rightEndLine,l=p.leftStartLine,c=p.leftEndLine);for(var h="",g=a;g<r;g+=1)h+="".concat(u(o,g),"\n");var f=s.ace.getSession().getScrollTop();s.ace.getSession().replace(new i(l,0,c,0),h),s.ace.getSession().setScrollTop(parseInt(f,10)),e.diff()}function T(e){var t=e.ace.getSession().doc.getAllLines(),n=[];return t.forEach((function(e){n.push(e.length+1)})),n}function C(e,t,n,o,s){var a=e.editors[t];o<n&&(o=n);var r="".concat(s," ").concat(o>n?"lines":"targetOnly");a.markers.push(a.ace.session.addMarker(new i(n,0,o-1,1),r,"fullLine"))}function k(e){E(e),F(e),function(e){var t=e.editors.left.ace.getSession().getScrollTop(),n=e.editors.right.ace.getSession().getScrollTop();e.copyRightContainer.style.cssText="top: ".concat(-t,"px"),e.copyLeftContainer.style.cssText="top: ".concat(-n,"px")}(e)}function E(e){e.editors.left.markers.forEach((function(t){e.editors.left.ace.getSession().removeMarker(t)}),e),e.editors.right.markers.forEach((function(t){e.editors.right.ace.getSession().removeMarker(t)}),e)}function N(e,t,n,i,o){var s={},a=/^\n/.test(o);if(t===y.DIFF_INSERT){var r=I(e.editors.left,n,o),l=L(e.editors.right,i),c=D(e.editors.right,l),d=D(e.editors.left,r.startLine),p=l;0===D(e.editors.left,r.startLine)&&a&&(a=!1),0===r.startChar&&A(e.editors.right,i,a)&&(p=l+1);var u=r.startLine===r.endLine,h=0;(r.startChar>0||u&&o.length<d)&&c>0&&r.startChar<d&&h++,s={leftStartLine:r.startLine,leftEndLine:r.endLine+1,rightStartLine:p,rightEndLine:p+h}}else{r=I(e.editors.right,i,o),l=L(e.editors.left,n),c=D(e.editors.left,l);var g=D(e.editors.right,r.startLine),f=l;0===D(e.editors.right,r.startLine)&&a&&(a=!1),0===r.startChar&&A(e.editors.left,n,a)&&(f=l+1),u=r.startLine===r.endLine,h=0,(r.startChar>0||u&&o.length<g)&&c>0&&r.startChar<g&&h++,s={leftStartLine:f,leftEndLine:f+h,rightStartLine:r.startLine,rightEndLine:r.endLine+1}}return s}function I(e,t,n){var i={startLine:0,startChar:0,endLine:0,endChar:0},o=t+n.length,s=0,a=!1,r=!1;e.lineLengths.forEach((function(e,n){s+=e,!a&&t<s&&(i.startLine=n,i.startChar=t-s+e,a=!0),!r&&o<=s&&(i.endLine=n,i.endChar=o-s+e,r=!0)})),i.startChar>0&&D(e,i.startLine)===i.startChar&&(i.startLine++,i.startChar=0),0===i.endChar&&i.endLine--;var l=/\n$/.test(n);return i.startChar>0&&l&&i.endLine++,i}function D(e,t){return u(e,t).length}function L(e,t){for(var n=e.ace.getSession().doc.getAllLines(),i=0,o=0,s=0;s<n.length;s+=1)if(t<=(o+=n[s].length+1)){i=s;break}return i}function A(e,t,n){for(var i=e.ace.getSession().doc.getAllLines(),o=0,s=0;s<i.length;s+=1){var a=o+=i[s].length+1;if(n&&(a-=1),t===a)break}return A}function P(e){e.gutterHeight=document.getElementById(e.options.classes.gutterID).clientHeight,e.gutterWidth=document.getElementById(e.options.classes.gutterID).clientWidth;var t=_(e,y.EDITOR_LEFT),n=_(e,y.EDITOR_RIGHT),i=Math.max(t,n,e.gutterHeight);e.gutterSVG=document.createElementNS(y.SVG_NS,"svg"),e.gutterSVG.setAttribute("width",e.gutterWidth),e.gutterSVG.setAttribute("height",i),document.getElementById(e.options.classes.gutterID).appendChild(e.gutterSVG)}function _(e,t){return(t===y.EDITOR_LEFT?e.editors.left:e.editors.right).ace.getSession().getLength()*e.lineHeight}function M(e){e.copyRightContainer=document.createElement("div"),e.copyRightContainer.setAttribute("class",e.options.classes.copyRightContainer),e.copyLeftContainer=document.createElement("div"),e.copyLeftContainer.setAttribute("class",e.options.classes.copyLeftContainer),document.getElementById(e.options.classes.gutterID).appendChild(e.copyRightContainer),document.getElementById(e.options.classes.gutterID).appendChild(e.copyLeftContainer)}function F(e){(function(e){document.getElementById(e.options.classes.gutterID).removeChild(e.gutterSVG),P(e)})(e),function(e){e.copyLeftContainer.innerHTML="",e.copyRightContainer.innerHTML=""}(e),e.diffs.forEach((function(t,n){e.options.showDiffs&&(C(e,y.EDITOR_LEFT,t.leftStartLine,t.leftEndLine,e.options.classes.diff),C(e,y.EDITOR_RIGHT,t.rightStartLine,t.rightEndLine,e.options.classes.diff),e.options.showConnectors&&function(e,t,n,i,o){var s=e.editors.left.ace.getSession().getScrollTop(),a=e.editors.right.ace.getSession().getScrollTop();e.connectorYOffset=1;var r=t*e.lineHeight-s+.5,l=e.gutterWidth+1,d=i*e.lineHeight-a+.5,p=n*e.lineHeight-s+e.connectorYOffset+.5,u=e.gutterWidth+1,h=o*e.lineHeight-a+e.connectorYOffset+.5,g=c(-1,r,l,d),f=c(u,h,-1,p),m="L".concat(l,",").concat(d," ").concat(u,",").concat(h),b="L".concat(-1,",").concat(p," ").concat(-1,",").concat(r),v="".concat(g," ").concat(m," ").concat(f," ").concat(b),w=document.createElementNS(y.SVG_NS,"path");w.setAttribute("d",v),w.setAttribute("class",e.options.classes.connector),e.gutterSVG.appendChild(w)}(e,t.leftStartLine,t.leftEndLine,t.rightStartLine,t.rightEndLine),function(e,t,n){if(t.leftEndLine>t.leftStartLine&&e.options.left.copyLinkEnabled){var i=g({className:e.options.classes.newCodeConnectorLink,topOffset:t.leftStartLine*e.lineHeight,tooltip:"Copy to right",diffIndex:n,arrowContent:e.options.classes.newCodeConnectorLinkContent});e.copyRightContainer.appendChild(i)}if(t.rightEndLine>t.rightStartLine&&e.options.right.copyLinkEnabled){var o=g({className:e.options.classes.deletedCodeConnectorLink,topOffset:t.rightStartLine*e.lineHeight,tooltip:"Copy to left",diffIndex:n,arrowContent:e.options.classes.deletedCodeConnectorLinkContent});e.copyLeftContainer.appendChild(o)}}(e,t,n))}),e)}t.exports=v},{"diff-match-patch":"k8CM","./helpers/merge":"iSlp","./helpers/throttle":"Os6R","./helpers/debounce":"gTec","./helpers/normalizeContent":"xRfK","./visuals/getCurve":"j8WE","./visuals/getMode":"gWhB","./visuals/getTheme":"IRlp","./visuals/getLine":"L8P8","./visuals/getEditorHeight":"gpkQ","./visuals/createArrow":"QEUm","./dom/ensureElement":"f1Db","./dom/query":"FPMV","./constants":"iJA9"}]},{},["Focm"])},oj90:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"Utils",(function(){return i}));var i={createAutocompleter:function(e,t,n,i=1){return{getCompletions:function(o,s,a,r,l){var c=o.session.getTokenAt(a.row,a.column);r.length<i||e&&!e.includes(c.type)?l(null,[]):l(null,t.map((function(e){return"object"==typeof e?{caption:e.word,value:e.word,meta:n,title:e.title,about:e.about,titleStyle:e.titleStyle}:{caption:e,value:e,meta:n}})))},getDocTooltip:function(e){if(!e.title&&!e.about)return"";e.docHTML=[`<div class='${e.titleStyle||"title-style-1"}' style='\n            display: flex;\n            flex-direction: column; \n            font-size: 0.8rem;\n            padding: 3px;'>`,"<p>",e.title,"</p>","<div class='node' style='\n            position:relative;\n            min-width: 100%;\n            overflow: hidden;'>","<div class='body' style='\n             font-size: 0.7rem;\n             line-height: 1rem;\n             top: 0;\n             padding: 3px'>",e.about,"</div>","</div>","</div>"].join("")}}},addDoubleTapDetector:function(e,t){e.lastTap=0,e.tapTimeout=0,e.addEventListener("touchend",(function(n){var i=(new Date).getTime(),o=i-e.lastTap;clearTimeout(e.tapTimeout),o<500&&o>0?(t(),n.preventDefault()):e.tapTimeout=setTimeout((function(){clearTimeout(e.tapTimeout)}),500),e.lastTap=i}))},uniqueSplit:function(e,t=" "){return[...new Set(e.split(t).filter(e=>e))]},getHighestZ:function(t){let n=Number.NEGATIVE_INFINITY;return e(t).children().each((function(){let t=parseInt(e(this).css("z-index"))||0;t>n&&(n=t)})),n},clamp:function(e,t,n){return Math.max(Math.min(e,n),t)},rectanglesOverlap:function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},stripHtml:function(e){for(;e.indexOf("<")>=0;)e=e.replace("<","&lt;");for(;e.indexOf(">")>=0;)e=e.replace(">","&gt");return e},xmlToObject:function(e){var t=[];if((e=e.childNodes.item(0)).hasChildNodes())for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes.item(n);if(i.hasChildNodes()){for(var o={},s=!1,a=0;a<i.childNodes.length;a++){var r=i.childNodes.item(a);if("#text"!=r.nodeName&&(s=!0,r.hasChildNodes()?o[r.nodeName]=r.childNodes.item(0).nodeValue:o[r.nodeName]="",r.attributes.length>0)){o[r.nodeName]={};for(var l=0;l<r.attributes.length;l++){var c=r.attributes.item(l);o[r.nodeName][c.nodeName]=c.nodeValue}}}s&&t.push(o)}}return t},now:Date.now||function(){return(new Date).getTime()},getPublicPath:function(e){return window.getPublicVsCodeWebviewUri?window.getPublicVsCodeWebviewUri(e):"public"+(e?"/"+e:"")},getEditorContextMenu:function(e){return{selector:".node-editor .form .editor",trigger:"right",build:function(t){var n={items:{}};if(!/^\[color=#([a-zA-Z0-9]{3,6})$/.test(app.getTagBeforeCursor())){if(app.editor.getSelectedText().length>1){if(n.items={cut:{name:"Cut",icon:"cut",callback:()=>{app.clipboard.length>0&&(app.data.triggerCopyClipboard(),app.insertTextAtCursor(""))}},copy:{name:"Copy",icon:"copy",callback:()=>{app.data.triggerCopyClipboard()}},paste:{name:"Paste",icon:"paste",callback:()=>app.data.triggerPasteClipboard()},sep1:"---------"},!app.getTagBeforeCursor().match(e)||"ink"===app.settings.documentType()&&"END"===app.editor.getSelectedText()||(n.items["go to node"]={name:"Edit node: "+app.editor.getSelectedText(),callback:()=>{const e=app.getFutureEditedNodeTitle();app.nodeVisitHistory.includes(e)||app.nodeVisitHistory.push(e),app.openNodeByTitle(app.editor.getSelectedText())}}),app.settings.spellcheckEnabled()){var i=app.getSpellCheckSuggestionItems();!1!==i&&(n.items.corrections={name:"Correct word",items:i})}var o=app.getThesaurusItems();!1!==o&&(n.items.corrections={name:"Related words",items:o})}else n.items={paste:{name:"Paste",icon:"paste",callback:()=>app.data.triggerPasteClipboard()}},"ink"===app.settings.documentType()&&(n.items.inkSnips={name:"Ink snippets",items:{structure:{name:"Structure",items:{stitch:{name:"Stitch",callback:()=>{app.insertTextAtCursor("= stitchName\nThis is the content of the stitch that should be embedded within a knot.\n-> END")}},end:{name:"Ending indicator",callback:()=>{app.insertTextAtCursor("-> END")}}}},choices:{name:"Choices",items:{basicChoice:{name:"Basic choice",callback:()=>{app.insertTextAtCursor("* This is a choice that can only be chosen once")}},stickyChoice:{name:"Sticky choice",callback:()=>{app.insertTextAtCursor("+ This is a sticky choice - the player can choose it more than once")}},choiceWithoutPrinting:{name:"Choice without printing",callback:()=>{app.insertTextAtCursor("* [A choice where the content isn't printed after choosing]")}},choiceWithoutMixedOutput:{name:"Choice without mixed output",callback:()=>{app.insertTextAtCursor("* Try [it] this example!")}}}},variableText:{name:"Variable text",items:{shuffle:{name:"~Shuffle (rand) text",callback:()=>{app.insertTextAtCursor("I tossed the coin. {~Heads|Tails}.")}},cycle:{name:"&Cycle text",callback:()=>{app.insertTextAtCursor("It was {&Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday} today.")}},sequence:{name:"Sequence text",callback:()=>{app.insertTextAtCursor('The radio hissed into life. {"Three!"|"Two!"|"One!"|There was the white noise racket of an explosion.|But it was just static.}\n\n{I bought a coffee with my five-pound note.|I bought a second coffee for my friend.|I didn\'t have enough money to buy any more coffee.}')}},onceOnly:{name:"!Once only text",callback:()=>{app.insertTextAtCursor("He told me a joke. {!I laughed politely.|I smiled.|I grimaced.|I promised myself to not react again.}\n")}}}},variables:{name:"Variables",items:{globalVariable:{name:"Global variable",callback:()=>{app.insertTextAtCursor("VAR myNumber = 5")}},temporaryVariable:{name:"Temporary variable",callback:()=>{app.insertTextAtCursor("temp myTemporaryValue = 5")}},modifyVariable:{name:"Modify variable",callback:()=>{app.insertTextAtCursor("~ myNumber = myNumber + 1")}}}},conditions:{name:"Conditions",items:{inlineCondition:{name:"Inline condition",callback:()=>{app.insertTextAtCursor("{yourVariable: This is written if yourVariable is true|Otherwise this is written}\n")}},multilineCondition:{name:"Multiline condition",callback:()=>{app.insertTextAtCursor("{yourVariable:\n    This is written if yourVariable is true.\n  - else:\n    Otherwise this is written.\n}")}}}}}},n.items.code={name:"Code",items:{equal:{name:"== (equal)",callback:()=>app.insertTextAtCursor("== ")},notEqual:{name:"!= (not equal)",callback:()=>app.insertTextAtCursor("!= ")},tag:{name:"# (tag)",callback:()=>app.insertTextAtCursor("# ")},list:{name:"LIST",callback:()=>app.insertTextAtCursor("LIST = ")},listFunc:{name:"List functions",items:{count:{name:"count",callback:()=>app.insertTextAtCursor("LIST_COUNT()")},min:{name:"min",callback:()=>app.insertTextAtCursor("LIST_MIN()")},max:{name:"max",callback:()=>app.insertTextAtCursor("LIST_MAX()")},rand:{name:"random",callback:()=>app.insertTextAtCursor("LIST_RANDOM()")}}},variable:{name:"VAR",callback:()=>app.insertTextAtCursor("VAR = ")},temp:{name:"~ temp",callback:()=>app.insertTextAtCursor("~ temp = ")},plusEq:{name:"+= (plus equal)",callback:()=>app.insertTextAtCursor("+= ")},else:{name:"- else",callback:()=>app.insertTextAtCursor("- else:\n")},or:{name:"|",callback:()=>app.insertTextAtCursor("|")},rand:{name:"~",callback:()=>app.insertTextAtCursor("~")}}},n.items.bladeCoder={name:"BladeCoder",items:{player:{name:"$PLAYER>",callback:()=>app.insertTextAtCursor("$PLAYER> ")},animation:{name:"Animation",callback:()=>app.ui.insertTextAtCursorWithParams("> Animation: animation=%0.%1, wait=%2, keepDirection=%3, repeat=%4, count=%5",[{name:"Actor",default:"$PLAYER"},{name:"Animation",default:"stand.right"},{name:"Wait",default:!1},{name:"Keep direction",default:!1},{name:"Repeat",default:"SPRITE_DEFINED"},{name:"Count",default:-1}])},goto:{name:"Goto",callback:()=>app.ui.insertTextAtCursorWithParams("> Goto: actor=%0, target=%1",[{name:"Actor",default:"$PLAYER"},{name:"target",default:"target"}])},wait:{name:"Wait",callback:()=>app.ui.insertTextAtCursorWithParams("> Wait: time=%0",[{name:"Time",default:.8}])},playSound:{name:"Play Sound",callback:()=>app.ui.insertTextAtCursorWithParams("> PlaySound: sound=%0, stop=%1",[{name:"Sound",default:"yawn"},{name:"Stop",default:!1}])},setActorAttr:{name:"Set Actor Attribute",callback:()=>app.ui.insertTextAtCursorWithParams("> SetActorAttr: actor=%0, talkAnimation=%1, visible=%2",[{name:"Actor",default:"$PLAYER"},{name:"Talk animation"},{name:"Visible",default:!0}])}}},n.items.end={name:"-> END",callback:()=>app.insertTextAtCursor("-> END")},n.items.star={name:"* (choice)",callback:()=>app.insertTextAtCursor("* ")},n.items.gather={name:"- (gather)",callback:()=>app.insertTextAtCursor("-")},n.items.stitch={name:"= (stitch)",callback:()=>app.insertTextAtCursor("= ")},n.items.glue={name:"<> (glue)",callback:()=>app.insertTextAtCursor("<>")},n.items.comment={name:"// (comment)",callback:()=>app.insertTextAtCursor("// ")},n.items.nested={name:"Nested",items:{gather2:{name:"-- (gather)",callback:()=>app.insertTextAtCursor("-- ")},star2:{name:"** (choice)",callback:()=>app.insertTextAtCursor("** ")}}},n.items.inkDoc={name:"How to use ink",callback:()=>window.open("https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md","_blank").focus()});return n}}}},debounce:function(e,t){var n;return function(){clearTimeout(n),n=setTimeout((function(){e()}),t)}}}}.call(this,n("EVdn"))},owJe:function(e,t,n){(function(e){var i=n("jXEy"),o=n("oj90"),s=o.Utils.getPublicPath("dictionaries/en/index.dic"),a=o.Utils.getPublicPath("dictionaries/en/index.aff");e("<style type='text/css'>.ace_marker-layer .misspelled { position: absolute; z-index: -2; border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head"),e("<style type='text/css'>.misspelled { border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head");var r=null;function l(e){var t=e.split(/\s+|\.|\,|\?|\\|\/|\!|\[|\]|"|'|;|:|`|\+|\-|\&|\$|@|~|#|>|<|_|\)|\(|Â£|\^|%|\*|â€ž|â€œ|\||[0-9]+/g),n=0,i=[];for(word in t){var o=t[word];r.correct(o)||(i[i.length]=[n,n+t[word].length]),n+=t[word].length+1}return i}t.load_dictionary=function(t){console.info(`Loading ${t} hunspell dictionary locally`),s=o.Utils.getPublicPath(`dictionaries/${t}/index.dic`),a=o.Utils.getPublicPath(`dictionaries/${t}/index.aff`),e.get(s,(function(e){dicData=e})).fail((function(){const n=sessionStorage.getItem("affData"),o=sessionStorage.getItem("dicData");if(n&&o)return console.info(t+" found in sessionStorage. Loading dictionary from cache..."),r=new i(n,o),void(c=!0);console.error(t+" not found locally. Loading dictionary from server instead..."),s=`https://raw.githubusercontent.com/wooorm/dictionaries/main/dictionaries/${t}/index.dic`,a=`https://raw.githubusercontent.com/wooorm/dictionaries/main/dictionaries/${t}/index.aff`,e.get(s,(function(e){dicData=e})).done((function(){e.get(a,(function(e){affData=e})).done((function(){sessionStorage.setItem("affData",affData),sessionStorage.setItem("dicData",dicData),r=new i(affData,dicData),c=!0}))}))})).done((function(){e.get(a,(function(e){affData=e})).done((function(){console.log("Dictionary loaded locally"),r=new i(affData,dicData),c=!0}))}))},t.misspelled=l;var c=!0,d=!1,p=[];function u(){if(null!=r&&!d&&c){d=!0;var e=ace.edit("editor").getSession();g();try{var t=ace.require("ace/range").Range,n=e.getDocument().getAllLines();for(var i in n){var o=l(n[i]);for(var s in o){var a=new t(i,o[s][0],i,o[s][1]);p[p.length]=e.addMarker(a,"misspelled","typo",!0)}}}finally{d=!1,c=!1}}}t.spell_check=u;var h=!1;function g(){var e=ace.edit("editor").getSession();for(var t in p)e.removeMarker(p[t]);p=[];var n=e.getDocument().getAllLines();for(var t in n)e.removeGutterDecoration(t,"misspelled")}t.enable_spellcheck=function(){h=!0,ace.edit("editor").getSession().on("change",(function(e){h&&(c=!0,u())})),c=!0,u()},t.disable_spellcheck=function(){h=!1,g()},t.clear_spellcheck_markers=g,t.suggest_word_for_misspelled=function(e){var t=r.suggest(e);return 0!==t.length&&t}}).call(this,n("EVdn"))},pLxK:function(e){e.exports=JSON.parse('{"a":"0.4.288"}')},pYPP:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i}));const i=function(t){const n=this,i=window.vsCodeApi?{getItem:()=>{},setItem:()=>{}}:window.localStorage;this.storage=i,e.extenders.persist=function(e,n){return e.subscribe((function(e){i.setItem(n,e),t.data.db.save(n,e)})),e},this.apply=function(){t.setTheme(n.theme()),t.setLanguage(n.language()),t.setDocumentType(n.documentType()),t.toggleInvertColors(),t.setMarkupLanguage(n.markupLanguage()),console.log("redraw throttle:",n.redrawThrottle()),t.workspace.setThrottle(n.redrawThrottle()),t.setGistCredentials({token:n.gistToken(),file:null!==n.gistFile()?n.gistFile().split("/").pop():null}),t.setGistPluginsFile(null!==n.gistPluginsFile()?n.gistPluginsFile().split("/").pop():null)},this.pasteFromClipboard=function(e){e&&e.length>0||navigator.clipboard&&navigator.clipboard.readText().then(n=>{t.log("clipboard",n),n&&n.length>5&&e(n)})},this.guessGistToken=function(){n.pasteFromClipboard(n.gistToken)},this.guessGistFile=function(){n.pasteFromClipboard(n.gistFile)},this.validateGridSize=function(){n.gridSize()<20&&n.gridSize(20),n.gridSize()>200&&n.gridSize(200),n.gridSize(parseInt(n.gridSize())),t.initGrid()},this.theme=e.observable(i.getItem("theme")||"dracula").extend({persist:"theme"}),this.documentType=e.observable(i.getItem("documentType")||"yarn").extend({persist:"documentType"}),this.language=e.observable(i.getItem("language")||"en-GB").extend({persist:"language"}),this.redrawThrottle=e.observable(parseInt(i.getItem("redrawThrottle")||"130")).extend({persist:"redrawThrottle"}),this.gistToken=e.observable(i.getItem("gistToken")).extend({persist:"gistToken"}),this.gistFile=e.observable(i.getItem("gistFile")).extend({persist:"gistFile"}),this.lastEditedGist=e.observable(i.getItem("lastEditedGist")).extend({persist:"lastEditedGist"}),this.lastStorageHost=e.observable(i.getItem("lastStorageHost")).extend({persist:"lastStorageHost"}),this.gistPluginsFile=e.observable(i.getItem("gistPluginsFile")).extend({persist:"gistPluginsFile"}),this.spellcheckEnabled=e.observable(null===i.getItem("spellcheckEnabled")||"true"===i.getItem("spellcheckEnabled")).extend({persist:"spellcheckEnabled"}),this.autoCloseTags=e.observable(null===i.getItem("autoCloseTags")||"true"===i.getItem("autoCloseTags")).extend({persist:"autoCloseTags"}),this.autocompleteSuggestionsEnabled=e.observable(null===i.getItem("autocompleteSuggestionsEnabled")||"true"===i.getItem("autocompleteSuggestionsEnabled")).extend({persist:"autocompleteSuggestionsEnabled"}),this.autoCloseBrackets=e.observable(null===i.getItem("autoCloseBrackets")||"true"===i.getItem("autoCloseBrackets")).extend({persist:"autoCloseBrackets"}),this.invertColorsEnabled=e.observable(null!==i.getItem("invertColorsEnabled")&&"true"===i.getItem("invertColorsEnabled")).extend({persist:"invertColorsEnabled"}),this.snapGridEnabled=e.observable(null!==i.getItem("snapGridEnabled")&&"true"===i.getItem("snapGridEnabled")).extend({persist:"snapGridEnabled"}),this.restoreSessionEnabled=e.observable(null!==i.getItem("restoreSessionEnabled")&&"true"===i.getItem("restoreSessionEnabled")).extend({persist:"restoreSessionEnabled"}),this.developmentModeEnabled=e.observable(null!==i.getItem("developmentModeEnabled")&&"true"===i.getItem("developmentModeEnabled")).extend({persist:"developmentModeEnabled"}),this.gridSize=e.observable(parseInt(i.getItem("gridSize")||"40")).extend({persist:"gridSize"}),this.createNodesEnabled=e.observable(null===i.getItem("createNodesEnabled")||"true"===i.getItem("createNodesEnabled")).extend({persist:"createNodesEnabled"}),this.editorStatsEnabled=e.observable(null!==i.getItem("editorStatsEnabled")&&"true"===i.getItem("editorStatsEnabled")).extend({persist:"editorStatsEnabled"}),this.markupLanguage=e.observable(i.getItem("markupLanguage")||"bbcode").extend({persist:"markupLanguage"}),this.filetypeVersion=e.observable(i.getItem("filetypeVersion")||"1").extend({persist:"filetypeVersion"}),this.lineStyle=e.observable(i.getItem("lineStyle")||"straight").extend({persist:"lineStyle"}),this.fileTabsVisible=e.observable(null===i.getItem("fileTabsVisible")||"true"===i.getItem("fileTabsVisible")).extend({persist:"fileTabsVisible"}),this.selectedFileTab=e.observable(i.getItem("selectedFileTab")||0).extend({persist:"selectedFileTab"}),this.alwaysOpenNodesInVisualStudioCodeEditor=e.observable(null!==i.getItem("alwaysOpenNodesInVisualStudioCodeEditor")&&"true"===i.getItem("alwaysOpenNodesInVisualStudioCodeEditor")).extend({persist:"alwaysOpenNodesInVisualStudioCodeEditor"}),this.editorSplitDirection=e.observable(i.getItem("editorSplitDirection")||"left").extend({persist:"editorSplitDirection"}),this.editorSplit=e.observable(null!==i.getItem("editorSplit")&&"true"===i.getItem("editorSplit")).extend({persist:"editorSplit"}),this.editorSplitSize=e.observable(i.getItem("editorSplitSize")||"50%").extend({persist:"editorSplitSize"})}}).call(this,n("Z1dp"))},qVgP:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s}));var i=n("+qE3");const{Story:o}=n("OeYU");var s=function(){let t=new i.EventEmitter;this.emiter=t,this.story=null,this.log=[],this.onRecompile=()=>{},this.curStory={messages:[],choices:[],tags:[],paragraphEl:""},this.resetStory=()=>{this.prevSavePoints=[],this.choiceHistory=[],this.textAreaEl.innerHTML="",this.curStory={messages:[],choices:[],tags:[],paragraphEl:""},this.story.ResetState()},this.terminate=()=>{if(this.textAreaEl)try{t.removeAllListeners(),this.finished=!0}catch(e){console.warn(e)}},this.setCurStory=({messages:e,choices:t,tags:n,paragraphEl:i})=>{this.curStory={messages:e,choices:t,tags:n,paragraphEl:i}};const n=(e="",t="")=>{const n=(e=>{let t=[];for(;e.canContinue;)t.push(e.Continue().replace(/\n/g,""));return t})(this.story),i=e.includes('"')?e:`[${e}]`,o=document.createElement("p");if(e){const s=document.createElement("p");s.innerHTML=`<p style="text-align: right;" id="${t}" class="playtestLink" title="Click to open [${t}] Node">${e} ( ${t} )</p>`,s.onclick=()=>app.navigateToNodeDuringPlayTest(t,i),o.appendChild(s),n.forEach(e=>{const t=document.createElement("p");t.innerHTML=e+"<br/>",o.appendChild(t)})}else o.innerHTML=n.join("<br/>");this.setCurStory({...this.curStory,messages:this.log?[...this.curStory.messages,e?`--${e}--`:"",n].filter(Boolean):[n],tags:this.story.currentTags,choices:this.story.currentChoices,paragraphEl:o}),a()};this.prevSavePoints=[];const s=(e,t)=>{this.prevSavePoints.push(this.story.state.toJson());const i=this.story.state.currentChoices[e].sourcePath.split(".")[0];this.story.ChooseChoiceIndex(e),n(t,i)};this.rewindStory=()=>{document.getElementById("choiceButtons").remove(),this.textAreaEl.removeChild(this.textAreaEl.lastElementChild),this.story.state.LoadJson(this.prevSavePoints.pop()),n()},this.createAndAddParagraph=t=>{if(console.log("made",t),t.innerHTML){const n=document.createElement("p");n.appendChild(t),n.className="story-playtest-bubble story-playtest-answer answer-post fade-in is-paused",this.textAreaEl.appendChild(n),e(n).removeClass("is-paused")}};const a=()=>{this.createAndAddParagraph(this.curStory.paragraphEl),this.textAreaEl.querySelectorAll("div").forEach(e=>e.remove());const e=document.createElement("div");e.id="choiceButtons",e.className="flex-wrap";const t=document.createElement("button");t.innerText="ðŸ”„",t.title="Recompile story",t.onclick=this.onRecompile,t.className="storyPreviewChoiceButton",e.appendChild(t);const i=document.createElement("button");i.innerText="ðŸŽ¬",i.title="Restart story",i.onclick=()=>{this.resetStory(),n()},i.className="storyPreviewChoiceButton",e.appendChild(i);const o=document.createElement("button");o.innerText="âª",o.title="Go to previous",o.disabled=0===this.prevSavePoints.length,o.onclick=()=>{this.rewindStory(),n()},e.appendChild(o),o.className="storyPreviewChoiceButton",this.curStory.choices.forEach((t,n)=>{const i=document.createElement("button");i.innerText=t.text,i.onclick=e=>{e.stopPropagation(),s(n,t.text)},i.className="storyPreviewChoiceButton",e.appendChild(i)}),this.textAreaEl.appendChild(e),this.textAreaEl.scrollTo({top:this.textAreaEl.scrollHeight+100,left:0,behavior:"smooth"})};this.initInk=(e,t,i,s,a,r,l,c,d,p)=>{this.onRecompile=t,console.log("INIT INK"),this.finished=!1,document.getElementById(r).style.visibility="hidden",this.textAreaEl=document.getElementById(c),this.textAreaEl.innerHTML='<div class="opacity-pulse centered"><h2>Parsing ink</h2> <h2 class="story-animated-dots"><p>.</p><p>.</p><p>.</p></h2></div>',this.inkTextData=s,this.compiler=e,this.compiler.init(e=>{if(this.textAreaEl.innerHTML="",e.errors.length>0)return this.textAreaEl.innerHTML=`<div class="title-error"><p>Parsing failed:</p>><br/><p>${e.errors.join("</p><p>")}</p><br/><p>${e.warnings.join("</p><p>")}</p></div>`,void(this.textAreaEl.onclick=()=>{console.log("====>",e),app.data.goToErrorInkNode(this.inkTextData,e.errors[0]),this.textAreaEl.onclick=null});if(e.warnings.length>0){const t=document.createElement("p");t.className="title-warning",e.warnings.forEach(e=>{const n=document.createElement("p");n.innerText=e,n.onclick=()=>{app.data.goToErrorInkNode(this.inkTextData,e)},t.appendChild(n)}),this.createAndAddParagraph(t)}if(this.story=new o(e.story),console.log("STORY",this.story),console.warn("Warnings",e.warnings),n(),""===this.story.currentText&&0===this.story.currentChoices.length)if(a!==app.data.InkGlobalScopeNodeName)this.compiler.submit(`-> ${a}\n`+s);else{const e=s.split("\n").find(e=>e.includes("==="));this.compiler.submit(`-> ${e.split("===")[1]}\n`+s)}}).then(()=>{if(!i.recompile&&i.story&&0!==i.prevSavePoints.length)return this.story=i.story,i.childNodes.forEach(e=>this.textAreaEl.appendChild(e)),this.prevSavePoints=i.prevSavePoints,void n();s&&this.compiler.submit(s)})}}}).call(this,n("EVdn"))},tUqF:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));const i=n("Wd8k"),o=n("L8pc"),s=new i.Runner,a=n("+qE3").EventEmitter;var r=function(){this.visitedNodes=[];this.node={title:""};let e=new a;this.emiter=e;let t=[];this.commandsPassedLog=t;this.commandPassed="";let n=!0;this.finished=n,this.scrollTextStyle=!1,this.visitedChapters=[],this.self=this,this.vnChoiceSelectionCursor=">",this.startTimeWait,this.vnSelectedChoice=-1,this.vnTextScrollInterval,this.storyChapter="",this.choices={};let i,r,l,c,d,p,u,h,g=null;this.vnSelectChoice=()=>{(new Date).getTime()-this.startTimeWait<1e3||(this.choices[this.storyChapter].push(c.options[this.vnSelectedChoice]),c.select(this.vnSelectedChoice),this.emiter.emit("choiceMade",c.options[this.vnSelectedChoice]),r="",i=void 0,c=self.goToNext(),this.vnSelectedChoice=-1,this.changeTextScrollSpeed(111))},this.vnUpdateChoice=(t=0)=>{if(this.vnSelectedChoice<0)return;let n=this.vnSelectedChoice+t;n>c.options.length-1?n=0:n<0&&(n=c.options.length-1),this.vnSelectedChoice=n,i=document.createElement("DIV"),c.options.forEach((e,t)=>{const n=document.createElement("DIV");t==this.vnSelectedChoice?n.innerHTML=`${this.vnChoiceSelectionCursor} [${e}]`:n.innerHTML=`${this.vnChoiceSelectionCursor.replace(/.*/gm,"&nbsp;")} [${e}]`,n.onclick=e=>{e.stopPropagation(),this.vnSelectedChoice=t,this.vnUpdateChoice()},n.ondblclick=e=>{e.stopPropagation(),this.vnSelectedChoice=t,this.vnSelectChoice()},n.className="storyPreviewChoiceButton",i.appendChild(n)}),e.emit("choiceUpdated",this.vnSelectedChoice),self.updateVNHud()},this.changeTextScrollSpeed=(t=0)=>{if(t!==this.vnTextScrollInterval){if(this.vnTextScrollInterval=t,clearInterval(p),g<0){if(this.isFinishedParsing(c))return void e.emit("finished");if("TextResult"===c.constructor.name)return r=c.text,g=0,e.emit("textResult",r),void this.changeTextScrollSpeed(220);"OptionsResult"===c.constructor.name&&-1===this.vnSelectedChoice&&(this.vnSelectedChoice=0,this.vnUpdateChoice(),this.startTimeWait=(new Date).getTime())}0!==t&&(p=setInterval(this.scrollUpdateText,t))}},self.goToNext=()=>{const e=d.next().value;if(!this.isFinishedParsing(e))return"TextResult"===e.constructor.name&&e.data&&this.node.title!==e.data.title&&(r="",g=-1,this.node=self.jsonCopy(e.data),this.visitedNodes.push(e.data.title),this.emiter.emit("startedNode",this.node)),e},this.isFinishedParsing=e=>(void 0===e||null===c)&&(n||(n=!0,g=-1),n=!0,n),this.runCommand=()=>{e.emit("commandCall",c.text),t.push(c.text),c=self.goToNext(),this.isFinishedParsing(c)||("TextResult"===c.constructor.name&&(r+="\n"+c.text,e.emit("textResult",c.text)),"OptionsResult"===c.constructor.name&&(g=-1))},this.scrollUpdateText=()=>{if(!this.isFinishedParsing(c))if(g<0)"CommandResult"===c.constructor.name&&this.runCommand();else if(g>r.length){if("TextResult"===c.constructor.name){if(c=self.goToNext(),this.isFinishedParsing(c))return;"CommandResult"===c.constructor.name?this.runCommand():("TextResult"===c.constructor.name||"OptionsResult"===c.constructor.name)&&(g=-1)}}else"TextResult"===c.constructor.name&&(g+=1,l=r.substring(0,g),self.updateVNHud())},self.updateVNHud=()=>{if("TextResult"===c.constructor.name){for(;l.lastIndexOf("[img]")>l.lastIndexOf("[/img]");)g+=1,l=r.substring(0,g);for(;l.lastIndexOf("[")>l.lastIndexOf("]");)g+=1,l=r.substring(0,g)}this.scrollTextStyle&&(document.getElementById(u).innerHTML=o.parse(l)+"<br>"),void 0!==i&&(this.scrollTextStyle||(document.getElementById(u).innerHTML=""),document.getElementById(u).appendChild(i))},this.terminate=()=>{try{let t=document.getElementById(u);t&&(t.innerHTML=""),t=document.getElementById(h),t&&(t.innerHTML=""),i=void 0,e.removeAllListeners(),this.finished=!0}catch(e){console.warn(e)}},this.initYarn=(t,i,a,r,l,c,d)=>{const p=["#f5ff6f","#44fe66","#e00ec0","#e93ecf","#0ec0e0","#3ecfe9","#e4dbcb","#978e7e","#666","#2f919a","deeppink","black","#97E1E9","#576574","#6EA5E0","#9EDE74","#FFE374","#F7A666","#C47862"],g=["__Ì´Ä±Ì´Ì´Ì¡Ì¡Ì¡ Ì¡ÍŒlÌ¡Ì¡Ì¡ Ì¡ÍŒlÌ¡*Ì¡Ì¡ Ì´Ì¡Ä±Ì´Ì´Ì¡ Ì¡Ì¡Í¡| Ì²â–«Ì²Í¡ Ì²Ì²Í¡â–«Ì²Ì²Í¡Í¡ Ì²|Ì¡Ì¡Ì¡ Ì¡, Ì´Ì¡Ä±Ì´Ì¡Ì¡ Ì¡ÍŒlÌ¡Ì¡Ì¡Ì¡.___","Â°ÂºÂ¤Ã¸,Â¸Â¸,Ã¸Â¤ÂºÂ°`Â°ÂºÂ¤Ã¸,Â¸,Ã¸Â¤Â°ÂºÂ¤Ã¸,Â¸Â¸,Ã¸Â¤ÂºÂ°`Â°ÂºÂ¤Ã¸,Â¸","(===||:::::::::::::::>","Â¸.Â·Â´Â¯`Â·.Â´Â¯`Â·.Â¸Â¸.Â·Â´Â¯`Â·.Â¸><(((Âº>","=^..^=","|==|iiii|>-----"," Â¦ÌµÌ± ÌµÌ± ÌµÌ± ÌµÌ± ÌµÌ±(Ì¢ Ì¡Ì…Í‡â””Ì…Í‡â”˜Í‡Ì… (â–¤8×›âˆ’â—¦","(â™¥_â™¥)","é¾´â†€â—¡â†€é¾´","â˜ â–…â–’â–‘â˜¼â€¿â˜¼â–‘â–’â–… â˜,","â–“âš—_âš—â–“","<:3 )~~~","(â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»","â—â–¬â–¬â–¬â–¬à¹‘Û©Û©à¹‘â–¬â–¬â–¬â–¬â–¬â—","(/)(Ã–,,,,Ã–)(/)","/)^3^(\\","( . Y . )","< )))) ><","(ãƒŽà² ç›Šà² )ãƒŽå½¡","d(^o^)bÂ¸Â¸â™¬Â·Â¯Â·â™©Â¸Â¸â™ªÂ·Â¯Â·â™«Â¸Â¸","O=('-'Q)","-`áƒ¦Â´-","Ë(â¦¿á´¥â¦¿)Ë€","(â•¥ï¹â•¥)","âœ²Â´*ã€‚.â„Â¨Â¯`*âœ²ã€‚â„ã€‚*ã€‚Â¨Â¯`*âœ²","â–‚â–ƒâ–…â–‡â–ˆâ–“â–’â–‘Û©ÛžÛ©        Û©ÛžÛ©â–‘â–’â–“â–ˆâ–‡â–…â–ƒâ–‚","( â€¢_â€¢)O*Â¯`Â·.Â¸.Â·Â´Â¯`Â°Q(â€¢_â€¢ )","â”»â”â”»ï¸µ  (Â°â–¡Â°)/ ï¸µ â”»â”â”»","|Ì²Ì²Ì²Í¡Í¡Í¡ Ì²â–«Ì²Í¡ Ì²Ì²Ì²Í¡Í¡Ï€Ì²Ì²Í¡Í¡ Ì²Ì²Í¡â–«Ì²Ì²Í¡Í¡ Ì²|Ì¡Ì¡Ì¡ Ì¡ Ì´Ì¡Ä±Ì´Ì¡Ì¡ Ì¡ÍŒlÌ¡ Ì´Ì¡Ä±Ì´Ì´Ì¡ Ì¡lÌ¡*Ì¡Ì¡ Ì´Ì¡Ä±Ì´Ì´Ì¡ Ì¡Ì¡Í¡|Ì²Ì²Ì²Í¡Í¡Í¡ Ì²â–«Ì²Í¡ Ì²Ì²Ì²Í¡Í¡Ï€Ì²Ì²Í¡Í¡ Ì²Ì²Í¡â–«Ì²Ì²Í¡Í¡ |","â¤â—¦.Â¸Â¸.  â—¦âœ¿","Ê•Ê˜Ì…ÍœÊ˜Ì…Ê”","( à¹ Y à¹ )","Ê•â€¢Í¡Ì«â€¢Ê•*Í¡Ì«*Ê•â€¢Í¡Í“â€¢Ê”-Í¡Ì«-Ê•â€¢Í¡Ì«â€¢Ê”*Í¡Ì«*Ê”-Í¡Ì«-Ê”","(ã£â—•â€¿â—•)ã£","âšâ–ˆâ•â•â–ˆâš","â”€=â‰¡Î£((( ã¤â—•Ù„Íœâ—•)ã¤","^â†€á´¥â†€^","à¼¼ ã¤ Í¡â—• Ñ¾ Í¡â—• à¼½ã¤","á•¦(Ã²_Ã³Ë‡)á•¤","â”¬â”´â”¬â”´â”¤ ÍœÊ– Í¡Â°) â”œâ”¬â”´â”¬â”´","[Ì²Ì…$Ì²Ì…(Ì²Ì…5)Ì²Ì…$Ì²Ì…]","(êˆâŒ“êˆâœ¿)","(à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘) â™¡","( â€¢ )( â€¢ )Ô…(â‰–âŒ£â‰–Ô…)","ï¼ˆã€‚ã€…Â°ï¼‰","âŠ‚(Â´ï½¥â—¡ï½¥âŠ‚ )âˆ˜ËšË³Â°","( ã…… )","(ï¾‰â˜‰ãƒ®âš†)ï¾‰ âŒ’*:ï½¥ï¾Ÿâœ§","(ï¼â€¸áƒš)","(â€¿|â€¿)","(ã‡(â€¢Ì€áµ¥áµ¥â€¢Ì)ãƒŽ)","ÊšâœŸâƒ›Éž","(â€²êˆÏ‰êˆâ€µ)","â™š â™› â™œ â™ â™ž â™Ÿ â™” â™• â™– â™— â™˜ â™™","(Â´á´—`)(Â´á´—`)","â™¥(Â´âˆ€ï½€)","à¸…(Ëµâ—ï»Œâ—Ëµ)à¸…"];if(h=l,u=a,this.yarnDataObject=t,this.startChapter=i,this.resourcesPath=r,this.finished=!1,this.scrollTextStyle="npc"===c,document.getElementById(h).innerHTML="<br/><font color='red'>ðŸš¥Press/Hold Z or ðŸ“±Double-click/Tap to advance</font><br/>",e.on("startedNode",(function(e){document.getElementById(h).innerHTML+="<br/><br/><font color='#581845'>ðŸ“œ --- Loaded next node ---</font>",document.getElementById(h).innerHTML+=`<font color='${p[Math.floor(Math.random()*p.length)]}'>  ${g[Math.floor(Math.random()*g.length)]}</font>`,document.getElementById(h).innerHTML+="<br/><font color='CADETBLUE'>&ensp;&ensp;&ensp;Title: "+e.title+"</font>",e.tags.length>0&&e.tags[0].length>0&&(document.getElementById(h).innerHTML+="<br/><font color='deeppink'>&ensp;&ensp;&ensp;Tags: "+e.tags+"</font>")})),e.on("choiceMade",(function(e){this.scrollTextStyle?document.getElementById(h).innerHTML+="<br/><font color='fuchsia'>ðŸ™Player chose: >"+e+"</font>":document.getElementById(h).innerHTML+=`<p class="story-playtest-bubble story-playtest-answer answer-post">${o.parse(e)}</p>`})),e.on("commandCall",(function(e){document.getElementById(h).innerHTML+=`<br/><font color='green'>ðŸ£Command call:</font> <font color='red'>&lt;&lt;${e}&gt;&gt;</font>`})),this.scrollTextStyle||(e.on("textResult",(function(e){document.getElementById(h).innerHTML+=`<p class="story-playtest-bubble">${o.parse(e)}</p>`,document.getElementById(u).innerHTML='<span class="story-animated-dots"><p>.</p><p>.</p><p>.</p></span>',document.getElementById(u).className="story-playtest-bubble",document.getElementById(h).scrollTo({top:document.getElementById(h).scrollHeight,left:0,behavior:"smooth"})})),e.on("choiceUpdated",(function(e){document.getElementById(u).className="story-playtest-answer"}))),e.on("finished",(function(){n=!0,e.removeAllListeners()})),Array.isArray(t))s.load(t);else{if(!("nodes"in t))return;s.load(t.nodes)}this.loadYarnChapter(i),s.variables.data={},d.forEach((function(e){console.log(e),s.variables.set(e.key,e.value)}))},this.loadYarnChapter=e=>{n=!1,this.storyChapter=e,this.choices[this.storyChapter]=[],this.visitedChapters.push(e),d=s.run(e),c=self.goToNext(),r=c.text,this.changeTextScrollSpeed(100)},this.wasChoiceMade=(e,t=this.storyChapter)=>!!this.choices[t].includes(e),this.timesNodeWasVisited=e=>{let t=0;return this.visitedNodes.forEach((n,i)=>{n===e&&(t+=1)}),t},self.jsonCopy=e=>JSON.parse(JSON.stringify(e))}},tn40:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("o+ka"),o=n.n(i);n("Z1zX");const s={theme:"ace/theme/monokai",mode:"ace/mode/javascript",tabSize:2,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0};var a=function({app:e,createButton:t,addSettingsItem:i,getPluginStore:a,onYarnEditorOpen:r,onYarnInPreviewMode:l,onYarnSavedNode:c,onYarnSetDocumentType:d,onKeyUp:p,onKeyDown:u,onLoad:h,setPluginStore:g,getVloatilePlugins:f,setVloatilePlugin:m,setVloatilePlugins:y,getGistPluginFiles:b}){const v=this;this.name="PluginEditor",this.editor=null,this.differ=null,this.editingFile="",this.volatilePlugins={},this.gistPluginFiles={},this.mode="edit",this.onSetPluginEditMode=e=>{this.mode=e,g(v.name,"pluginEditMode",e),document.querySelectorAll("#edit-plugin-mode > button").forEach(e=>e.classList.remove("active")),document.getElementById("edit-plugin-mode-"+e).classList.add("active"),console.log({mode:e}),document.getElementById("js-editor").style.display="edit"===e?"block":"none",document.getElementById("diff-editor").style.display="commit"===e?"block":"none",document.getElementById("plugin-output-previewer").style.display="test"===e?"block":"none",this.onSetEditingFile()},this.onOpenPluginEditor=async()=>{n("Puta"),n("8UzD"),n("wiAF");const t=ace.require("ace/ext/beautify");n("XxQW"),this.onSetEditingFile=()=>{const e=document.getElementById("edited-plugin-file").value;f().then(n=>{this.volatilePlugins=n;let i=this.volatilePlugins[e].content;this.editingFile=e,this.editor.setValue(i),this.editor.clearSelection(),t.beautify(this.editor.session),b().then(t=>{const n=t.find(t=>t.filename==e);console.log({gistPluginFile:n},this.differ.getEditors()),i=this.editor.getValue(),this.differ.getEditors().left.getSession().setValue(i),this.differ.getEditors().right.getSession().setValue(n.content),this.differ.getEditors().right.setReadOnly("commit"===this.mode)})})};const{value:i}=await Swal.fire({showCloseButton:!1,showCancelButton:!1,title:`\n        <div class="flex-wrap" style="flex:1;justify-content:space-between;gap: 4px; font-size: 1.4rem">\n          <div>\n            <select id="edited-plugin-file" class="settings-value" onchange="app.plugins.${v.name}.onSetEditingFile()">\n              ${Object.keys(this.volatilePlugins).map(e=>`<option value="${e}">${e}</option>`)}\n            </select>\n          </div>\n          <div id="edit-plugin-mode" class="button-group-rounded">\n            <button onclick="app.plugins.${v.name}.onSetPluginEditMode('edit')" id="edit-plugin-mode-edit">Edit</button>\n            <button onclick="app.plugins.${v.name}.onSetPluginEditMode('commit')" id="edit-plugin-mode-commit">Commit</button> \n            <button onclick="app.plugins.${v.name}.onSetPluginEditMode('test')" id="edit-plugin-mode-test">Test</button>\n          </div>\n        </div>\n        `.replaceAll("\n",""),html:'\n      <div id="js-editor-wrapper">\n        <div id="js-editor" style="height: 70vh; width: 100%;">function greet(name) {\n            return "Hello!" + name;\n        }\n        </div>        \n      </div>\n\n      <div style="position: relative;">\n          <div id="diff-editor" class="diff-editor" style="height: 70vh; width: 100%;"></div>\n      </div>\n      \n      <div>\n        <div id="plugin-output-previewer" style="height: 70vh; width: 100%;">\n          Write to previewer\n        </div>\n      </div>\n        ',focusConfirm:!1,customClass:"swal-wide",width:window.innerWidth-20+"px",onOpen:()=>{this.editor=ace.edit("js-editor"),this.editor.setOptions(s);const t=e.utils.debounce(()=>{m(this.editingFile,{content:this.editor.getValue()})},600);this.editor.getSession().on("change",(function(){t()}));const n=a(v.name);this.onSetPluginEditMode(n.pluginEditMode||"commit"),g(v.name,"pluginEditorOpen",!0),this.differ=new o.a({element:document.querySelector(".diff-editor"),left:{...s,content:""},theme:"ace/theme/monokai",right:{...s,content:"... no connection with gist"}});const i=e.utils.debounce(()=>{m(this.editingFile,{content:this.differ.getEditors().left.getValue()})},600);this.differ.getEditors().left.getSession().on("change",(function(){i()})),this.onSetEditingFile()},preConfirm:()=>(g(v.name,"pluginEditorOpen",!1),this.editor.getValue())})},h(()=>{console.log({isInDevMode:e.settings.developmentModeEnabled()}),e.settings.developmentModeEnabled()&&(f().then(e=>{this.volatilePlugins=e,console.log({gotVolatilePlugins:e})}),t(v.name,{name:"Edit plugins",attachTo:"fileMenuDropdown",onClick:"onOpenPluginEditor()",iconName:"cog"}))})}},uMdg:function(e,t,n){},wt9v:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="wt9v"}},[["e6Wu",1,2]]]);