(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{0:function(e,t){},1:function(e,t){},10:function(e,t){},"1mrn":function(e,t,n){},2:function(e,t){},"2Qx2":function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return d}));var o=n("W2Rx"),a=n("oj90");const s=n("33yf"),r=n("OeYU"),l=n("Iab2"),d={appInstanceStates:e.observable([]),restoreFromLocalStorage:e.observable(!0),isDocumentDirty:e.observable(!1),editingPath:e.observable(null),editingName:e.observable("NewFile"),editingType:e.observable("json"),editingFolder:e.observable(null),documentHeader:e.observable(null),lastStorageHost:e.observable("LOCAL"),lastEditedUnix:e.observable(new Date),lastSavedUnix:e.observable(null),inkCompiler:null,editingFileFolder:function(e=""){const t=d.editingPath()?d.editingPath():"";return e.length>0?s.join(s.dirname(t),e):s.dirname(t)},startNewFile:function(e="NewFile",t="json"){d.editingPath(null),d.editingName(e),d.editingType(t),d.editingFolder(null),d.documentHeader(null),app.workspace.selectedNodes=[],app.editing(null),t===a.FILETYPE.INK&&app.settings.documentType("ink"),app.nodes([app.newNode(!0).title("ink"===app.settings.documentType()?d.InkGlobalScopeNodeName:"Start").body("ink"===app.settings.documentType()?"":"Empty text")]),app.tags([]),app.updateNodeLinks(),app.workspace.warpToNodeByIdx(0),d.lastStorageHost("LOCAL"),d.isDocumentDirty(!0),app.refreshWindowTitle(),d.saveAppStateToLocalStorage(),app.ui.dispatchEvent("newYarnFileStarted")},askForFileName:function(){Swal.fire({title:"Enter a New File Name",input:"text",inputPlaceholder:"NewFile",showCancelButton:!0}).then(e=>{(e.value||""===e.value)&&d.startNewFile(e.value||"NewFile")})},setNewFile:function(){Swal.fire({title:"Create a New File?",text:`Any unsaved progress to ${d.editingName()}.${d.editingType()} will be lost!\n      Path: ${d.editingPath()}\n      Storage: ${d.lastStorageHost()}\n      `,icon:"warning",showCancelButton:!0,confirmButtonText:"New file",cancelButtonText:"No, cancel!"}).then(e=>{e.value&&d.askForFileName()})},loadDocumentStateTabFromIndex:function(e){console.log("ATTEMPT TO LOAD STATE",e),app.settings.selectedFileTab(e),d.loadAppStateFromLocalStorage()},getCurrentAppState:function(){return{editingPath:d.editingPath(),editingName:d.editingName(),documentType:app.settings.documentType(),editingType:d.editingType(),editingFolder:d.editingFolder(),editingTitle:app.editing()?app.editing().title():null,nodes:d.getNodesAsObjects(),documentHeader:d.documentHeader(),tags:app.tags(),editorSelection:app.editor?app.editor.selection.getRange():null,transform:app.workspace.transform,scale:app.workspace.scale,lastStorageHost:d.lastStorageHost(),lastEditedUnix:d.lastEditedUnix()||"",lastSavedUnix:d.lastSavedUnix(),pluginStorage:app.plugins.pluginStorage}},deleteDocumentStateTab:function(e){Swal.fire({title:"Are you sure?",text:`Are you sure you want to close this file? Any unsaved changes to ${d.editingName()}.${d.editingType()} will be lost!\n      Path: ${d.editingPath()||""}\n      Storage: ${d.lastStorageHost()}\n      `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes close",cancelButtonText:"Cancel",reverseButtons:!0}).then(t=>{if(t.value){console.log("DELETE TAB",d.appInstanceStates(),e);const t=d.appInstanceStates().filter((t,n)=>n!==e).map(e=>({...e}));d.appInstanceStates([...t]),d.saveAppStateToLocalStorage(!1),setTimeout(()=>{const t=e>d.appInstanceStates().length-1?d.appInstanceStates().length-1:e;d.loadDocumentStateTabFromIndex(t)},500),console.log(d.appInstanceStates(),"resulting mutation",t)}})},addDocumentState:function({editingName:e,editingType:t,yarnData:n,checked:i}){d.appInstanceStates([...d.appInstanceStates(),{...d.getCurrentAppState()}]),console.log("DOCUMENT TAB ADDED",d.appInstanceStates()),d.saveAppStateToLocalStorage(),d.loadDocumentStateTabFromIndex(d.appInstanceStates().length-1),i?(d.editingName(e),d.editingType(t)):d.startNewFile(e,t),console.log({editingName:e,yarnData:n,editingType:t,checked:i})},addDocumentStateTab:function(){d.promptFileNameAndFormat(d.addDocumentState,null,"📜 Name of new file"," Copy of "+d.editingName())},saveAppStateToLocalStorage:a.Utils.debounce((function(e=!0){if(!d.restoreFromLocalStorage())return;const t=app.settings.storage;d.isDocumentDirty(!0),d.lastEditedUnix(new Date),app.refreshWindowTitle();const n=[...d.appInstanceStates()];e&&(n[app.settings.selectedFileTab()]=d.getCurrentAppState()),d.appInstanceStates(n),t.setItem("appStates",JSON.stringify(d.appInstanceStates())),app.ui.dispatchEvent("yarnSavedStateToLocalStorage")}),700),loadAppStateFromLocalStorage:function(){if(!d.restoreFromLocalStorage())return;const e=app.settings.storage;e.getItem("appState")&&(console.log("--- storage.clear() ---"),e.clear());const t=JSON.parse(e.getItem("appStates")),n=t[app.settings.selectedFileTab()];if(d.appInstanceStates(t),console.log("APP state",t,n),n){const{editingPath:e,lastStorageHost:t,editingName:i,editingType:o,documentType:a,editingFolder:s,editingTitle:r,editorSelection:l,nodes:c,documentHeader:p,tags:u,transform:g,scale:h,pluginStorage:m,lastEditedUnix:f,lastSavedUnix:y}=n;app.tags(u),d.editingPath(e),d.editingName(i),d.editingType(o),app.settings.documentType(a),d.editingFolder(s),d.lastStorageHost(t),d.lastEditedUnix(f),d.lastSavedUnix(y),d.documentHeader(p),d.isDocumentDirty(!0),app.refreshWindowTitle(),app.ui.dispatchEvent("yarnLoadedStateFromLocalStorage"),console.log("--- app.plugins.pluginStorage ---"),app.plugins.pluginStorage=m,d.getNodesFromObjectsAsync(c).then(e=>{r&&(app.editNode(e.find(e=>e.title()===r)),l&&app.editor.selection.setRange(l)),console.log("--- app.nodes(newNodes) ---",e.length),app.nodes(e),console.log("--- app.updateNodeLinks ---"),app.updateNodeLinks(),console.log("--- app.workspace.setTranslation ---"),app.workspace.setTranslation(g.x,g.y),console.log("--- app.workspace.setZoom ---"),app.workspace.setZoom(4*h)})}},readFile:function(e,t,n){d.getFileData(e,t).then(t=>{d.editingPath(e.path),d.editingType(t.type),d.loadData(t.data,t.type,n)})},setNewFileStats:function(e,t,n="LOCAL"){console.log("Updated save data",e,t),d.editingName(e.replace(/^.*[\\\/]/,"")),d.isDocumentDirty(!1),d.editingPath(t),d.lastStorageHost(n),app.refreshWindowTitle()},openFile:function(e,t){const n=d.editingPath()?"Any unsaved progress to "+d.editingName()+" will be lost.":"Any unsaved progress will be lost.";Swal.fire({title:"Are you sure you want to open another file?",text:n,icon:"warning",showConfirmButton:!0,showCancelButton:!0}).then(n=>{!0===n.value&&(d.readFile(e,t,!0),d.setNewFileStats(t,e.path),app.refreshWindowTitle())})},openFileFromFilePath:function(e){const t=app.path.basename(e);i.ajax({url:e,async:!1,success:n=>{const i=d.getFileType(t);i===a.FILETYPE.UNKNOWN?Swal.fire({title:"Unknown filetype!",icon:"error"}):(d.loadData(n,i,!0),d.setNewFileStats(t,e),d.editingType(i))}})},getFileData:function(e,t){return new Promise((n,i)=>{const o=new FileReader;o.onload=function(s){const r=d.getFileType(t);r===a.FILETYPE.UNKNOWN?(Swal.fire({title:"Unknown filetype!",icon:"error"}),i()):n({file:e,type:r,data:o.result,name:e.name})},o.readAsText(e)})},openFiles:async function(e,t){const n=document.getElementById("open-file").files;for(const e of Object.values(n)){const t=await d.getFileData(e,e.name);console.log("FILEDATA",t);const n=t.name,i=t.type;d.addDocumentState({editingName:n,editingType:i,yarnData:t.data}),d.loadData(t.data,i,!0)}},openFolder:function(e,t){editingFolder=t,Swal.fire({text:"openFolder not yet implemented e: "+e+" foldername: "+t,icon:"error"})},appendFile:function(e,t){d.readFile(e,t,!1)},getFileType:function(e){const t=e.toLowerCase();return t.endsWith(".json")?a.FILETYPE.JSON:t.endsWith(".yarn.txt")?a.FILETYPE.YARN:t.endsWith(".ink")?a.FILETYPE.INK:t.endsWith(".yarn")?a.FILETYPE.YARN:t.endsWith(".xml")?a.FILETYPE.XML:t.endsWith(".txt")?a.FILETYPE.TWEE:t.endsWith(".tw2")||t.endsWith(".twee")?a.FILETYPE.TWEE2:a.FILETYPE.UNKNOWN},dispatchEventDataLoaded:function(){var e=new CustomEvent("yarnLoadedData");e.document=document,e.data=d,e.app=app,window.dispatchEvent(e),window.parent.dispatchEvent(e)},restoreSettingsFromDocumentHeader:function(){if(null!==d.documentHeader()){const e=d.documentHeader();console.log("Apply settings from file header:",e),"markupLanguage"in e&&app.settings.markupLanguage(e.markupLanguage),"language"in e&&app.settings.language(e.language),"filetypeVersion"in e&&app.settings.filetypeVersion(e.filetypeVersion),app.settings.apply()}},loadData:function(e,t,n){const i=[],o=e=>{for(let t=0;t<e.length;t++)"title"in e[t]&&i.push(e[t])};if(t===a.FILETYPE.JSON){if(!(e=JSON.parse(e)))return;Array.isArray(e)?o(e):(d.documentHeader(e.header),o(e.nodes)),app.setDocumentType("yarn")}else if(t===a.FILETYPE.INK){var s=e.split(/\r?\n/),r=null;const t=e=>{try{r.title=s[e].split("//yarn-editor-metadata:")[0].replace(/===/g,"").trim();const{x:t,y:n,colorID:i}=JSON.parse(s[e].split("//yarn-editor-metadata:")[1]);r.position={x:parseInt(t),y:parseInt(n)},r.colorID=i}catch(e){console.warn("node metadata failed parse: ",e)}};for(let e=0;e<s.length;e++){const n={body:"",position:{x:160*i.length,y:160*i.length},colorID:0,tags:""};null!==r||s[e].trim().startsWith("===")||((r={...n,position:{x:-400,y:0}}).title=d.InkGlobalScopeNodeName),s[e].trim().startsWith("===")?(null!==r&&i.push(r),r={title:s[e].trim().replace(/===/g,""),...n},s[e].trim().includes("//yarn-editor-metadata:")&&t(e)):null!==r&&(r.body+=s[e]+"\n")}null!==r&&i.push(r),app.setDocumentType("ink")}else if(t===a.FILETYPE.YARN){s=e.split(/\r?\n/),r=null;var l=!1;for(let e=0;e<s.length;e++)if("==="===s[e].trim())l=!1,null!=r&&(i.push(r),r=null);else if(l)r.body+=s[e]+"\n";else if(s[e].indexOf("title:")>-1)null==r&&(r={}),r.title=s[e].substr(7,s[e].length-7);else if(s[e].indexOf("position:")>-1){null==r&&(r={});var c=s[e].substr(9,s[e].length-9).split(",");r.position={x:Number(c[0].trim()),y:Number(c[1].trim())}}else s[e].indexOf("colorID:")>-1?(null==r&&(r={}),r.colorID=Number(s[e].substr(9,s[e].length-9).trim())):s[e].indexOf("tags:")>-1?(null==r&&(r={}),r.tags=s[e].substr(6,s[e].length-6)):"---"===s[e].trim()&&(l=!0,r.body="");null!=r&&i.push(r),app.setDocumentType("yarn")}else if(t===a.FILETYPE.TWEE||t===a.FILETYPE.TWEE2){s=e.split("\n"),r=null;for(var p=0,u=0;u<s.length;u++)if(s[u]=s[u].trim(),"::"===s[u].substr(0,2)){null!=r&&i.push(r),r={};var g="",h="",m={x:80*++p,y:80*p},f=s[u].indexOf("["),y=s[u].indexOf("]");f>0&&y>0&&(h=s[u].substr(f+1,y-f-1));var b=s[u].indexOf("<"),v=s[u].indexOf(">");if(b>0&&v>0){var w=s[u].substr(b+1,v-b-1).split(",");m.x=parseInt(w[0]),m.y=parseInt(w[1])}var T=0;f>0?T=f:b>0&&(T=b),g=(g=T?s[u].substr(3,T-3):s[u].substr(3)).trim(),r.title=g,r.tags=h,r.body="",r.position=m}else null!=r&&(r.body.length>0&&(s[u]+="\n"),r.body+=s[u]);null!=r&&i.push(r),app.setDocumentType("yarn")}else if(t===a.FILETYPE.XML){app.setDocumentType("yarn");var S=(new DOMParser).parseFromString(e,"text/xml");if(void 0!==(e=a.Utils.xmlToObject(S)))for(let t=0;t<e.length;t++)i.push(e[t])}app.limitNodesUpdate(()=>{n&&app.nodes.removeAll(),d.getNodesFromObjects(i).forEach(e=>app.nodes.push(e))}),d.editingType(t),d.restoreSettingsFromDocumentHeader(),app.updateNodeLinks(),app.workspace.warpToNodeByIdx(0),d.isDocumentDirty(!1),d.addGlobalScopeToInkDoc(),d.dispatchEventDataLoaded()},addGlobalScopeToInkDoc:function(){"ink"!==app.settings.documentType()||app.nodes().find(e=>e.title().trim()===d.InkGlobalScopeNodeName)||app.newNode(!0).title(d.InkGlobalScopeNodeName).x(-400)},getNodeFromObject:function(e){return new o.a({title:e.title,body:e.body,tags:e.tags,colorID:e.colorID,x:parseInt(e.position.x),y:parseInt(e.position.y)})},getNodeAsObject:function(e){return{title:e.title(),tags:e.tags(),body:e.body(),position:{x:e.x(),y:e.y()},colorID:e.colorID()}},getNodesFromObjects:function(e){const t=[];if(!e)return[];for(let n=0;n<e.length;n++)t.push(d.getNodeFromObject(e[n]));return t},getNodesFromObjectsAsync:async function(e){if(!e)return[];const t=e.map(e=>new Promise(t=>t(d.getNodeFromObject(e))));return await Promise.all(t)},getNodesAsObjects:function(){const e=[],t=app.nodes();for(var n=0;n<t.length;n++)e.push(d.getNodeAsObject(t[n]));return e},getSaveData:async function(e,t=null,n=!1,i=d.getNodesAsObjects()){var o="";if(e===a.FILETYPE.JSON)if("2"===app.settings.filetypeVersion()){console.log("Saving as Yarn json v2 type");const e=new Date;d.documentHeader({...d.documentHeader(),lastSavedUnix:e,language:app.settings.language(),documentType:app.settings.documentType(),markupLanguage:app.settings.markupLanguage(),filetypeVersion:app.settings.filetypeVersion(),pluginStorage:app.plugins.pluginStorage}),o=JSON.stringify({header:d.documentHeader(),nodes:i},null,"\t")}else o=JSON.stringify(i,null,"\t");else if(e===a.FILETYPE.INK){const e=i.find(e=>e.title.trim()===d.InkGlobalScopeNodeName);if(e){if(n){const t=e.body.split(/\r\n|\r|\n/).filter(e=>e.trim().startsWith("INCLUDE "));o+=e.body.split(/\r\n|\r|\n/).filter(e=>!e.trim().startsWith("INCLUDE ")).join("\n");for(const e of t){const t=e.trim().split("INCLUDE ");if(t.length>1){const e=d.appInstanceStates().find(e=>e.editingType===a.FILETYPE.INK&&e.editingName===t[1]);if(e){o+=await d.getSaveData(a.FILETYPE.INK,null,n,e.nodes)+"\n"}}}}else o+=e.body;if(t&&o.split(/\r\n|\r|\n/).length>t)return e}for(let e=0;e<i.length;e++){const n=i[e];if(n.title.trim()!==d.InkGlobalScopeNodeName)if(o+=`\n=== ${n.title} === //yarn-editor-metadata: `+JSON.stringify({x:parseInt(n.position.x),y:parseInt(n.position.y),colorID:parseInt(n.colorID)})+"\n",o+=n.body,(s=n.body).length>0&&"\n"===s[s.length-1]||(o+="\n"),t&&o.split(/\r\n|\r|\n/).length>t)return n}}else if(e===a.FILETYPE.INKJSON){const e=await d.getSaveData("ink",null,!0),t=new Promise((t,n)=>{app.ui.toastMixin.fire({title:"Ink file is compiling",icon:"info",timer:4e3,text:"Please wait..."}),d.inkCompiler.init(i=>{i.errors.length>0?(Swal.fire({title:"Failed to parse ink file",html:`<div class="title-error">${i.errors.join("<br/>")}</div>`,icon:"error"}).then(()=>d.goToErrorInkNode(e,i.errors[0])),n()):(console.log("Warnings",i.warnings),app.ui.toastMixin.fire({animation:!0,title:i.warnings.length>0?"Ink file compiled with some warnings":"Ink file compiled successfully",icon:i.warnings.length>0?"warning":"success",text:i.warnings.join("\n")}),console.log({responseStory:i.story}),t(JSON.stringify(i.story,null,"\t")))}).then(()=>d.inkCompiler.submit(e))});o=await t}else if(e===a.FILETYPE.YARN)for(let e=0;e<i.length;e++){var s;o+="title: "+i[e].title+"\n",o+="tags: "+i[e].tags+"\n",o+="colorID: "+i[e].colorID+"\n",o+="position: "+i[e].position.x+","+i[e].position.y+"\n",o+="---\n",o+=i[e].body,(s=i[e].body).length>0&&"\n"===s[s.length-1]||(o+="\n"),o+="===\n"}else if(e===a.FILETYPE.RENPY)for(let e=0;e<i.length;e++){o+=`\n${i[e].tags.includes("screen")?"screen":"label"} `+i[e].title.replace(/[ ]/g,"_")+":\n";const t=i[e].body;t.length>0&&"\n"===t[t.length-1]||(o+="\n");let n=!1,a=!1,s="";const r=i[e].tags.includes("renpy");t.split("\n").forEach(e=>{const t=e.trim(),i=a?"\t\t":"\t";if(r)s+=`${i}${e}\n`;else if(t.startsWith("[[")){const e=t.replace(/[\[\[]|[\]\]]]/g,"").split("|");e.length>1?(n||(s+=i+"menu:\n",n=!0),s+=`${i}\t"${e[0].trim()}":\n${i}\t\tjump ${e[1].trim()}\n`):s+=`${i}jump ${e[0].trim()}\n`}else if(t.startsWith("<<if")){const e=t.replace(/\<\<\|$|\>\>|if/g,"").split(/==|!=|>|</g).filter(Boolean),n=t.substring(2,t.length-2).match(/(>|==|!=|<)/);s+=e.length>1&&n?`\tif ${e[0].trim()} ${n[0]} ${e[1].trim()}:\n`:`\t# ${t}\n`,a=!0}else if(t.startsWith("<<elseif")){const e=t.replace(/\<\<\|$|\>\>|elseif/g,"").split(/==|!=|>|</g).filter(Boolean),n=t.substring(2,t.length-2).match(/(>|==|!=|<)/);s+=e.length>1&&n?`\telif ${e[0].trim()} ${n[0]} ${e[1].trim()}:\n`:`\t# ${t}\n`,a=!0}else if(t.startsWith("<<else"))s+="\telse:\n",a=!0;else if(t.startsWith("<<endif"))s+="\n",a=!1;else if(t.startsWith("<<set")){const e=t.replace(/[\<\>\$]|set /g,"").split("=");console.log({set:e}),s+=e.length>1?`${i}$ ${e[0].trim()} = ${e[1].trim()}\n`:`${i}#$ ${e[0].trim()} = 0:\n`}else t.startsWith("<<")?s+=`${i}${t.replace(/[\<\>]/g,"")}\n`:t.startsWith("//")?s+=`${i}#${t.substring(2)}\n`:t.length>0&&(t.endsWith('"')?s+=`${i}${t}\n`:s+=`${i}"${t}"\n`);n=!1}),o+=s+"\n"}else if(e===a.FILETYPE.TWEE)for(let e=0;e<i.length;e++){var r="";i[e].tags.length>0&&(r=" ["+i[e].tags+"]"),o+=":: "+i[e].title+r+"\n",o+=i[e].body+"\n\n"}else if(e===a.FILETYPE.TWEE2)for(let e=0;e<i.length;e++){r="";i[e].tags.length>0&&(r=" ["+i[e].tags+"]");var l=" <"+i[e].position.x+","+i[e].position.y+">";o+=":: "+i[e].title+r+l+"\n",o+=i[e].body+"\n\n"}else if(e===a.FILETYPE.XML){o+="<nodes>\n";for(let e=0;e<i.length;e++)o+="\t<node>\n",o+="\t\t<title>"+i[e].title+"</title>\n",o+="\t\t<tags>"+i[e].tags+"</tags>\n",o+="\t\t<body>"+i[e].body+"</body>\n",o+='\t\t<position x="'+i[e].position.x+'" y="'+i[e].position.y+'"></position>\n',o+="\t\t<colorID>"+i[e].colorID+"</colorID>\n",o+="\t</node>\n";o+="</nodes>\n"}return d.isDocumentDirty(!1),app.refreshWindowTitle(),o},saveTo:function(e,t,n=null){app.fs&&app.fs.writeFile(e,t,{encoding:"utf-8"},(function(t){d.editingPath(e),n&&n(),t?Swal.fire({title:"Error Saving Data to "+e+": "+t,icon:"error"}):(app.ui.notification.fire({title:"Saved!",icon:"success"}),app.ui.dispatchEvent("yarnSavedData"),d.setNewFileStats(e,e,"LOCAL"))}))},openFileDialog:function(e,t){e.bind("change",(function(n){t(n.currentTarget.files[0],e.val());var i="";null!=e.attr("nwsaveas")&&(i='nwsaveas="'+e.attr("nwsaveas")+'"'),null!=e.attr("accept")&&(i='accept="'+e.attr("accept")+'"'),e.parent().append('<input type="file" id="'+e.attr("id")+'"  '+i+">"),e.unbind("change"),e.remove()})),e.trigger("click")},saveFileDialog:function(e,t,n){const i=(d.editingName()||"").replace(/\.[^/.]+$/,"")+"."+t;if(app.electron)app.electron.remote.dialog.showSaveDialog({title:"Saving "+i,filters:[{name:t+" file",extensions:[t]}],defaultPath:i}).then(e=>{d.saveTo(e.filePath,n)}).catch(e=>{console.error(e)});else{var o=new Blob([n],{type:"text/plain;charset=utf-8"});l(o,i)}},insertImageFileName:function(){d.openFileDialog(i("#open-image"),(function(e,t){app.insertTextAtCursor(e.path?e.path:e.name)}))},tryOpenFile:function(){d.openFileDialog(i("#open-file"),d.openFiles)},promptFileNameAndFormat:function(e,t=null,n="💾 Save file - enter file name",i=""){const o=d.editingName().replace(/\.[^/.]+$/,"")+"."+d.editingType();Swal.fire({title:n,html:` <input id="swal-input1" list="select-file-name" name="select" placeholder="${o}">\n      <datalist class="form-control" id="select-file-name">    \n        ${t&&t.map(e=>`<option value="${e}" />`).join("")}\n      </datalist>\n      ${i?`<br/><br/><input type="checkbox" id="swal-checkbox-checked"> ${i}</input>`:""}\n        `,onOpen:()=>{"NewFile"!==d.editingName()&&(document.getElementById("swal-input1").value=o,document.getElementById("swal-input1").addEventListener("focus",e=>{e.target.value="",e.target.showPicker()}))},showCancelButton:!0,preConfirm:()=>({name:document.getElementById("swal-input1").value,checked:!!i&&document.getElementById("swal-checkbox-checked").checked})}).then(({value:t})=>{if(t){const{name:n,checked:i}=t,o=n.split(".").pop(),s=Object.values(a.FILETYPE).includes(o)?o:d.editingType(),r=(n||"").replace(/\.[^/.]+$/,"")+"."+s;d.getSaveData(s).then(t=>{e({editingName:r,editingType:s,yarnData:t,checked:i})})}})},tryShareFilePwa:function(e){d.promptFileNameAndFormat(({editingName:e,yarnData:t})=>{const n=[new Blob([t],{type:"text/plain"})],i=new File(n,e,{});navigator.canShare&&navigator.canShare({files:[i]})?navigator.share({title:e,text:t,file:[i]}).then(()=>console.log("Successful share")).catch(e=>console.log("Error sharing",e)):Swal.fire({title:"Web Share API is not supported in your browser.\nTry using it on your smartphone or tablet...",icon:"error"})})},trySaveGist:function(e){e&&e.file&&e.file.length>0?e.get(e.file).then(t=>{const n=Object.keys(t.body.files);console.log(n),d.promptFileNameAndFormat(({editingName:t,yarnData:n})=>{d.editingName(t),e.edit(e.file,{files:{[t]:{content:n}}}),Swal.fire("Saved!","The Yarn has been saved to gist "+e.file,"success"),d.lastStorageHost("GIST"),d.isDocumentDirty(!1),app.refreshWindowTitle()},n)}):(Swal.fire("Not configured","Your github settings are not configured","warning"),app.ui.openSettingsDialog())},openGist:function(e,t){const n=d.getFileType(t);d.loadData(e,n,!0),d.isDocumentDirty(!1),d.lastStorageHost("GIST"),d.editingPath(null),d.editingName(t),app.refreshWindowTitle()},tryOpenGist:function(e){if(e&&e.file&&e.file.length>0){const t="GIST"===d.lastStorageHost()?d.editingName():"";e.get(e.file).then(e=>{const n=e.body.files,i={};Object.keys(n).forEach(e=>{i[e]=e}),Swal.fire({title:"🐙 Open file from a gist",input:"select",inputOptions:i,inputAttributes:{autocomplete:"off"},inputValue:t,inputPlaceholder:"Select a file from the gist",showCancelButton:!0}).then(({value:e})=>{if(e){const t=n[e].content;d.openGist(t,e)}})})}else Swal.fire("Not configured","Your github settings are not configured","warning"),app.ui.openSettingsDialog()},tryOpenFolder:function(){d.openFileDialog(i("#open-folder"),d.openFolder)},tryAppend:function(){d.openFileDialog(i("#open-file"),d.appendFile)},save:function(){app.editingVisualStudioCodeFile()||(d.editingPath()?d.trySaveCurrent():d.trySave(a.FILETYPE.JSON))},trySave:function(e){d.getSaveData(e).then(t=>d.saveFileDialog(i("#save-file"),e,t))},trySaveCurrent:function(){if(d.isDocumentDirty())if("GIST"===d.lastStorageHost()){const e=app.gists;e.get(e.file).then(t=>{d.getSaveData(d.editingType()).then(t=>{d.getSaveData(d.editingType()),e.edit(e.file,{files:{[d.editingName()]:{content:t}}}),d.lastStorageHost("GIST"),d.isDocumentDirty(!1),app.refreshWindowTitle(),app.ui.toastMixin.fire({title:"Saved",text:`Saved ${d.editingName()} to Gist`})})})}else d.editingPath()?d.editingPath().length>0&&d.editingType().length>0&&d.getSaveData(d.editingType()).then(e=>{d.saveTo(d.editingPath(),e)}):app.gists&&app.gists.options.token?d.trySaveGist(app.gists):d.trySave(a.FILETYPE.JSON)},doesFileExist:function(e){return!1},triggerPasteClipboard:function(){if(app.electron){const e=app.electron.clipboard.readText();app.clipboard=e,document.execCommand("paste")}else navigator.clipboard&&navigator.clipboard.readText().then(e=>{app.clipboard=e}).catch(e=>{app.clipboard=app.editor.getSelectedText(),console.log("No clipboard access",e,"using local instead")}),setTimeout(()=>app.insertTextAtCursor(app.clipboard),100)},triggerCopyClipboard:function(){if(app.electron)app.electron.clipboard.writeText(app.editor.getSelectedText()),app.clipboard=app.editor.getSelectedText();else{const e=app.editor.getSelectedText();app.clipboard=e,navigator.clipboard&&e.length>0&&navigator.clipboard.writeText(e).then(()=>{app.clipboard=e})}},InkCompiler:function(){this.errors=[],this.warnings=[],this.errorHandler=(e,t)=>{let n=e.match(/^(ERROR|RUNTIME ERROR): ('([^']+)' )?line (\d+): (.*)/);let i=e.match(/^(WARNING|RUNTIME WARNING|TODO): ('([^']+)' )?line (\d+): (.*)/);n?this.errors.push(e):i&&this.warnings.push(e)},this.compilerOptions=new r.CompilerOptions(null,[],!1,this.errorHandler),this.ready=!1,this.worker=null,this.onComplete=()=>{},this.init=(e=(()=>{}))=>(this.onComplete=e,new Promise((e,t)=>{e()})),this.submit=e=>{this.errors=[],this.warnings=[];const t=new r.Compiler(e,this.compilerOptions).Compile().ToJson(),n={story:JSON.parse(t),warnings:this.warnings,errors:this.errors};this.onComplete(n)},this.getInkErrorGotoNode=async(e,t)=>{const n=t.substr(t.lastIndexOf(":")+1,t.length).trim();try{const e=Number(t.match(/line ([0-9]+):/)[1]);return{ln:e,node:(await d.getSaveData(a.FILETYPE.INK,e)).title,find:n}}catch(e){return console.error(e),null}}},InkGlobalScopeNodeName:"INK_GLOBAL_SCOPE",goToErrorInkNode:(e,t)=>{d.inkCompiler.getInkErrorGotoNode(e,t).then(e=>{if(e){const{node:t,ln:n,find:i}=e;app.openNodeByTitle(t,i)}})}}}).call(this,n("Z1dp"),n("EVdn"))},3:function(e,t){},"3ozf":function(e,t,n){},4:function(e,t){},5:function(e,t){},"5aMW":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s}));var i=n("tUqF"),o=n("qVgP");const{JSONEditor:a}=n("JGHU");var s=function({app:t,createButton:s,addSettingsItem:r,getPluginStore:l,onYarnEditorOpen:d,onYarnInPreviewMode:c,onYarnSavedNode:p,onYarnSetDocumentType:u,onKeyUp:g,onKeyDown:h,onLoad:m,setPluginStore:f}){const y=this;this.name="Runner",this.onOpenDialog=async()=>{let e=null;const{value:t}=await Swal.fire({title:"Playtest starting variables",html:'<div class="json-editor-wrapper"><div id="jsoneditor"/></div>',focusConfirm:!1,customClass:"swal-wide",onOpen:()=>{n("1mrn"),e=new a({id:"jsoneditor"});const t=l(y.name);console.log({editor:e}),e.setValue("object"!=typeof t.variables?[{key:"er",value:"erd"}]:t.variables),f(y.name,"runnerVariablesOpen",!0)},preConfirm:()=>(f(y.name,"runnerVariablesOpen",!1),e.getValue())});t&&f(y.name,"variables",t)},m(()=>{r({title:"Playtesting Style",valueKey:"playtestStyle",defaultValue:"chat",optionsKey:"availablePlaytestStyles",options:[{id:"npc",name:"Npc bubble"},{id:"chat",name:"Chat messages"}],setterKey:"setPlaytestStyle",settingsColumn:"A"}),s(y.name,{name:"Playtest variables",attachTo:"fileMenuDropdown",onClick:"onOpenDialog()",iconName:"cog"}),l(y.name).runnerVariablesOpen&&y.onOpenDialog()});const b=()=>{if("yarn"===t.settings.documentType())this.previewStory=new i.a,this.gotoLastPlayNode=function(){t.editing()&&t.editing().title()!==y.previewStory.node.title&&t.openNodeByTitle(y.previewStory.node.title),t.editor.focus()},this.advanceStoryPlayMode=function(e=5){y.previewStory.finished?(y.togglePlayMode(!1),y.gotoLastPlayNode()):(y.previewStory.changeTextScrollSpeed(e),-1!=y.previewStory.vnSelectedChoice&&5===e&&y.previewStory.vnSelectChoice())},this.togglePlayMode=function(n=!1){const i=e(".editor")[0],o=document.getElementById("storyPlayButton"),a=document.getElementById("editor-play");if(e("#editor-play").addClass("inYarnMode"),e("#commandDebugLabel").addClass("inYarnMode"),t.isEditorInPlayMode(n),n){i.style.display="none",e(".bbcode-toolbar").addClass("hidden"),a.style.display="flex",e(o).addClass("disabled"),y.previewStory.emiter.on("finished",(function(){y.togglePlayMode(!1),y.gotoLastPlayNode()})),y.previewStory.emiter.on("startedNode",(function(e){t.isEditorSplit&&t.workspace.warpToNode(t.getFirstFoundNode(e.title.toLowerCase().trim()))}));const n=l(y.name);console.log("variables",n),t.data.getSaveData("json").then(e=>{y.previewStory.initYarn(JSON.parse(e),t.editing().title().trim(),"NVrichTextLabel",!1,"commandDebugLabel",t.settings.playtestStyle(),n.variables||[])})}else t.editor.session.setScrollTop(a.scrollTop),a.style.display="none",i.style.display="flex",e(o).removeClass("disabled"),e(".bbcode-toolbar").removeClass("hidden"),e(".toggle-toolbar").removeClass("hidden"),e(".editor-counter").removeClass("hidden"),y.previewStory.terminate()},c(()=>y.togglePlayMode(!1)),p(()=>y.togglePlayMode(!1)),d(()=>{s(y.name,{iconName:"play",title:"Preview",attachTo:"bbcodeToolbar",onClick:"togglePlayMode(true)",className:"bbcode-button bbcode-button-right",id:"storyPlayButton"});const e=document.createElement("div");e.innerHTML=`\n    <div class="editor-play" id="editor-play" onpointerdown="app.plugins.${y.name}.advanceStoryPlayMode(30)" ondblclick="app.plugins.${y.name}.advanceStoryPlayMode()">\n        <p class="story-playtest-answer" id="NVrichTextLabel"></p>\n        <div id="commandDebugLabel"></div>\n    </div>\n  `,document.getElementById("editorContainer").appendChild(e),h(e=>{if(t.editing()&&!y.previewStory.finished)switch(e.keyCode){case t.input.keys.Z:y.previewStory.changeTextScrollSpeed(10),-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnSelectChoice();break;case t.input.keys.Up:-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnUpdateChoice(-1);break;case t.input.keys.Down:-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnUpdateChoice(1)}}),g(e=>{e.keyCode===t.input.keys.Z&&(y.previewStory.changeTextScrollSpeed(200),-1!=y.previewStory.vnSelectedChoice&&y.previewStory.vnSelectChoice())})});else{this.previewStory=new o.a,this.prevSession={story:null,prevSavePoints:[],childNodes:[],recompile:!1};const n=new t.data.InkCompiler;this.togglePlayMode=function(i=!1){const o=e(".editor")[0],a=document.getElementById("storyPlayButton"),s=document.getElementById("editor-play");if(t.isEditorInPlayMode(i),e("#editor-play").addClass("inInkMode"),e("#commandDebugLabel").addClass("inInkMode"),i){s.style.display="flex",e("#editor").addClass("editor-take-half"),y.previewStory.emiter.on("finished",(function(){y.togglePlayMode(!1),y.gotoLastPlayNode()})),y.previewStory.emiter.on("startedNode",(function(e){t.isEditorSplit&&t.workspace.warpToNode(t.getFirstFoundNode(e.title.toLowerCase().trim()))}));const i=l(y.name);console.log("VARIABLES::::",i),t.data.getSaveData("ink",null,!0).then(e=>{y.previewStory.initInk(n,()=>{y.prevSession={...y.prevSession,recompile:!0},y.togglePlayMode(!0)},y.prevSession,e,t.editing().title().trim(),"NVrichTextLabel",!1,"commandDebugLabel",t.settings.playtestStyle(),i.variables||[])})}else t.editor.session.setScrollTop(s.scrollTop),s.style.display="none",o.style.display="flex",e("#editor").removeClass("editor-take-half"),e(a).removeClass("disabled"),y.prevSession={prevSavePoints:y.previewStory.prevSavePoints,story:y.previewStory.story,childNodes:y.previewStory.textAreaEl?[...y.previewStory.textAreaEl.childNodes]:[],recompile:!1},y.previewStory.terminate();t.editor.resize()},c(()=>y.togglePlayMode(!1)),p(()=>y.togglePlayMode(!1)),this.advanceStoryPlayMode=function(e=5){},d(()=>{s(y.name,{iconName:"play",title:"Preview",attachTo:"bbcodeToolbar",onClick:"togglePlayMode(!app.isEditorInPlayMode())",className:"bbcode-button bbcode-button-right",id:"storyPlayButton"});const e=document.createElement("div");e.innerHTML=`\n    <div class="editor-play" id="editor-play" onpointerdown="app.plugins.${y.name}.advanceStoryPlayMode(30)" ondblclick="app.plugins.${y.name}.advanceStoryPlayMode()">\n        <p class="story-playtest-answer" id="NVrichTextLabel"></p>\n        <div id="commandDebugLabel"></div>\n    </div>\n  `,document.getElementById("editorContainer").appendChild(e)})}};b(),u(b),t.togglePlayMode=this.togglePlayMode}}).call(this,n("EVdn"))},"5dEm":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var i=n("oj90");const o=function(t){const n=this,o={toast:!0,position:"bottom",icon:"error",title:"Alignment requires two or more nodes be selected.",showConfirmButton:!1,timer:3500,timerProgressBar:!0};this.canvas=e(".arrows")[0],this.context=n.canvas.getContext("2d"),this.gridCanvas=e("#grid-canvas")[0],this.gridContext=n.gridCanvas.getContext("2d"),this.gridEnabled=!0,this.updateArrowsThrottle=50,this.updateArrowsInterval=void 0,this.deferredArrowsDrawInterval=void 0,this.nextArrowsUpdate=Number.NEGATIVE_INFINITY,this.isDrawingArrows=!1,this.selectedNodes=[],this.scale=1,this.offset={x:0,y:0},this.transform={x:0,y:0},this.isMarqueeEnabled=!1,this.marqueeSelection=[],this.marqueeRect={x1:0,y1:0,x2:0,y2:0},this.marqueeOffset=[0,0],this.zoomSpeed=.005,this.zoomLimitMin=.05,this.zoomLimitMax=1,this.setThrottle=function(e,t){const o=t?t.target.value:e;n.updateArrowsThrottle=i.Utils.clamp(o,16,250)},this.setTranslation=function(e,t,i=0){n.transform.x=e,n.transform.y=t,n.translate(i)},this.shiftTranslation=function(e,t,i=0){n.setTranslation(n.transform.x+e,n.transform.y+t,i)},this.translate=function(t){t&&n.startUpdatingArrows(),e(".nodes-holder").finish().transition({transform:"matrix("+n.scale+",0,0,"+n.scale+","+n.transform.x+","+n.transform.y+")"},t||0,"easeInQuad",(function(){t&&n.stopUpdatingArrows(),n.updateArrows(),n.updateGrid()}))},this.toWorkspaceCoordinates=(e,i)=>t.settings.snapGridEnabled()?{x:n.stepify((e-n.transform.x)/n.scale,t.settings.gridSize()),y:n.stepify((i-n.transform.y)/n.scale,t.settings.gridSize())}:{x:(e-n.transform.x)/n.scale,y:(i-n.transform.y)/n.scale},this.onPanLeft=function(){n.shiftTranslation(n.getPanAmount(),0,100)},this.onPanRight=function(){n.shiftTranslation(-n.getPanAmount(),0,100)},this.onPanUp=function(){n.shiftTranslation(0,n.getPanAmount(),100)},this.onPanDown=function(){n.shiftTranslation(0,-n.getPanAmount(),100)},this.getPanAmount=function(){return t.input.isShiftDown?100*n.scale:500*n.scale},this.setZoom=function(e){n.scale=e/4,n.translate(200)},this.onZoom=function(e,t,o){const a=n.scale,s=o*n.zoomSpeed*n.scale;n.scale=i.Utils.clamp(n.scale+s,n.zoomLimitMin,n.zoomLimitMax);const r=e-n.transform.x,l=t-n.transform.y,d=r-r*(n.scale/a),c=l-l*(n.scale/a);n.shiftTranslation(d,c)},this.onDragStart=function(e){n.offset.x=e.x,n.offset.y=e.y},this.onDragUpdate=function(e){n.isMarqueeEnabled&&t.workspace.onMarqueeEnd(),t.workspace.shiftNodes(e)},this.onDragEnd=function(){t.data.saveAppStateToLocalStorage()},this.onMarqueeStart=function(e){n.isMarqueeEnabled=!0,n.offset.x=e.x,n.offset.y=e.y,n.marqueeSelection=[],n.marqueeOffset[0]=0,n.marqueeOffset[1]=0,n.marqueeRect={x1:0,y1:0,x2:0,y2:0}},this.onMarqueeUpdate=function(e){n.isMarqueeEnabled&&(n.updateMarqueeRect(e),n.selectNodesInsideMarquee())},this.updateMarqueeRect=function(t){t.x>n.offset.x&&t.y<n.offset.y?(n.marqueeRect.x1=n.offset.x,n.marqueeRect.y1=t.y,n.marqueeRect.x2=t.x,n.marqueeRect.y2=n.offset.y):t.x>n.offset.x&&t.y>n.offset.y?(n.marqueeRect.x1=n.offset.x,n.marqueeRect.y1=n.offset.y,n.marqueeRect.x2=t.x,n.marqueeRect.y2=t.y):t.x<n.offset.x&&t.y<n.offset.y?(n.marqueeRect.x1=t.x,n.marqueeRect.y1=t.y,n.marqueeRect.x2=n.offset.x,n.marqueeRect.y2=n.offset.y):(n.marqueeRect.x1=t.x,n.marqueeRect.y1=n.offset.y,n.marqueeRect.x2=n.offset.x,n.marqueeRect.y2=t.y),e("#marquee").css({display:"block",x:n.marqueeRect.x1,y:n.marqueeRect.y1,width:Math.abs(n.marqueeRect.x1-n.marqueeRect.x2),height:Math.abs(n.marqueeRect.y1-n.marqueeRect.y2)})},this.selectNodesInsideMarquee=function(){const e=n.toWorkspaceCoordinates(n.marqueeRect.x1,n.marqueeRect.y1),o=n.toWorkspaceCoordinates(n.marqueeRect.x2,n.marqueeRect.y2),a={left:e.x,right:o.x,top:e.y,bottom:o.y};t.nodes().forEach(e=>{const t=n.marqueeSelection.indexOf(e),o=t>=0,s=e.x(),r=e.y(),l={left:s,right:s+e.width,top:r,bottom:r+e.height},d=i.Utils.rectanglesOverlap(a,l);d&&!o&&(n.selectNodes(e),n.marqueeSelection.push(e)),!d&&o&&(n.deselectNodes(e),n.marqueeSelection.splice(t,1))})},this.onMarqueeEnd=function(){n.isMarqueeEnabled&&(0==n.marqueeSelection.length&&n.deselectAll(),n.isMarqueeEnabled=!1,n.marqueeSelection=[],n.marqueeRect={x1:0,y1:0,x2:0,y2:0},e("#marquee").css({display:"none",x:0,y:0,width:0,height:0}))},this.shiftNodes=function(e){const t={x:e.x-n.offset.x,y:e.y-n.offset.y};n.shiftTranslation(t.x,t.y),n.offset=e},this.updateGrid=function(){const i=e(".nodes-holder").offset(),o=t.settings.gridSize();if(n.gridContext.clearRect(0,0,n.gridCanvas.width,n.gridCanvas.height),t.settings.snapGridEnabled()){const r=e(window).width(),l=e(window).height(),d=i.left%(o*n.scale),c=i.top%(o*n.scale);n.gridContext.beginPath(),n.gridContext.lineWidth=.5;for(var a=d;a<r;a+=o*n.scale)n.gridContext.moveTo(a,0),n.gridContext.lineTo(a,l);for(var s=c;s<l;s+=o*n.scale)n.gridContext.moveTo(0,s),n.gridContext.lineTo(r,s);if(n.gridContext.stroke(),n.gridContext.closePath(),"blueprint"===t.settings.theme()){n.gridContext.beginPath(),n.gridContext.lineWidth=.25;const e=16,t=200,d=Math.round(Math.min(1,o/t)*e),c=Math.max(1,Math.round(n.scale*d)),p=o*n.scale/c,u=i.left%p,g=i.top%p;for(a=u;a<r;a+=p)n.gridContext.moveTo(a,0),n.gridContext.lineTo(a,l);for(s=g;s<l;s+=p)n.gridContext.moveTo(0,s),n.gridContext.lineTo(r,s);n.gridContext.stroke(),n.gridContext.closePath()}}},this.startUpdatingArrows=function(){n.stopUpdatingArrows(),n.updateArrowsInterval=setInterval(n.updateArrows,n.updateArrowsThrottle)},this.stopUpdatingArrows=function(){n.updateArrowsInterval&&(window.clearInterval(n.updateArrowsInterval),n.updateArrowsInterval=void 0)},this.updateArrows=function(){if(n.isDrawingArrows)return;const i=(new Date).getTime();if(i<n.nextArrowsUpdate)return void(n.deferredArrowsDrawInterval||(n.deferredArrowsDrawInterval=window.setTimeout(n.updateArrows,n.nextArrowsUpdate+n.updateArrowsThrottle-i)));n.isDrawingArrows=!0,window.clearInterval(n.deferredArrowsDrawInterval),n.deferredArrowsDrawInterval=void 0,n.nextArrowsUpdate=i+n.updateArrowsThrottle;const o=t.nodes(),a=e(".nodes-holder").offset(),s=n.scale,r=3*s,l=8*s,d=8*s,c=[],p=[];n.canvas.width=e(window).width(),n.canvas.height=e(window).height(),n.context.lineWidth=r,n.context.strokeStyle=n.context.fillStyle=e(".arrows").css("color");for(let n of o)if(n.halfWidth=e(n.element).width()/2,n.halfHeight=e(n.element).height()/2,n.linkedTo().length)if("straight"===t.settings.lineStyle()){const e=(n.x()+n.halfWidth)*s+a.left,t=(n.y()+n.halfHeight)*s+a.top;for(let i of n.linkedTo()){const n=(i.x()+i.halfWidth)*s+a.left,o=(i.y()+i.halfHeight)*s+a.top,r=Math.sqrt((e-n)*(e-n)+(t-o)*(t-o)),u={x:(n-e)/r,y:(o-t)/r},g=(110+160*(1-Math.max(Math.abs(u.x),Math.abs(u.y))))*s,h={x:e+u.x*g,y:t+u.y*g},m={x:n-u.x*g,y:o-u.y*g};c.push({x1:h.x,y1:h.y,x2:m.x,y2:m.y}),p.push({x1:m.x+10*u.x,y1:m.y+10*u.y,x2:m.x-u.x*l-u.y*d,y2:m.y-u.y*l+u.x*d,x3:m.x-u.x*l+u.y*d,y3:m.y-u.y*l-u.x*d})}}else for(let e of n.linkedTo()){const t=(n.x()+n.halfWidth)*s+a.left,i=(n.y()+n.halfHeight)*s+a.top,o=(e.x()+e.halfWidth)*s+a.left,r=(e.y()+e.halfHeight)*s+a.top,g=(360-180*Math.atan2(r-i,o-t)/Math.PI)%360;let h,m,f,y;var u=!1;g<=45||g>=315?(u=!0,h=(n.x()+n.width)*s+a.left,m=(n.y()+n.halfHeight)*s+a.top,f=e.x()*s+a.left-l,y=(e.y()+e.halfHeight)*s+a.top,p.push({x1:f+l,y1:y,x2:f-l,y2:y-d,x3:f-l,y3:y+d})):g>45&&g<135?(u=!1,h=(n.x()+n.halfWidth)*s+a.left,m=n.y()*s+a.top,f=(e.x()+e.halfWidth)*s+a.left,y=(e.y()+n.height)*s+a.top+d,p.push({x1:f,y1:y-d,x2:f-l,y2:y+d,x3:f+l,y3:y+d})):g>=135&&g<=225?(u=!0,h=n.x()*s+a.left,m=(n.y()+n.halfHeight)*s+a.top,f=(e.x()+e.width)*s+a.left+l,y=(e.y()+e.halfHeight)*s+a.top,p.push({x1:f-l,y1:y,x2:f+l,y2:y-d,x3:f+l,y3:y+d})):g>225&&g<315&&(u=!1,h=(n.x()+n.halfWidth)*s+a.left,m=(n.y()+n.height)*s+a.top,f=(e.x()+e.halfWidth)*s+a.left,y=e.y()*s+a.top-d,p.push({x1:f,y1:y+d,x2:f-l,y2:y-d,x3:f+l,y3:y-d})),c.push({x1:h,y1:m,x2:f,y2:y,drawHorizontal:u})}n.context.beginPath();for(let e of c)n.context.moveTo(e.x1,e.y1),"straight"===t.settings.lineStyle()?n.context.lineTo(e.x2,e.y2):!0===e.drawHorizontal?n.context.bezierCurveTo(e.x2,e.y1,e.x1,e.y2,e.x2,e.y2):n.context.bezierCurveTo(e.x1,e.y2,e.x2,e.y1,e.x2,e.y2);n.context.stroke(),n.context.beginPath();for(let e of p)n.context.moveTo(e.x1,e.y1),n.context.lineTo(e.x2,e.y2),n.context.lineTo(e.x3,e.y3);n.context.fill(),n.isDrawingArrows=!1},this.bringToFront=function(t){const n=e(t),o=i.Utils.getHighestZ(n.parent());n.css("z-index",o+1)},this.selectAll=function(){n.selectNodes(t.nodes())},this.deselectAll=function(){n.deselectNodes(t.nodes())},this.selectNodes=function(e){const i=Array.isArray(e)?e:[e];for(let e of i)if(e.active()&&!n.selectedNodes.includes(e)&&t.canEditNodeMeta(e.title())){if(t.input.isScreenTouched&&t.input.isDragging)return;n.selectedNodes.push(e),e.setSelected(!0)}},this.deselectNodes=function(e){const t=Array.isArray(e)?e:[e];for(let e of t){const t=n.selectedNodes.indexOf(e);e.active()&&t>=0&&(n.selectedNodes.splice(t,1),e.setSelected(!1))}},this.getSelectedNodes=function(){return 1===n.selectedNodes.length?[n.selectedNodes[0]]:Array.apply(this,n.selectedNodes)},this.warpToNodeByIdx=function(e){n.warpToNode(t.nodes()[e]),t.focusedNodeIdx=e},this.warpToSelectedNodeByIdx=function(e){n.warpToNode(n.getSelectedNodes()[e]),t.focusedNodeIdx=e},this.warpToNode=function(t){if(t){var i=e(t.element);n.warpToXY(t.x()||t.createX,t.y()||t.createY),i.clearQueue(),i.transition({outlineColor:"pink",outlineWidth:2,outlineOffset:0},500),setTimeout(()=>{i.transition({outlineColor:"transparent",outlineWidth:1,outlineOffset:50},300)},700)}},this.warpToXY=function(i,o){const a=-i*n.scale,s=-o*n.scale,r=e(window).width()/2,l=e(window).height()/2,d=100*n.scale/2,c=100*n.scale/2;n.setTranslation(a+r-d+t.getSplitEditorXOffset(),s+l-c,100)},this.alignV=function(){if(t.input.isCtrlDown)return void n.reduceAlignV();const e=t.nodes().filter(e=>e.selected).sort((e,t)=>e.y()>t.y()?1:e.y()<t.y()?-1:0);if(e.length<2)return void Swal.fire(o);const i=e.shift();e.forEach((e,t)=>{e.moveTo(i.x(),e.y())})},this.reduceAlignV=function(){const e=t.settings.gridSize(),i=t.nodes().filter(e=>e.selected).sort((e,t)=>e.y()>t.y()?1:e.y()<t.y()?-1:0);if(i.length<2)return void Swal.fire(o);const a=i.shift();t.settings.snapGridEnabled()&&a.moveTo(n.stepify(a.x(),t.settings.gridSize()),n.stepify(a.y(),t.settings.gridSize()));const s=e-(a.y()+a.height)%e+e;i.forEach((e,n)=>{const i=t.settings.snapGridEnabled()?a.y()+e.height*(n+1)+s*(n+1):a.y()+210*(n+1);e.moveTo(a.x(),i)})},this.alignH=function(){if(t.input.isCtrlDown)return void n.reduceAlignH();const e=t.nodes().filter(e=>e.selected).sort((e,t)=>e.x()>t.x()?1:e.x()<t.x()?-1:0);if(e.length<2)return void Swal.fire(o);const i=e.shift();e.forEach((e,t)=>{e.moveTo(e.x(),i.y())})},this.reduceAlignH=function(){const e=t.settings.gridSize(),i=t.nodes().filter(e=>e.selected).sort((e,t)=>e.x()>t.x()?1:e.x()<t.x()?-1:0);if(i.length<2)return void Swal.fire(o);const a=i.shift();t.settings.snapGridEnabled()&&a.moveTo(n.stepify(a.x(),e),n.stepify(a.y(),e));const s=e-(a.x()+a.width)%e+e;i.forEach((e,n)=>{const i=t.settings.snapGridEnabled()?a.x()+e.width*(n+1)+s*(n+1):a.x()+210*(n+1);e.moveTo(i,a.y())})},this.arrangeSpiral=function(){const e=n.getSelectedNodes();e.length<2?Swal.fire(o):(e.forEach((e,i)=>{e.moveTo(t.settings.snapGridEnabled()?n.stepify(Math.cos(.5*i)*(600+30*i),t.settings.gridSize()):Math.cos(.5*i)*(600+30*i),t.settings.snapGridEnabled()?n.stepify(Math.sin(.5*i)*(600+30*i),t.settings.gridSize()):Math.cos(.5*i)*(600+30*i))}),n.warpToXY(0,0))},this.sortAlphabetical=function(){const i=n.getSelectedNodes().sort((e,t)=>e.title().localeCompare(t.title()));if(i.length<2)return void Swal.fire(o);let a=Math.round(i.length/2),s=0,r=0;const l=e(i[0].element).width()+30,d=e(i[0].element).height()+30,c=t.settings.gridSize();t.settings.snapGridEnabled()&&i[0].moveTo(n.stepify(i[0].x(),c),n.stepify(i[0],c)),i.forEach((e,n)=>{n%a?s+=1:(r+=1,s=0),1===n&&(r=0);const o=i[0].x()+i[0].width,p=c-o%c+c,u=i[0].y()+i[0].height,g=c-u%c+c;e.moveTo(t.settings.snapGridEnabled()?i[0].x()+s*e.width+s*p:i[0].x()+s*l,t.settings.snapGridEnabled()?i[0].y()+r*e.height+r*g:i[0].y()+r*d)}),n.warpToNode(i[0])},this.stepify=function(e,t){return Math.round(e/t)*t}}}).call(this,n("EVdn"))},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},INAQ:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return a}));var o=n("oj90");const a=function(t){const n=this,a=Object.freeze({Left:0,Middle:1,Right:2}),s=Object.freeze({Enter:13,Escape:27,Space:32,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,C:67,D:68,O:79,S:83,V:86,W:87,X:88,Y:89,Z:90});this.keys=s,this.mouse={x:0,y:0},this.isDragging=!1,this.isScreenTouched=!1,this.isMiddleButtonDown=!1,this.isLeftButtonDown=!1,this.isShiftDown=!1,this.isCtrlDown=!1,this.isHoverOverWorkspace=!1,this.trackMouseEvents=function(){e(document).on("pointerdown",e=>{if(n.isDragging="nodes"===e.target.className||"body"===e.target.className&&(n.isMiddleButtonDown||0===t.workspace.selectedNodes.length),n.mouse.x=e.pageX,n.mouse.y=e.pageY,n.isMiddleButtonDown=e.button===a.Middle,this.isLeftButtonDown=e.button===a.Left,t.inWorkspace()){if(n.isDragging)switch(e.button){case a.Left:"nodes"===e.target.className&&t.workspace.onMarqueeStart({x:e.pageX,y:e.pageY});break;case a.Middle:t.workspace.onDragStart({x:e.pageX,y:e.pageY})}}else t.inEditor()&&e.button===a.Right&&(t.guessPopUpHelper(),e.preventDefault())}),window.addEventListener("touchstart",()=>{n.isScreenTouched=!0}),e(document).on("pointermove",e=>{n.mouse.x=e.pageX,n.mouse.y=e.pageY}),e(document).on("mousemove touchmove",e=>{if(n.isDragging){t.focusedNodeIdx=-1;const i=n.isScreenTouched&&e.changedTouches?e.changedTouches[0].pageX:e.pageX,o=n.isScreenTouched&&e.changedTouches?e.changedTouches[0].pageY:e.pageY;t.inWorkspace()&&(e.altKey||n.isMiddleButtonDown||n.isScreenTouched?t.workspace.onDragUpdate({x:i,y:o}):t.workspace.onMarqueeUpdate({x:i,y:o}))}}),e(document).on("pointerup touchend",e=>{n.isScreenTouched=!1,n.isDragging=!1,e.button===a.Left&&(n.isLeftButtonDown=!1),e.button===a.Middle&&(n.isMiddleButtonDown=!1),t.inWorkspace()&&(t.workspace.onDragEnd(),t.workspace.onMarqueeEnd())}),e(".nodes").mousewheel(e=>{e.altKey||(t.inWorkspace()||n.isHoverOverWorkspace)&&(t.workspace.onZoom(e.pageX,e.pageY,e.deltaY),e.preventDefault())}),e(".nodes").hover(()=>{n.isHoverOverWorkspace=!0},()=>{n.isHoverOverWorkspace=!1}),e(".nodes").on("pointerdown",()=>{t.isEditorSplit&&(t.focusEditor(!1),t.makeNewNodesFromLinks(),t.propagateUpdateFromNode(t.editing()),t.mustUpdateTags=!0,t.updateTagsRepository(),t.workspace.updateArrows())}),e(document).contextmenu(n=>{if(!t.inWorkspace())return;const i=e(n.target).hasClass("nodes")||e(n.target).parents(".nodes").length;if(n.button===a.Right&&i){const{x:e,y:i}=t.workspace.toWorkspaceCoordinates(n.pageX,n.pageY);t.newNodeAt(e,i)}return!i})},this.trackKeyboardEvents=function(){e(document).on("keyup keydown",e=>{n.isShiftDown=e.shiftKey,n.isCtrlDown=e.ctrlKey}),e(document).on("keyup",(function(e){if(e.keyCode===s.Space){if(t.inWorkspace()&&e.altKey||t.inEditor()&&!e.altKey)return;t.workspace.scale=1;const n=t.workspace.getSelectedNodes(),i=n.length>0,o=i>0?n:t.nodes();++t.focusedNodeIdx,(t.focusedNodeIdx<0||t.focusedNodeIdx>=o.length)&&(t.focusedNodeIdx=0),t.inWorkspace()?i?t.workspace.warpToSelectedNodeByIdx(t.focusedNodeIdx):t.workspace.warpToNodeByIdx(t.focusedNodeIdx):t.inEditor()&&t.editNode(t.nodes()[t.focusedNodeIdx])}})),e(document).on("keydown",e=>{if(t.inWorkspace()){if((e.metaKey||e.ctrlKey)&&e.shiftKey)switch(e.keyCode){case s.S:t.data.trySave(o.FILETYPE.JSON);break;case s.A:t.data.tryAppend()}if((e.metaKey||e.ctrlKey)&&e.altKey)switch(e.keyCode){case s.S:t.data.trySaveCurrent()}else if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.C:t.nodeClipboard=t.cloneNodeArray(t.workspace.getSelectedNodes());break;case s.D:t.workspace.deselectAll();break;case s.O:t.data.tryOpenFile();break;case s.S:t.data.trySaveCurrent();break;case s.X:const e=t.workspace.getSelectedNodes();t.nodeClipboard=t.cloneNodeArray(e),t.deleteNodes(e);break;case s.Y:t.historyDirection("redo");break;case s.Z:t.historyDirection("undo")}else e.keyCode===s.Delete||"Delete"===e.key?t.confirmDeleteNodes(t.workspace.getSelectedNodes()):t.$searchField.is(":focus")||e.ctrlKey||e.metaKey||(e.keyCode===s.A||e.keyCode===s.Left?t.workspace.onPanLeft():e.keyCode===s.D||e.keyCode===s.Right?t.workspace.onPanRight():e.keyCode===s.W||e.keyCode===s.Up?t.workspace.onPanUp():e.keyCode!==s.S&&e.keyCode!==s.Down||t.workspace.onPanDown())}}),e(document).on("keyup",e=>{if(t.inWorkspace())if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.A:t.workspace.selectAll();break;case s.V:t.pasteNodes()}else if(e.keyCode===s.Enter||"Enter"===e.key){const e=t.nodes()[t.focusedNodeIdx];e?t.editNode(e):t.editNode(t.nodes()[0])}}),e(document).on("keydown",(function(e){if(t.inEditor())if(e.metaKey||e.ctrlKey)switch(e.keyCode){case s.C:n.clipboard=t.editor.getSelectedText();break;case s.X:document.execCommand("copy"),t.clipboard=t.editor.getSelectedText(),t.insertTextAtCursor("");break;case s.S:t.data.trySaveCurrent()}else switch(e.keyCode){case s.Escape:t.saveNode(),t.closeEditor()}})),e(document).on("keyup",(function(e){if(t.inEditor()&&(e.metaKey||e.ctrlKey)&&e.altKey)switch(e.keyCode){case s.Enter:t.saveNode(),t.closeEditor()}})),e(document).on("keydown",(function(e){if(t.ui.settingsDialogVisible())switch(e.keyCode){case s.Escape:t.ui.closeSettingsDialog()}})),e(document).on("keyup keydown pointerdown pointerup",(function(e){t.inEditor()&&t.updateEditorStats()}))},this.initKnockoutBindings=function(){i.bindingHandlers.preventBubble={init:function(e,t){var n=i.utils.unwrapObservable(t());i.utils.registerEventHandler(e,n,(function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}))}},i.bindingHandlers.mousedown={init:function(t,n,o,a,s){var r=i.unwrap(n());e(t).mousedown((function(){r()}))}}};n.initKnockoutBindings(),n.trackMouseEvents(),n.trackKeyboardEvents()}}).call(this,n("EVdn"),n("Z1dp"))},JGHU:function(e,t,n){"use strict";n.r(t),function(e,i){n.d(t,"JSONEditor",(function(){return o}));var o=function({id:t}){this.tableAdd=({key:t,value:n})=>{var i=this.table.find("tr.hide").clone(!0).removeClass("hide table-line");t&&n&&(console.log("mutate",{key:t,value:n,html:i.html()}),i.html(`\n                <td contenteditable="true" class="cell">${t}</td>\n                <td contenteditable="true" class="cell">${n}</td>\n                <td>\n                    <span class="table-remove glyphicon glyphicon-remove">x delete</span>\n                </td>\n            `),e(".table-remove").on("click",(function(){e(this).parents("tr").detach()}))),this.table.find("table").append(i)},this.getValue=()=>{var t=this.table.find("tr:not(:hidden)"),n=[],i=[];return e(t.shift()).find("th:not(:empty):not([data-attr-ignore])").each((function(){n.push(e(this).text().toLowerCase())})),t.each((function(){var t=e(this).find("td"),o={};n.forEach((function(e,n){o[e]=t.eq(n).text()})),i.push(o)})),i},this.init=()=>{document.getElementById(t).innerHTML='\n        <div class="container">\n  <div id="table" class="table-editable">\n    <table class="table">\n        <tr class="table-header">\n            <th>Key</th>\n            <th>Value</th>\n            <th data-attr-ignore>Remove</th>\n        </tr>\n\n\n      \x3c!-- This is our clonable table line --\x3e\n      <tr class="hide" class="editable-row">\n        <td contenteditable="true" class="cell">key</td>\n        <td contenteditable="true" class="cell">val</td>\n        <td>\n          <span class="table-remove glyphicon glyphicon-remove">x delete</span>\n        </td>\n      </tr>\n    </table>\n\n    <div class="table-footer">\n        <button id="save-btn" class="btn btn-primary">Save Data</button>\n        <p id="save"></p>\n        <span class="table-add glyphicon glyphicon-plus">+ add</span>\n    </div>\n  </div>\n</div>\n        ';var n=e("#table"),o=e("#save-btn");this.table=n,this.rows=n.find("tr:not(:hidden)"),e("#save-btn").addClass("hide"),e(".table-add").on("click",this.tableAdd),e(".table-remove").on("click",(function(){console.log({removeThis:this}),e(this).parents("tr").detach()})),i.fn.pop=[].pop,i.fn.shift=[].shift,o.on("click",this.getValue)},this.init(),this.setValue=(e=[])=>{e.forEach(this.tableAdd)}}}.call(this,n("EVdn"),n("EVdn"))},P0sH:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return g}));var o=n("owJe"),a=n("W2Rx"),s=n("5dEm"),r=n("INAQ"),l=n("pYPP"),d=n("fkuv"),c=n("2Qx2"),p=n("oj90"),u=n("l8+o"),g=function(t,g){const h=this;this.utils=p.Utils,this.setTheme=function(t,n){let i=n?n.target.value:t;setTimeout(h.initGrid,50),setTimeout(h.workspace.updateArrows,50),e("#theme-stylesheet").attr("href",p.Utils.getPublicPath(`themes/${i}.css`))},this.setLanguage=function(e,t){const n=t?t.target.value:e;Object(o.load_dictionary)(h.settings.language().split("-")[0]);const i=new CustomEvent("yarnSetLanguage");i.language=n,window.dispatchEvent(i),window.parent.dispatchEvent(i)},this.setDocumentType=function(e,t){const n=t?t.target.value:e;h.settings.documentType(n),console.log("Set doc type",e,app.data.inkCompiler),"ink"===n?(null===app.data.inkCompiler&&(app.data.inkCompiler=new app.data.InkCompiler),c.a.addGlobalScopeToInkDoc(),app.setMarkupLanguage("html")):app.data.inkCompiler=null,app.updateNodeLinks();const i=new CustomEvent("yarnSetDocumentType");i.language=n,window.dispatchEvent(i),window.parent.dispatchEvent(i)},this.setMarkupLanguage=function(e,t){const n=t?t.target.value:e;app.settings.markupLanguage(n),h.richTextFormatter=new u.a(h),h.mustRefreshNodes.notifySubscribers()},this.setFiletypeVersion=function(e,t){const n=t?t.target.value:e;h.filetypeVersion=n},this.setGistCredentials=function(e,t){const{token:i,file:o}=e,a=new(n("XZLo"))({token:i});h.gists=a,h.gists.file=o},this.input=new r.a(h),this.settings=new l.a(h),this.workspace=new s.a(h),this.ui=new d.a(h),this.richTextFormatter=new u.a(h),this.data=c.a,this.name=i.observable(t),this.version=i.observable(g),this.editing=i.observable(null),this.nodes=i.observableArray([]),this.tags=i.observableArray([]),this.mustRefreshNodes=i.observable(),this.mustUpdateTags=!0,this.nodeHistory=[],this.nodeFuture=[],this.editingHistory=[],this.editingSaveHistoryTimeout=null,this.focusedNodeIdx=-1,this.isElectron=!1,this.editor=null,this.nodeVisitHistory=[],this.plugins={pluginStorage:{}},this.clipboard="",this.nodeClipboard=[],this.speachInstance=null,this.editingPath=i.observable(null),this.$searchField=e(".search-field"),this.isEditorInPreviewMode=!1,this.isEditorInPlayMode=i.observable(!1),this.isEditorSplit=!1,this.isEditorFocused=!1,this.editorResizeHandleOptions={handleSelector:"#editor-resize-handle",resizeHeight:!1,resizeWidthFrom:"right",onDragStart:function(){h.isSplitEditorInFocus=!0,e("#node-editor").removeClass("split-editor-out-of-focus")},onDragEnd:function(){h.editor.resize(),h.settings.editorSplitSize(e("#editor-form").width())}},this.inEditor=()=>(h.editing()||h.isEditorSplit&&h.isEditorFocused)&&!h.ui.isDialogOpen(),this.inWorkspace=()=>(!h.editing()||h.isEditorSplit&&!1===h.isEditorFocused)&&!h.ui.isDialogOpen(),this.run=function(){var t="Unknown OS";-1!=navigator.platform.indexOf("Win")&&(t="Windows"),-1!=navigator.platform.indexOf("Mac")&&(t="MacOS"),-1!=navigator.platform.indexOf("X11")&&(t="UNIX"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),h.isElectron=navigator.userAgent.toLowerCase().includes("electron");var n=navigator.userAgent||navigator.vendor||window.opera;let o;/android|iPad|iPhone|iPod/.test(n.toLowerCase())&&!window.MSStream&&(t="mobile"),"Windows"==t&&(h.workspace.zoomSpeed=.1),window.addEventListener("beforeunload",e=>(this.data.saveAppStateToLocalStorage(),null)),window.addEventListener("DOMContentLoaded",e=>{if(h.electron){const e=h.electron.remote.process.argv.length>1?h.electron.remote.process.argv[1]:null;if(e&&app.fs.existsSync(e))return void this.data.openFileFromFilePath(e)}this.data.loadAppStateFromLocalStorage();const t=new URL(window.location),n=t.searchParams.get("text")||t.searchParams.get("url");null!==n&&h.insertTextAtCursor(n+"\n",!0)});const a=e("#addPwa")[0];a.style.display="none",window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),o=e,a.style.display="block",a.addEventListener("click",e=>{a.style.display="none",o.prompt(),o.userChoice.then(e=>{"accepted"===e.outcome?(console.log("User accepted the A2HS prompt"),a.style.display="none"):console.log("User dismissed the A2HS prompt"),o=null})})}),e("#app").show(),i.applyBindings(h,e("#app")[0]),h.editingVisualStudioCodeFile()||h.newNode().title("Start"),h.settings.apply(),e(".search-title input").click(h.updateSearch),e(".search-body input").click(h.updateSearch),e(".search-tags input").click(h.updateSearch),h.$searchField.on("input",h.updateSearch),h.$searchField.on("keyup",(function(e){27==e.keyCode?h.clearSearch():h.searchWarp()})),"mobile"===t&&h.workspace.setZoom(3),e(window).on("resize",(function(){h.ui.isScreenNarrow()&&h.editing()&&h.isEditorSplit&&h.toggleEditorView(),h.workspace.updateArrows(),h.initGrid()})),setTimeout(h.initGrid,50),this.guessPopUpHelper=function(){/color=#([a-zA-Z0-9]{3,6})$/.test(h.getTagBeforeCursor())&&h.insertColorCode()},this.insertEmoji=function(){this.emPicker.toggle(),h.togglePreviewMode(!0),e("#emojiPicker-container").css({left:h.input.mouse.x-200,top:h.input.mouse.y-125}),e("#emojiPicker-container").show()},this.insertColorCode=function(){e("#colorPicker-container").is(":visible")||(e("#colorPicker").spectrum("set",h.editor.getSelectedText()),e("#colorPicker").spectrum("toggle"),e("#colorPicker-container").css({left:h.input.mouse.x-70,top:h.input.mouse.y-50}),e("#colorPicker-container").show(),h.togglePreviewMode(!0),setTimeout(()=>{const t=e("#colorPicker").spectrum("get");h.applyPickerColorEditor(t)},100))},this.applyPickerColorEditor=function(e){const t=JSON.parse(JSON.stringify(h.editor.selection.getRange()));h.editor.selection.setRange(t);const n=e.toHexString().replace("#","");h.editor.session.replace(t,n),h.editor.selection.setRange({start:h.editor.getCursorPosition(),end:{row:h.editor.getCursorPosition().row,column:h.editor.getCursorPosition().column-n.length}}),h.togglePreviewMode(!0)},document.addEventListener("contextmenu",(function(e){h.editing()&&e.preventDefault()}),!1),document.ondragover=document.ondrop=e=>{e.preventDefault()},document.body.ondrop=e=>{e.preventDefault();for(var t=0;t<e.dataTransfer.files.length;t++)c.a.appendFile(e.dataTransfer.files[t],e.dataTransfer.files[t].name,!1)},window.addEventListener("message",e=>{const t=e.data;switch(t.type){case"UpdateNode":h.nodes().forEach(e=>{e.title().trim()===t.payload.originalNodeTitle.trim()&&(e.title(t.payload.title),e.tags(t.payload.tags),e.body(t.payload.body),h.setYarnDocumentIsDirty())})}});var s=new CustomEvent("yarnReady");s.document=document,s.data=c.a,s.app=this,window.dispatchEvent(s),window.parent.dispatchEvent(s);const r=new URLSearchParams(window.location.href.split("?")[1]),l=r.get("gist"),d=r.get("fileName");l&&d&&fetch("https://api.github.com/gists/"+l).then(e=>e.json()).then(e=>{const t=e.files[d].content;c.a.openGist(t,d)})},this.limitNodesUpdate=function(e){h.nodes.extend({rateLimit:{method:"notifyWhenChangesStop",timeout:250}}),e(),h.nodes.limit(e=>()=>e())},this.getNodesConnectedTo=function(e){var t=[],n=h.nodes();for(var i in n)if(n[i]!=e&&n[i].isConnectedTo(e,!0)){var o=!1;for(var a in t)if(t[a]==n[i]){o=!0;break}o||t.push(n[i])}return t},this.matchConnectedColorID=function(e){var t=h.getNodesConnectedTo(e);for(var n in t)t[n].colorID(e.colorID())},this.quit=function(){h.isElectron},this.canEditNodeMeta=function(e){return"ink"!==app.settings.documentType()||e.trim()!==c.a.InkGlobalScopeNodeName},this.sanitiseNodeTitle=function(){"ink"===app.settings.documentType()&&(app.editing().title().startsWith("function ")||app.editing().title(app.editing().title().replace(/[ ]/g,"_")))},this.validateTitle=function(){var t=document.getElementById("editorTitle").value,n=e("#editorTitle");h.getOtherNodeTitles().includes(t)||h.titleExistsTwice(t)?(n.attr("class","title title-error"),n.attr("title","Another node has the same title")):"yarn"!==app.settings.documentType()||RegExp("^[a-z0-9]+$","i").test(t)?(n.removeAttr("title"),n.removeClass("title-error")):(n.attr("class","title title-error"),n.attr("title","Only upper or lower case letters and numbers are allowed in a node title."))},this.refreshWindowTitle=function(){let e="";"LOCAL"===c.a.lastStorageHost()?e="Yarn - "+(c.a.editingPath()||c.a.editingName())+" "+(c.a.isDocumentDirty()?"*":""):"GIST"===c.a.lastStorageHost()&&(e="Gist - "+(c.a.editingPath()||c.a.editingName())+" "+(c.a.isDocumentDirty()?"*":"")),h.electron?h.electron.remote.getCurrentWindow().setTitle(e):document.title=e},this.usingVisualStudioCodeExtension=function(){return!!window.vsCodeApi},this.editingVisualStudioCodeFile=function(){return!0===window.editingVsCodeFile},this.setYarnDocumentIsDirty=function(){h.usingVisualStudioCodeExtension()&&h.editingVisualStudioCodeFile()&&c.a.getSaveData(c.a.editingType()).then(e=>{window.vsCodeApi.postMessage({type:"DocumentEdit",payload:e})})},this.recordNodeAction=function(e,t){if(h.nodeFuture.length>0){for(var n=0;n<h.nodeFuture.length;n++){delete h.nodeFuture.pop().node}delete h.nodeFuture,h.nodeFuture=[]}var i={action:e,node:t,lastX:t.x(),lastY:t.y()};"removed"==e&&(i.lastY+=80),h.nodeHistory.push(i),h.setYarnDocumentIsDirty()},this.historyDirection=function(e){function t(e){var t=h.nodes.indexOf(e);t>=0&&h.nodes.splice(t,1),h.updateNodeLinks()}var n=null;if(n="undo"==e?h.nodeHistory.pop():h.nodeFuture.pop()){var i=n.action,o=n.node;"undo"==e?("created"==i?(n.lastX=o.x(),n.lastY=o.y(),t(o)):"removed"==i&&h.recreateNode(o,n.lastX,n.lastY),h.nodeFuture.push(n),h.setYarnDocumentIsDirty()):("created"==i?h.recreateNode(o,n.lastX,n.lastY):"removed"==i&&t(o),h.nodeHistory.push(n),h.setYarnDocumentIsDirty())}},this.recreateNode=function(e,t,n){h.nodes.push(e),e.moveTo(t,n),h.updateNodeLinks()},this.setSelectedColors=function(e){var t=h.workspace.getSelectedNodes();for(var n in t.splice(t.indexOf(e),1),t)t[n].colorID(e.colorID())},this.pasteNodes=function(){h.nodeClipboard.length&&(h.workspace.deselectAll(),h.nodeClipboard.forEach((function(e){var t=new a.a({title:h.getUniqueTitle(e.title()),body:e.body(),tags:e.tags(),colorID:e.colorID(),x:e.createX,y:e.createY});h.nodes.push(t),h.workspace.selectNodes(t),h.recordNodeAction("created",t)})),h.updateNodeLinks())},this.confirmDeleteNodes=function(e){const t=Array.isArray(e)?void 0:e,n=Array.isArray(e)?[...e]:t&&t.selected?[...h.workspace.getSelectedNodes()]:[e];n.length&&Swal.fire({title:"Are you sure?",text:`${n.length} ${1===n.length?"node":"nodes"} will be deleted.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(e=>{e.value&&h.deleteNodes(n)})},this.deleteNodes=function(e){const t=Array.isArray(e)?e:[e],n=[];for(let e=t.length-1;e>=0;--e)n.push(t[e].remove());Promise.all(n).then(()=>{h.limitNodesUpdate(()=>{for(let e=t.length-1;e>=0;--e)h.inEditor()&&h.editing()===t[e]&&h.closeEditor(),h.deleteNode(t[e]);h.updateNodeLinks(),h.workspace.deselectNodes(t),h.workspace.updateArrows()})})},this.deleteNode=function(e){const t=h.nodes.indexOf(e);t>=0&&(h.recordNodeAction("removed",e),h.nodes.splice(t,1)),h.setYarnDocumentIsDirty()},this.cloneNodeArray=function(e){return e.map((function(e){return new a.a({title:e.title(),body:e.body(),tags:e.tags(),colorID:e.colorID(),x:e.x()+10,y:e.y()+10})}))},this.newNode=function(e=!0){var t=new a.a;return h.nodes.push(t),e&&h.updateNodeLinks(),h.recordNodeAction("created",t),t},this.newNodeAt=function(e,t){var n=new a.a({x:e-100,y:t-100});return h.nodes.push(n),h.updateNodeLinks(),h.recordNodeAction("created",n),n},this.searchTextInEditor=function(e=!0){e?h.editor.execCommand("find"):h.editor.searchBox&&h.editor.searchBox.hide()},this.showRandomQuote=function(){e.ajax({url:"https://api.forismatic.com/api/1.0/?",dataType:"jsonp",data:"method=getQuote&format=jsonp&lang=en&jsonp=?",success:function(e){Swal.fire({text:e.quoteText+"\n\n-"+e.quoteAuthor})}})},this.editNode=function(t,n=!0){if(!n&&!t.active())return;if(h.settings.alwaysOpenNodesInVisualStudioCodeEditor())return void h.editNodeInVisualStudioCodeEditor(t);h.editing()&&h.editing()!==t&&h.saveNode(!1),h.isEditorInPlayMode()&&h.togglePlayMode(!1),h.isEditorInPreviewMode&&h.togglePreviewMode(!1),t.oldTitle=t.title(),h.editing(t),h.mustUpdateTags=!0,e("#node-editor-background").css({opacity:0}).transition({opacity:1},250),e("#node-editor").css({y:"-100",opacity:0}).transition({y:"0",opacity:1},250),h.editor=ace.edit("editor"),h.editor.setOptions({scrollPastEnd:.5}),h.editor.focus(),h.editor.navigateFileEnd(),e("#colorPicker").spectrum({flat:!0,showButtons:!1,showInput:!0,showPalette:!0,preferredFormat:"hex",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"]],move:function(e){h.applyPickerColorEditor(e)},clickoutFiresChange:!0});const i=ace.require("ace/ext/language_tools"),a=p.Utils.createAutocompleter("ink"===app.settings.documentType()?["divert.target"]:["string.llink","string.rlink"],app.getOtherNodeTitles().map(e=>{const n=h.getNodeByTitle(e);return{word:e,title:e,about:`${n.tags().length>0?`tags: ${n.tags()}<br/>`:""}Preview:<br/>${n.clippedBody()}`,titleStyle:t.titleStyles[n.colorID()]}}),"Node Link");i.setCompleters([a,i.keyWordCompleter,i.textCompleter,i.snippetCompleter]);let s=void 0;h.editor.getSession().on("change",(function(e){const t=h.settings.autoCloseTags();if("insert"===e.action&&t){if(h.richTextFormatter.justInsertedAutoComplete)return void(h.richTextFormatter.justInsertedAutoComplete=!1);s&&clearTimeout(s),s=setTimeout(()=>{s=void 0,h.richTextFormatter.completableTags.forEach(e=>{if(h.getTagBeforeCursor()===e.Start){h.richTextFormatter.justInsertedAutoComplete=!0;let t=e.Completion,n=e.Offset;h.settings.autoCloseBrackets()&&e.BehaviorCompletion&&(t=e.BehaviorCompletion,n+=1),e.Completion&&h.insertTextAtCursor(t),e.Offset&&h.moveEditCursor(n),e.Func&&e.Func()}})},200)}})),this.emPicker=new EmojiPicker(document.getElementById("emojiPickerDom"),e=>{h.insertTextAtCursor(e.char),this.emPicker.toggle(),h.togglePreviewMode(!1)}),Object(o.enable_spellcheck)(),h.toggleInvertColors(),h.toggleShowCounter(),h.toggleSpellCheck(),h.validateTitle(),h.updateEditorStats(),h.updateEditorOptions(),h.$searchField.val().length>0&&e(".search-body input").is(":checked")&&h.editor.findAll(h.$searchField.val()),h.settings.editorSplit()&&(h.splitEditor(),h.workspace.warpToNodeByIdx(t.index()-1)),"right"===h.settings.editorSplitDirection()?(e("#editor-form").addClass("split-editor-right"),e("#editor-resize-handle").addClass("float-right")):(e("#editor-form").removeClass("split-editor-right"),e("#editor-resize-handle").removeClass("float-right")),e(".node-editor").on("pointerdown","> *",(function(e){h.isEditorSplit&&(h.focusEditor(!0),e.stopPropagation())})),e(".app-info").hide(),h.editor.resize(),null!=t.undoManager&&h.editor.session.setUndoManager(t.undoManager);var r=new CustomEvent("yarnEditorOpen");r.document=document,r.data=c.a,r.app=app,window.dispatchEvent(r),window.parent.dispatchEvent(r)},this.splitEditor=function(){h.isEditorSplit=!0,h.focusEditor(!0),h.settings.editorSplit(!0),h.editorResizeHandleOptions.resizeWidthFrom="right"===h.settings.editorSplitDirection()?"left":"right",e("#editor-form").width(h.settings.editorSplitSize()).addClass("split-editor").toggleClass("split-editor-right","right"===h.settings.editorSplitDirection()).resizable(h.editorResizeHandleOptions),e("#node-editor-background").addClass("hidden"),e("#node-editor").css({"z-index":10002}),e("#editor-resize-handle").removeClass("hidden").toggleClass("float-right","right"===h.settings.editorSplitDirection()),e("#split-editor-button").addClass("hidden"),e("#snap-editor-button").removeClass("hidden"),e("#exit-editor").removeClass("hidden"),e("#full-size-editor-button").removeClass("hidden"),e("#split-button-separator").removeClass("hidden"),h.ui.checkAndMoveAppButtons()},this.toggleEditorView=function(){h.settings.editorSplit(!h.settings.editorSplit()),h.reopenEditor()},this.reopenEditor=function(){h.saveNode();let e=h.editing();h.closeEditor(),setTimeout(()=>{h.editNode(e)},250)},this.editorSnapToggle=function(){h.settings.editorSplitDirection("right"===h.settings.editorSplitDirection()?"left":"right"),h.reopenEditor()},this.focusEditor=function(t){!0===t?(e("#node-editor").removeClass("split-editor-unfocused"),h.isEditorFocused=!0):(e("#node-editor").addClass("split-editor-unfocused"),h.isEditorFocused=!1)},this.getSplitEditorXOffset=function(){let t=0;return h.inEditor()&&h.settings.editorSplit()&&(t=e("#editor-form").width()/2,"right"===h.settings.editorSplitDirection()&&(t*=-1)),t},this.editNodeInVisualStudioCodeEditor=function(e){h.usingVisualStudioCodeExtension()?(h.setYarnDocumentIsDirty(),window.vsCodeApi.postMessage({type:"OpenNode",payload:{title:e.title().trim(),tags:e.tags().trim(),body:h.trimBodyLinks(e.body().trim())}})):console.error("Tried to open node in Visual Studio Code text editor but we're not in the Visual Studio Code extension")},this.chooseRelativePathImage=function(e){h.insertTextAtCursor(e)},this.getNodeByTitle=function(e){return h.nodes().find(t=>t.title().trim().toLowerCase()===e.trim().toLowerCase())},this.openNodeByTitle=function(e,t=""){h.isEditorInPlayMode()&&h.togglePlayMode(),h.makeNodeWithName(e);const n=h.nodes().find(t=>t.title().trim().toLowerCase()===e.trim().toLowerCase());n&&(h.editNode(n,!0),t&&setTimeout(()=>h.editor.find(t),200))},this.openLastEditedNode=function(){if(0===h.nodeVisitHistory.length)h.saveNode(),h.closeEditor();else{const e=h.nodeVisitHistory.pop();h.propagateUpdateFromNode(h.editing()),h.openNodeByTitle(e)}},this.getSpellCheckSuggestionItems=function(){var e=Object(o.suggest_word_for_misspelled)(h.editor.getSelectedText());if(e){var t={};return e.forEach(e=>{t[e]={name:e,icon:"edit",callback:e=>{h.insertTextAtCursor(e)}}}),t}return!1},this.getThesaurusItems=function(){var e=n("GLdW")(h.editor.getSelectedText());if(!e)return!1;var t=[];if(Object.keys(e).forEach((function(n){e[n].forEach((function(e){t.includes(e)||e===n||t.push(e)}))})),t.length>0){var i={};return t.forEach(e=>{i[e]={name:e,icon:"edit",callback:e=>{h.insertTextAtCursor(e)}}}),i}return!1},this.toggleSpellCheck=function(){setTimeout((function(){h.settings.spellcheckEnabled()?Object(o.enable_spellcheck)():Object(o.disable_spellcheck)()}),50)},this.toggleInvertColors=function(){const t=h.settings.invertColorsEnabled()?{filter:"invert(100%)"}:{filter:"invert(0%)"};e("#app").css(t),e("#app-bg").css(t),e(".tooltip").css(t),e(".node .body").css(t),e(".editor-container .editor-preview").css(t)},this.initGrid=function(){if(h.settings.snapGridEnabled()){var t=e(window).width(),n=e(window).height();e("#grid-canvas").attr("width",t),e("#grid-canvas").attr("height",n),e("#gridSize").attr("disabled",!1),h.workspace.gridContext.strokeStyle=h.workspace.gridContext.fillStyle=e(".grid-canvas").css("color")}else e("#gridSize").attr("disabled",!0);app.workspace.updateGrid()},this.toggleShowCounter=function(){h.settings.editorStatsEnabled()?e(".node-editor .form .editor-counter").css({display:"initial"}):e(".node-editor .form .editor-counter").css({display:"none"})},this.toggleAutocompleteSuggestions=function(){h.settings.autocompleteSuggestionsEnabled(!h.settings.autocompleteSuggestionsEnabled()),h.updateEditorOptions()},this.toggleAutoCloseBrackets=function(){h.settings.autoCloseBrackets(!h.settings.autoCloseBrackets()),h.updateEditorOptions()},this.updateEditorOptions=function(){h.editor.setOptions({enableBasicAutocompletion:app.settings.autocompleteSuggestionsEnabled(),enableLiveAutocompletion:app.settings.autocompleteSuggestionsEnabled(),behavioursEnabled:app.settings.autoCloseBrackets()})},this.togglePreviewMode=function(t){const n=e(".editor")[0],i=e("#editor-preview")[0];h.isEditorInPreviewMode=t,app.ui.dispatchEvent("yarnInPreviewMode"),t?(e(".bbcode-toolbar").addClass("hidden"),n.style.display="none",i.style.display="block",i.innerHTML=h.richTextFormatter.richTextToHtml(h.editing().body(),!0),i.scrollTop=h.editor.renderer.scrollTop):(e(".bbcode-toolbar").removeClass("hidden"),h.editor.session.setScrollTop(i.scrollTop),i.innerHTML="",i.style.display="none",n.style.display="flex",h.editor.focus(),h.editor.resize(),e("#colorPicker-container").is(":visible")&&e("#colorPicker-container").hide(),e("#emojiPicker-container").is(":visible")&&e("#emojiPicker-container").hide())},this.appendText=function(e){h.editing().body(h.editing().body()+e);const t=h.editor.session.getLength()-1,n=h.editor.session.getLine(t).length;h.editor.gotoLine(t+1,n)},this.moveEditCursor=function(e){const t=h.editor.getCursorPosition();h.editor.gotoLine(t.row+1,t.column+e),h.editor.focus()},this.insertTextAtCursor=function(e,t=!1){if(!h.editing())return;h.editor.session.replace(h.editor.selection.getRange(),"");const n=h.editor.getCursorPosition();if(h.editor.session.insert(n,e),t){const e=h.editor.getCursorPosition();editor.scrollToLine(e.row,!0,!0,(function(){})),h.editor.focus()}h.updateEditorStats(),h.editor.focus()},this.getTagBeforeCursor=function(){const e=h.editor.getSelectionRange(),t=e.start.row,n=h.editor.session.getLine(t).substring(e.start.column-2,e.start.column+2);if(!n)return"";if("ink"===app.settings.documentType()){if(["->"].includes(n.trim()))return n.trim()}else if(["[[","<<"].includes(n.trim())||n.includes("|"))return n.trim();return h.richTextFormatter.identifyTag(n)},this.saveNode=function(){const t=h.editing();if(t){const n=e("#editorTitle")[0],i=h.getFutureEditedNodeTitle();n.value=i,t.title(i),t.body(h.trimBodyLinks(t.body().trim())),h.makeNewNodesFromLinks(),h.propagateUpdateFromNode(t),h.workspace.updateArrows(),setTimeout(h.updateSearch,600),h.setYarnDocumentIsDirty(),app.ui.dispatchEvent("yarnSavedNode")}},this.closeEditor=function(){h.editing().undoManager=h.editor.session.getUndoManager(),e("#node-editor-background").transition({opacity:0},250),e("#node-editor").transition({y:"-100",opacity:0},250,(function(e){h.editing(null),h.editor.destroy(),h.editor=null,this.emPicker=null})),h.isEditorSplit=!1,h.isEditorFocused=!1,e(".app-info").show(),app.ui.resetAppButtonsLocation(),h.isEditorInPlayMode()&&h.togglePlayMode(!1),h.isEditorInPreviewMode&&h.togglePreviewMode(!1)},this.convertMarkup=function(){h.nodes().forEach(e=>{e.body(h.richTextFormatter.convert(e.body()))})},this.updateSearch=p.Utils.debounce((function(){for(var t=0;t<h.nodes().length;t++){var n=h.nodes()[t],i=e(n.element),o=app.$searchField.val().toLowerCase();const{matchTitle:a,matchBody:s,matchTags:r,clearSearch:l}=app.ui.nodeSearchMatches(n,o);l?(n.active(!0),i.clearQueue(),i.transition({opacity:1},500)):a||s||r?(n.active({title:a,body:s,tags:r}),i.clearQueue(),i.transition({opacity:1},500)):(n.active(!1),i.clearQueue(),i.transition({opacity:.25},500))}}),600),this.trimBodyLinks=function(e){return e.replace(/\[\[(.+?)\|\s*(.+?)\s*\]\]/g,"[[$1|$2]]")},this.updateNodeLinks=function(){for(let e of h.nodes())e.updateLinks()},this.propagateUpdateFromNode=function(e){var t=[],n=[];for(t.push(e);e=t.pop();)n.includes(e)||(n.push(e),e.updateLinks(),e.linkedTo().forEach(e=>{n.includes(e)||t.push(e)}),e.linkedFrom().forEach(e=>{n.includes(e)||t.push(e)}))},this.updateTagsRepository=p.Utils.debounce((function(){if(!app.mustUpdateTags)return;app.mustUpdateTags=!1;h.tags().forEach(e=>e.count=0),h.nodes().forEach(e=>{p.Utils.uniqueSplit(e.tags()," ").forEach(e=>{const t=h.tags().find(t=>t.text==e);if(t)++t.count;else{const t=(()=>{const e=h.tags().map(e=>e.id);for(let t=1;;++t)if(!e.includes(t))return t})();h.tags.push({id:t,style:"tag-style-"+t,text:e,count:1})}})});let e=h.tags().length;for(;e--;)0===h.tags()[e].count&&h.tags().splice(e,1)}),500),this.makeNewNodesFromLinks=function(){if(!h.settings.createNodesEnabled())return console.info("Autocreate new nodes disabled");var e=h.editing().getLinksInNode();if(null!=e)for(var t=0;t<e.length;t++){const i=e[t].trim();var n=220*(t+1);h.makeNodeWithName(i,n)}},this.makeNodeWithName=function(e,t=220){const n=h.getOtherNodeTitles();"ink"!==app.settings.documentType()&&e&&e.length>0&&!n.includes(e)&&e!=h.editing().title()&&h.newNodeAt(h.editing().x()+t,h.editing().y()-120).title(e)},this.titleExistsTwice=function(e){return h.nodes().filter(t=>t.title().trim()===e.trim()).length>1},this.getFutureEditedNodeTitle=function(){const t=e("#editorTitle")[0];return h.getUniqueTitle(t.value.trim())},this.getOtherNodeTitles=function(){const e=[];return h.nodes().forEach(t=>{if(!h.editing()||t.title()!==h.editing().title()){if("ink"===app.settings.documentType()&&t.title().trim()===c.a.InkGlobalScopeNodeName)return;e.push(t.title().trim())}}),e},this.getHighlightedText=function(t){t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\</g,"&lt;")).replace(/\>/g,"&gt;")).replace(/\&lt;\&lt;(.*?)\&gt;\&gt;/g,'<p class="conditionbounds">&lt;&lt;</p><p class="condition">$1</p><p class="conditionbounds">&gt;&gt;</p>')).replace(/\[\[([^\|]*?)\]\]/g,'<p class="linkbounds">[[</p><p class="linkname">$1</p><p class="linkbounds">]]</p>')).replace(/\[\[([^\[\]]*?)\|([^\[\]]*?)\]\]/g,'<p class="linkbounds">[[</p>$1<p style="color:red"><p class="linkbounds">|</p><p class="linkname">$2</p><p class="linkbounds">]]</p>')).replace(/[^:]\/\/(.*)?($|\n)/g,'<span class="comment">//$1</span>\n')).replace(/\/\*((.|[\r\n])*)?\*\//gm,'<span class="comment">/*$1*/</span>')).replace(/\/\%((.|[\r\n])*)?\%\//gm,'<span class="comment">/%$1%/</span>');var n=e("<div>");return n[0].innerHTML=t,n.find(".comment").each((function(){e(this).find("p").each((function(){e(this).removeClass()}))})),n.find(".linkname").each((function(){var t=e(this).text(),n=!1;for(var i in h.nodes())if(h.nodes()[i].title().toLowerCase()==t.toLowerCase()){n=!0;break}n||e(this).removeClass("linkname")})),t=n[0].innerHTML},this.updateLineNumbers=function(t){for(var n=t.split("\n"),i="",o=0;o<Math.max(1,n.length);o++)(0==o||o<n.length-1||n[o].length>0)&&(i+=o+1+"<br />");e(".editor-container .lines").html(i)},this.moveNodes=function(e,t){for(var n in h.nodes()){var i=h.nodes()[n];i.moveTo(i.x()+e,i.y()+t)}},this.getFirstFoundNode=function(e){return h.nodes().find(t=>t.title().toLowerCase().trim()===e)},this.searchWarp=function(){var e=h.$searchField.val().toLowerCase().trim();if(""===e)h.workspace.warpToNodeByIdx(0);else{const t=h.getFirstFoundNode(e);h.workspace.warpToNodeByIdx(h.nodes.indexOf(t))}},this.clearSearch=function(){h.$searchField.val(""),h.updateSearch()},this.updateEditorStats=function(){var t=h.editor.getSession().getValue(),n=h.editor.getCursorPosition(),i=t.split("\n");e(".editor-counter .character-count").html(t.length),e(".editor-counter .line-count").html(i.length),e(".editor-counter .row-index").html(n.row),e(".editor-counter .column-index").html(n.column),c.a.saveAppStateToLocalStorage()},this.getUniqueTitle=function(e){var t=h.getOtherNodeTitles();if(e&&!t.includes(e))return e;var n=e||"Node",i=2;const o=n.match(/^(.*)(_([0-9]+))$/);if(o&&4===o.length&&(n=o[1],i=Number(o[3])),!t.includes(n))return n;for(;;++i){var a=n+"_"+i;if(!t.includes(a))return a}},this.navigateToNodeDuringPlayTest=function(e,t=""){h.openNodeByTitle(e,t),h.togglePlayMode(!0),app.workspace.warpToNode(app.getFirstFoundNode(e))}}}).call(this,n("EVdn"),n("Z1dp"))},"P85/":function(e,t,n){},W2Rx:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return s}));var o=n("oj90");let a=0;let s=function(t={}){const n=this;this.titleStyles=["title-style-1","title-style-2","title-style-3","title-style-4","title-style-5","title-style-6","title-style-7","title-style-8","title-style-9"],this.index=e.observable(a++),this.title=e.observable(t.title||app.getUniqueTitle()),this.tags=e.observable(t.tags||""),this.body=e.observable(t.body||""),this.active=e.observable(t.active||!0),this.width=200,this.height=200,this.tempOpacity=null,this.style=null,this.colorID=e.observable(t.colorID||0),this.checked=!1,this.selected=!1,this.createX=t.x||null,this.createY=t.y||null,this.undoManager=null,this.clippedTags=e.computed((function(){return app.updateTagsRepository(),o.Utils.uniqueSplit(n.tags()," ").map(e=>app.tags().find(t=>t.text===e)).filter(e=>e)}),this),this.clippedBody=e.computed((function(){if(app.ui.isScreenNarrow()&&app.editing())return;app.mustRefreshNodes();let e=app.getHighlightedText(this.body());return e=app.richTextFormatter.richTextToHtml(e),e=e.substr(0,225),e}),this),this.linkedTo=e.observableArray(),this.linkedFrom=e.observableArray(),this.element=null,this.canDoubleClick=!0,this.create=function(){if(n.style=window.getComputedStyle(i(n.element).get(0)),n.createX&&n.createY)n.x(n.createX),n.y(n.createY);else{let e=i(n.element).parent();n.x((-e.offset().left+i(window).width()/2-100)/app.workspace.scale),n.y((-e.offset().top+i(window).height()/2-100)/app.workspace.scale)}app.workspace.bringToFront(n.element),app.workspace.startUpdatingArrows(),i(n.element).css({opacity:0,scale:.8,y:"-=80px",rotate:"45deg"}).transition({opacity:1,scale:1,y:"+=80px",rotate:"0deg"},250,"easeInQuad",(function(){app.workspace.stopUpdatingArrows(),app.workspace.updateArrows()})),n.drag(),i(n.element).on("dblclick",(function(){n.canDoubleClick&&app.editNode(n)})),o.Utils.addDoubleTapDetector(n.element,(function(){n.canDoubleClick&&app.editNode(n)})),i(n.element).on("click",(function(e){e.ctrlKey&&(n.selected?app.workspace.deselectNodes(n):app.workspace.selectNodes(n))}))},this.setSelected=function(e){n.selected=e,n.selected?i(n.element).addClass("selected"):i(n.element).removeClass("selected")},this.toggleSelected=function(){n.setSelected(!n.selected)},this.x=function(e){if(null!=e&&i(n.element).css({x:Math.floor(e)}),n.style)return Math.floor(new WebKitCSSMatrix(n.style.webkitTransform).m41)},this.y=function(e){if(null!=e&&i(n.element).css({y:Math.floor(e)}),n.style)return Math.floor(new WebKitCSSMatrix(n.style.webkitTransform).m42)},this.resetDoubleClick=function(){n.canDoubleClick=!0},this.cycleColorDown=function(){n.doCycleColorDown(),setTimeout(n.resetDoubleClick,500),n.canDoubleClick=!1,app.input.isShiftDown&&app.matchConnectedColorID(n),n.selected&&app.setSelectedColors(n),app.setYarnDocumentIsDirty()},this.cycleColorUp=function(){n.doCycleColorUp(),setTimeout(n.resetDoubleClick,500),n.canDoubleClick=!1,app.input.isShiftDown&&app.matchConnectedColorID(n),n.selected&&app.setSelectedColors(n),app.setYarnDocumentIsDirty()},this.doCycleColorDown=function(){n.colorID(n.colorID()-1),n.colorID()<0&&n.colorID(8)},this.doCycleColorUp=function(){n.colorID(n.colorID()+1),n.colorID()>8&&n.colorID(0)},this.remove=async function(){return new Promise((e,t)=>{i(n.element).transition({opacity:0,scale:.8,y:"-=80px",rotate:"-45deg"},250,"easeInQuad",e)})},this.drag=function(){const e={x:0,y:0};let t=!1,o=!1;i(document.body).on("mousemove touchmove",(function(i){if(t){const t=app.input.isScreenTouched&&i.changedTouches?i.changedTouches[0].pageX:i.pageX,a=app.input.isScreenTouched&&i.changedTouches?i.changedTouches[0].pageY:i.pageY;let{x:s,y:r}=app.workspace.toWorkspaceCoordinates(t,a);s-=e.x,r-=e.y;let l=s-n.x(),d=r-n.y();const c=app.workspace.getSelectedNodes();if(("mousemove"===i.originalEvent.type||c.includes(n)&&"touchmove"===i.originalEvent.type)&&(n.x(s),n.y(r)),o&&(n.selected?c.splice(c.indexOf(n),1):c=app.getNodesConnectedTo(n),c.length>0))for(let e in c)c[e].active()&&(c[e].x(c[e].x()+l),c[e].y(c[e].y()+d));app.workspace.updateArrows()}})),i(n.element).on("pointerdown",(function(i){if(!t&&n.active()&&0===i.button){t=!0,(app.input.isShiftDown||n.selected)&&(o=!0);const{x:a,y:s}=app.workspace.toWorkspaceCoordinates(i.pageX,i.pageY);e.x=app.settings.snapGridEnabled()?app.workspace.stepify(a-n.x(),app.settings.gridSize()):a-n.x(),e.y=app.settings.snapGridEnabled()?app.workspace.stepify(s-n.y(),app.settings.gridSize()):s-n.y()}})),i(n.element).on("touchend",(function(e){app.workspace.selectNodes(n)})),i(document).on("pointerup touchend",(function(){(t||o)&&(t=!1,o=!1,app.setYarnDocumentIsDirty())}))},this.moveTo=function(e,t){app.workspace.startUpdatingArrows(),i(n.element).clearQueue(),i(n.element).transition({x:e,y:t},app.stopUpdatingArrows,500)},this.isConnectedTo=function(e,t){if(t&&e.isConnectedTo(n,!1))return!0;let i=n.linkedTo();for(let t in i){if(i[t]==e)return!0;if(i[t].isConnectedTo(e,!1))return!0;if(e.isConnectedTo(i[t],!1))return!0}return!1},this.getLinksInNode=function(e){const t="yarn"===app.settings.documentType();let i=(e||n).body().match(t?/\[\[(.*?)\]\]/g:/\-\>(.*)/g);if(null!=i){let e={};for(let n=i.length-1;n>=0;n--)t?(i[n]=i[n].substr(2,i[n].length-4).trim(),i[n].indexOf("|")>=0&&(i[n]=i[n].split("|")[1]),null!=e[i[n]]&&i.splice(n,1),e[i[n]]=!0):i[n]=i[n].substr(2,i[n].length).trim();return i}},this.updateLinks=function(){n.resetDoubleClick(),n.updateLinksFromParents(),n.updateLinksToChildren()},this.updateLinksFromParents=function(){n.oldTitle&&n.oldTitle!==n.title()&&(n.linkedFrom.removeAll(),app.nodes().forEach(e=>{const t=n.getLinksInNode(e);if(t)if(t.includes(n.oldTitle)){const t=RegExp("\\|\\s*"+n.oldTitle+"\\s*\\]\\]","g"),i=RegExp("\\[\\[\\s*"+n.oldTitle+"\\s*\\]\\]","g");let o=e.body().replace(t,"|"+n.title()+"]]");o=o.replace(i,"[["+n.title()+"]]"),e.body(o),n.linkedFrom.push(e)}else t.includes(n.title())&&n.linkedFrom.push(e)}),n.oldTitle=void 0)},this.updateLinksToChildren=function(){n.linkedTo.removeAll();let e=n.getLinksInNode();if(e)for(let t in app.nodes()){let i=app.nodes()[t];for(let t=0;t<e.length;t++)i!=n&&i.title().trim()===e[t].trim()&&n.linkedTo.push(i)}}};e.bindingHandlers.nodeBind={init:function(e,t,n,i,o){o.$rawData.element=e,o.$rawData.create()},update:function(e,t,n,o,a){i(e).on("pointerdown",(function(){app.workspace.bringToFront(e)}))}}}).call(this,n("Z1dp"),n("EVdn"))},bHyH:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return a}));const o=[n("5aMW").a];var a=function(t){const n=this,a=e=>(n.pluginStorage||(n.pluginStorage={}),n.pluginStorage[e]||(n.pluginStorage={...n.pluginStorage,[e]:{}}),this.pluginStorage[e]),s=(e,t,i)=>{const o={...a(e),[t]:i};n.pluginStorage={...n.pluginStorage,[e]:o}};window.addEventListener("yarnLoadedData",e=>{if(null!==t.data.documentHeader()){const e=t.data.documentHeader();"pluginStorage"in e&&(n.pluginStorage=e.pluginStorage)}}),window.addEventListener("newYarnFileStarted",e=>{n.pluginStorage={}});const r=({title:n,valueKey:i,defaultValue:o,optionsKey:a,options:s,setterKey:r,settingsColumn:l})=>{t.settings[i]=e.observable(t.settings.storage.getItem(i)||o).extend({persist:i}),t.ui[a]=s,t[r]=function(e,n){const o=n?n.target.value:e;t.settings[i](o)},window.addEventListener("settingsOpened",()=>{const e=t.ui[a].map(e=>`<option value="${e.id}" ${e.id===t.settings[i]()?'selected="true"':""}>${e.name}</option>`).join(""),o=`\n              <label class="settings-label" for="theme">${n}</label>\n              <div class="settings-value markup">\n                <select id="mySelect">\n                   ${e}\n                </select>\n              </div>\n    `,s=document.createElement("div");s.className="settings-item",s.innerHTML=o,document.getElementById("settingsColumn"+(l||"A")).appendChild(s),document.getElementById("mySelect").addEventListener("change",e=>{t[r](!1,e)})})},l=(e,{name:t,iconName:n,onClick:i,attachTo:o,className:a,title:s,onPointerDown:r,onDoubleClick:l,id:d})=>{if(null!==document.getElementById(d))return;const c=document.createElement("span");return c.id=d||t||s||n,c.innerHTML=`\n      <span class="item ${a||""}" title="${s||""}" ${i?`onclick="click: app.plugins.${e}.${i}"`:""}\n       ${r?` onpointerdown="app.plugins.${e}.${r}"`:""}\n              ${l?`ondblclick="app.plugins.${e}.${l}"`:""}\n       >\n        <svg class="icon menu-icon icon-file-${n} icon-lg icon-fw" style="color:currentColor;"><use xlink:href="public/icons.svg#icon-${n}"></use></svg>\n        <span class="hide-when-narrow">&nbsp;</span>\n        ${t||""}\n      </span>\n    `,document.getElementById(o).appendChild(c),c},d=(e,{id:t,attachTo:n,className:i,title:o,tooltipId:a,toggleValueKey:s,onToggle:r,enableKey:l,iconName:d})=>{if(null!==document.getElementById(t))return;const c=document.createElement("span");return c.id=t,c.className="styled-checkbox",c.innerHTML=`\n            <input class="styled-checkbox" type="checkbox" id="${s}" data-bind="checked: app.plugins.${e}.${l}, event: { change: app.plugins.${e}.${r} }"></input>\n            <label for="${s}" title="${o}" class="${i}"><span title="${o}" class="button-bubble" id="${a}"></span>\n              <svg class="icon icon-${d} icon-fw icon-lg"><use xlink:href="public/icons.svg#icon-${d}"></use></svg>\n            </label>\n    `,document.getElementById(n).appendChild(c),c},c=e=>{window.addEventListener("yarnSavedNode",t=>{e(t)})},p=e=>{window.addEventListener("yarnInPreviewMode",t=>{e(t)})},u=e=>{window.addEventListener("yarnLoadedData",t=>{e(t)})},g=e=>{window.addEventListener("yarnSetDocumentType",t=>{e(t)})},h=e=>{window.addEventListener("yarnEditorOpen",t=>{e(t)})},m=e=>{window.addEventListener("DOMContentLoaded",t=>{e(t)})},f=e=>{window.addEventListener("yarnSetLanguage",t=>{e(t)})},y=e=>{window.addEventListener("yarnLoadedStateFromLocalStorage",t=>{e(t)})},b=e=>{window.addEventListener("yarnSavedStateToLocalStorage",t=>{e(t)})},v=e=>{i(document).on("keyup",t=>{e(t)})},w=e=>{i(document).on("keydown",t=>{e(t)})};o.forEach(e=>{const n=new e({app:t,createButton:l,createToggle:d,getPluginStore:a,setPluginStore:s,addSettingsItem:r,onYarnLoadedData:u,onYarnEditorOpen:h,onYarnInPreviewMode:c,onYarnSavedNode:p,onYarnSetLanguage:f,onYarnLoadedStateFromLocalStorage:y,onYarnSavedStateToLocalStorage:b,onYarnSetDocumentType:g,onKeyUp:v,onKeyDown:w,onLoad:m});window.addEventListener("DOMContentLoaded",e=>{(e=>{t.plugins[e.name]=e})(n)})})}}).call(this,n("Z1dp"),n("EVdn"))},e6Wu:function(e,t,n){"use strict";n.r(t);n("3ozf"),n("P85/"),n("uMdg"),n("gugv");var i=n("oj90"),o=n("0h2I"),a=n.n(o),s=(n("5uVa"),n("si6p"),n("ghrA"),n("bU/s")),r=n.n(s),l=(n("A8C4"),n("VEX6"),n("jF1P"),n("YhK8"),n("Ab/9"),n("KDOe"),n("PSD3")),d=n.n(l),c=n("P0sH"),p=n("pLxK"),u=n("bHyH");window.ko=a.a,window.$=window.jQuery=n("EVdn"),window.ace=r.a,r.a.config.set("basePath",i.Utils.getPublicPath()),window.define=r.a.define,window.Swal=d.a,"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})}),window.app=new c.a("Yarn",p.a),window.app.run();const g=new u.a(window.app);window.app.plugins=g},fkuv:function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return a}));var o=n("2Qx2");const a=function(t){const n=this;this.notification=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2500}),this.dispatchEvent=function(e,t){const n=new CustomEvent(e);n.options=t,window.dispatchEvent(n),window.parent.dispatchEvent(n)},this.settingsDialogVisible=e.observable(!1),this.narrowScreenThreshold=600,this.isScreenNarrow=function(){return i(window).width()<=n.narrowScreenThreshold},this.availableMarkupLanguages=[{id:"bbcode",name:"Bbcode"},{id:"html",name:"Html"}],this.availableFiletypeVersions=[{id:"1",name:"1"},{id:"2",name:"2"}],this.availableThemes=[{id:"classic",name:"Classic"},{id:"blueprint",name:"Blueprint"},{id:"dracula",name:"Dracula"}],this.availableDocumentTypes=[{id:"yarn",name:"Yarn"},{id:"ink",name:"Ink"}],this.availableLanguages=[{name:"Čeština",id:"cs-CZ"},{name:"Deutsch",id:"de-DE"},{name:"English",id:"en-GB"},{name:"Español",id:"es-ES"},{name:"Français",id:"fr-FR"},{name:"Íslenska",id:"is-IS"},{name:"Nederlands",id:"nl-NL"},{name:"Norsk bokmål",id:"nb-NO"},{name:"Polski",id:"pl-PL"},{name:"Română",id:"ro-RO"},{name:"Slovenčina",id:"sk-SK"},{name:"Svenska",id:"sv-SE"},{name:"Türkçe",id:"tr-TR"},{name:"български",id:"bg-BG"},{name:"Pусский",id:"ru-RU"},{name:"Српски",id:"sr-RS"},{name:"한국어",id:"ko-KR"}],this.availableLineStyles=[{id:"straight",name:"Straight Lines"},{id:"bezier",name:"Bezier Curves"}],this.openSettingsDialog=function(){n.settingsDialogVisible(!0),i(".settings-dialog").css({opacity:0}).transition({opacity:1},250),i(".settings-dialog .form").css({y:"-100"}).transition({y:"0"},250);var e=new CustomEvent("settingsOpened");window.dispatchEvent(e)},this.openHelpDialog=function(){Swal.fire({title:"Help",html:'\n      <div style="text-align: justify">\n        <p>Useful editor shortcuts:</p>\n        <small>\n          <ul>\n            <li>Cmd/Ctrl + Left Click -- Create multiple input carets</li>\n            <li>Cmd/Ctrl + Left/Right -- Caret jump word</li>\n            <li>Cmd/Ctrl + Up/Down -- Scroll up/down</li>\n            <li>Cmd/Ctrl + Left/Right + Shift -- Caret jump word selection</li>\n            <li>Cmd/Ctrl + F -- Search</li>\n            <li>Cmd/Ctrl + Alt + K -- Find All</li>\n            <li>Cmd/Ctrl + H -- Search and Replace</li>\n            <li>Cmd/Ctrl + A -- Select all</li>\n            <li>Cmd/Ctrl + U -- To Uppercase</li>\n            <li>Cmd/Ctrl + Shift + U -- To Lowercase</li>\n            <li>Alt + Up/Down -- Move line(s) up/down</li>\n            <li><a href="https://ace.c9.io/demo/keyboard_shortcuts.html" target="_blank">...</a></li>   \n          </ul>\n        </small>\n        <div>How to use <a href="https://yarnspinner.dev/docs/syntax/" target="_blank">Yarn Syntax</a></div>\n        <div>How to use <a href="https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md" target="_blank">Ink Syntax</a></div>\n        <p>Runtimes:</p>\n        <a href="https://github.com/YarnSpinnerTool/YarnSpinner" target="_blank">YarnSpinner (Unity3d)</a>\n        <a href="https://github.com/hylyh/bondage.js" target="_blank">BondageJs (yarn javascript)</a>\n        <a href="https://github.com/inkle/ink-unity-integration" target="_blank">Ink C# (Unity3d)</a>\n        <a href="https://github.com/y-lohse/inkjs" target="_blank">InkJs (javascript)</a>\n        <a href="https://github.com/bladecoder/blade-ink" target="_blank">BladeInk (java)</a>\n        <a href="https://github.com/inkle/ink-library" target="_blank">Many more Ink parsers</a>\n      </div>\n      ',showCancelButton:!0,confirmButtonText:"About",cancelButtonText:"Close"}).then(e=>{e.value&&Swal.fire({title:"About",html:'\n          <div style="text-align: justify">\n            <div><a href="https://github.com/YarnSpinnerTool" target="_blank">Yarn</a> was created by <a href="https://github.com/AlecHolowka" target="_blank">Alec Holowka</a></div>\n            <br>\n            <a href="https://github.com/blurymind/YarnClassic/graphs/contributors" target="_blank">Top contributors:</a>\n            <small>\n              <ul>\n                <li><a href="https://github.com/blurymind" target="_blank">Todor Imreorov</a></li>\n                <li><a href="https://github.com/daviddq" target="_blank">David Diaz</a></li>\n                <li><a href="https://github.com/FaultyFunctions" target="_blank">@FaultyFunctions</a></li>\n              </ul>\n            </small>\n            <a href="https://github.com/blurymind/YarnClassic/issues/new" target="_blank">Report a Bug</a>\n          </div>\n          ',showCancelButton:!1,confirmButtonText:"OK"})})},this.closeSettingsDialog=function(){i(".settings-dialog").css({opacity:1}).transition({opacity:0},250,e=>{n.settingsDialogVisible(!1)}),i(".settings-dialog .form").css({y:"0"}).transition({y:"-100"},250),setTimeout(()=>t.settings.apply(),100)},this.isDialogOpen=function(){return n.settingsDialogVisible()||Swal.isVisible()&&!Swal.isTimerRunning()},this.confirmMarkupConversion=function(){Swal.fire({title:"Are you sure?",text:"Markup on all nodes will be modified. This can rarely result in broken texts. This operation can't be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, convert it!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(e=>{e.value&&(t.convertMarkup(),Swal.fire("Converted!","The markup on the nodes has been converted.","success"))})},this.nodeSearchMatches=function(e,t,n=!1){var o=n||i(".search-title input").is(":checked"),a=n||i(".search-body input").is(":checked"),s=n||i(".search-tags input").is(":checked");return 0!==t.length&&(o||a||s)?{matchTitle:o&&e.title().toLowerCase().indexOf(t)>=0,matchBody:a&&e.body().toLowerCase().indexOf(t)>=0,matchTags:s&&e.tags().toLowerCase().indexOf(t)>=0,clearSearch:!1}:{matchTitle:!1,matchBody:!1,matchTags:!1,clearSearch:!0}},this.findMatchingNodes=function(e){const n={matchTitle:[],matchBody:[],matchTags:[],foundNodes:!1};return[...t.nodes()].reverse().forEach(i=>{const{matchTitle:o,matchBody:a,matchTags:s}=t.ui.nodeSearchMatches(i,e,!0);o&&n.matchTitle.push(i),a&&n.matchBody.push(i),s&&n.matchTags.push(i)}),n.foundNodes=n.matchTitle.length>0||n.matchBody.length>0||n.matchTags.length>0,n},this.createSearchMenuLine=function(e,n,a,s="title"){const r=document.createElement("div");if(r.innerHTML=`${e.title()} ${s?`(${s})`:""}`,i(r).addClass("item "+e.titleStyles[e.colorID()]),"link"==n){if(e.title()!==t.editing().title()){if("ink"===t.settings.documentType()&&e.title().trim()===o.a.InkGlobalScopeNodeName)return;r.setAttribute("onclick","ink"===t.settings.documentType()?"app.insertTextAtCursor('-> "+e.title()+"')":"app.insertTextAtCursor('[["+e.title()+"]]')"),a.appendChild(r)}}else"open"==n&&(r.setAttribute("onclick",`app.openNodeByTitle("${e.title()}")`),r.setAttribute("onmouseenter",`app.workspace.warpToNodeByIdx(${t.nodes.indexOf(e)})`),a.appendChild(r))},this.openNodeListMenu=function(e){const n="link"===e?document.getElementById("linkHelperMenuFilter").value.toLowerCase():document.getElementById("nodeSearchInput").value.toLowerCase(),i=document.getElementById(e+"HelperMenu");i.innerHTML="";const o=()=>{[...t.nodes()].reverse().forEach(t=>{this.createSearchMenuLine(t,e,i,"")})};if(!n)return void o();const a=this.findMatchingNodes(n);a.foundNodes?(a.matchTitle.forEach(t=>{this.createSearchMenuLine(t,e,i,"title")}),a.matchTags.forEach(t=>{this.createSearchMenuLine(t,e,i,"tags")}),a.matchBody.forEach(t=>{this.createSearchMenuLine(t,e,i,"body")})):o()},this.checkAndMoveAppButtons=function(){i(".app-add-node").toggleClass("app-add-node-alt","right"===t.settings.editorSplitDirection()),i(".app-sort").toggleClass("app-sort-alt","right"===t.settings.editorSplitDirection()),i(".app-undo-redo").toggleClass("app-undo-redo-alt","right"===t.settings.editorSplitDirection()),i(".app-zoom").toggleClass("app-zoom-alt","right"===t.settings.editorSplitDirection())},this.resetAppButtonsLocation=function(){i(".app-add-node").removeClass("app-add-node-alt"),i(".app-sort").removeClass("app-sort-alt"),i(".app-undo-redo").removeClass("app-undo-redo-alt"),i(".app-zoom").removeClass("app-zoom-alt")},this.toastMixin=Swal.mixin({toast:!0,icon:"success",title:"Done!",animation:!1,position:"bottom",showConfirmButton:!1,timer:2500,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}}),this.insertTextAtCursorWithParams=function(e="",n=[]){const o=n.map((e,t)=>"boolean"==typeof e.default?`<div class="flex-wrap"><span>${e.name} :</span><input type="checkbox" id="swal-input${t}" class="swal2-input"> </div>`:"number"==typeof e.default?`<div class="flex-wrap"><span>${e.name} :</span><input type="number" step=0.01 id="swal-input${t}" class="swal2-input"> </div>`:`<div class="flex-wrap"><span>${e.name} :</span> <input id="swal-input${t}" class="swal2-input" style="flex:1"></div>`).join("\n");Swal.fire({title:"Snippet properties",html:o,preConfirm:function(){return new Promise((function(e){e(n.map((e,t)=>"boolean"==typeof e.default?i("#swal-input"+t).is(":checked"):i("#swal-input"+t).val()))}))},onOpen:function(){i("#swal-input0").focus(),n.forEach((e,t)=>{void 0!==e.default&&("boolean"==typeof e.default?i("#swal-input"+t)[0].checked=e.default:i("#swal-input"+t)[0].value=e.default,console.log(i("#swal-input"+t)))})}}).then((function(n){if(!n.value)return;let i=e;n.value.forEach((e,t)=>{void 0!==e&&(i=i.replace("%"+t,e))}),t.insertTextAtCursor(i)}))}}}).call(this,n("Z1dp"),n("EVdn"))},gugv:function(e,t,n){},jF1P:function(e,t,n){(function(e){var t,n;t={},n=0,e.bindingHandlers.ace={init:function(i,o,a,s,r){var l=a().aceOptions||{},d=e.utils.unwrapObservable(o());i.id||(i.id="knockout-ace-"+n,n+=1);var c=ace.edit(i.id);l.theme&&c.setTheme("ace/theme/"+l.theme),l.mode&&c.getSession().setMode("ace/mode/"+l.mode),c.setValue(d),c.gotoLine(0),c.setShowPrintMargin(!1),c.getSession().setUseWrapMode(!0),c.getSession().on("change",(function(t){e.isWriteableObservable(o())&&o()(c.getValue())})),t[i.id]=c,e.utils.domNodeDisposal.addDisposeCallback(i,(function(){try{c.destroy()}catch(e){}delete t[i.id]}))},update:function(n,i,o,a,s){var r=e.utils.unwrapObservable(i()),l=n.id;if(void 0!==l&&""!==l&&t.hasOwnProperty(l)){var d=t[l];d.getValue()!==r&&(d.setValue(r),d.gotoLine(0))}}},e.aceEditors={resizeAll:function(){for(var e in t)t.hasOwnProperty(e)&&t[e].resize()},get:function(e){return t[e]}}}).call(this,n("Z1dp"))},"l8+o":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("mIo7"),o=n("mqgS");const a=function(e){const t=e=>{const t=/((https:\/\/)?(www.)?instagram.com\/p\/[^\s\<]+)/gi,n=/(?:http(?:s?):\/\/|)(?:www\.)?youtu(?:be\.com\/watch\?v=|\.be\/)([\w\-\_]*)(&(amp;)?‌​[\w\?‌​=]*)?(?:\?t=[0-9]+)?/gi,i=new RegExp(`^(?!${/(https?:\/\/twitter.com\/[^\s\<]+\/[^\s\<]+\/[^\s\<]+)/gi.source}|${n.source}|${t.source})https?:.*$`,"gm");return e=(e=(e=e.replace(i,(function(e){return`\n      <a class="link" href="${e}">${e}</a>\n    `}))).replace(n,(function(e){const t=e.match(/(?:https\:.*|)(?:www.|)youtu(?:.*\/v\/|.*v\=|\.be\/)([A-Za-z0-9_\-]{11}(?:\?t=[0-9]+)?)/i);if(t.length>1)return`\n        <iframe height="315" src="https://www.youtube.com/embed/${t[1]}" title="YouTube video player"\n              frameBorder="0"\n              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\n              allowFullScreen></iframe> \n      `}))).replace(t,(function(e){const t=e.match(/((?:https?:\/\/)?(?:www.)?instagram.com\/p\/([^\s\<]+)\/)/i);if(t.length>2)return console.log("EXTRACTED",t),`\n            <iframe height="540" src="http://instagram.com/p/${t[2]}/embed" frameborder="0"></iframe>\n      `}))};return"html"===e.settings.markupLanguage()?new o.a(e,t):new i.a(e,t)}},mIo7:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return BbcodeRichTextFormatter}));const bbcode=__webpack_require__("L8pc"),BbcodeRichTextFormatter=function(app,addExtraPreviewerEmbeds){const self=this;this.justInsertedAutoComplete=!1,this.completableTags=Object.freeze([{Start:"<<",Completion:">>",Offset:-2},{Start:"[colo",Completion:"r=#][/color]",Offset:-9,BehaviorCompletion:"r=#][/color",Func:()=>{app.insertColorCode()}},{Start:"[b",Completion:"][/b]",BehaviorCompletion:"][/b",Offset:-4},{Start:"[i",Completion:"][/i]",BehaviorCompletion:"][/i",Offset:-4},{Start:"[img",Completion:"][/img]",BehaviorCompletion:"][/img",Offset:-6},{Start:"[u",Completion:"][/u]",BehaviorCompletion:"][/u",Offset:-4},{Start:"[url",Completion:"][/url]",BehaviorCompletion:"][/url",Offset:-6}]),this.getTagOpen=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"~ ":"{ ":"<<";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"-> ":"* [":"[[";case"color":return"[color=#]";default:return`[${e}]`}},this.getTagClose=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":" }":">>";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":"]":"|]]";default:return`[/${e}]`}},this.identifyTag=function(e){return-1!==e.lastIndexOf("[")?e.substring(e.lastIndexOf("["),e.length):""},this.insertTag=function(e){const t=self.getTagOpen(e),n=self.getTagClose(e),i=JSON.parse(JSON.stringify(app.editor.selection.getRange()));app.editor.session.insert(i.start,t),app.editor.session.insert({column:i.end.column+t.length,row:i.end.row},n),"color"===e&&(0===app.editor.getSelectedText().length?app.moveEditCursor(-9):app.editor.selection.setRange({start:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1},end:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1}}),app.insertColorCode()),"img"===e?0===app.editor.getSelectedText().length&&(app.moveEditCursor(-6),app.data.triggerPasteClipboard(),setTimeout(()=>app.moveEditCursor(6),300)):0===app.editor.getSelectedText().length?app.isEditorInPreviewMode||app.moveEditCursor(-n.length):app.editor.selection.setRange({start:app.editor.selection.getRange().start,end:{row:app.editor.selection.getRange().end.row,column:app.editor.selection.getRange().end.column-n.length}}),app.editor.focus()},this._convertTag=function(inPattern,outPattern,text){const globalRegex=new RegExp(inPattern,"gi"),localRegex=new RegExp(inPattern,"i");return text.replace(globalRegex,m=>{const match=m.match(localRegex),template=eval("`"+outPattern+"`");return match.length?template:null})},this.convert=function(e){let t=e;return t=self._convertTag("<b>(.*?)<\\/b>","[b]${match[1]}[/b]",t),t=self._convertTag("<u>(.*?)<\\/u>","[u]${match[1]}[/u]",t),t=self._convertTag("<i>(.*?)<\\/i>","[i]${match[1]}[/i]",t),t=self._convertTag("<img>(.*?)<\\/img>","[img]${match[1]}[/img]",t),t=self._convertTag("<color=#(.*?)>(.*?)<\\/color>","[color=#${match[1]}]${match[2]}[/color]",t),t=self._convertTag("<url>(.*?)<\\/url>","[url]${match[1]}[/url]",t),t},this.richTextToHtml=function(e,t=!1){let n=1,i=t?'<div><font color="pink">'+n+". </font><font>"+e+"</font></div>":e;return i=i.replace(/<</gi,"<font color='violet'>(run:"),i=i.replace(/>>/gi,")</font>"),i=i.replace(/\[color=#[A-Za-z0-9]+\]/gi,(function(e){const t=e.match(/\[color=#([A-Za-z0-9]+)\]/i);if(t&&t.length>1)return"[color=#"+t[1]+"]<font color=#"+t[1]+">&#9751</font>"})),i=i.replace(/\[img\][^\[]+\[\/img\]/gi,(function(e){const n=e.match(/\[img\](.*)\[\/img\]/i);if(n.length>1){const e=app.data.editingFileFolder(n[1]);return app.data.doesFileExist(e)?t?'<img src="'+e+'"> </img>':'<img src="'+e+'" width="128" height="auto"> </img>':t?'<img src="'+n[1]+'"> </img>':'<img src="'+n[1]+'" width="128" height="auto"> </img>'}})),t&&(i=addExtraPreviewerEmbeds(i)),i=i.replace(/[\n\r]/g,(function(e){let i="</font><br/>";return n+=1,t&&(i+='</div><div><font color="pink">'+n+". </font><font>"),i})),i=bbcode.parse(i),i}}},mqgS:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return HtmlRichTextFormatter}));const HtmlRichTextFormatter=function(app,addExtraPreviewerEmbeds){const self=this;this.justInsertedAutoComplete=!1,this.completableTags=Object.freeze([{Start:"<<",Completion:">>",Offset:-2},{Start:"<colo",Completion:"r=#></color>",Offset:-9,Func:()=>{app.insertColorCode()}},{Start:"<b",Completion:"></b>",Offset:-4},{Start:"<img",Completion:"></img>",Offset:-6},{Start:"<i",Completion:"></i>",Offset:-4},{Start:"<u",Completion:"></u>",Offset:-4},{Start:"<url",Completion:"></url>",Offset:-6}]),this.getTagOpen=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"~ ":"{ ":"<<";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"-> ":"* [":"[[";case"color":return"<color=#>";default:return`<${e}>`}},this.getTagClose=function(e){switch(e){case"cmd":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":" }":">>";case"opt":return"ink"===app.settings.documentType()?0===app.editor.getSelectedText().length?"":"]":"|]]";default:return`</${e}>`}},this.identifyTag=function(e){return-1!==e.lastIndexOf("<")?e.substring(e.lastIndexOf("<"),e.length):""},this.insertTag=function(e){const t=self.getTagOpen(e),n=self.getTagClose(e),i=JSON.parse(JSON.stringify(app.editor.selection.getRange()));app.editor.session.insert(i.start,t),app.editor.session.insert({column:i.end.column+t.length,row:i.end.row},n),"color"===e&&(0===app.editor.getSelectedText().length?app.moveEditCursor(-9):app.editor.selection.setRange({start:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1},end:{row:app.editor.selection.getRange().start.row,column:app.editor.selection.getRange().start.column-1}}),app.insertColorCode()),"img"===e?navigator.clipboard.readText().then(e=>{0===app.editor.getSelectedText().length&&(app.moveEditCursor(-7),app.insertTextAtCursor(` src="${e}"`))}):0===app.editor.getSelectedText().length?app.isEditorInPreviewMode||app.moveEditCursor(-n.length):app.editor.selection.setRange({start:app.editor.selection.getRange().start,end:{row:app.editor.selection.getRange().end.row,column:app.editor.selection.getRange().end.column-n.length}}),app.editor.focus()},this._convertTag=function(inPattern,outPattern,text){const globalRegex=new RegExp(inPattern,"gi"),localRegex=new RegExp(inPattern,"i");return text.replace(globalRegex,m=>{const match=m.match(localRegex),template=eval("`"+outPattern+"`");return match.length?template:null})},this.convert=function(e){let t=e;return t=self._convertTag("\\[b\\](.*?)\\[\\/b\\]","<b>${match[1]}</b>",t),t=self._convertTag("\\[u\\](.*?)\\[\\/u\\]","<u>${match[1]}</u>",t),t=self._convertTag("\\[i\\](.*?)\\[\\/i\\]","<i>${match[1]}</i>",t),t=self._convertTag("\\[img\\](.*?)\\[\\/img\\]","<img>${match[1]}</img>",t),t=self._convertTag("\\[color=#(.*?)\\](.*?)\\[\\/color\\]","<color=#${match[1]}>${match[2]}</color>",t),t=self._convertTag("\\[url\\](.*?)\\[\\/url\\]","<url>${match[1]}</url>",t),t},this.richTextToHtml=function(e,t=!1){let n=1,i=t?'<div><font color="pink">'+n+". </font><font>"+e+"</font></div>":e;return i=i.replace(/<</gi,"<font color='violet'>(run:"),i=i.replace(/>>/gi,")</font>"),[/&lt;color=#(.*?)&gt;(.*?)&lt;\/color&gt;/,/<color=#(.*?)>(.*?)<\/color>/].forEach(e=>{const t=new RegExp(e,"gi"),n=new RegExp(e,"i");i=i.replace(t,(function(e){const t=e.match(n);if(t&&t.length>2)return`<font color=#${t[1]}>&#9751${t[2]}</font>`}))}),i=i.replace(/&lt;img&gt;[^\[]+&lt;\/img&gt;/gi,(function(e){const n=e.match(/&lt;img&gt;(.*?)&lt;\/img&gt;/i);if(n.length>1){const e=app.data.editingFileFolder(n[1]);return app.data.doesFileExist(e)?t?'<img src="'+e+'"> </img>':'<img src="'+e+'" width="128" height="auto"> </img>':t?'<img src="'+n[1]+'"> </img>':'<img src="'+n[1]+'" width="128" height="auto"> </img>'}})),i=i.replace(/&lt;b&gt;.*&lt;\/b&gt;/gi,e=>{const t=e.match(/&lt;b&gt;(.*)&lt;\/b&gt;/i);if(t.length)return`<b>${t[1]}</b>`}),i=i.replace(/&lt;u&gt;.*&lt;\/u&gt;/gi,e=>{const t=e.match(/&lt;u&gt;(.*)&lt;\/u&gt;/i);if(t.length)return`<u>${t[1]}</u>`}),i=i.replace(/&lt;i&gt;.*&lt;\/i&gt;/gi,e=>{const t=e.match(/&lt;i&gt;(.*)&lt;\/i&gt;/i);if(t.length)return`<i>${t[1]}</i>`}),t&&(i=addExtraPreviewerEmbeds(i)),i=i.replace(/[\n\r]/g,(function(e){let i="</font><br/>";return n+=1,t&&(i+='</div><div><font color="pink">'+n+". </font><font>"),i})),i}}},oj90:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"FILETYPE",(function(){return i})),n.d(t,"Utils",(function(){return o}));var i={JSON:"json",XML:"xml",TWEE:"twee",TWEE2:"tw2",UNKNOWN:"none",YARN:"yarn",INK:"ink",INKJSON:"ink.json",RENPY:"rpy"},o={createAutocompleter:function(e,t,n,i=1){return{getCompletions:function(o,a,s,r,l){var d=o.session.getTokenAt(s.row,s.column);r.length<i||e&&!e.includes(d.type)?l(null,[]):l(null,t.map((function(e){return"object"==typeof e?{caption:e.word,value:e.word,meta:n,title:e.title,about:e.about,titleStyle:e.titleStyle}:{caption:e,value:e,meta:n}})))},getDocTooltip:function(e){if(!e.title&&!e.about)return"";e.docHTML=[`<div class='${e.titleStyle||"title-style-1"}' style='\n            display: flex;\n            flex-direction: column; \n            font-size: 0.8rem;\n            padding: 3px;'>`,"<p>",e.title,"</p>","<div class='node' style='\n            position:relative;\n            min-width: 100%;\n            overflow: hidden;'>","<div class='body' style='\n             font-size: 0.7rem;\n             line-height: 1rem;\n             top: 0;\n             padding: 3px'>",e.about,"</div>","</div>","</div>"].join("")}}},addDoubleTapDetector:function(e,t){e.lastTap=0,e.tapTimeout=0,e.addEventListener("touchend",(function(n){var i=(new Date).getTime(),o=i-e.lastTap;clearTimeout(e.tapTimeout),o<500&&o>0?(t(),n.preventDefault()):e.tapTimeout=setTimeout((function(){clearTimeout(e.tapTimeout)}),500),e.lastTap=i}))},uniqueSplit:function(e,t=" "){return[...new Set(e.split(t).filter(e=>e))]},getHighestZ:function(t){let n=Number.NEGATIVE_INFINITY;return e(t).children().each((function(){let t=parseInt(e(this).css("z-index"))||0;t>n&&(n=t)})),n},clamp:function(e,t,n){return Math.max(Math.min(e,n),t)},rectanglesOverlap:function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},stripHtml:function(e){for(;e.indexOf("<")>=0;)e=e.replace("<","&lt;");for(;e.indexOf(">")>=0;)e=e.replace(">","&gt");return e},xmlToObject:function(e){var t=[];if((e=e.childNodes.item(0)).hasChildNodes())for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes.item(n);if(i.hasChildNodes()){for(var o={},a=!1,s=0;s<i.childNodes.length;s++){var r=i.childNodes.item(s);if("#text"!=r.nodeName&&(a=!0,r.hasChildNodes()?o[r.nodeName]=r.childNodes.item(0).nodeValue:o[r.nodeName]="",r.attributes.length>0)){o[r.nodeName]={};for(var l=0;l<r.attributes.length;l++){var d=r.attributes.item(l);o[r.nodeName][d.nodeName]=d.nodeValue}}}a&&t.push(o)}}return t},now:Date.now||function(){return(new Date).getTime()},getPublicPath:function(e){return window.getPublicVsCodeWebviewUri?window.getPublicVsCodeWebviewUri(e):"public"+(e?"/"+e:"")},getEditorContextMenu:function(e){return{selector:".node-editor .form .editor",trigger:"right",build:function(t){var n={items:{}};if(!/^\[color=#([a-zA-Z0-9]{3,6})$/.test(app.getTagBeforeCursor())){if(app.editor.getSelectedText().length>1){if(n.items={cut:{name:"Cut",icon:"cut",callback:()=>{app.clipboard.length>0&&(app.data.triggerCopyClipboard(),app.insertTextAtCursor(""))}},copy:{name:"Copy",icon:"copy",callback:()=>{app.data.triggerCopyClipboard()}},paste:{name:"Paste",icon:"paste",callback:()=>app.data.triggerPasteClipboard()},sep1:"---------"},!app.getTagBeforeCursor().match(e)||"ink"===app.settings.documentType()&&"END"===app.editor.getSelectedText()||(n.items["go to node"]={name:"Edit node: "+app.editor.getSelectedText(),callback:()=>{const e=app.getFutureEditedNodeTitle();app.nodeVisitHistory.includes(e)||app.nodeVisitHistory.push(e),app.openNodeByTitle(app.editor.getSelectedText())}}),app.settings.spellcheckEnabled()){var i=app.getSpellCheckSuggestionItems();!1!==i&&(n.items.corrections={name:"Correct word",items:i})}var o=app.getThesaurusItems();!1!==o&&(n.items.corrections={name:"Related words",items:o})}else n.items={paste:{name:"Paste",icon:"paste",callback:()=>app.data.triggerPasteClipboard()}},"ink"===app.settings.documentType()&&(n.items.inkSnips={name:"Ink snippets",items:{structure:{name:"Structure",items:{stitch:{name:"Stitch",callback:()=>{app.insertTextAtCursor("= stitchName\nThis is the content of the stitch that should be embedded within a knot.\n-> END")}},end:{name:"Ending indicator",callback:()=>{app.insertTextAtCursor("-> END")}}}},choices:{name:"Choices",items:{basicChoice:{name:"Basic choice",callback:()=>{app.insertTextAtCursor("* This is a choice that can only be chosen once")}},stickyChoice:{name:"Sticky choice",callback:()=>{app.insertTextAtCursor("+ This is a sticky choice - the player can choose it more than once")}},choiceWithoutPrinting:{name:"Choice without printing",callback:()=>{app.insertTextAtCursor("* [A choice where the content isn't printed after choosing]")}},choiceWithoutMixedOutput:{name:"Choice without mixed output",callback:()=>{app.insertTextAtCursor("* Try [it] this example!")}}}},variableText:{name:"Variable text",items:{shuffle:{name:"~Shuffle (rand) text",callback:()=>{app.insertTextAtCursor("I tossed the coin. {~Heads|Tails}.")}},cycle:{name:"&Cycle text",callback:()=>{app.insertTextAtCursor("It was {&Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday} today.")}},sequence:{name:"Sequence text",callback:()=>{app.insertTextAtCursor('The radio hissed into life. {"Three!"|"Two!"|"One!"|There was the white noise racket of an explosion.|But it was just static.}\n\n{I bought a coffee with my five-pound note.|I bought a second coffee for my friend.|I didn\'t have enough money to buy any more coffee.}')}},onceOnly:{name:"!Once only text",callback:()=>{app.insertTextAtCursor("He told me a joke. {!I laughed politely.|I smiled.|I grimaced.|I promised myself to not react again.}\n")}}}},variables:{name:"Variables",items:{globalVariable:{name:"Global variable",callback:()=>{app.insertTextAtCursor("VAR myNumber = 5")}},temporaryVariable:{name:"Temporary variable",callback:()=>{app.insertTextAtCursor("temp myTemporaryValue = 5")}},modifyVariable:{name:"Modify variable",callback:()=>{app.insertTextAtCursor("~ myNumber = myNumber + 1")}}}},conditions:{name:"Conditions",items:{inlineCondition:{name:"Inline condition",callback:()=>{app.insertTextAtCursor("{yourVariable: This is written if yourVariable is true|Otherwise this is written}\n")}},multilineCondition:{name:"Multiline condition",callback:()=>{app.insertTextAtCursor("{yourVariable:\n    This is written if yourVariable is true.\n  - else:\n    Otherwise this is written.\n}")}}}}}},n.items.code={name:"Code",items:{equal:{name:"== (equal)",callback:()=>app.insertTextAtCursor("== ")},notEqual:{name:"!= (not equal)",callback:()=>app.insertTextAtCursor("!= ")},tag:{name:"# (tag)",callback:()=>app.insertTextAtCursor("# ")},list:{name:"LIST",callback:()=>app.insertTextAtCursor("LIST = ")},listFunc:{name:"List functions",items:{count:{name:"count",callback:()=>app.insertTextAtCursor("LIST_COUNT()")},min:{name:"min",callback:()=>app.insertTextAtCursor("LIST_MIN()")},max:{name:"max",callback:()=>app.insertTextAtCursor("LIST_MAX()")},rand:{name:"random",callback:()=>app.insertTextAtCursor("LIST_RANDOM()")}}},variable:{name:"VAR",callback:()=>app.insertTextAtCursor("VAR = ")},temp:{name:"~ temp",callback:()=>app.insertTextAtCursor("~ temp = ")},plusEq:{name:"+= (plus equal)",callback:()=>app.insertTextAtCursor("+= ")},else:{name:"- else",callback:()=>app.insertTextAtCursor("- else:\n")},or:{name:"|",callback:()=>app.insertTextAtCursor("|")},rand:{name:"~",callback:()=>app.insertTextAtCursor("~")}}},n.items.bladeCoder={name:"BladeCoder",items:{player:{name:"$PLAYER>",callback:()=>app.insertTextAtCursor("$PLAYER> ")},animation:{name:"Animation",callback:()=>app.ui.insertTextAtCursorWithParams("> Animation: animation=%0.%1, wait=%2, keepDirection=%3, repeat=%4, count=%5",[{name:"Actor",default:"$PLAYER"},{name:"Animation",default:"stand.right"},{name:"Wait",default:!1},{name:"Keep direction",default:!1},{name:"Repeat",default:"SPRITE_DEFINED"},{name:"Count",default:-1}])},goto:{name:"Goto",callback:()=>app.ui.insertTextAtCursorWithParams("> Goto: actor=%0, target=%1",[{name:"Actor",default:"$PLAYER"},{name:"target",default:"target"}])},wait:{name:"Wait",callback:()=>app.ui.insertTextAtCursorWithParams("> Wait: time=%0",[{name:"Time",default:.8}])},playSound:{name:"Play Sound",callback:()=>app.ui.insertTextAtCursorWithParams("> PlaySound: sound=%0, stop=%1",[{name:"Sound",default:"yawn"},{name:"Stop",default:!1}])},setActorAttr:{name:"Set Actor Attribute",callback:()=>app.ui.insertTextAtCursorWithParams("> SetActorAttr: actor=%0, talkAnimation=%1, visible=%2",[{name:"Actor",default:"$PLAYER"},{name:"Talk animation"},{name:"Visible",default:!0}])}}},n.items.end={name:"-> END",callback:()=>app.insertTextAtCursor("-> END")},n.items.star={name:"* (choice)",callback:()=>app.insertTextAtCursor("* ")},n.items.gather={name:"- (gather)",callback:()=>app.insertTextAtCursor("-")},n.items.stitch={name:"= (stitch)",callback:()=>app.insertTextAtCursor("= ")},n.items.glue={name:"<> (glue)",callback:()=>app.insertTextAtCursor("<>")},n.items.comment={name:"// (comment)",callback:()=>app.insertTextAtCursor("// ")},n.items.nested={name:"Nested",items:{gather2:{name:"-- (gather)",callback:()=>app.insertTextAtCursor("-- ")},star2:{name:"** (choice)",callback:()=>app.insertTextAtCursor("** ")}}},n.items.inkDoc={name:"How to use ink",callback:()=>window.open("https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md","_blank").focus()});return app.getTagBeforeCursor().match(/\[img/g)&&(n.items["Choose image"]={name:"Choose image",callback:()=>{app.data.insertImageFileName()}}),n}}}},debounce:function(e,t){var n;return function(){clearTimeout(n),n=setTimeout((function(){e()}),t)}}}}.call(this,n("EVdn"))},owJe:function(e,t,n){(function(e){var i=n("jXEy"),o=n("oj90"),a=o.Utils.getPublicPath("dictionaries/en/index.dic"),s=o.Utils.getPublicPath("dictionaries/en/index.aff");e("<style type='text/css'>.ace_marker-layer .misspelled { position: absolute; z-index: -2; border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head"),e("<style type='text/css'>.misspelled { border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head");var r=null;function l(e){var t=e.split(/\s+|\.|\,|\?|\\|\/|\!|\[|\]|"|'|;|:|`|\+|\-|\&|\$|@|~|#|>|<|_|\)|\(|£|\^|%|\*|„|“|\||[0-9]+/g),n=0,i=[];for(word in t){var o=t[word];r.correct(o)||(i[i.length]=[n,n+t[word].length]),n+=t[word].length+1}return i}t.load_dictionary=function(t){console.info(`Loading ${t} hunspell dictionary locally`),a=o.Utils.getPublicPath(`dictionaries/${t}/index.dic`),s=o.Utils.getPublicPath(`dictionaries/${t}/index.aff`),e.get(a,(function(e){dicData=e})).fail((function(){const n=sessionStorage.getItem("affData"),o=sessionStorage.getItem("dicData");if(n&&o)return console.info(t+" found in sessionStorage. Loading dictionary from cache..."),r=new i(n,o),void(d=!0);console.error(t+" not found locally. Loading dictionary from server instead..."),a=`https://raw.githubusercontent.com/wooorm/dictionaries/main/dictionaries/${t}/index.dic`,s=`https://raw.githubusercontent.com/wooorm/dictionaries/main/dictionaries/${t}/index.aff`,e.get(a,(function(e){dicData=e})).done((function(){e.get(s,(function(e){affData=e})).done((function(){sessionStorage.setItem("affData",affData),sessionStorage.setItem("dicData",dicData),r=new i(affData,dicData),d=!0}))}))})).done((function(){e.get(s,(function(e){affData=e})).done((function(){console.log("Dictionary loaded locally"),r=new i(affData,dicData),d=!0}))}))},t.misspelled=l;var d=!0,c=!1,p=[];function u(){if(null!=r&&!c&&d){c=!0;var e=ace.edit("editor").getSession();h();try{var t=ace.require("ace/range").Range,n=e.getDocument().getAllLines();for(var i in n){var o=l(n[i]);for(var a in o){var s=new t(i,o[a][0],i,o[a][1]);p[p.length]=e.addMarker(s,"misspelled","typo",!0)}}}finally{c=!1,d=!1}}}t.spell_check=u;var g=!1;function h(){var e=ace.edit("editor").getSession();for(var t in p)e.removeMarker(p[t]);p=[];var n=e.getDocument().getAllLines();for(var t in n)e.removeGutterDecoration(t,"misspelled")}t.enable_spellcheck=function(){g=!0,ace.edit("editor").getSession().on("change",(function(e){g&&(d=!0,u())})),d=!0,u()},t.disable_spellcheck=function(){g=!1,h()},t.clear_spellcheck_markers=h,t.suggest_word_for_misspelled=function(e){var t=r.suggest(e);return 0!==t.length&&t}}).call(this,n("EVdn"))},pLxK:function(e){e.exports=JSON.parse('{"a":"0.4.263"}')},pYPP:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i}));const i=function(t){const n=this,i=window.vsCodeApi?{getItem:()=>{},setItem:()=>{}}:window.localStorage;this.storage=i,e.extenders.persist=function(e,t){return e.subscribe((function(e){i.setItem(t,e)})),e},this.apply=function(){t.setTheme(n.theme()),t.setLanguage(n.language()),t.setDocumentType(n.documentType()),t.toggleInvertColors(),t.setMarkupLanguage(n.markupLanguage()),console.log("redraw throttle:",n.redrawThrottle()),t.workspace.setThrottle(n.redrawThrottle()),t.setGistCredentials({token:n.gistToken(),file:null!==n.gistFile()?n.gistFile().split("/").pop():null})},this.validateGridSize=function(){n.gridSize()<20&&n.gridSize(20),n.gridSize()>200&&n.gridSize(200),n.gridSize(parseInt(n.gridSize())),t.initGrid()},this.theme=e.observable(i.getItem("theme")||"dracula").extend({persist:"theme"}),this.documentType=e.observable(i.getItem("documentType")||"yarn").extend({persist:"documentType"}),this.language=e.observable(i.getItem("language")||"en-GB").extend({persist:"language"}),this.redrawThrottle=e.observable(parseInt(i.getItem("redrawThrottle")||"130")).extend({persist:"redrawThrottle"}),this.gistToken=e.observable(i.getItem("gistToken")).extend({persist:"gistToken"}),this.gistFile=e.observable(i.getItem("gistFile")).extend({persist:"gistFile"}),this.spellcheckEnabled=e.observable(null===i.getItem("spellcheckEnabled")||"true"===i.getItem("spellcheckEnabled")).extend({persist:"spellcheckEnabled"}),this.autoCloseTags=e.observable(null===i.getItem("autoCloseTags")||"true"===i.getItem("autoCloseTags")).extend({persist:"autoCloseTags"}),this.autocompleteSuggestionsEnabled=e.observable(null===i.getItem("autocompleteSuggestionsEnabled")||"true"===i.getItem("autocompleteSuggestionsEnabled")).extend({persist:"autocompleteSuggestionsEnabled"}),this.autoCloseBrackets=e.observable(null===i.getItem("autoCloseBrackets")||"true"===i.getItem("autoCloseBrackets")).extend({persist:"autoCloseBrackets"}),this.invertColorsEnabled=e.observable(null!==i.getItem("invertColorsEnabled")&&"true"===i.getItem("invertColorsEnabled")).extend({persist:"invertColorsEnabled"}),this.snapGridEnabled=e.observable(null!==i.getItem("snapGridEnabled")&&"true"===i.getItem("snapGridEnabled")).extend({persist:"snapGridEnabled"}),this.gridSize=e.observable(parseInt(i.getItem("gridSize")||"40")).extend({persist:"gridSize"}),this.createNodesEnabled=e.observable(null===i.getItem("createNodesEnabled")||"true"===i.getItem("createNodesEnabled")).extend({persist:"createNodesEnabled"}),this.editorStatsEnabled=e.observable(null!==i.getItem("editorStatsEnabled")&&"true"===i.getItem("editorStatsEnabled")).extend({persist:"editorStatsEnabled"}),this.markupLanguage=e.observable(i.getItem("markupLanguage")||"bbcode").extend({persist:"markupLanguage"}),this.filetypeVersion=e.observable(i.getItem("filetypeVersion")||"1").extend({persist:"filetypeVersion"}),this.lineStyle=e.observable(i.getItem("lineStyle")||"straight").extend({persist:"lineStyle"}),this.fileTabsVisible=e.observable(null===i.getItem("fileTabsVisible")||"true"===i.getItem("fileTabsVisible")).extend({persist:"fileTabsVisible"}),this.selectedFileTab=e.observable(i.getItem("selectedFileTab")||0).extend({persist:"selectedFileTab"}),this.alwaysOpenNodesInVisualStudioCodeEditor=e.observable(null!==i.getItem("alwaysOpenNodesInVisualStudioCodeEditor")&&"true"===i.getItem("alwaysOpenNodesInVisualStudioCodeEditor")).extend({persist:"alwaysOpenNodesInVisualStudioCodeEditor"}),this.editorSplitDirection=e.observable(i.getItem("editorSplitDirection")||"left").extend({persist:"editorSplitDirection"}),this.editorSplit=e.observable(null!==i.getItem("editorSplit")&&"true"===i.getItem("editorSplit")).extend({persist:"editorSplit"}),this.editorSplitSize=e.observable(i.getItem("editorSplitSize")||"50%").extend({persist:"editorSplitSize"})}}).call(this,n("Z1dp"))},qVgP:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var i=n("+qE3");const{Story:o}=n("OeYU");var a=function(){let t=new i.EventEmitter;this.emiter=t,this.story=null,this.log=[],this.onRecompile=()=>{},this.curStory={messages:[],choices:[],tags:[],paragraphEl:""},this.resetStory=()=>{this.prevSavePoints=[],this.choiceHistory=[],this.textAreaEl.innerHTML="",this.curStory={messages:[],choices:[],tags:[],paragraphEl:""},this.story.ResetState()},this.terminate=()=>{if(this.textAreaEl)try{t.removeAllListeners(),this.finished=!0}catch(e){console.warn(e)}},this.setCurStory=({messages:e,choices:t,tags:n,paragraphEl:i})=>{this.curStory={messages:e,choices:t,tags:n,paragraphEl:i}};const n=(e="",t="")=>{const n=(e=>{let t=[];for(;e.canContinue;)t.push(e.Continue().replace(/\n/g,""));return t})(this.story),i=e.includes('"')?e:`[${e}]`,o=document.createElement("p");if(e){const a=document.createElement("p");a.innerHTML=`<p style="text-align: right;" id="${t}" class="playtestLink" title="Click to open [${t}] Node">${e} ( ${t} )</p>`,a.onclick=()=>app.navigateToNodeDuringPlayTest(t,i),o.appendChild(a),n.forEach(e=>{const t=document.createElement("p");t.innerHTML=e+"<br/>",o.appendChild(t)})}else o.innerHTML=n.join("<br/>");this.setCurStory({...this.curStory,messages:this.log?[...this.curStory.messages,e?`--${e}--`:"",n].filter(Boolean):[n],tags:this.story.currentTags,choices:this.story.currentChoices,paragraphEl:o}),s()};this.prevSavePoints=[];const a=(e,t)=>{this.prevSavePoints.push(this.story.state.toJson());const i=this.story.state.currentChoices[e].sourcePath.split(".")[0];this.story.ChooseChoiceIndex(e),n(t,i)};this.rewindStory=()=>{document.getElementById("choiceButtons").remove(),this.textAreaEl.removeChild(this.textAreaEl.lastElementChild),this.story.state.LoadJson(this.prevSavePoints.pop()),n()},this.createAndAddParagraph=t=>{if(console.log("made",t),t.innerHTML){const n=document.createElement("p");n.appendChild(t),n.className="story-playtest-bubble story-playtest-answer answer-post fade-in is-paused",this.textAreaEl.appendChild(n),e(n).removeClass("is-paused")}};const s=()=>{this.createAndAddParagraph(this.curStory.paragraphEl),this.textAreaEl.querySelectorAll("div").forEach(e=>e.remove());const e=document.createElement("div");e.id="choiceButtons",e.className="flex-wrap";const t=document.createElement("button");t.innerText="🔄",t.title="Recompile story",t.onclick=this.onRecompile,t.className="storyPreviewChoiceButton",e.appendChild(t);const i=document.createElement("button");i.innerText="🎬",i.title="Restart story",i.onclick=()=>{this.resetStory(),n()},i.className="storyPreviewChoiceButton",e.appendChild(i);const o=document.createElement("button");o.innerText="⏪",o.title="Go to previous",o.disabled=0===this.prevSavePoints.length,o.onclick=()=>{this.rewindStory(),n()},e.appendChild(o),o.className="storyPreviewChoiceButton",this.curStory.choices.forEach((t,n)=>{const i=document.createElement("button");i.innerText=t.text,i.onclick=e=>{e.stopPropagation(),a(n,t.text)},i.className="storyPreviewChoiceButton",e.appendChild(i)}),this.textAreaEl.appendChild(e),this.textAreaEl.scrollTo({top:this.textAreaEl.scrollHeight+100,left:0,behavior:"smooth"})};this.initInk=(e,t,i,a,s,r,l,d,c,p)=>{this.onRecompile=t,console.log("INIT INK"),this.finished=!1,document.getElementById(r).style.visibility="hidden",this.textAreaEl=document.getElementById(d),this.textAreaEl.innerHTML='<div class="opacity-pulse centered"><h2>Parsing ink</h2> <h2 class="story-animated-dots"><p>.</p><p>.</p><p>.</p></h2></div>',this.inkTextData=a,this.compiler=e,this.compiler.init(e=>{if(this.textAreaEl.innerHTML="",e.errors.length>0)return this.textAreaEl.innerHTML=`<div class="title-error"><p>Parsing failed:</p>><br/><p>${e.errors.join("</p><p>")}</p><br/><p>${e.warnings.join("</p><p>")}</p></div>`,void(this.textAreaEl.onclick=()=>{console.log("====>",e),app.data.goToErrorInkNode(this.inkTextData,e.errors[0]),this.textAreaEl.onclick=null});if(e.warnings.length>0){const t=document.createElement("p");t.className="title-warning",e.warnings.forEach(e=>{const n=document.createElement("p");n.innerText=e,n.onclick=()=>{app.data.goToErrorInkNode(this.inkTextData,e)},t.appendChild(n)}),this.createAndAddParagraph(t)}if(this.story=new o(e.story),console.log("STORY",this.story),console.warn("Warnings",e.warnings),n(),""===this.story.currentText&&0===this.story.currentChoices.length)if(s!==app.data.InkGlobalScopeNodeName)this.compiler.submit(`-> ${s}\n`+a);else{const e=a.split("\n").find(e=>e.includes("==="));this.compiler.submit(`-> ${e.split("===")[1]}\n`+a)}}).then(()=>{if(!i.recompile&&i.story&&0!==i.prevSavePoints.length)return this.story=i.story,i.childNodes.forEach(e=>this.textAreaEl.appendChild(e)),this.prevSavePoints=i.prevSavePoints,void n();a&&this.compiler.submit(a)})}}}).call(this,n("EVdn"))},tUqF:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));const i=n("Wd8k"),o=n("L8pc"),a=new i.Runner,s=n("+qE3").EventEmitter;var r=function(){this.visitedNodes=[];this.node={title:""};let e=new s;this.emiter=e;let t=[];this.commandsPassedLog=t;this.commandPassed="";let n=!0;this.finished=n,this.scrollTextStyle=!1,this.visitedChapters=[],this.self=this,this.vnChoiceSelectionCursor=">",this.startTimeWait,this.vnSelectedChoice=-1,this.vnTextScrollInterval,this.storyChapter="",this.choices={};let i,r,l,d,c,p,u,g,h=null;this.vnSelectChoice=()=>{(new Date).getTime()-this.startTimeWait<1e3||(this.choices[this.storyChapter].push(d.options[this.vnSelectedChoice]),d.select(this.vnSelectedChoice),this.emiter.emit("choiceMade",d.options[this.vnSelectedChoice]),r="",i=void 0,d=self.goToNext(),this.vnSelectedChoice=-1,this.changeTextScrollSpeed(111))},this.vnUpdateChoice=(t=0)=>{if(this.vnSelectedChoice<0)return;let n=this.vnSelectedChoice+t;n>d.options.length-1?n=0:n<0&&(n=d.options.length-1),this.vnSelectedChoice=n,i=document.createElement("DIV"),d.options.forEach((e,t)=>{const n=document.createElement("DIV");t==this.vnSelectedChoice?n.innerHTML=`${this.vnChoiceSelectionCursor} [${e}]`:n.innerHTML=`${this.vnChoiceSelectionCursor.replace(/.*/gm,"&nbsp;")} [${e}]`,n.onclick=e=>{e.stopPropagation(),this.vnSelectedChoice=t,this.vnUpdateChoice()},n.ondblclick=e=>{e.stopPropagation(),this.vnSelectedChoice=t,this.vnSelectChoice()},n.className="storyPreviewChoiceButton",i.appendChild(n)}),e.emit("choiceUpdated",this.vnSelectedChoice),self.updateVNHud()},this.changeTextScrollSpeed=(t=0)=>{if(t!==this.vnTextScrollInterval){if(this.vnTextScrollInterval=t,clearInterval(p),h<0){if(this.isFinishedParsing(d))return void e.emit("finished");if("TextResult"===d.constructor.name)return r=d.text,h=0,e.emit("textResult",r),void this.changeTextScrollSpeed(220);"OptionsResult"===d.constructor.name&&-1===this.vnSelectedChoice&&(this.vnSelectedChoice=0,this.vnUpdateChoice(),this.startTimeWait=(new Date).getTime())}0!==t&&(p=setInterval(this.scrollUpdateText,t))}},self.goToNext=()=>{const e=c.next().value;if(!this.isFinishedParsing(e))return"TextResult"===e.constructor.name&&e.data&&this.node.title!==e.data.title&&(r="",h=-1,this.node=self.jsonCopy(e.data),this.visitedNodes.push(e.data.title),this.emiter.emit("startedNode",this.node)),e},this.isFinishedParsing=e=>(void 0===e||null===d)&&(n||(n=!0,h=-1),n=!0,n),this.runCommand=()=>{e.emit("commandCall",d.text),t.push(d.text),d=self.goToNext(),this.isFinishedParsing(d)||("TextResult"===d.constructor.name&&(r+="\n"+d.text,e.emit("textResult",d.text)),"OptionsResult"===d.constructor.name&&(h=-1))},this.scrollUpdateText=()=>{if(!this.isFinishedParsing(d))if(h<0)"CommandResult"===d.constructor.name&&this.runCommand();else if(h>r.length){if("TextResult"===d.constructor.name){if(d=self.goToNext(),this.isFinishedParsing(d))return;"CommandResult"===d.constructor.name?this.runCommand():("TextResult"===d.constructor.name||"OptionsResult"===d.constructor.name)&&(h=-1)}}else"TextResult"===d.constructor.name&&(h+=1,l=r.substring(0,h),self.updateVNHud())},self.updateVNHud=()=>{if("TextResult"===d.constructor.name){for(;l.lastIndexOf("[img]")>l.lastIndexOf("[/img]");)h+=1,l=r.substring(0,h);for(;l.lastIndexOf("[")>l.lastIndexOf("]");)h+=1,l=r.substring(0,h)}this.scrollTextStyle&&(document.getElementById(u).innerHTML=o.parse(l)+"<br>"),void 0!==i&&(this.scrollTextStyle||(document.getElementById(u).innerHTML=""),document.getElementById(u).appendChild(i))},this.terminate=()=>{try{let t=document.getElementById(u);t&&(t.innerHTML=""),t=document.getElementById(g),t&&(t.innerHTML=""),i=void 0,e.removeAllListeners(),this.finished=!0}catch(e){console.warn(e)}},this.initYarn=(t,i,s,r,l,d,c)=>{const p=["#f5ff6f","#44fe66","#e00ec0","#e93ecf","#0ec0e0","#3ecfe9","#e4dbcb","#978e7e","#666","#2f919a","deeppink","black","#97E1E9","#576574","#6EA5E0","#9EDE74","#FFE374","#F7A666","#C47862"],h=["__̴ı̴̴̡̡̡ ̡͌l̡̡̡ ̡͌l̡*̡̡ ̴̡ı̴̴̡ ̡̡͡| ̲▫̲͡ ̲̲͡▫̲̲͡͡ ̲|̡̡̡ ̡, ̴̡ı̴̡̡ ̡͌l̡̡̡̡.___","°º¤ø,¸¸,ø¤º°`°º¤ø,¸,ø¤°º¤ø,¸¸,ø¤º°`°º¤ø,¸","(===||:::::::::::::::>","¸.·´¯`·.´¯`·.¸¸.·´¯`·.¸><(((º>","=^..^=","|==|iiii|>-----"," ¦̵̱ ̵̱ ̵̱ ̵̱ ̵̱(̢ ̡͇̅└͇̅┘͇̅ (▤8כ−◦","(♥_♥)","龴ↀ◡ↀ龴","☁ ▅▒░☼‿☼░▒▅ ☁,","▓⚗_⚗▓","<:3 )~~~","(╯°□°）╯︵ ┻━┻","●▬▬▬▬๑۩۩๑▬▬▬▬▬●","(/)(Ö,,,,Ö)(/)","/)^3^(\\","( . Y . )","< )))) ><","(ノಠ益ಠ)ノ彡","d(^o^)b¸¸♬·¯·♩¸¸♪·¯·♫¸¸","O=('-'Q)","-`ღ´-","ˁ(⦿ᴥ⦿)ˀ","(╥﹏╥)","✲´*。.❄¨¯`*✲。❄。*。¨¯`*✲","▂▃▅▇█▓▒░۩۞۩        ۩۞۩░▒▓█▇▅▃▂","( •_•)O*¯`·.¸.·´¯`°Q(•_• )","┻━┻︵  (°□°)/ ︵ ┻━┻","|̲̲̲͡͡͡ ̲▫̲͡ ̲̲̲͡͡π̲̲͡͡ ̲̲͡▫̲̲͡͡ ̲|̡̡̡ ̡ ̴̡ı̴̡̡ ̡͌l̡ ̴̡ı̴̴̡ ̡l̡*̡̡ ̴̡ı̴̴̡ ̡̡͡|̲̲̲͡͡͡ ̲▫̲͡ ̲̲̲͡͡π̲̲͡͡ ̲̲͡▫̲̲͡͡ |","❤◦.¸¸.  ◦✿","ʕʘ̅͜ʘ̅ʔ","( ๏ Y ๏ )","ʕ•̫͡•ʕ*̫͡*ʕ•͓͡•ʔ-̫͡-ʕ•̫͡•ʔ*̫͡*ʔ-̫͡-ʔ","(っ◕‿◕)っ","❚█══█❚","─=≡Σ((( つ◕ل͜◕)つ","^ↀᴥↀ^","༼ つ ͡◕ Ѿ ͡◕ ༽つ","ᕦ(ò_óˇ)ᕤ","┬┴┬┴┤ ͜ʖ ͡°) ├┬┴┬┴","[̲̅$̲̅(̲̅5)̲̅$̲̅]","(ꈍ⌓ꈍ✿)","(๑•́ ₃ •̀๑) ♡","( • )( • )ԅ(≖⌣≖ԅ)","（。々°）","⊂(´･◡･⊂ )∘˚˳°","( ㅅ )","(ﾉ☉ヮ⚆)ﾉ ⌒*:･ﾟ✧","(－‸ლ)","(‿|‿)","(㇏(•̀ᵥᵥ•́)ノ)","ʚ✟⃛ɞ","(′ꈍωꈍ‵)","♚ ♛ ♜ ♝ ♞ ♟ ♔ ♕ ♖ ♗ ♘ ♙","(´ᴗ`)(´ᴗ`)","♥(´∀｀)","ฅ(˵●ﻌ●˵)ฅ"];if(g=l,u=s,this.yarnDataObject=t,this.startChapter=i,this.resourcesPath=r,this.finished=!1,this.scrollTextStyle="npc"===d,document.getElementById(g).innerHTML="<br/><font color='red'>🚥Press/Hold Z or 📱Double-click/Tap to advance</font><br/>",e.on("startedNode",(function(e){document.getElementById(g).innerHTML+="<br/><br/><font color='#581845'>📜 --- Loaded next node ---</font>",document.getElementById(g).innerHTML+=`<font color='${p[Math.floor(Math.random()*p.length)]}'>  ${h[Math.floor(Math.random()*h.length)]}</font>`,document.getElementById(g).innerHTML+="<br/><font color='CADETBLUE'>&ensp;&ensp;&ensp;Title: "+e.title+"</font>",e.tags.length>0&&e.tags[0].length>0&&(document.getElementById(g).innerHTML+="<br/><font color='deeppink'>&ensp;&ensp;&ensp;Tags: "+e.tags+"</font>")})),e.on("choiceMade",(function(e){this.scrollTextStyle?document.getElementById(g).innerHTML+="<br/><font color='fuchsia'>🐙Player chose: >"+e+"</font>":document.getElementById(g).innerHTML+=`<p class="story-playtest-bubble story-playtest-answer answer-post">${o.parse(e)}</p>`})),e.on("commandCall",(function(e){document.getElementById(g).innerHTML+=`<br/><font color='green'>🐣Command call:</font> <font color='red'>&lt;&lt;${e}&gt;&gt;</font>`})),this.scrollTextStyle||(e.on("textResult",(function(e){document.getElementById(g).innerHTML+=`<p class="story-playtest-bubble">${o.parse(e)}</p>`,document.getElementById(u).innerHTML='<span class="story-animated-dots"><p>.</p><p>.</p><p>.</p></span>',document.getElementById(u).className="story-playtest-bubble",document.getElementById(g).scrollTo({top:document.getElementById(g).scrollHeight,left:0,behavior:"smooth"})})),e.on("choiceUpdated",(function(e){document.getElementById(u).className="story-playtest-answer"}))),e.on("finished",(function(){n=!0,e.removeAllListeners()})),Array.isArray(t))a.load(t);else{if(!("nodes"in t))return;a.load(t.nodes)}this.loadYarnChapter(i),a.variables.data={},c.forEach((function(e){console.log(e),a.variables.set(e.key,e.value)}))},this.loadYarnChapter=e=>{n=!1,this.storyChapter=e,this.choices[this.storyChapter]=[],this.visitedChapters.push(e),c=a.run(e),d=self.goToNext(),r=d.text,this.changeTextScrollSpeed(100)},this.wasChoiceMade=(e,t=this.storyChapter)=>!!this.choices[t].includes(e),this.timesNodeWasVisited=e=>{let t=0;return this.visitedNodes.forEach((n,i)=>{n===e&&(t+=1)}),t},self.jsonCopy=e=>JSON.parse(JSON.stringify(e))}},uMdg:function(e,t,n){},wt9v:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="wt9v"}},[["e6Wu",1,2]]]);